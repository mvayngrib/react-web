var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();

















var _ReactEmitterSubscription=require('./EmitterSubscription');var _ReactEmitterSubscription2=_interopRequireDefault(_ReactEmitterSubscription);
var _ReactErrorUtils=require('../../Utilties/ErrorUitls.web');var _ReactErrorUtils2=_interopRequireDefault(_ReactErrorUtils);
var _ReactEventSubscriptionVendor=require('./EventSubscriptionVendor');var _ReactEventSubscriptionVendor2=_interopRequireDefault(_ReactEventSubscriptionVendor);
var _emptyFunction=require('fbjs/lib/emptyFunction');var _emptyFunction2=_interopRequireDefault(_emptyFunction);
var _invariant=require('fbjs/lib/invariant');var _invariant2=_interopRequireDefault(_invariant);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}var














EventEmitter=function(){



function EventEmitter(){_classCallCheck(this,EventEmitter);
this._subscriber=new _ReactEventSubscriptionVendor2.default();
}_createClass(EventEmitter,[{key:'addListener',value:function addListener(
















eventType,listener,context){
return this._subscriber.addSubscription(
eventType,
new _ReactEmitterSubscription2.default(this._subscriber,listener,context));
}},{key:'once',value:function once(











eventType,listener,context){
var emitter=this;
return this.addListener(eventType,function(){
emitter.removeCurrentListener();
listener.apply(context,arguments);
});
}},{key:'removeAllListeners',value:function removeAllListeners(








eventType){
this._subscriber.removeAllSubscriptions(eventType);
}},{key:'removeCurrentListener',value:function removeCurrentListener()






















{
(0,_invariant2.default)(
!!this._currentSubscription,
'Not in an emitting cycle; there is no current subscription');

this._subscriber.removeSubscription(this._currentSubscription);
}},{key:'listeners',value:function listeners(








eventType){
var subscriptions=this._subscriber.getSubscriptionsForType(eventType);
return subscriptions?
subscriptions.filter(_emptyFunction2.default.thatReturnsTrue).map(
function(subscription){
return subscription.listener;
}):
[];
}},{key:'emit',value:function emit(















eventType){
var subscriptions=this._subscriber.getSubscriptionsForType(eventType);
if(subscriptions){
var keys=Object.keys(subscriptions);
for(var ii=0;ii<keys.length;ii++){
var key=keys[ii];
var subscription=subscriptions[key];


if(subscription){
this._currentSubscription=subscription;

_ReactErrorUtils2.default.applyWithGuard(
subscription.listener,
subscription.context,
Array.prototype.slice.call(arguments,1),
null,
'EventEmitter:'+eventType);

}
}
this._currentSubscription=null;
}
}}]);return EventEmitter;}();


module.exports=EventEmitter;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkV2ZW50RW1pdHRlci5qcyJdLCJuYW1lcyI6WyJFdmVudEVtaXR0ZXIiLCJfc3Vic2NyaWJlciIsImV2ZW50VHlwZSIsImxpc3RlbmVyIiwiY29udGV4dCIsImFkZFN1YnNjcmlwdGlvbiIsImVtaXR0ZXIiLCJhZGRMaXN0ZW5lciIsInJlbW92ZUN1cnJlbnRMaXN0ZW5lciIsImFwcGx5IiwiYXJndW1lbnRzIiwicmVtb3ZlQWxsU3Vic2NyaXB0aW9ucyIsIl9jdXJyZW50U3Vic2NyaXB0aW9uIiwicmVtb3ZlU3Vic2NyaXB0aW9uIiwic3Vic2NyaXB0aW9ucyIsImdldFN1YnNjcmlwdGlvbnNGb3JUeXBlIiwiZmlsdGVyIiwidGhhdFJldHVybnNUcnVlIiwibWFwIiwic3Vic2NyaXB0aW9uIiwia2V5cyIsIk9iamVjdCIsImlpIiwibGVuZ3RoIiwia2V5IiwiYXBwbHlXaXRoR3VhcmQiLCJBcnJheSIsInByb3RvdHlwZSIsInNsaWNlIiwiY2FsbCIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWtCQSwrRDtBQUNBLDhEO0FBQ0EsdUU7QUFDQSxxRDtBQUNBLDZDOzs7Ozs7Ozs7Ozs7Ozs7QUFlTUEsWTs7OztBQUlKLHVCQUFjO0FBQ1osS0FBS0MsV0FBTCxDQUFtQiw0Q0FBbkI7QUFDRCxDOzs7Ozs7Ozs7Ozs7Ozs7OztBQWlCQ0MsUyxDQUFtQkMsUSxDQUFVQyxPLENBQXVDO0FBQ3BFLE1BQU8sTUFBS0gsV0FBTCxDQUFpQkksZUFBakI7QUFDTEgsU0FESztBQUVMLHVDQUF3QixLQUFLRCxXQUE3QixDQUEwQ0UsUUFBMUMsQ0FBb0RDLE9BQXBELENBRkssQ0FBUDtBQUdELEM7Ozs7Ozs7Ozs7OztBQVlJRixTLENBQW1CQyxRLENBQVVDLE8sQ0FBdUM7QUFDdkUsR0FBSUUsU0FBVSxJQUFkO0FBQ0EsTUFBTyxNQUFLQyxXQUFMLENBQWlCTCxTQUFqQixDQUE0QixVQUFXO0FBQzVDSSxRQUFRRSxxQkFBUjtBQUNBTCxTQUFTTSxLQUFULENBQWVMLE9BQWYsQ0FBd0JNLFNBQXhCO0FBQ0QsQ0FITSxDQUFQO0FBSUQsQzs7Ozs7Ozs7O0FBU2tCUixTLENBQW9CO0FBQ3JDLEtBQUtELFdBQUwsQ0FBaUJVLHNCQUFqQixDQUF3Q1QsU0FBeEM7QUFDRCxDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXVCdUI7QUFDdEI7QUFDRSxDQUFDLENBQUMsS0FBS1Usb0JBRFQ7QUFFRSw0REFGRjs7QUFJQSxLQUFLWCxXQUFMLENBQWlCWSxrQkFBakIsQ0FBb0MsS0FBS0Qsb0JBQXpDO0FBQ0QsQzs7Ozs7Ozs7O0FBU1NWLFMsQ0FBK0Q7QUFDdkUsR0FBSVksZUFBZ0IsS0FBS2IsV0FBTCxDQUFpQmMsdUJBQWpCLENBQXlDYixTQUF6QyxDQUFwQjtBQUNBLE1BQU9ZO0FBQ0hBLGNBQWNFLE1BQWQsQ0FBcUIsd0JBQWNDLGVBQW5DLEVBQW9EQyxHQUFwRDtBQUNFLFNBQVNDLFlBQVQsQ0FBdUI7QUFDckIsTUFBT0EsY0FBYWhCLFFBQXBCO0FBQ0QsQ0FISCxDQURHO0FBS0gsRUFMSjtBQU1ELEM7Ozs7Ozs7Ozs7Ozs7Ozs7QUFnQklELFMsQ0FBbUI7QUFDdEIsR0FBSVksZUFBZ0IsS0FBS2IsV0FBTCxDQUFpQmMsdUJBQWpCLENBQXlDYixTQUF6QyxDQUFwQjtBQUNBLEdBQUlZLGFBQUosQ0FBbUI7QUFDakIsR0FBSU0sTUFBT0MsT0FBT0QsSUFBUCxDQUFZTixhQUFaLENBQVg7QUFDQSxJQUFLLEdBQUlRLElBQUssQ0FBZCxDQUFpQkEsR0FBS0YsS0FBS0csTUFBM0IsQ0FBbUNELElBQW5DLENBQXlDO0FBQ3ZDLEdBQUlFLEtBQU1KLEtBQUtFLEVBQUwsQ0FBVjtBQUNBLEdBQUlILGNBQWVMLGNBQWNVLEdBQWQsQ0FBbkI7OztBQUdBLEdBQUlMLFlBQUosQ0FBa0I7QUFDaEIsS0FBS1Asb0JBQUwsQ0FBNEJPLFlBQTVCOztBQUVBLDBCQUFXTSxjQUFYO0FBQ0VOLGFBQWFoQixRQURmO0FBRUVnQixhQUFhZixPQUZmO0FBR0VzQixNQUFNQyxTQUFOLENBQWdCQyxLQUFoQixDQUFzQkMsSUFBdEIsQ0FBMkJuQixTQUEzQixDQUFzQyxDQUF0QyxDQUhGO0FBSUUsSUFKRjtBQUtFLGdCQUFrQlIsU0FMcEI7O0FBT0Q7QUFDRjtBQUNELEtBQUtVLG9CQUFMLENBQTRCLElBQTVCO0FBQ0Q7QUFDRixDOzs7QUFHSGtCLE9BQU9DLE9BQVAsQ0FBaUIvQixZQUFqQiIsImZpbGUiOiJFdmVudEVtaXR0ZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIEBnZW5lcmF0ZWQgU2lnbmVkU291cmNlPDw0OTRlNjZkZWE3MmEzZTkwYjc2M2E1ZWM1MGIxZTBjYT4+XG4gKlxuICogISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhIVxuICogISEgVGhpcyBmaWxlIGlzIGEgY2hlY2staW4gb2YgYSBzdGF0aWNfdXBzdHJlYW0gcHJvamVjdCEgICAgICAhIVxuICogISEgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhIVxuICogISEgWW91IHNob3VsZCBub3QgbW9kaWZ5IHRoaXMgZmlsZSBkaXJlY3RseS4gSW5zdGVhZDogICAgICAgICAhIVxuICogISEgMSkgVXNlIGBmanMgdXNlLXVwc3RyZWFtYCB0byB0ZW1wb3JhcmlseSByZXBsYWNlIHRoaXMgd2l0aCAhIVxuICogISEgICAgdGhlIGxhdGVzdCB2ZXJzaW9uIGZyb20gdXBzdHJlYW0uICAgICAgICAgICAgICAgICAgICAgICAhIVxuICogISEgMikgTWFrZSB5b3VyIGNoYW5nZXMsIHRlc3QgdGhlbSwgZXRjLiAgICAgICAgICAgICAgICAgICAgICAhIVxuICogISEgMykgVXNlIGBmanMgcHVzaC11cHN0cmVhbWAgdG8gY29weSB5b3VyIGNoYW5nZXMgYmFjayB0byAgICAhIVxuICogISEgICAgc3RhdGljX3Vwc3RyZWFtLiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAhIVxuICogISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhISEhIVxuICpcbiAqIEBwcm92aWRlc01vZHVsZSBFdmVudEVtaXR0ZXJcbiAqIEB0eXBlY2hlY2tzXG4gKi9cblxuaW1wb3J0IEVtaXR0ZXJTdWJzY3JpcHRpb24gZnJvbSAnUmVhY3RFbWl0dGVyU3Vic2NyaXB0aW9uJztcbmltcG9ydCBFcnJvclV0aWxzIGZyb20gJ1JlYWN0RXJyb3JVdGlscyc7XG5pbXBvcnQgRXZlbnRTdWJzY3JpcHRpb25WZW5kb3IgZnJvbSAnUmVhY3RFdmVudFN1YnNjcmlwdGlvblZlbmRvcic7XG5pbXBvcnQgZW1wdHlGdW5jdGlvbiBmcm9tICdmYmpzL2xpYi9lbXB0eUZ1bmN0aW9uJztcbmltcG9ydCBpbnZhcmlhbnQgZnJvbSAnZmJqcy9saWIvaW52YXJpYW50JztcblxuLyoqXG4gKiBAY2xhc3MgRXZlbnRFbWl0dGVyXG4gKiBAZGVzY3JpcHRpb25cbiAqIEFuIEV2ZW50RW1pdHRlciBpcyByZXNwb25zaWJsZSBmb3IgbWFuYWdpbmcgYSBzZXQgb2YgbGlzdGVuZXJzIGFuZCBwdWJsaXNoaW5nXG4gKiBldmVudHMgdG8gdGhlbSB3aGVuIGl0IGlzIHRvbGQgdGhhdCBzdWNoIGV2ZW50cyBoYXBwZW5lZC4gSW4gYWRkaXRpb24gdG8gdGhlXG4gKiBkYXRhIGZvciB0aGUgZ2l2ZW4gZXZlbnQgaXQgYWxzbyBzZW5kcyBhIGV2ZW50IGNvbnRyb2wgb2JqZWN0IHdoaWNoIGFsbG93c1xuICogdGhlIGxpc3RlbmVycy9oYW5kbGVycyB0byBwcmV2ZW50IHRoZSBkZWZhdWx0IGJlaGF2aW9yIG9mIHRoZSBnaXZlbiBldmVudC5cbiAqXG4gKiBUaGUgZW1pdHRlciBpcyBkZXNpZ25lZCB0byBiZSBnZW5lcmljIGVub3VnaCB0byBzdXBwb3J0IGFsbCB0aGUgZGlmZmVyZW50XG4gKiBjb250ZXh0cyBpbiB3aGljaCBvbmUgbWlnaHQgd2FudCB0byBlbWl0IGV2ZW50cy4gSXQgaXMgYSBzaW1wbGUgbXVsdGljYXN0XG4gKiBtZWNoYW5pc20gb24gdG9wIG9mIHdoaWNoIGV4dHJhIGZ1bmN0aW9uYWxpdHkgY2FuIGJlIGNvbXBvc2VkLiBGb3IgZXhhbXBsZSwgYVxuICogbW9yZSBhZHZhbmNlZCBlbWl0dGVyIG1heSB1c2UgYW4gRXZlbnRIb2xkZXIgYW5kIEV2ZW50RmFjdG9yeS5cbiAqL1xuY2xhc3MgRXZlbnRFbWl0dGVyIHtcbiAgLyoqXG4gICAqIEBjb25zdHJ1Y3RvclxuICAgKi9cbiAgY29uc3RydWN0b3IoKSB7XG4gICAgdGhpcy5fc3Vic2NyaWJlciA9IG5ldyBFdmVudFN1YnNjcmlwdGlvblZlbmRvcigpO1xuICB9XG5cbiAgLyoqXG4gICAqIEFkZHMgYSBsaXN0ZW5lciB0byBiZSBpbnZva2VkIHdoZW4gZXZlbnRzIG9mIHRoZSBzcGVjaWZpZWQgdHlwZSBhcmVcbiAgICogZW1pdHRlZC4gQW4gb3B0aW9uYWwgY2FsbGluZyBjb250ZXh0IG1heSBiZSBwcm92aWRlZC4gVGhlIGRhdGEgYXJndW1lbnRzXG4gICAqIGVtaXR0ZWQgd2lsbCBiZSBwYXNzZWQgdG8gdGhlIGxpc3RlbmVyIGZ1bmN0aW9uLlxuICAgKlxuICAgKiBUT0RPOiBBbm5vdGF0ZSB0aGUgbGlzdGVuZXIgYXJnJ3MgdHlwZS4gVGhpcyBpcyB0cmlja3kgYmVjYXVzZSBsaXN0ZW5lcnNcbiAgICogICAgICAgY2FuIGJlIGludm9rZWQgd2l0aCB2YXJhcmdzLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gZXZlbnRUeXBlIC0gTmFtZSBvZiB0aGUgZXZlbnQgdG8gbGlzdGVuIHRvXG4gICAqIEBwYXJhbSB7ZnVuY3Rpb259IGxpc3RlbmVyIC0gRnVuY3Rpb24gdG8gaW52b2tlIHdoZW4gdGhlIHNwZWNpZmllZCBldmVudCBpc1xuICAgKiAgIGVtaXR0ZWRcbiAgICogQHBhcmFtIHsqfSBjb250ZXh0IC0gT3B0aW9uYWwgY29udGV4dCBvYmplY3QgdG8gdXNlIHdoZW4gaW52b2tpbmcgdGhlXG4gICAqICAgbGlzdGVuZXJcbiAgICovXG4gIGFkZExpc3RlbmVyKFxuICAgIGV2ZW50VHlwZTogU3RyaW5nLCBsaXN0ZW5lciwgY29udGV4dDogP09iamVjdCk6IEVtaXR0ZXJTdWJzY3JpcHRpb24ge1xuICAgIHJldHVybiB0aGlzLl9zdWJzY3JpYmVyLmFkZFN1YnNjcmlwdGlvbihcbiAgICAgIGV2ZW50VHlwZSxcbiAgICAgIG5ldyBFbWl0dGVyU3Vic2NyaXB0aW9uKHRoaXMuX3N1YnNjcmliZXIsIGxpc3RlbmVyLCBjb250ZXh0KSk7XG4gIH1cblxuICAvKipcbiAgICogU2ltaWxhciB0byBhZGRMaXN0ZW5lciwgZXhjZXB0IHRoYXQgdGhlIGxpc3RlbmVyIGlzIHJlbW92ZWQgYWZ0ZXIgaXQgaXNcbiAgICogaW52b2tlZCBvbmNlLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gZXZlbnRUeXBlIC0gTmFtZSBvZiB0aGUgZXZlbnQgdG8gbGlzdGVuIHRvXG4gICAqIEBwYXJhbSB7ZnVuY3Rpb259IGxpc3RlbmVyIC0gRnVuY3Rpb24gdG8gaW52b2tlIG9ubHkgb25jZSB3aGVuIHRoZVxuICAgKiAgIHNwZWNpZmllZCBldmVudCBpcyBlbWl0dGVkXG4gICAqIEBwYXJhbSB7Kn0gY29udGV4dCAtIE9wdGlvbmFsIGNvbnRleHQgb2JqZWN0IHRvIHVzZSB3aGVuIGludm9raW5nIHRoZVxuICAgKiAgIGxpc3RlbmVyXG4gICAqL1xuICBvbmNlKGV2ZW50VHlwZTogU3RyaW5nLCBsaXN0ZW5lciwgY29udGV4dDogP09iamVjdCk6IEVtaXR0ZXJTdWJzY3JpcHRpb24ge1xuICAgIHZhciBlbWl0dGVyID0gdGhpcztcbiAgICByZXR1cm4gdGhpcy5hZGRMaXN0ZW5lcihldmVudFR5cGUsIGZ1bmN0aW9uKCkge1xuICAgICAgZW1pdHRlci5yZW1vdmVDdXJyZW50TGlzdGVuZXIoKTtcbiAgICAgIGxpc3RlbmVyLmFwcGx5KGNvbnRleHQsIGFyZ3VtZW50cyk7XG4gICAgfSk7XG4gIH1cblxuICAvKipcbiAgICogUmVtb3ZlcyBhbGwgb2YgdGhlIHJlZ2lzdGVyZWQgbGlzdGVuZXJzLCBpbmNsdWRpbmcgdGhvc2UgcmVnaXN0ZXJlZCBhc1xuICAgKiBsaXN0ZW5lciBtYXBzLlxuICAgKlxuICAgKiBAcGFyYW0gez9zdHJpbmd9IGV2ZW50VHlwZSAtIE9wdGlvbmFsIG5hbWUgb2YgdGhlIGV2ZW50IHdob3NlIHJlZ2lzdGVyZWRcbiAgICogICBsaXN0ZW5lcnMgdG8gcmVtb3ZlXG4gICAqL1xuICByZW1vdmVBbGxMaXN0ZW5lcnMoZXZlbnRUeXBlOiA/U3RyaW5nKSB7XG4gICAgdGhpcy5fc3Vic2NyaWJlci5yZW1vdmVBbGxTdWJzY3JpcHRpb25zKGV2ZW50VHlwZSk7XG4gIH1cblxuICAvKipcbiAgICogUHJvdmlkZXMgYW4gQVBJIHRoYXQgY2FuIGJlIGNhbGxlZCBkdXJpbmcgYW4gZXZlbnRpbmcgY3ljbGUgdG8gcmVtb3ZlIHRoZVxuICAgKiBsYXN0IGxpc3RlbmVyIHRoYXQgd2FzIGludm9rZWQuIFRoaXMgYWxsb3dzIGEgZGV2ZWxvcGVyIHRvIHByb3ZpZGUgYW4gZXZlbnRcbiAgICogb2JqZWN0IHRoYXQgY2FuIHJlbW92ZSB0aGUgbGlzdGVuZXIgKG9yIGxpc3RlbmVyIG1hcCkgZHVyaW5nIHRoZVxuICAgKiBpbnZvY2F0aW9uLlxuICAgKlxuICAgKiBJZiBpdCBpcyBjYWxsZWQgd2hlbiBub3QgaW5zaWRlIG9mIGFuIGVtaXR0aW5nIGN5Y2xlIGl0IHdpbGwgdGhyb3cuXG4gICAqXG4gICAqIEB0aHJvd3Mge0Vycm9yfSBXaGVuIGNhbGxlZCBub3QgZHVyaW5nIGFuIGV2ZW50aW5nIGN5Y2xlXG4gICAqXG4gICAqIEBleGFtcGxlXG4gICAqICAgdmFyIHN1YnNjcmlwdGlvbiA9IGVtaXR0ZXIuYWRkTGlzdGVuZXJNYXAoe1xuICAgKiAgICAgc29tZUV2ZW50OiBmdW5jdGlvbihkYXRhLCBldmVudCkge1xuICAgKiAgICAgICBjb25zb2xlLmxvZyhkYXRhKTtcbiAgICogICAgICAgZW1pdHRlci5yZW1vdmVDdXJyZW50TGlzdGVuZXIoKTtcbiAgICogICAgIH1cbiAgICogICB9KTtcbiAgICpcbiAgICogICBlbWl0dGVyLmVtaXQoJ3NvbWVFdmVudCcsICdhYmMnKTsgLy8gbG9ncyAnYWJjJ1xuICAgKiAgIGVtaXR0ZXIuZW1pdCgnc29tZUV2ZW50JywgJ2RlZicpOyAvLyBkb2VzIG5vdCBsb2cgYW55dGhpbmdcbiAgICovXG4gIHJlbW92ZUN1cnJlbnRMaXN0ZW5lcigpIHtcbiAgICBpbnZhcmlhbnQoXG4gICAgICAhIXRoaXMuX2N1cnJlbnRTdWJzY3JpcHRpb24sXG4gICAgICAnTm90IGluIGFuIGVtaXR0aW5nIGN5Y2xlOyB0aGVyZSBpcyBubyBjdXJyZW50IHN1YnNjcmlwdGlvbidcbiAgICApO1xuICAgIHRoaXMuX3N1YnNjcmliZXIucmVtb3ZlU3Vic2NyaXB0aW9uKHRoaXMuX2N1cnJlbnRTdWJzY3JpcHRpb24pO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgYW4gYXJyYXkgb2YgbGlzdGVuZXJzIHRoYXQgYXJlIGN1cnJlbnRseSByZWdpc3RlcmVkIGZvciB0aGUgZ2l2ZW5cbiAgICogZXZlbnQuXG4gICAqXG4gICAqIEBwYXJhbSB7c3RyaW5nfSBldmVudFR5cGUgLSBOYW1lIG9mIHRoZSBldmVudCB0byBxdWVyeVxuICAgKiBAcmV0dXJucyB7YXJyYXl9XG4gICAqL1xuICBsaXN0ZW5lcnMoZXZlbnRUeXBlOiBTdHJpbmcpOiBBcnJheSAvKiBUT0RPOiBBcnJheTxFdmVudFN1YnNjcmlwdGlvbj4gKi8ge1xuICAgIHZhciBzdWJzY3JpcHRpb25zID0gdGhpcy5fc3Vic2NyaWJlci5nZXRTdWJzY3JpcHRpb25zRm9yVHlwZShldmVudFR5cGUpO1xuICAgIHJldHVybiBzdWJzY3JpcHRpb25zXG4gICAgICA/IHN1YnNjcmlwdGlvbnMuZmlsdGVyKGVtcHR5RnVuY3Rpb24udGhhdFJldHVybnNUcnVlKS5tYXAoXG4gICAgICAgICAgZnVuY3Rpb24oc3Vic2NyaXB0aW9uKSB7XG4gICAgICAgICAgICByZXR1cm4gc3Vic2NyaXB0aW9uLmxpc3RlbmVyO1xuICAgICAgICAgIH0pXG4gICAgICA6IFtdO1xuICB9XG5cbiAgLyoqXG4gICAqIEVtaXRzIGFuIGV2ZW50IG9mIHRoZSBnaXZlbiB0eXBlIHdpdGggdGhlIGdpdmVuIGRhdGEuIEFsbCBoYW5kbGVycyBvZiB0aGF0XG4gICAqIHBhcnRpY3VsYXIgdHlwZSB3aWxsIGJlIG5vdGlmaWVkLlxuICAgKlxuICAgKiBAcGFyYW0ge3N0cmluZ30gZXZlbnRUeXBlIC0gTmFtZSBvZiB0aGUgZXZlbnQgdG8gZW1pdFxuICAgKiBAcGFyYW0gey4uLip9IEFyYml0cmFyeSBhcmd1bWVudHMgdG8gYmUgcGFzc2VkIHRvIGVhY2ggcmVnaXN0ZXJlZCBsaXN0ZW5lclxuICAgKlxuICAgKiBAZXhhbXBsZVxuICAgKiAgIGVtaXR0ZXIuYWRkTGlzdGVuZXIoJ3NvbWVFdmVudCcsIGZ1bmN0aW9uKG1lc3NhZ2UpIHtcbiAgICogICAgIGNvbnNvbGUubG9nKG1lc3NhZ2UpO1xuICAgKiAgIH0pO1xuICAgKlxuICAgKiAgIGVtaXR0ZXIuZW1pdCgnc29tZUV2ZW50JywgJ2FiYycpOyAvLyBsb2dzICdhYmMnXG4gICAqL1xuICBlbWl0KGV2ZW50VHlwZTogU3RyaW5nKSB7XG4gICAgdmFyIHN1YnNjcmlwdGlvbnMgPSB0aGlzLl9zdWJzY3JpYmVyLmdldFN1YnNjcmlwdGlvbnNGb3JUeXBlKGV2ZW50VHlwZSk7XG4gICAgaWYgKHN1YnNjcmlwdGlvbnMpIHtcbiAgICAgIHZhciBrZXlzID0gT2JqZWN0LmtleXMoc3Vic2NyaXB0aW9ucyk7XG4gICAgICBmb3IgKHZhciBpaSA9IDA7IGlpIDwga2V5cy5sZW5ndGg7IGlpKyspIHtcbiAgICAgICAgdmFyIGtleSA9IGtleXNbaWldO1xuICAgICAgICB2YXIgc3Vic2NyaXB0aW9uID0gc3Vic2NyaXB0aW9uc1trZXldO1xuXG4gICAgICAgIC8vIFRoZSBzdWJzY3JpcHRpb24gbWF5IGhhdmUgYmVlbiByZW1vdmVkIGR1cmluZyB0aGlzIGV2ZW50IGxvb3AuXG4gICAgICAgIGlmIChzdWJzY3JpcHRpb24pIHtcbiAgICAgICAgICB0aGlzLl9jdXJyZW50U3Vic2NyaXB0aW9uID0gc3Vic2NyaXB0aW9uO1xuXG4gICAgICAgICAgRXJyb3JVdGlscy5hcHBseVdpdGhHdWFyZChcbiAgICAgICAgICAgIHN1YnNjcmlwdGlvbi5saXN0ZW5lcixcbiAgICAgICAgICAgIHN1YnNjcmlwdGlvbi5jb250ZXh0LFxuICAgICAgICAgICAgQXJyYXkucHJvdG90eXBlLnNsaWNlLmNhbGwoYXJndW1lbnRzLCAxKSxcbiAgICAgICAgICAgIG51bGwsXG4gICAgICAgICAgICAnRXZlbnRFbWl0dGVyOicgKyBldmVudFR5cGVcbiAgICAgICAgICApO1xuICAgICAgICB9XG4gICAgICB9XG4gICAgICB0aGlzLl9jdXJyZW50U3Vic2NyaXB0aW9uID0gbnVsbDtcbiAgICB9XG4gIH1cbn1cblxubW9kdWxlLmV4cG9ydHMgPSBFdmVudEVtaXR0ZXI7XG4iXX0=