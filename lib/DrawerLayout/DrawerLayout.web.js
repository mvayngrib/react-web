





'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();

var _react=require('react');var _react2=_interopRequireDefault(_react);
var _ReactStyleSheet=require('../StyleSheet/StyleSheet.web');var _ReactStyleSheet2=_interopRequireDefault(_ReactStyleSheet);
var _ReactView=require('../View/View.web');var _ReactView2=_interopRequireDefault(_ReactView);
var _ReactAnimated=require('../Animated/Animated.web');var _ReactAnimated2=_interopRequireDefault(_ReactAnimated);
var _ReactPanResponder=require('../PanResponder/PanResponder.web');var _ReactPanResponder2=_interopRequireDefault(_ReactPanResponder);
var _ReactDimensions=require('../Dimensions/Dimensions.web');var _ReactDimensions2=_interopRequireDefault(_ReactDimensions);
var _NativeMethodsMixin=require('../Utilties/NativeMethodsMixin.web');
var _reactMixin=require('react-mixin');var _reactMixin2=_interopRequireDefault(_reactMixin);
var _autobindDecorator=require('autobind-decorator');var _autobindDecorator2=_interopRequireDefault(_autobindDecorator);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}

var DEVICE_WIDTH=parseFloat(_ReactDimensions2.default.get('window').width);
var THRESHOLD=DEVICE_WIDTH/2;
var VX_MAX=0.1;

var IDLE='Idle';
var DRAGGING='Dragging';
var SETTLING='Settling';var

DrawerLayout=function(_Component){_inherits(DrawerLayout,_Component);function DrawerLayout(){var _ref;var _temp,_this,_ret;_classCallCheck(this,DrawerLayout);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}return _ret=(_temp=(_this=_possibleConstructorReturn(this,(_ref=DrawerLayout.__proto__||Object.getPrototypeOf(DrawerLayout)).call.apply(_ref,[this].concat(args))),_this),_this.


























state={
openValue:new _ReactAnimated2.default.Value(0)},_temp),_possibleConstructorReturn(_this,_ret);}_createClass(DrawerLayout,[{key:'componentWillMount',value:function componentWillMount()


{var _this2=this;var
openValue=this.state.openValue;

openValue.addListener(function(_ref2){var value=_ref2.value;
_this2._lastOpenValue=value;
_this2.props.onDrawerSlide&&_this2.props.onDrawerSlide({nativeEvent:{offset:value}});
});

this._panResponder=_ReactPanResponder2.default.create({
onMoveShouldSetPanResponder:this._shouldSetPanResponder,
onPanResponderGrant:this._panResponderGrant,
onPanResponderMove:this._panResponderMove,
onPanResponderTerminationRequest:function onPanResponderTerminationRequest(evt,gestureState){return true;},
onPanResponderRelease:this._panResponderRelease,
onPanResponderTerminate:function onPanResponderTerminate(evt,gestureState){}});

}},{key:'render',value:function render()

{var
openValue=this.state.openValue;var _props=
this.props;var drawerPosition=_props.drawerPosition;var drawerWidth=_props.drawerWidth;
var dynamicDrawerStyles={};
dynamicDrawerStyles[drawerPosition]=0;
dynamicDrawerStyles.width=drawerWidth;


var outputRange=void 0;

if(drawerPosition==='left'){
outputRange=[-drawerWidth,0];
}else{
outputRange=[drawerWidth,0];
}

var drawerTranslateX=openValue.interpolate({
inputRange:[0,1],
outputRange:outputRange,
extrapolate:'clamp'});

var animatedDrawerStyles={transform:[{translateX:drawerTranslateX}]};




var overlayOpacity=openValue.interpolate({
inputRange:[0,1],
outputRange:[0,0.7],
extrapolate:'clamp'});

var animatedOverlayStyles={opacity:overlayOpacity};

return(
_react2.default.createElement(_ReactView2.default,_extends({style:{flex:1,backgroundColor:'transparent'}},this._panResponder.panHandlers),
_react2.default.createElement(_ReactAnimated2.default.View,{style:styles.main},
this.props.children),


_react2.default.createElement(_ReactAnimated2.default.View,{style:[styles.overlay,animatedOverlayStyles],onClick:this.close}),
_react2.default.createElement(_ReactAnimated2.default.View,{style:[styles.drawer,dynamicDrawerStyles,animatedDrawerStyles]},
this.props.renderNavigationView())));



}},{key:'_emitStateChanged',value:function _emitStateChanged(

newState){
this.props.onDrawerStateChanged&&this.props.onDrawerStateChanged(newState);
}},{key:'open',value:function open()

{var _this3=this;var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};
this._emitStateChanged(SETTLING);
_ReactAnimated2.default.spring(this.state.openValue,_extends({toValue:1,bounciness:0,restSpeedThreshold:0.1},options)).start(function(){
_this3.props.onDrawerOpen&&_this3.props.onDrawerOpen();
_this3._emitStateChanged(IDLE);
});
}},{key:'close',value:function close()

{var _this4=this;var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};
this._emitStateChanged(SETTLING);
_ReactAnimated2.default.spring(this.state.openValue,_extends({toValue:0,bounciness:0,restSpeedThreshold:1},options)).start(function(){
_this4.props.onDrawerClose&&_this4.props.onDrawerClose();
_this4._emitStateChanged(IDLE);
});
}},{key:'_handleDrawerOpen',value:function _handleDrawerOpen()

{
this.props.onDrawerOpen&&this.props.onDrawerOpen();
}},{key:'_handleDrawerClose',value:function _handleDrawerClose()

{
this.props.onDrawerClose&&this.props.onDrawerClose();
}},{key:'_shouldSetPanResponder',value:function _shouldSetPanResponder(

e,_ref3){var moveX=_ref3.moveX;var dx=_ref3.dx;var dy=_ref3.dy;var
drawerPosition=this.props.drawerPosition;

if(drawerPosition==='left'){
var overlayArea=DEVICE_WIDTH-(DEVICE_WIDTH-this.props.drawerWidth);

if(this._lastOpenValue===1){
if(dx<0&&Math.abs(dx)>Math.abs(dy)*3||moveX>overlayArea){
this._isClosing=true;
this._closingAnchorValue=this._getOpenValueForX(moveX);
return true;
}
}else{
if(moveX<=35&&dx>0){
this._isClosing=false;
return true;
}else{
return false;
}
}
}else{
var _overlayArea=DEVICE_WIDTH-this.props.drawerWidth;

if(this._lastOpenValue===1){
if(dx>0&&Math.abs(dx)>Math.abs(dy)*3||moveX<_overlayArea){
this._isClosing=true;
this._closingAnchorValue=this._getOpenValueForX(moveX);
return true;
}
}else{
if(moveX>=DEVICE_WIDTH-35&&dx<0){
this._isClosing=false;
return true;
}else{
return false;
}
}
}
}},{key:'_panResponderGrant',value:function _panResponderGrant()

{
this._emitStateChanged(DRAGGING);
}},{key:'_panResponderMove',value:function _panResponderMove(

e,_ref4){var moveX=_ref4.moveX;
var openValue=this._getOpenValueForX(moveX);

if(this._isClosing){
openValue=1-(this._closingAnchorValue-openValue);
}

if(openValue>1){
openValue=1;
}else if(openValue<0){
openValue=0;
}

this.state.openValue.setValue(openValue);
}},{key:'_panResponderRelease',value:function _panResponderRelease(

e,_ref5){var moveX=_ref5.moveX;var vx=_ref5.vx;var
drawerPosition=this.props.drawerPosition;

var previouslyOpen=this._isClosing;
var isWithinVelocityThreshold=vx<VX_MAX&&vx>-VX_MAX;

if(drawerPosition==='left'){
if(vx>0&&moveX>THRESHOLD||vx>=VX_MAX||isWithinVelocityThreshold&&previouslyOpen&&moveX>THRESHOLD){
this.open({velocity:vx});
}else if(vx<0&&moveX<THRESHOLD||vx<-VX_MAX||isWithinVelocityThreshold&&!previouslyOpen){
this.close({velocity:vx});
}else if(previouslyOpen){
this.open();
}else{
this.close();
}
}else{
if(vx<0&&moveX<THRESHOLD||vx<=-VX_MAX||isWithinVelocityThreshold&&previouslyOpen&&moveX<THRESHOLD){
this.open({velocity:-1*vx});
}else if(vx>0&&moveX>THRESHOLD||vx>VX_MAX||isWithinVelocityThreshold&&!previouslyOpen){
this.close({velocity:-1*vx});
}else if(previouslyOpen){
this.open();
}else{
this.close();
}
}
}},{key:'_getOpenValueForX',value:function _getOpenValueForX(

x){var _props2=
this.props;var drawerPosition=_props2.drawerPosition;var drawerWidth=_props2.drawerWidth;

if(drawerPosition==='left'){
return x/drawerWidth;
}else if(drawerPosition==='right'){
return(DEVICE_WIDTH-x)/drawerWidth;
}
}}]);return DrawerLayout;}(_react.Component);DrawerLayout.positions={Left:'left',Right:'right'};DrawerLayout.defaultProps={drawerWidth:0,drawerPosition:'left'};DrawerLayout.propTypes={drawerWidth:_react.PropTypes.number.isRequired,drawerPosition:_react.PropTypes.oneOf(['left','right']).isRequired,renderNavigationView:_react.PropTypes.func.isRequired,onDrawerSlide:_react.PropTypes.func,onDrawerStateChanged:_react.PropTypes.func,onDrawerOpen:_react.PropTypes.func,onDrawerClose:_react.PropTypes.func,keyboardDismissMode:_react.PropTypes.oneOf(['none','on-drag'])};


var styles=_ReactStyleSheet2.default.create({
drawer:{
position:'absolute',
top:0,
bottom:0},

main:{
flex:1},

overlay:{
backgroundColor:'#000',
position:'absolute',
top:0,
left:0,
bottom:0,
right:0}});




_reactMixin2.default.onClass(DrawerLayout,_NativeMethodsMixin.Mixin);
(0,_autobindDecorator2.default)(DrawerLayout);

DrawerLayout.isReactNativeComponent=true;exports.default=

DrawerLayout;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkRyYXdlckxheW91dC53ZWIuanMiXSwibmFtZXMiOlsiREVWSUNFX1dJRFRIIiwicGFyc2VGbG9hdCIsImdldCIsIndpZHRoIiwiVEhSRVNIT0xEIiwiVlhfTUFYIiwiSURMRSIsIkRSQUdHSU5HIiwiU0VUVExJTkciLCJEcmF3ZXJMYXlvdXQiLCJzdGF0ZSIsIm9wZW5WYWx1ZSIsIlZhbHVlIiwiYWRkTGlzdGVuZXIiLCJ2YWx1ZSIsIl9sYXN0T3BlblZhbHVlIiwicHJvcHMiLCJvbkRyYXdlclNsaWRlIiwibmF0aXZlRXZlbnQiLCJvZmZzZXQiLCJfcGFuUmVzcG9uZGVyIiwiY3JlYXRlIiwib25Nb3ZlU2hvdWxkU2V0UGFuUmVzcG9uZGVyIiwiX3Nob3VsZFNldFBhblJlc3BvbmRlciIsIm9uUGFuUmVzcG9uZGVyR3JhbnQiLCJfcGFuUmVzcG9uZGVyR3JhbnQiLCJvblBhblJlc3BvbmRlck1vdmUiLCJfcGFuUmVzcG9uZGVyTW92ZSIsIm9uUGFuUmVzcG9uZGVyVGVybWluYXRpb25SZXF1ZXN0IiwiZXZ0IiwiZ2VzdHVyZVN0YXRlIiwib25QYW5SZXNwb25kZXJSZWxlYXNlIiwiX3BhblJlc3BvbmRlclJlbGVhc2UiLCJvblBhblJlc3BvbmRlclRlcm1pbmF0ZSIsImRyYXdlclBvc2l0aW9uIiwiZHJhd2VyV2lkdGgiLCJkeW5hbWljRHJhd2VyU3R5bGVzIiwib3V0cHV0UmFuZ2UiLCJkcmF3ZXJUcmFuc2xhdGVYIiwiaW50ZXJwb2xhdGUiLCJpbnB1dFJhbmdlIiwiZXh0cmFwb2xhdGUiLCJhbmltYXRlZERyYXdlclN0eWxlcyIsInRyYW5zZm9ybSIsInRyYW5zbGF0ZVgiLCJvdmVybGF5T3BhY2l0eSIsImFuaW1hdGVkT3ZlcmxheVN0eWxlcyIsIm9wYWNpdHkiLCJmbGV4IiwiYmFja2dyb3VuZENvbG9yIiwicGFuSGFuZGxlcnMiLCJzdHlsZXMiLCJtYWluIiwiY2hpbGRyZW4iLCJvdmVybGF5IiwiY2xvc2UiLCJkcmF3ZXIiLCJyZW5kZXJOYXZpZ2F0aW9uVmlldyIsIm5ld1N0YXRlIiwib25EcmF3ZXJTdGF0ZUNoYW5nZWQiLCJvcHRpb25zIiwiX2VtaXRTdGF0ZUNoYW5nZWQiLCJzcHJpbmciLCJ0b1ZhbHVlIiwiYm91bmNpbmVzcyIsInJlc3RTcGVlZFRocmVzaG9sZCIsInN0YXJ0Iiwib25EcmF3ZXJPcGVuIiwib25EcmF3ZXJDbG9zZSIsImUiLCJtb3ZlWCIsImR4IiwiZHkiLCJvdmVybGF5QXJlYSIsIk1hdGgiLCJhYnMiLCJfaXNDbG9zaW5nIiwiX2Nsb3NpbmdBbmNob3JWYWx1ZSIsIl9nZXRPcGVuVmFsdWVGb3JYIiwic2V0VmFsdWUiLCJ2eCIsInByZXZpb3VzbHlPcGVuIiwiaXNXaXRoaW5WZWxvY2l0eVRocmVzaG9sZCIsIm9wZW4iLCJ2ZWxvY2l0eSIsIngiLCJwb3NpdGlvbnMiLCJMZWZ0IiwiUmlnaHQiLCJkZWZhdWx0UHJvcHMiLCJwcm9wVHlwZXMiLCJudW1iZXIiLCJpc1JlcXVpcmVkIiwib25lT2YiLCJmdW5jIiwia2V5Ym9hcmREaXNtaXNzTW9kZSIsInBvc2l0aW9uIiwidG9wIiwiYm90dG9tIiwibGVmdCIsInJpZ2h0Iiwib25DbGFzcyIsImlzUmVhY3ROYXRpdmVDb21wb25lbnQiXSwibWFwcGluZ3MiOiI7Ozs7OztBQU1BLGE7O0FBRUEsNEI7QUFDQSw2RDtBQUNBLDJDO0FBQ0EsdUQ7QUFDQSxtRTtBQUNBLDZEO0FBQ0E7QUFDQSx1QztBQUNBLHFEOztBQUVBLEdBQU1BLGNBQWVDLFdBQVcsMEJBQVdDLEdBQVgsQ0FBZSxRQUFmLEVBQXlCQyxLQUFwQyxDQUFyQjtBQUNBLEdBQU1DLFdBQVlKLGFBQWUsQ0FBakM7QUFDQSxHQUFNSyxRQUFTLEdBQWY7O0FBRUEsR0FBTUMsTUFBTyxNQUFiO0FBQ0EsR0FBTUMsVUFBVyxVQUFqQjtBQUNBLEdBQU1DLFVBQVcsVUFBakIsQzs7QUFFTUMsWTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBMkJKQyxLLENBQVE7QUFDTkMsVUFBVyxHQUFJLHlCQUFTQyxLQUFiLENB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Q2pCQyxLQUFNLE1BRFcsQ0FFakJDLE1BQU8sT0FGVSxDLENBRmYvRSxZLENBT0dnRixZLENBQWUsQ0FDcEJ0RCxZQUFhLENBRE8sQ0FFcEJELGVBQWdCLE1BRkksQyxDQVBsQnpCLFksQ0FZR2lGLFMsQ0FBWSxDQUNqQnZELFlBQWEsaUJBQVV3RCxNQUFWLENBQWlCQyxVQURiLENBRWpCMUQsZUFBZ0IsaUJBQVUyRCxLQUFWLENBQWdCLENBQUMsTUFBRCxDQUFTLE9BQVQsQ0FBaEIsRUFBbUNELFVBRmxDLENBR2pCbkMscUJBQXNCLGlCQUFVcUMsSUFBVixDQUFlRixVQUhwQixDQUtqQjNFLGNBQWUsaUJBQVU2RSxJQUxSLENBTWpCbkMscUJBQXNCLGlCQUFVbUMsSUFOZixDQVFqQjNCLGFBQWMsaUJBQVUyQixJQVJQLENBU2pCMUIsY0FBZSxpQkFBVTBCLElBVFIsQ0FZakJDLG9CQUFxQixpQkFBVUYsS0FBVixDQUFnQixDQUFDLE1BQUQsQ0FBUyxTQUFULENBQWhCLENBWkosQzs7O0FBb05yQixHQUFJMUMsUUFBUywwQkFBVzlCLE1BQVgsQ0FBa0I7QUFDN0JtQyxPQUFRO0FBQ053QyxTQUFVLFVBREo7QUFFTkMsSUFBSyxDQUZDO0FBR05DLE9BQVEsQ0FIRixDQURxQjs7QUFNN0I5QyxLQUFNO0FBQ0pKLEtBQU0sQ0FERixDQU51Qjs7QUFTN0JNLFFBQVM7QUFDUEwsZ0JBQWlCLE1BRFY7QUFFUCtDLFNBQVUsVUFGSDtBQUdQQyxJQUFLLENBSEU7QUFJUEUsS0FBTSxDQUpDO0FBS1BELE9BQVEsQ0FMRDtBQU1QRSxNQUFPLENBTkEsQ0FUb0IsQ0FBbEIsQ0FBYjs7Ozs7QUFvQkEscUJBQU1DLE9BQU4sQ0FBYzVGLFlBQWQ7QUFDQSxnQ0FBU0EsWUFBVDs7QUFFQUEsYUFBYTZGLHNCQUFiLENBQXNDLElBQXRDLEM7O0FBRWU3RixZIiwiZmlsZSI6IkRyYXdlckxheW91dC53ZWIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgMjAxNS1wcmVzZW50LCBBbGliYWJhIEdyb3VwIEhvbGRpbmcgTGltaXRlZC5cbiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKlxuICogQHByb3ZpZGVzTW9kdWxlIFJlYWN0RHJhd2VyTGF5b3V0XG4gKi9cbid1c2Ugc3RyaWN0JztcblxuaW1wb3J0IFJlYWN0LCB7IENvbXBvbmVudCwgUHJvcFR5cGVzIH0gZnJvbSAncmVhY3QnO1xuaW1wb3J0IFN0eWxlU2hlZXQgZnJvbSAnUmVhY3RTdHlsZVNoZWV0JztcbmltcG9ydCBWaWV3IGZyb20gJ1JlYWN0Vmlldyc7XG5pbXBvcnQgQW5pbWF0ZWQgZnJvbSAnUmVhY3RBbmltYXRlZCc7XG5pbXBvcnQgUGFuUmVzcG9uZGVyIGZyb20gJ1JlYWN0UGFuUmVzcG9uZGVyJztcbmltcG9ydCBEaW1lbnNpb25zIGZyb20gJ1JlYWN0RGltZW5zaW9ucyc7XG5pbXBvcnQgeyBNaXhpbiBhcyBOYXRpdmVNZXRob2RzTWl4aW4gfSBmcm9tICdOYXRpdmVNZXRob2RzTWl4aW4nO1xuaW1wb3J0IG1peGluIGZyb20gJ3JlYWN0LW1peGluJztcbmltcG9ydCBhdXRvYmluZCBmcm9tICdhdXRvYmluZC1kZWNvcmF0b3InO1xuXG5jb25zdCBERVZJQ0VfV0lEVEggPSBwYXJzZUZsb2F0KERpbWVuc2lvbnMuZ2V0KCd3aW5kb3cnKS53aWR0aCk7XG5jb25zdCBUSFJFU0hPTEQgPSBERVZJQ0VfV0lEVEggLyAyO1xuY29uc3QgVlhfTUFYID0gMC4xO1xuXG5jb25zdCBJRExFID0gJ0lkbGUnO1xuY29uc3QgRFJBR0dJTkcgPSAnRHJhZ2dpbmcnO1xuY29uc3QgU0VUVExJTkcgPSAnU2V0dGxpbmcnO1xuXG5jbGFzcyBEcmF3ZXJMYXlvdXQgZXh0ZW5kcyBDb21wb25lbnQge1xuXG4gIHN0YXRpYyBwb3NpdGlvbnMgPSB7XG4gICAgTGVmdDogJ2xlZnQnLFxuICAgIFJpZ2h0OiAncmlnaHQnXG4gIH1cblxuICBzdGF0aWMgZGVmYXVsdFByb3BzID0ge1xuICAgIGRyYXdlcldpZHRoOiAwLFxuICAgIGRyYXdlclBvc2l0aW9uOiAnbGVmdCcsXG4gIH1cblxuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgIGRyYXdlcldpZHRoOiBQcm9wVHlwZXMubnVtYmVyLmlzUmVxdWlyZWQsXG4gICAgZHJhd2VyUG9zaXRpb246IFByb3BUeXBlcy5vbmVPZihbJ2xlZnQnLCAncmlnaHQnXSkuaXNSZXF1aXJlZCxcbiAgICByZW5kZXJOYXZpZ2F0aW9uVmlldzogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcblxuICAgIG9uRHJhd2VyU2xpZGU6IFByb3BUeXBlcy5mdW5jLFxuICAgIG9uRHJhd2VyU3RhdGVDaGFuZ2VkOiBQcm9wVHlwZXMuZnVuYyxcblxuICAgIG9uRHJhd2VyT3BlbjogUHJvcFR5cGVzLmZ1bmMsXG4gICAgb25EcmF3ZXJDbG9zZTogUHJvcFR5cGVzLmZ1bmMsXG5cbiAgICAvKiBOb3QgaW1wbGVtZW50ZWQgKi9cbiAgICBrZXlib2FyZERpc21pc3NNb2RlOiBQcm9wVHlwZXMub25lT2YoWydub25lJywgJ29uLWRyYWcnXSksXG4gIH1cblxuICBzdGF0ZSA9IHtcbiAgICBvcGVuVmFsdWU6IG5ldyBBbmltYXRlZC5WYWx1ZSgwKSxcbiAgfVxuXG4gIGNvbXBvbmVudFdpbGxNb3VudCgpIHtcbiAgICBsZXQgeyBvcGVuVmFsdWUgfSA9IHRoaXMuc3RhdGU7XG5cbiAgICBvcGVuVmFsdWUuYWRkTGlzdGVuZXIoKHt2YWx1ZX0pID0+IHtcbiAgICAgIHRoaXMuX2xhc3RPcGVuVmFsdWUgPSB2YWx1ZTtcbiAgICAgIHRoaXMucHJvcHMub25EcmF3ZXJTbGlkZSAmJiB0aGlzLnByb3BzLm9uRHJhd2VyU2xpZGUoe25hdGl2ZUV2ZW50OiB7b2Zmc2V0OiB2YWx1ZX19KTtcbiAgICB9KTtcblxuICAgIHRoaXMuX3BhblJlc3BvbmRlciA9IFBhblJlc3BvbmRlci5jcmVhdGUoe1xuICAgICAgb25Nb3ZlU2hvdWxkU2V0UGFuUmVzcG9uZGVyOiB0aGlzLl9zaG91bGRTZXRQYW5SZXNwb25kZXIsXG4gICAgICBvblBhblJlc3BvbmRlckdyYW50OiB0aGlzLl9wYW5SZXNwb25kZXJHcmFudCxcbiAgICAgIG9uUGFuUmVzcG9uZGVyTW92ZTogdGhpcy5fcGFuUmVzcG9uZGVyTW92ZSxcbiAgICAgIG9uUGFuUmVzcG9uZGVyVGVybWluYXRpb25SZXF1ZXN0OiAoZXZ0LCBnZXN0dXJlU3RhdGUpID0+IHRydWUsXG4gICAgICBvblBhblJlc3BvbmRlclJlbGVhc2U6IHRoaXMuX3BhblJlc3BvbmRlclJlbGVhc2UsXG4gICAgICBvblBhblJlc3BvbmRlclRlcm1pbmF0ZTogKGV2dCwgZ2VzdHVyZVN0YXRlKSA9PiB7IH1cbiAgICB9KTtcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBsZXQgeyBvcGVuVmFsdWUgfSA9IHRoaXMuc3RhdGU7XG4gICAgbGV0IHsgZHJhd2VyUG9zaXRpb24sIGRyYXdlcldpZHRoIH0gPSB0aGlzLnByb3BzO1xuICAgIGxldCBkeW5hbWljRHJhd2VyU3R5bGVzID0ge307XG4gICAgZHluYW1pY0RyYXdlclN0eWxlc1tkcmF3ZXJQb3NpdGlvbl0gPSAwO1xuICAgIGR5bmFtaWNEcmF3ZXJTdHlsZXMud2lkdGggPSBkcmF3ZXJXaWR0aDtcblxuICAgIC8qIERyYXdlciBzdHlsZXMgKi9cbiAgICBsZXQgb3V0cHV0UmFuZ2U7XG5cbiAgICBpZiAoZHJhd2VyUG9zaXRpb24gPT09ICdsZWZ0Jykge1xuICAgICAgb3V0cHV0UmFuZ2UgPSBbLWRyYXdlcldpZHRoLCAwXTtcbiAgICB9IGVsc2Uge1xuICAgICAgb3V0cHV0UmFuZ2UgPSBbZHJhd2VyV2lkdGgsIDBdO1xuICAgIH1cblxuICAgIGxldCBkcmF3ZXJUcmFuc2xhdGVYID0gb3BlblZhbHVlLmludGVycG9sYXRlKHtcbiAgICAgIGlucHV0UmFuZ2U6IFswLCAxXSxcbiAgICAgIG91dHB1dFJhbmdlLFxuICAgICAgZXh0cmFwb2xhdGU6ICdjbGFtcCcsXG4gICAgfSk7XG4gICAgbGV0IGFuaW1hdGVkRHJhd2VyU3R5bGVzID0ge3RyYW5zZm9ybTogW3t0cmFuc2xhdGVYOiBkcmF3ZXJUcmFuc2xhdGVYfV19O1xuXG4gICAgLyogT3ZlcmxheSBzdHlsZXMgKi9cbiAgICAvLyBsZXQgb3BhY2l0eU91dHB1dFJhbmdlO1xuXG4gICAgbGV0IG92ZXJsYXlPcGFjaXR5ID0gb3BlblZhbHVlLmludGVycG9sYXRlKHtcbiAgICAgIGlucHV0UmFuZ2U6IFswLCAxXSxcbiAgICAgIG91dHB1dFJhbmdlOiBbMCwgMC43XSxcbiAgICAgIGV4dHJhcG9sYXRlOiAnY2xhbXAnLFxuICAgIH0pO1xuICAgIGxldCBhbmltYXRlZE92ZXJsYXlTdHlsZXMgPSB7b3BhY2l0eTogb3ZlcmxheU9wYWNpdHl9O1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxWaWV3IHN0eWxlPXt7ZmxleDogMSwgYmFja2dyb3VuZENvbG9yOiAndHJhbnNwYXJlbnQnfX0gey4uLnRoaXMuX3BhblJlc3BvbmRlci5wYW5IYW5kbGVyc30+XG4gICAgICAgIDxBbmltYXRlZC5WaWV3IHN0eWxlPXtzdHlsZXMubWFpbn0+XG4gICAgICAgICAge3RoaXMucHJvcHMuY2hpbGRyZW59XG4gICAgICAgIDwvQW5pbWF0ZWQuVmlldz5cblxuICAgICAgICA8QW5pbWF0ZWQuVmlldyBzdHlsZT17W3N0eWxlcy5vdmVybGF5LCBhbmltYXRlZE92ZXJsYXlTdHlsZXNdfSBvbkNsaWNrPXt0aGlzLmNsb3NlfSAvPlxuICAgICAgICA8QW5pbWF0ZWQuVmlldyBzdHlsZT17W3N0eWxlcy5kcmF3ZXIsIGR5bmFtaWNEcmF3ZXJTdHlsZXMsIGFuaW1hdGVkRHJhd2VyU3R5bGVzXX0+XG4gICAgICAgICAge3RoaXMucHJvcHMucmVuZGVyTmF2aWdhdGlvblZpZXcoKX1cbiAgICAgICAgPC9BbmltYXRlZC5WaWV3PlxuICAgICAgPC9WaWV3PlxuICAgICk7XG4gIH1cblxuICBfZW1pdFN0YXRlQ2hhbmdlZChuZXdTdGF0ZSkge1xuICAgIHRoaXMucHJvcHMub25EcmF3ZXJTdGF0ZUNoYW5nZWQgJiYgdGhpcy5wcm9wcy5vbkRyYXdlclN0YXRlQ2hhbmdlZChuZXdTdGF0ZSk7XG4gIH1cblxuICBvcGVuKG9wdGlvbnMgPSB7fSkge1xuICAgIHRoaXMuX2VtaXRTdGF0ZUNoYW5nZWQoU0VUVExJTkcpO1xuICAgIEFuaW1hdGVkLnNwcmluZyh0aGlzLnN0YXRlLm9wZW5WYWx1ZSwge3RvVmFsdWU6IDEsIGJvdW5jaW5lc3M6IDAsIHJlc3RTcGVlZFRocmVzaG9sZDogMC4xLCAuLi5vcHRpb25zfSkuc3RhcnQoKCkgPT4ge1xuICAgICAgdGhpcy5wcm9wcy5vbkRyYXdlck9wZW4gJiYgdGhpcy5wcm9wcy5vbkRyYXdlck9wZW4oKTtcbiAgICAgIHRoaXMuX2VtaXRTdGF0ZUNoYW5nZWQoSURMRSk7XG4gICAgfSk7XG4gIH1cblxuICBjbG9zZShvcHRpb25zID0ge30pIHtcbiAgICB0aGlzLl9lbWl0U3RhdGVDaGFuZ2VkKFNFVFRMSU5HKTtcbiAgICBBbmltYXRlZC5zcHJpbmcodGhpcy5zdGF0ZS5vcGVuVmFsdWUsIHt0b1ZhbHVlOiAwLCBib3VuY2luZXNzOiAwLCByZXN0U3BlZWRUaHJlc2hvbGQ6IDEsIC4uLm9wdGlvbnN9KS5zdGFydCgoKSA9PiB7XG4gICAgICB0aGlzLnByb3BzLm9uRHJhd2VyQ2xvc2UgJiYgdGhpcy5wcm9wcy5vbkRyYXdlckNsb3NlKCk7XG4gICAgICB0aGlzLl9lbWl0U3RhdGVDaGFuZ2VkKElETEUpO1xuICAgIH0pO1xuICB9XG5cbiAgX2hhbmRsZURyYXdlck9wZW4oKSB7XG4gICAgdGhpcy5wcm9wcy5vbkRyYXdlck9wZW4gJiYgdGhpcy5wcm9wcy5vbkRyYXdlck9wZW4oKTtcbiAgfVxuXG4gIF9oYW5kbGVEcmF3ZXJDbG9zZSgpIHtcbiAgICB0aGlzLnByb3BzLm9uRHJhd2VyQ2xvc2UgJiYgdGhpcy5wcm9wcy5vbkRyYXdlckNsb3NlKCk7XG4gIH1cblxuICBfc2hvdWxkU2V0UGFuUmVzcG9uZGVyKGUsIHttb3ZlWCwgZHgsIGR5fSkge1xuICAgIGxldCB7IGRyYXdlclBvc2l0aW9uIH0gPSB0aGlzLnByb3BzO1xuXG4gICAgaWYgKGRyYXdlclBvc2l0aW9uID09PSAnbGVmdCcpIHtcbiAgICAgIGxldCBvdmVybGF5QXJlYSA9IERFVklDRV9XSURUSCAtIChERVZJQ0VfV0lEVEggLSB0aGlzLnByb3BzLmRyYXdlcldpZHRoKTtcblxuICAgICAgaWYgKHRoaXMuX2xhc3RPcGVuVmFsdWUgPT09IDEpIHtcbiAgICAgICAgaWYgKChkeCA8IDAgJiYgKE1hdGguYWJzKGR4KSA+IChNYXRoLmFicyhkeSkgKiAzKSkpIHx8IChtb3ZlWCA+IG92ZXJsYXlBcmVhKSkge1xuICAgICAgICAgIHRoaXMuX2lzQ2xvc2luZyA9IHRydWU7XG4gICAgICAgICAgdGhpcy5fY2xvc2luZ0FuY2hvclZhbHVlID0gdGhpcy5fZ2V0T3BlblZhbHVlRm9yWChtb3ZlWCk7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChtb3ZlWCA8PSAzNSAmJiBkeCA+IDApIHtcbiAgICAgICAgICB0aGlzLl9pc0Nsb3NpbmcgPSBmYWxzZTtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgbGV0IG92ZXJsYXlBcmVhID0gREVWSUNFX1dJRFRIIC0gdGhpcy5wcm9wcy5kcmF3ZXJXaWR0aDtcblxuICAgICAgaWYgKHRoaXMuX2xhc3RPcGVuVmFsdWUgPT09IDEpIHtcbiAgICAgICAgaWYgKChkeCA+IDAgJiYgKE1hdGguYWJzKGR4KSA+IChNYXRoLmFicyhkeSkgKiAzKSkpIHx8IChtb3ZlWCA8IG92ZXJsYXlBcmVhKSkge1xuICAgICAgICAgIHRoaXMuX2lzQ2xvc2luZyA9IHRydWU7XG4gICAgICAgICAgdGhpcy5fY2xvc2luZ0FuY2hvclZhbHVlID0gdGhpcy5fZ2V0T3BlblZhbHVlRm9yWChtb3ZlWCk7XG4gICAgICAgICAgcmV0dXJuIHRydWU7XG4gICAgICAgIH1cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIGlmIChtb3ZlWCA+PSBERVZJQ0VfV0lEVEggLSAzNSAmJiBkeCA8IDApIHtcbiAgICAgICAgICB0aGlzLl9pc0Nsb3NpbmcgPSBmYWxzZTtcbiAgICAgICAgICByZXR1cm4gdHJ1ZTtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBfcGFuUmVzcG9uZGVyR3JhbnQoKSB7XG4gICAgdGhpcy5fZW1pdFN0YXRlQ2hhbmdlZChEUkFHR0lORyk7XG4gIH1cblxuICBfcGFuUmVzcG9uZGVyTW92ZShlLCB7bW92ZVh9KSB7XG4gICAgbGV0IG9wZW5WYWx1ZSA9IHRoaXMuX2dldE9wZW5WYWx1ZUZvclgobW92ZVgpO1xuXG4gICAgaWYgKHRoaXMuX2lzQ2xvc2luZykge1xuICAgICAgb3BlblZhbHVlID0gMSAtICh0aGlzLl9jbG9zaW5nQW5jaG9yVmFsdWUgLSBvcGVuVmFsdWUpO1xuICAgIH1cblxuICAgIGlmIChvcGVuVmFsdWUgPiAxKSB7XG4gICAgICBvcGVuVmFsdWUgPSAxO1xuICAgIH0gZWxzZSBpZiAob3BlblZhbHVlIDwgMCkge1xuICAgICAgb3BlblZhbHVlID0gMDtcbiAgICB9XG5cbiAgICB0aGlzLnN0YXRlLm9wZW5WYWx1ZS5zZXRWYWx1ZShvcGVuVmFsdWUpO1xuICB9XG5cbiAgX3BhblJlc3BvbmRlclJlbGVhc2UoZSwge21vdmVYLCB2eH0pIHtcbiAgICBsZXQgeyBkcmF3ZXJQb3NpdGlvbiB9ID0gdGhpcy5wcm9wcztcbiAgICAvLyBsZXQgeyBvcGVuVmFsdWUgfSA9IHRoaXMuc3RhdGU7XG4gICAgbGV0IHByZXZpb3VzbHlPcGVuID0gdGhpcy5faXNDbG9zaW5nO1xuICAgIGxldCBpc1dpdGhpblZlbG9jaXR5VGhyZXNob2xkID0gdnggPCBWWF9NQVggJiYgdnggPiAtVlhfTUFYO1xuXG4gICAgaWYgKGRyYXdlclBvc2l0aW9uID09PSAnbGVmdCcpIHtcbiAgICAgIGlmICgodnggPiAwICYmIG1vdmVYID4gVEhSRVNIT0xEKSB8fCAodnggPj0gVlhfTUFYKSB8fCBpc1dpdGhpblZlbG9jaXR5VGhyZXNob2xkICYmIHByZXZpb3VzbHlPcGVuICYmIG1vdmVYID4gVEhSRVNIT0xEKSB7XG4gICAgICAgIHRoaXMub3Blbih7dmVsb2NpdHk6IHZ4fSk7XG4gICAgICB9IGVsc2UgaWYgKCh2eCA8IDAgJiYgbW92ZVggPCBUSFJFU0hPTEQpIHx8ICh2eCA8IC1WWF9NQVgpIHx8IGlzV2l0aGluVmVsb2NpdHlUaHJlc2hvbGQgJiYgIXByZXZpb3VzbHlPcGVuKSB7XG4gICAgICAgIHRoaXMuY2xvc2Uoe3ZlbG9jaXR5OiB2eH0pO1xuICAgICAgfSBlbHNlIGlmIChwcmV2aW91c2x5T3Blbikge1xuICAgICAgICB0aGlzLm9wZW4oKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKCh2eCA8IDAgJiYgbW92ZVggPCBUSFJFU0hPTEQpIHx8ICh2eCA8PSAtVlhfTUFYKSB8fCBpc1dpdGhpblZlbG9jaXR5VGhyZXNob2xkICYmIHByZXZpb3VzbHlPcGVuICYmIG1vdmVYIDwgVEhSRVNIT0xEKSB7XG4gICAgICAgIHRoaXMub3Blbih7dmVsb2NpdHk6IC0xICogdnh9KTtcbiAgICAgIH0gZWxzZSBpZiAoKHZ4ID4gMCAmJiBtb3ZlWCA+IFRIUkVTSE9MRCkgfHwgKHZ4ID4gVlhfTUFYKSB8fCBpc1dpdGhpblZlbG9jaXR5VGhyZXNob2xkICYmICFwcmV2aW91c2x5T3Blbikge1xuICAgICAgICB0aGlzLmNsb3NlKHt2ZWxvY2l0eTogLTEgKiB2eH0pO1xuICAgICAgfSBlbHNlIGlmIChwcmV2aW91c2x5T3Blbikge1xuICAgICAgICB0aGlzLm9wZW4oKTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHRoaXMuY2xvc2UoKTtcbiAgICAgIH1cbiAgICB9XG4gIH1cblxuICBfZ2V0T3BlblZhbHVlRm9yWCh4KSB7XG4gICAgbGV0IHsgZHJhd2VyUG9zaXRpb24sIGRyYXdlcldpZHRoIH0gPSB0aGlzLnByb3BzO1xuXG4gICAgaWYgKGRyYXdlclBvc2l0aW9uID09PSAnbGVmdCcpIHtcbiAgICAgIHJldHVybiB4IC8gZHJhd2VyV2lkdGg7XG4gICAgfSBlbHNlIGlmIChkcmF3ZXJQb3NpdGlvbiA9PT0gJ3JpZ2h0Jykge1xuICAgICAgcmV0dXJuIChERVZJQ0VfV0lEVEggLSB4KSAvIGRyYXdlcldpZHRoO1xuICAgIH1cbiAgfVxufVxuXG5sZXQgc3R5bGVzID0gU3R5bGVTaGVldC5jcmVhdGUoe1xuICBkcmF3ZXI6IHtcbiAgICBwb3NpdGlvbjogJ2Fic29sdXRlJyxcbiAgICB0b3A6IDAsXG4gICAgYm90dG9tOiAwLFxuICB9LFxuICBtYWluOiB7XG4gICAgZmxleDogMSxcbiAgfSxcbiAgb3ZlcmxheToge1xuICAgIGJhY2tncm91bmRDb2xvcjogJyMwMDAnLFxuICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLFxuICAgIHRvcDogMCxcbiAgICBsZWZ0OiAwLFxuICAgIGJvdHRvbTogMCxcbiAgICByaWdodDogMCxcbiAgfSxcbn0pO1xuXG5cbm1peGluLm9uQ2xhc3MoRHJhd2VyTGF5b3V0LCBOYXRpdmVNZXRob2RzTWl4aW4pO1xuYXV0b2JpbmQoRHJhd2VyTGF5b3V0KTtcblxuRHJhd2VyTGF5b3V0LmlzUmVhY3ROYXRpdmVDb21wb25lbnQgPSB0cnVlO1xuXG5leHBvcnQgZGVmYXVsdCBEcmF3ZXJMYXlvdXQ7XG4iXX0=