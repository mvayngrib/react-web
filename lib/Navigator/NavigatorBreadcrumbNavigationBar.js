








'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();

var _react=require('react');var _react2=_interopRequireDefault(_react);
var _ReactNavigatorBreadcrumbNavigationBarStyles=require('./NavigatorBreadcrumbNavigationBarStyles.web');var _ReactNavigatorBreadcrumbNavigationBarStyles2=_interopRequireDefault(_ReactNavigatorBreadcrumbNavigationBarStyles);
var _ReactNavigatorNavigationBarStylesAndroid=require('./NavigatorNavigationBarStylesAndroid');var _ReactNavigatorNavigationBarStylesAndroid2=_interopRequireDefault(_ReactNavigatorNavigationBarStylesAndroid);
var _ReactNavigatorNavigationBarStylesIOS=require('./NavigatorNavigationBarStylesIOS');var _ReactNavigatorNavigationBarStylesIOS2=_interopRequireDefault(_ReactNavigatorNavigationBarStylesIOS);
var _ReactPlatform=require('../Platform/Platform.web');var _ReactPlatform2=_interopRequireDefault(_ReactPlatform);
var _ReactStyleSheet=require('../StyleSheet/StyleSheet.web');var _ReactStyleSheet2=_interopRequireDefault(_ReactStyleSheet);
var _ReactView=require('../View/View.web');var _ReactView2=_interopRequireDefault(_ReactView);
var _immutable=require('immutable');
var _invariant=require('fbjs/lib/invariant');var _invariant2=_interopRequireDefault(_invariant);
var _autobindDecorator=require('autobind-decorator');var _autobindDecorator2=_interopRequireDefault(_autobindDecorator);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}

var Interpolators=_ReactNavigatorBreadcrumbNavigationBarStyles2.default.Interpolators;
var NavigatorNavigationBarStyles=_ReactPlatform2.default.OS==='android'?_ReactNavigatorNavigationBarStylesAndroid2.default:_ReactNavigatorNavigationBarStylesIOS2.default;





var CRUMB_PROPS=Interpolators.map(function(){return{style:{}};});
var ICON_PROPS=Interpolators.map(function(){return{style:{}};});
var SEPARATOR_PROPS=Interpolators.map(function(){return{style:{}};});
var TITLE_PROPS=Interpolators.map(function(){return{style:{}};});
var RIGHT_BUTTON_PROPS=Interpolators.map(function(){return{style:{}};});


var navStatePresentedIndex=function navStatePresentedIndex(navState){
if(navState.presentedIndex!==undefined){
return navState.presentedIndex;
}

return navState.observedTopOfStack;
};









var initStyle=function initStyle(index,presentedIndex){
return index===presentedIndex?_ReactNavigatorBreadcrumbNavigationBarStyles2.default.Center[index]:
index<presentedIndex?_ReactNavigatorBreadcrumbNavigationBarStyles2.default.Left[index]:
_ReactNavigatorBreadcrumbNavigationBarStyles2.default.Right[index];
};var

NavigatorBreadcrumbNavigationBar=function(_Component){_inherits(NavigatorBreadcrumbNavigationBar,_Component);function NavigatorBreadcrumbNavigationBar(){_classCallCheck(this,NavigatorBreadcrumbNavigationBar);return _possibleConstructorReturn(this,(NavigatorBreadcrumbNavigationBar.__proto__||Object.getPrototypeOf(NavigatorBreadcrumbNavigationBar)).apply(this,arguments));}_createClass(NavigatorBreadcrumbNavigationBar,[{key:'_updateIndexProgress',value:function _updateIndexProgress(
























progress,index,fromIndex,toIndex){
var amount=toIndex>fromIndex?progress:1-progress;
var oldDistToCenter=index-fromIndex;
var newDistToCenter=index-toIndex;
var interpolate;
(0,_invariant2.default)(
Interpolators[index],
'Cannot find breadcrumb interpolators for '+index);

if(oldDistToCenter>0&&newDistToCenter===0||
newDistToCenter>0&&oldDistToCenter===0){
interpolate=Interpolators[index].RightToCenter;
}else if(oldDistToCenter<0&&newDistToCenter===0||
newDistToCenter<0&&oldDistToCenter===0){
interpolate=Interpolators[index].CenterToLeft;
}else if(oldDistToCenter===newDistToCenter){
interpolate=Interpolators[index].RightToCenter;
}else{
interpolate=Interpolators[index].RightToLeft;
}

if(interpolate.Crumb(CRUMB_PROPS[index].style,amount)){
this._setPropsIfExists('crumb_'+index,CRUMB_PROPS[index]);
}
if(interpolate.Icon(ICON_PROPS[index].style,amount)){
this._setPropsIfExists('icon_'+index,ICON_PROPS[index]);
}
if(interpolate.Separator(SEPARATOR_PROPS[index].style,amount)){
this._setPropsIfExists('separator_'+index,SEPARATOR_PROPS[index]);
}
if(interpolate.Title(TITLE_PROPS[index].style,amount)){
this._setPropsIfExists('title_'+index,TITLE_PROPS[index]);
}
var right=this.refs['right_'+index];
if(right&&
interpolate.RightItem(RIGHT_BUTTON_PROPS[index].style,amount)){
right.setNativeProps(RIGHT_BUTTON_PROPS[index]);
}
}},{key:'updateProgress',value:function updateProgress(

progress,fromIndex,toIndex){
var max=Math.max(fromIndex,toIndex);
var min=Math.min(fromIndex,toIndex);
for(var index=min;index<=max;index++){
this._updateIndexProgress(progress,index,fromIndex,toIndex);
}
}},{key:'onAnimationStart',value:function onAnimationStart(

fromIndex,toIndex){
var max=Math.max(fromIndex,toIndex);
var min=Math.min(fromIndex,toIndex);
for(var index=min;index<=max;index++){
this._setRenderViewsToHardwareTextureAndroid(index,true);
}
}},{key:'onAnimationEnd',value:function onAnimationEnd()

{
var max=this.props.navState.routeStack.length-1;
for(var index=0;index<=max;index++){
this._setRenderViewsToHardwareTextureAndroid(index,false);
}
}},{key:'_setRenderViewsToHardwareTextureAndroid',value:function _setRenderViewsToHardwareTextureAndroid(

index,renderToHardwareTexture){
var props={
renderToHardwareTextureAndroid:renderToHardwareTexture};


this._setPropsIfExists('icon_'+index,props);
this._setPropsIfExists('separator_'+index,props);
this._setPropsIfExists('title_'+index,props);
this._setPropsIfExists('right_'+index,props);
}},{key:'componentWillMount',value:function componentWillMount()

{
this._descriptors={
crumb:new _immutable.Map(),
title:new _immutable.Map(),
right:new _immutable.Map()};

}},{key:'render',value:function render()

{
var navState=this.props.navState;
var icons=navState&&navState.routeStack.map(this._getBreadcrumb);
var titles=navState.routeStack.map(this._getTitle);
var buttons=navState.routeStack.map(this._getRightButton);
return(
_react2.default.createElement(_ReactView2.default,{style:[styles.breadCrumbContainer,this.props.style]},
titles,
icons,
buttons));


}},{key:'_getBreadcrumb',value:function _getBreadcrumb(

route,index){
if(this._descriptors.crumb.has(route)){
return this._descriptors.crumb.get(route);
}

var navBarRouteMapper=this.props.routeMapper;
var firstStyles=initStyle(index,navStatePresentedIndex(this.props.navState));

var breadcrumbDescriptor=
_react2.default.createElement(_ReactView2.default,{ref:'crumb_'+index,style:firstStyles.Crumb},
_react2.default.createElement(_ReactView2.default,{ref:'icon_'+index,style:firstStyles.Icon},
navBarRouteMapper.iconForRoute(route,this.props.navigator)),

_react2.default.createElement(_ReactView2.default,{ref:'separator_'+index,style:firstStyles.Separator},
navBarRouteMapper.separatorForRoute(route,this.props.navigator)));




this._descriptors.crumb=this._descriptors.crumb.set(route,breadcrumbDescriptor);
return breadcrumbDescriptor;
}},{key:'_getTitle',value:function _getTitle(

route,index){
if(this._descriptors.title.has(route)){
return this._descriptors.title.get(route);
}

var titleContent=this.props.routeMapper.titleContentForRoute(
this.props.navState.routeStack[index],
this.props.navigator);

var firstStyles=initStyle(index,navStatePresentedIndex(this.props.navState));

var titleDescriptor=
_react2.default.createElement(_ReactView2.default,{ref:'title_'+index,style:firstStyles.Title},
titleContent);


this._descriptors.title=this._descriptors.title.set(route,titleDescriptor);
return titleDescriptor;
}},{key:'_getRightButton',value:function _getRightButton(

route,index){
if(this._descriptors.right.has(route)){
return this._descriptors.right.get(route);
}
var rightContent=this.props.routeMapper.rightContentForRoute(
this.props.navState.routeStack[index],
this.props.navigator);

if(!rightContent){
this._descriptors.right=this._descriptors.right.set(route,null);
return null;
}
var firstStyles=initStyle(index,navStatePresentedIndex(this.props.navState));
var rightButtonDescriptor=
_react2.default.createElement(_ReactView2.default,{ref:'right_'+index,style:firstStyles.RightItem},
rightContent);


this._descriptors.right=this._descriptors.right.set(route,rightButtonDescriptor);
return rightButtonDescriptor;
}},{key:'_setPropsIfExists',value:function _setPropsIfExists(

ref,props){
var ref=this.refs[ref];
ref&&ref.setNativeProps(props);
}}]);return NavigatorBreadcrumbNavigationBar;}(_react.Component);NavigatorBreadcrumbNavigationBar.propTypes={navigator:_react.PropTypes.shape({push:_react.PropTypes.func,pop:_react.PropTypes.func,replace:_react.PropTypes.func,popToRoute:_react.PropTypes.func,popToTop:_react.PropTypes.func}),routeMapper:_react.PropTypes.shape({rightContentForRoute:_react.PropTypes.func,titleContentForRoute:_react.PropTypes.func,iconForRoute:_react.PropTypes.func}),navState:_react2.default.PropTypes.shape({routeStack:_react2.default.PropTypes.arrayOf(_react2.default.PropTypes.object),presentedIndex:_react2.default.PropTypes.number}),style:_ReactView2.default.propTypes.style};NavigatorBreadcrumbNavigationBar.statics={Styles:_ReactNavigatorBreadcrumbNavigationBarStyles2.default};

;

var styles=_ReactStyleSheet2.default.create({
breadCrumbContainer:{
overflow:'hidden',
position:'absolute',
height:NavigatorNavigationBarStyles.General.TotalNavHeight,
top:0,
left:0,
right:0}});



(0,_autobindDecorator2.default)(NavigatorBreadcrumbNavigationBar);

module.exports=NavigatorBreadcrumbNavigationBar;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIk5hdmlnYXRvckJyZWFkY3J1bWJOYXZpZ2F0aW9uQmFyLmpzIl0sIm5hbWVzIjpbIkludGVycG9sYXRvcnMiLCJOYXZpZ2F0b3JOYXZpZ2F0aW9uQmFyU3R5bGVzIiwiT1MiLCJDUlVNQl9QUk9QUyIsIm1hcCIsInN0eWxlIiwiSUNPTl9QUk9QUyIsIlNFUEFSQVRPUl9QUk9QUyIsIlRJVExFX1BST1BTIiwiUklHSFRfQlVUVE9OX1BST1BTIiwibmF2U3RhdGVQcmVzZW50ZWRJbmRleCIsIm5hdlN0YXRlIiwicHJlc2VudGVkSW5kZXgiLCJ1bmRlZmluZWQiLCJvYnNlcnZlZFRvcE9mU3RhY2siLCJpbml0U3R5bGUiLCJpbmRleCIsIkNlbnRlciIsIkxlZnQiLCJSaWdodCIsIk5hdmlnYXRvckJyZWFkY3J1bWJOYXZpZ2F0aW9uQmFyIiwicHJvZ3Jlc3MiLCJmcm9tSW5kZXgiLCJ0b0luZGV4IiwiYW1vdW50Iiwib2xkRGlzdFRvQ2VudGVyIiwibmV3RGlzdFRvQ2VudGVyIiwiaW50ZXJwb2xhdGUiLCJSaWdodFRvQ2VudGVyIiwiQ2VudGVyVG9MZWZ0IiwiUmlnaHRUb0xlZnQiLCJDcnVtYiIsIl9zZXRQcm9wc0lmRXhpc3RzIiwiSWNvbiIsIlNlcGFyYXRvciIsIlRpdGxlIiwicmlnaHQiLCJyZWZzIiwiUmlnaHRJdGVtIiwic2V0TmF0aXZlUHJvcHMiLCJtYXgiLCJNYXRoIiwibWluIiwiX3VwZGF0ZUluZGV4UHJvZ3Jlc3MiLCJfc2V0UmVuZGVyVmlld3NUb0hhcmR3YXJlVGV4dHVyZUFuZHJvaWQiLCJwcm9wcyIsInJvdXRlU3RhY2siLCJsZW5ndGgiLCJyZW5kZXJUb0hhcmR3YXJlVGV4dHVyZSIsInJlbmRlclRvSGFyZHdhcmVUZXh0dXJlQW5kcm9pZCIsIl9kZXNjcmlwdG9ycyIsImNydW1iIiwidGl0bGUiLCJpY29ucyIsIl9nZXRCcmVhZGNydW1iIiwidGl0bGVzIiwiX2dldFRpdGxlIiwiYnV0dG9ucyIsIl9nZXRSaWdodEJ1dHRvbiIsInN0eWxlcyIsImJyZWFkQ3J1bWJDb250YWluZXIiLCJyb3V0ZSIsImhhcyIsImdldCIsIm5hdkJhclJvdXRlTWFwcGVyIiwicm91dGVNYXBwZXIiLCJmaXJzdFN0eWxlcyIsImJyZWFkY3J1bWJEZXNjcmlwdG9yIiwiaWNvbkZvclJvdXRlIiwibmF2aWdhdG9yIiwic2VwYXJhdG9yRm9yUm91dGUiLCJzZXQiLCJ0aXRsZUNvbnRlbnQiLCJ0aXRsZUNvbnRlbnRGb3JSb3V0ZSIsInRpdGxlRGVzY3JpcHRvciIsInJpZ2h0Q29udGVudCIsInJpZ2h0Q29udGVudEZvclJvdXRlIiwicmlnaHRCdXR0b25EZXNjcmlwdG9yIiwicmVmIiwicHJvcFR5cGVzIiwic2hhcGUiLCJwdXNoIiwiZnVuYyIsInBvcCIsInJlcGxhY2UiLCJwb3BUb1JvdXRlIiwicG9wVG9Ub3AiLCJQcm9wVHlwZXMiLCJhcnJheU9mIiwib2JqZWN0IiwibnVtYmVyIiwic3RhdGljcyIsIlN0eWxlcyIsImNyZWF0ZSIsIm92ZXJmbG93IiwicG9zaXRpb24iLCJoZWlnaHQiLCJHZW5lcmFsIiwiVG90YWxOYXZIZWlnaHQiLCJ0b3AiLCJsZWZ0IiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBU0EsYTs7QUFFQSw0QjtBQUNBLHlHO0FBQ0EsK0Y7QUFDQSx1RjtBQUNBLHVEO0FBQ0EsNkQ7QUFDQSwyQztBQUNBO0FBQ0EsNkM7QUFDQSxxRDs7QUFFQSxHQUFJQSxlQUFnQixzREFBdUNBLGFBQTNEO0FBQ0EsR0FBSUMsOEJBQStCLHdCQUFTQyxFQUFULEdBQWdCLFNBQWhCLGtHQUFuQzs7Ozs7O0FBTUEsR0FBSUMsYUFBY0gsY0FBY0ksR0FBZCxDQUFrQixVQUFNLENBQUMsTUFBTyxDQUFDQyxNQUFPLEVBQVIsQ0FBUCxDQUFvQixDQUE3QyxDQUFsQjtBQUNBLEdBQUlDLFlBQWFOLGNBQWNJLEdBQWQsQ0FBa0IsVUFBTSxDQUFDLE1BQU8sQ0FBQ0MsTUFBTyxFQUFSLENBQVAsQ0FBb0IsQ0FBN0MsQ0FBakI7QUFD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QUFnQkMsT0FBaEIsQ0FBd0IsZ0JBQU1ELFNBQU4sQ0FBZ0JFLE1BQXhDLENBRGtCLENBRTlCN0UsZUFBZ0IsZ0JBQU0yRSxTQUFOLENBQWdCRyxNQUZGLENBQXRCLENBYk8sQ0FpQmpCckYsTUFBTyxvQkFBSzBFLFNBQUwsQ0FBZTFFLEtBakJMLEMsQ0FEZmUsZ0MsQ0FxQkd1RSxPLENBQVUsQ0FDZkMsNERBRGUsQzs7QUEwS2xCOztBQUVELEdBQUlqQyxRQUFTLDBCQUFXa0MsTUFBWCxDQUFrQjtBQUM3QmpDLG9CQUFxQjtBQUNuQmtDLFNBQVUsUUFEUztBQUVuQkMsU0FBVSxVQUZTO0FBR25CQyxPQUFRL0YsNkJBQTZCZ0csT0FBN0IsQ0FBcUNDLGNBSDFCO0FBSW5CQyxJQUFLLENBSmM7QUFLbkJDLEtBQU0sQ0FMYTtBQU1uQmhFLE1BQU8sQ0FOWSxDQURRLENBQWxCLENBQWI7Ozs7QUFXQSxnQ0FBU2hCLGdDQUFUOztBQUVBaUYsT0FBT0MsT0FBUCxDQUFpQmxGLGdDQUFqQiIsImZpbGUiOiJOYXZpZ2F0b3JCcmVhZGNydW1iTmF2aWdhdGlvbkJhci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSAyMDE1LXByZXNlbnQsIEFsaWJhYmEgR3JvdXAgSG9sZGluZyBMaW1pdGVkLlxuICogQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTUtcHJlc2VudCwgRmFjZWJvb2ssIEluYy5cbiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKlxuICogQHByb3ZpZGVzTW9kdWxlIFJlYWN0TmF2aWdhdG9yQnJlYWRjcnVtYk5hdmlnYXRpb25CYXJcbiAqL1xuJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgUmVhY3QsIHsgQ29tcG9uZW50LCBQcm9wVHlwZXMgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgTmF2aWdhdG9yQnJlYWRjcnVtYk5hdmlnYXRpb25CYXJTdHlsZXMgZnJvbSAnUmVhY3ROYXZpZ2F0b3JCcmVhZGNydW1iTmF2aWdhdGlvbkJhclN0eWxlcyc7XG5pbXBvcnQgTmF2aWdhdG9yTmF2aWdhdGlvbkJhclN0eWxlc0FuZHJvaWQgZnJvbSAnUmVhY3ROYXZpZ2F0b3JOYXZpZ2F0aW9uQmFyU3R5bGVzQW5kcm9pZCc7XG5pbXBvcnQgTmF2aWdhdG9yTmF2aWdhdGlvbkJhclN0eWxlc0lPUyBmcm9tICdSZWFjdE5hdmlnYXRvck5hdmlnYXRpb25CYXJTdHlsZXNJT1MnO1xuaW1wb3J0IFBsYXRmb3JtIGZyb20gJ1JlYWN0UGxhdGZvcm0nO1xuaW1wb3J0IFN0eWxlU2hlZXQgZnJvbSAnUmVhY3RTdHlsZVNoZWV0JztcbmltcG9ydCBWaWV3IGZyb20gJ1JlYWN0Vmlldyc7XG5pbXBvcnQgeyBNYXAgfSBmcm9tICdpbW11dGFibGUnO1xuaW1wb3J0IGludmFyaWFudCBmcm9tICdmYmpzL2xpYi9pbnZhcmlhbnQnO1xuaW1wb3J0IGF1dG9iaW5kIGZyb20gJ2F1dG9iaW5kLWRlY29yYXRvcic7XG5cbnZhciBJbnRlcnBvbGF0b3JzID0gTmF2aWdhdG9yQnJlYWRjcnVtYk5hdmlnYXRpb25CYXJTdHlsZXMuSW50ZXJwb2xhdG9ycztcbnZhciBOYXZpZ2F0b3JOYXZpZ2F0aW9uQmFyU3R5bGVzID0gUGxhdGZvcm0uT1MgPT09ICdhbmRyb2lkJyA/XG4gIE5hdmlnYXRvck5hdmlnYXRpb25CYXJTdHlsZXNBbmRyb2lkIDogTmF2aWdhdG9yTmF2aWdhdGlvbkJhclN0eWxlc0lPUztcblxuLyoqXG4gKiBSZXVzYWJsZSBwcm9wcyBvYmplY3RzLlxuICovXG52YXIgQ1JVTUJfUFJPUFMgPSBJbnRlcnBvbGF0b3JzLm1hcCgoKSA9PiB7cmV0dXJuIHtzdHlsZToge319O30pO1xudmFyIElDT05fUFJPUFMgPSBJbnRlcnBvbGF0b3JzLm1hcCgoKSA9PiB7cmV0dXJuIHtzdHlsZToge319O30pO1xudmFyIFNFUEFSQVRPUl9QUk9QUyA9IEludGVycG9sYXRvcnMubWFwKCgpID0+IHtyZXR1cm4ge3N0eWxlOiB7fX07fSk7XG52YXIgVElUTEVfUFJPUFMgPSBJbnRlcnBvbGF0b3JzLm1hcCgoKSA9PiB7cmV0dXJuIHtzdHlsZToge319O30pO1xudmFyIFJJR0hUX0JVVFRPTl9QUk9QUyA9IEludGVycG9sYXRvcnMubWFwKCgpID0+IHtyZXR1cm4ge3N0eWxlOiB7fX07fSk7XG5cblxudmFyIG5hdlN0YXRlUHJlc2VudGVkSW5kZXggPSBmdW5jdGlvbihuYXZTdGF0ZSkge1xuICBpZiAobmF2U3RhdGUucHJlc2VudGVkSW5kZXggIT09IHVuZGVmaW5lZCkge1xuICAgIHJldHVybiBuYXZTdGF0ZS5wcmVzZW50ZWRJbmRleDtcbiAgfVxuICAvLyBUT0RPOiByZW5hbWUgYG9ic2VydmVkVG9wT2ZTdGFja2AgdG8gYHByZXNlbnRlZEluZGV4YCBpbiBgTmF2aWdhdG9ySU9TYFxuICByZXR1cm4gbmF2U3RhdGUub2JzZXJ2ZWRUb3BPZlN0YWNrO1xufTtcblxuXG4vKipcbiAqIFRoZSBmaXJzdCByb3V0ZSBpcyBpbml0aWFsbHkgcmVuZGVyZWQgdXNpbmcgYSBkaWZmZXJlbnQgc3R5bGUgdGhhbiBhbGxcbiAqIGZ1dHVyZSByb3V0ZXMuXG4gKlxuICogQHBhcmFtIHtudW1iZXJ9IGluZGV4IEluZGV4IG9mIGJyZWFkY3J1bWIuXG4gKiBAcmV0dXJuIHtvYmplY3R9IFN0eWxlIGNvbmZpZyBmb3IgaW5pdGlhbCByZW5kZXJpbmcgb2YgaW5kZXguXG4gKi9cbnZhciBpbml0U3R5bGUgPSBmdW5jdGlvbihpbmRleCwgcHJlc2VudGVkSW5kZXgpIHtcbiAgcmV0dXJuIGluZGV4ID09PSBwcmVzZW50ZWRJbmRleCA/IE5hdmlnYXRvckJyZWFkY3J1bWJOYXZpZ2F0aW9uQmFyU3R5bGVzLkNlbnRlcltpbmRleF0gOlxuICAgIGluZGV4IDwgcHJlc2VudGVkSW5kZXggPyBOYXZpZ2F0b3JCcmVhZGNydW1iTmF2aWdhdGlvbkJhclN0eWxlcy5MZWZ0W2luZGV4XSA6XG4gICAgTmF2aWdhdG9yQnJlYWRjcnVtYk5hdmlnYXRpb25CYXJTdHlsZXMuUmlnaHRbaW5kZXhdO1xufTtcblxuY2xhc3MgTmF2aWdhdG9yQnJlYWRjcnVtYk5hdmlnYXRpb25CYXIgZXh0ZW5kcyBDb21wb25lbnQge1xuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgIG5hdmlnYXRvcjogUHJvcFR5cGVzLnNoYXBlKHtcbiAgICAgIHB1c2g6IFByb3BUeXBlcy5mdW5jLFxuICAgICAgcG9wOiBQcm9wVHlwZXMuZnVuYyxcbiAgICAgIHJlcGxhY2U6IFByb3BUeXBlcy5mdW5jLFxuICAgICAgcG9wVG9Sb3V0ZTogUHJvcFR5cGVzLmZ1bmMsXG4gICAgICBwb3BUb1RvcDogUHJvcFR5cGVzLmZ1bmMsXG4gICAgfSksXG4gICAgcm91dGVNYXBwZXI6IFByb3BUeXBlcy5zaGFwZSh7XG4gICAgICByaWdodENvbnRlbnRGb3JSb3V0ZTogUHJvcFR5cGVzLmZ1bmMsXG4gICAgICB0aXRsZUNvbnRlbnRGb3JSb3V0ZTogUHJvcFR5cGVzLmZ1bmMsXG4gICAgICBpY29uRm9yUm91dGU6IFByb3BUeXBlcy5mdW5jLFxuICAgIH0pLFxuICAgIG5hdlN0YXRlOiBSZWFjdC5Qcm9wVHlwZXMuc2hhcGUoe1xuICAgICAgcm91dGVTdGFjazogUmVhY3QuUHJvcFR5cGVzLmFycmF5T2YoUmVhY3QuUHJvcFR5cGVzLm9iamVjdCksXG4gICAgICBwcmVzZW50ZWRJbmRleDogUmVhY3QuUHJvcFR5cGVzLm51bWJlcixcbiAgICB9KSxcbiAgICBzdHlsZTogVmlldy5wcm9wVHlwZXMuc3R5bGUsXG4gIH1cblxuICBzdGF0aWMgc3RhdGljcyA9IHtcbiAgICBTdHlsZXM6IE5hdmlnYXRvckJyZWFkY3J1bWJOYXZpZ2F0aW9uQmFyU3R5bGVzLFxuICB9XG5cbiAgX3VwZGF0ZUluZGV4UHJvZ3Jlc3MocHJvZ3Jlc3MsIGluZGV4LCBmcm9tSW5kZXgsIHRvSW5kZXgpIHtcbiAgICB2YXIgYW1vdW50ID0gdG9JbmRleCA+IGZyb21JbmRleCA/IHByb2dyZXNzIDogKDEgLSBwcm9ncmVzcyk7XG4gICAgdmFyIG9sZERpc3RUb0NlbnRlciA9IGluZGV4IC0gZnJvbUluZGV4O1xuICAgIHZhciBuZXdEaXN0VG9DZW50ZXIgPSBpbmRleCAtIHRvSW5kZXg7XG4gICAgdmFyIGludGVycG9sYXRlO1xuICAgIGludmFyaWFudChcbiAgICAgIEludGVycG9sYXRvcnNbaW5kZXhdLFxuICAgICAgJ0Nhbm5vdCBmaW5kIGJyZWFkY3J1bWIgaW50ZXJwb2xhdG9ycyBmb3IgJyArIGluZGV4XG4gICAgKTtcbiAgICBpZiAob2xkRGlzdFRvQ2VudGVyID4gMCAmJiBuZXdEaXN0VG9DZW50ZXIgPT09IDAgfHxcbiAgICAgICAgbmV3RGlzdFRvQ2VudGVyID4gMCAmJiBvbGREaXN0VG9DZW50ZXIgPT09IDApIHtcbiAgICAgIGludGVycG9sYXRlID0gSW50ZXJwb2xhdG9yc1tpbmRleF0uUmlnaHRUb0NlbnRlcjtcbiAgICB9IGVsc2UgaWYgKG9sZERpc3RUb0NlbnRlciA8IDAgJiYgbmV3RGlzdFRvQ2VudGVyID09PSAwIHx8XG4gICAgICAgICAgICAgICBuZXdEaXN0VG9DZW50ZXIgPCAwICYmIG9sZERpc3RUb0NlbnRlciA9PT0gMCkge1xuICAgICAgaW50ZXJwb2xhdGUgPSBJbnRlcnBvbGF0b3JzW2luZGV4XS5DZW50ZXJUb0xlZnQ7XG4gICAgfSBlbHNlIGlmIChvbGREaXN0VG9DZW50ZXIgPT09IG5ld0Rpc3RUb0NlbnRlcikge1xuICAgICAgaW50ZXJwb2xhdGUgPSBJbnRlcnBvbGF0b3JzW2luZGV4XS5SaWdodFRvQ2VudGVyO1xuICAgIH0gZWxzZSB7XG4gICAgICBpbnRlcnBvbGF0ZSA9IEludGVycG9sYXRvcnNbaW5kZXhdLlJpZ2h0VG9MZWZ0O1xuICAgIH1cblxuICAgIGlmIChpbnRlcnBvbGF0ZS5DcnVtYihDUlVNQl9QUk9QU1tpbmRleF0uc3R5bGUsIGFtb3VudCkpIHtcbiAgICAgIHRoaXMuX3NldFByb3BzSWZFeGlzdHMoJ2NydW1iXycgKyBpbmRleCwgQ1JVTUJfUFJPUFNbaW5kZXhdKTtcbiAgICB9XG4gICAgaWYgKGludGVycG9sYXRlLkljb24oSUNPTl9QUk9QU1tpbmRleF0uc3R5bGUsIGFtb3VudCkpIHtcbiAgICAgIHRoaXMuX3NldFByb3BzSWZFeGlzdHMoJ2ljb25fJyArIGluZGV4LCBJQ09OX1BST1BTW2luZGV4XSk7XG4gICAgfVxuICAgIGlmIChpbnRlcnBvbGF0ZS5TZXBhcmF0b3IoU0VQQVJBVE9SX1BST1BTW2luZGV4XS5zdHlsZSwgYW1vdW50KSkge1xuICAgICAgdGhpcy5fc2V0UHJvcHNJZkV4aXN0cygnc2VwYXJhdG9yXycgKyBpbmRleCwgU0VQQVJBVE9SX1BST1BTW2luZGV4XSk7XG4gICAgfVxuICAgIGlmIChpbnRlcnBvbGF0ZS5UaXRsZShUSVRMRV9QUk9QU1tpbmRleF0uc3R5bGUsIGFtb3VudCkpIHtcbiAgICAgIHRoaXMuX3NldFByb3BzSWZFeGlzdHMoJ3RpdGxlXycgKyBpbmRleCwgVElUTEVfUFJPUFNbaW5kZXhdKTtcbiAgICB9XG4gICAgdmFyIHJpZ2h0ID0gdGhpcy5yZWZzWydyaWdodF8nICsgaW5kZXhdO1xuICAgIGlmIChyaWdodCAmJlxuICAgICAgICBpbnRlcnBvbGF0ZS5SaWdodEl0ZW0oUklHSFRfQlVUVE9OX1BST1BTW2luZGV4XS5zdHlsZSwgYW1vdW50KSkge1xuICAgICAgcmlnaHQuc2V0TmF0aXZlUHJvcHMoUklHSFRfQlVUVE9OX1BST1BTW2luZGV4XSlcbiAgICB9XG4gIH1cblxuICB1cGRhdGVQcm9ncmVzcyhwcm9ncmVzcywgZnJvbUluZGV4LCB0b0luZGV4KSB7XG4gICAgdmFyIG1heCA9IE1hdGgubWF4KGZyb21JbmRleCwgdG9JbmRleCk7XG4gICAgdmFyIG1pbiA9IE1hdGgubWluKGZyb21JbmRleCwgdG9JbmRleCk7XG4gICAgZm9yICh2YXIgaW5kZXggPSBtaW47IGluZGV4IDw9IG1heDsgaW5kZXgrKykge1xuICAgICAgdGhpcy5fdXBkYXRlSW5kZXhQcm9ncmVzcyhwcm9ncmVzcywgaW5kZXgsIGZyb21JbmRleCwgdG9JbmRleCk7XG4gICAgfVxuICB9XG5cbiAgb25BbmltYXRpb25TdGFydChmcm9tSW5kZXgsIHRvSW5kZXgpIHtcbiAgICB2YXIgbWF4ID0gTWF0aC5tYXgoZnJvbUluZGV4LCB0b0luZGV4KTtcbiAgICB2YXIgbWluID0gTWF0aC5taW4oZnJvbUluZGV4LCB0b0luZGV4KTtcbiAgICBmb3IgKHZhciBpbmRleCA9IG1pbjsgaW5kZXggPD0gbWF4OyBpbmRleCsrKSB7XG4gICAgICB0aGlzLl9zZXRSZW5kZXJWaWV3c1RvSGFyZHdhcmVUZXh0dXJlQW5kcm9pZChpbmRleCwgdHJ1ZSk7XG4gICAgfVxuICB9XG5cbiAgb25BbmltYXRpb25FbmQoKSB7XG4gICAgdmFyIG1heCA9IHRoaXMucHJvcHMubmF2U3RhdGUucm91dGVTdGFjay5sZW5ndGggLSAxO1xuICAgIGZvciAodmFyIGluZGV4ID0gMDsgaW5kZXggPD0gbWF4OyBpbmRleCsrKSB7XG4gICAgICB0aGlzLl9zZXRSZW5kZXJWaWV3c1RvSGFyZHdhcmVUZXh0dXJlQW5kcm9pZChpbmRleCwgZmFsc2UpO1xuICAgIH1cbiAgfVxuXG4gIF9zZXRSZW5kZXJWaWV3c1RvSGFyZHdhcmVUZXh0dXJlQW5kcm9pZChpbmRleCwgcmVuZGVyVG9IYXJkd2FyZVRleHR1cmUpIHtcbiAgICB2YXIgcHJvcHMgPSB7XG4gICAgICByZW5kZXJUb0hhcmR3YXJlVGV4dHVyZUFuZHJvaWQ6IHJlbmRlclRvSGFyZHdhcmVUZXh0dXJlLFxuICAgIH07XG5cbiAgICB0aGlzLl9zZXRQcm9wc0lmRXhpc3RzKCdpY29uXycgKyBpbmRleCwgcHJvcHMpO1xuICAgIHRoaXMuX3NldFByb3BzSWZFeGlzdHMoJ3NlcGFyYXRvcl8nICsgaW5kZXgsIHByb3BzKTtcbiAgICB0aGlzLl9zZXRQcm9wc0lmRXhpc3RzKCd0aXRsZV8nICsgaW5kZXgsIHByb3BzKTtcbiAgICB0aGlzLl9zZXRQcm9wc0lmRXhpc3RzKCdyaWdodF8nICsgaW5kZXgsIHByb3BzKTtcbiAgfVxuXG4gIGNvbXBvbmVudFdpbGxNb3VudCgpIHtcbiAgICB0aGlzLl9kZXNjcmlwdG9ycyA9IHtcbiAgICAgIGNydW1iOiBuZXcgTWFwKCksXG4gICAgICB0aXRsZTogbmV3IE1hcCgpLFxuICAgICAgcmlnaHQ6IG5ldyBNYXAoKSxcbiAgICB9O1xuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIHZhciBuYXZTdGF0ZSA9IHRoaXMucHJvcHMubmF2U3RhdGU7XG4gICAgdmFyIGljb25zID0gbmF2U3RhdGUgJiYgbmF2U3RhdGUucm91dGVTdGFjay5tYXAodGhpcy5fZ2V0QnJlYWRjcnVtYik7XG4gICAgdmFyIHRpdGxlcyA9IG5hdlN0YXRlLnJvdXRlU3RhY2subWFwKHRoaXMuX2dldFRpdGxlKTtcbiAgICB2YXIgYnV0dG9ucyA9IG5hdlN0YXRlLnJvdXRlU3RhY2subWFwKHRoaXMuX2dldFJpZ2h0QnV0dG9uKTtcbiAgICByZXR1cm4gKFxuICAgICAgPFZpZXcgc3R5bGU9e1tzdHlsZXMuYnJlYWRDcnVtYkNvbnRhaW5lciwgdGhpcy5wcm9wcy5zdHlsZV19PlxuICAgICAgICB7dGl0bGVzfVxuICAgICAgICB7aWNvbnN9XG4gICAgICAgIHtidXR0b25zfVxuICAgICAgPC9WaWV3PlxuICAgICk7XG4gIH1cblxuICBfZ2V0QnJlYWRjcnVtYihyb3V0ZSwgaW5kZXgpIHtcbiAgICBpZiAodGhpcy5fZGVzY3JpcHRvcnMuY3J1bWIuaGFzKHJvdXRlKSkge1xuICAgICAgcmV0dXJuIHRoaXMuX2Rlc2NyaXB0b3JzLmNydW1iLmdldChyb3V0ZSk7XG4gICAgfVxuXG4gICAgdmFyIG5hdkJhclJvdXRlTWFwcGVyID0gdGhpcy5wcm9wcy5yb3V0ZU1hcHBlcjtcbiAgICB2YXIgZmlyc3RTdHlsZXMgPSBpbml0U3R5bGUoaW5kZXgsIG5hdlN0YXRlUHJlc2VudGVkSW5kZXgodGhpcy5wcm9wcy5uYXZTdGF0ZSkpO1xuXG4gICAgdmFyIGJyZWFkY3J1bWJEZXNjcmlwdG9yID0gKFxuICAgICAgPFZpZXcgcmVmPXsnY3J1bWJfJyArIGluZGV4fSBzdHlsZT17Zmlyc3RTdHlsZXMuQ3J1bWJ9PlxuICAgICAgICA8VmlldyByZWY9eydpY29uXycgKyBpbmRleH0gc3R5bGU9e2ZpcnN0U3R5bGVzLkljb259PlxuICAgICAgICAgIHtuYXZCYXJSb3V0ZU1hcHBlci5pY29uRm9yUm91dGUocm91dGUsIHRoaXMucHJvcHMubmF2aWdhdG9yKX1cbiAgICAgICAgPC9WaWV3PlxuICAgICAgICA8VmlldyByZWY9eydzZXBhcmF0b3JfJyArIGluZGV4fSBzdHlsZT17Zmlyc3RTdHlsZXMuU2VwYXJhdG9yfT5cbiAgICAgICAgICB7bmF2QmFyUm91dGVNYXBwZXIuc2VwYXJhdG9yRm9yUm91dGUocm91dGUsIHRoaXMucHJvcHMubmF2aWdhdG9yKX1cbiAgICAgICAgPC9WaWV3PlxuICAgICAgPC9WaWV3PlxuICAgICk7XG5cbiAgICB0aGlzLl9kZXNjcmlwdG9ycy5jcnVtYiA9IHRoaXMuX2Rlc2NyaXB0b3JzLmNydW1iLnNldChyb3V0ZSwgYnJlYWRjcnVtYkRlc2NyaXB0b3IpO1xuICAgIHJldHVybiBicmVhZGNydW1iRGVzY3JpcHRvcjtcbiAgfVxuXG4gIF9nZXRUaXRsZShyb3V0ZSwgaW5kZXgpIHtcbiAgICBpZiAodGhpcy5fZGVzY3JpcHRvcnMudGl0bGUuaGFzKHJvdXRlKSkge1xuICAgICAgcmV0dXJuIHRoaXMuX2Rlc2NyaXB0b3JzLnRpdGxlLmdldChyb3V0ZSk7XG4gICAgfVxuXG4gICAgdmFyIHRpdGxlQ29udGVudCA9IHRoaXMucHJvcHMucm91dGVNYXBwZXIudGl0bGVDb250ZW50Rm9yUm91dGUoXG4gICAgICB0aGlzLnByb3BzLm5hdlN0YXRlLnJvdXRlU3RhY2tbaW5kZXhdLFxuICAgICAgdGhpcy5wcm9wcy5uYXZpZ2F0b3JcbiAgICApO1xuICAgIHZhciBmaXJzdFN0eWxlcyA9IGluaXRTdHlsZShpbmRleCwgbmF2U3RhdGVQcmVzZW50ZWRJbmRleCh0aGlzLnByb3BzLm5hdlN0YXRlKSk7XG5cbiAgICB2YXIgdGl0bGVEZXNjcmlwdG9yID0gKFxuICAgICAgPFZpZXcgcmVmPXsndGl0bGVfJyArIGluZGV4fSBzdHlsZT17Zmlyc3RTdHlsZXMuVGl0bGV9PlxuICAgICAgICB7dGl0bGVDb250ZW50fVxuICAgICAgPC9WaWV3PlxuICAgICk7XG4gICAgdGhpcy5fZGVzY3JpcHRvcnMudGl0bGUgPSB0aGlzLl9kZXNjcmlwdG9ycy50aXRsZS5zZXQocm91dGUsIHRpdGxlRGVzY3JpcHRvcik7XG4gICAgcmV0dXJuIHRpdGxlRGVzY3JpcHRvcjtcbiAgfVxuXG4gIF9nZXRSaWdodEJ1dHRvbihyb3V0ZSwgaW5kZXgpIHtcbiAgICBpZiAodGhpcy5fZGVzY3JpcHRvcnMucmlnaHQuaGFzKHJvdXRlKSkge1xuICAgICAgcmV0dXJuIHRoaXMuX2Rlc2NyaXB0b3JzLnJpZ2h0LmdldChyb3V0ZSk7XG4gICAgfVxuICAgIHZhciByaWdodENvbnRlbnQgPSB0aGlzLnByb3BzLnJvdXRlTWFwcGVyLnJpZ2h0Q29udGVudEZvclJvdXRlKFxuICAgICAgdGhpcy5wcm9wcy5uYXZTdGF0ZS5yb3V0ZVN0YWNrW2luZGV4XSxcbiAgICAgIHRoaXMucHJvcHMubmF2aWdhdG9yXG4gICAgKTtcbiAgICBpZiAoIXJpZ2h0Q29udGVudCkge1xuICAgICAgdGhpcy5fZGVzY3JpcHRvcnMucmlnaHQgPSB0aGlzLl9kZXNjcmlwdG9ycy5yaWdodC5zZXQocm91dGUsIG51bGwpO1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIHZhciBmaXJzdFN0eWxlcyA9IGluaXRTdHlsZShpbmRleCwgbmF2U3RhdGVQcmVzZW50ZWRJbmRleCh0aGlzLnByb3BzLm5hdlN0YXRlKSk7XG4gICAgdmFyIHJpZ2h0QnV0dG9uRGVzY3JpcHRvciA9IChcbiAgICAgIDxWaWV3IHJlZj17J3JpZ2h0XycgKyBpbmRleH0gc3R5bGU9e2ZpcnN0U3R5bGVzLlJpZ2h0SXRlbX0+XG4gICAgICAgIHtyaWdodENvbnRlbnR9XG4gICAgICA8L1ZpZXc+XG4gICAgKTtcbiAgICB0aGlzLl9kZXNjcmlwdG9ycy5yaWdodCA9IHRoaXMuX2Rlc2NyaXB0b3JzLnJpZ2h0LnNldChyb3V0ZSwgcmlnaHRCdXR0b25EZXNjcmlwdG9yKTtcbiAgICByZXR1cm4gcmlnaHRCdXR0b25EZXNjcmlwdG9yO1xuICB9XG5cbiAgX3NldFByb3BzSWZFeGlzdHMocmVmLCBwcm9wcykge1xuICAgIHZhciByZWYgPSB0aGlzLnJlZnNbcmVmXTtcbiAgICByZWYgJiYgcmVmLnNldE5hdGl2ZVByb3BzKHByb3BzKTtcbiAgfVxuXG59O1xuXG52YXIgc3R5bGVzID0gU3R5bGVTaGVldC5jcmVhdGUoe1xuICBicmVhZENydW1iQ29udGFpbmVyOiB7XG4gICAgb3ZlcmZsb3c6ICdoaWRkZW4nLFxuICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLFxuICAgIGhlaWdodDogTmF2aWdhdG9yTmF2aWdhdGlvbkJhclN0eWxlcy5HZW5lcmFsLlRvdGFsTmF2SGVpZ2h0LFxuICAgIHRvcDogMCxcbiAgICBsZWZ0OiAwLFxuICAgIHJpZ2h0OiAwLFxuICB9LFxufSk7XG5cbmF1dG9iaW5kKE5hdmlnYXRvckJyZWFkY3J1bWJOYXZpZ2F0aW9uQmFyKTtcblxubW9kdWxlLmV4cG9ydHMgPSBOYXZpZ2F0b3JCcmVhZGNydW1iTmF2aWdhdGlvbkJhcjtcbiJdfQ==