









'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();


var _immutable=require('immutable');
var _invariant=require('fbjs/lib/invariant');var _invariant2=_interopRequireDefault(_invariant);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}




function isRouteEmpty(route){
return route===undefined||route===null||route===''||false;
}

var _nextID=0;var

RouteNode=


function RouteNode(route){_classCallCheck(this,RouteNode);



this.key=String(_nextID++);

this.value=route;
};


var StackDiffRecord=(0,_immutable.Record)({
key:null,
route:null,
index:null});var





RouteStack=function(){




function RouteStack(index,routeNodes){_classCallCheck(this,RouteStack);
(0,_invariant2.default)(
routeNodes.size>0,
'size must not be empty');


(0,_invariant2.default)(
index>-1&&index<=routeNodes.size-1,
'index out of bound');


this._routeNodes=routeNodes;
this._index=index;
}_createClass(RouteStack,[{key:'toArray',value:function toArray()











{
var result=[];
var ii=0;
var nodes=this._routeNodes;
while(ii<nodes.size){
result.push(nodes.get(ii).value);
ii++;
}
return result;
}},{key:'get',value:function get(

index){
if(index<0||index>this._routeNodes.size-1){
return null;
}
return this._routeNodes.get(index).value;
}},{key:'keyOf',value:function keyOf(







route){
if(isRouteEmpty(route)){
return null;
}
var index=this.indexOf(route);
return index>-1?
this._routeNodes.get(index).key:
null;
}},{key:'indexOf',value:function indexOf(

route){
if(isRouteEmpty(route)){
return-1;
}

var finder=function finder(node){
return node.value===route;
};

return this._routeNodes.findIndex(finder,this);
}},{key:'slice',value:function slice(

begin,end){
var routeNodes=this._routeNodes.slice(begin,end);
var index=Math.min(this._index,routeNodes.size-1);
return this._update(index,routeNodes);
}},{key:'push',value:function push(





route){var _this=this;

(0,_invariant2.default)(
!isRouteEmpty(route),
'Must supply route to push');


(0,_invariant2.default)(this._routeNodes.indexOf(route)===-1,'route must be unique');


var routeNodes=this._routeNodes.withMutations(function(list){
list.slice(0,_this._index+1).push(new RouteNode(route));
});

return this._update(routeNodes.size-1,routeNodes);
}},{key:'pop',value:function pop()





{
(0,_invariant2.default)(this._routeNodes.size>1,'shoud not pop routeNodes stack to empty');


var routeNodes=this._routeNodes.slice(0,this._index);
return this._update(routeNodes.size-1,routeNodes);
}},{key:'jumpToIndex',value:function jumpToIndex(

index){
(0,_invariant2.default)(
index>-1&&index<this._routeNodes.size,
'index out of bound');


return this._update(index,this._routeNodes);
}},{key:'replaceAtIndex',value:function replaceAtIndex(







index,route){
(0,_invariant2.default)(
!isRouteEmpty(route),
'Must supply route to replace');


if(this.get(index)===route){
return this;
}

(0,_invariant2.default)(this.indexOf(route)===-1,'route must be unique');

if(index<0){
index+=this._routeNodes.size;
}

(0,_invariant2.default)(
index>-1&&index<this._routeNodes.size,
'index out of bound');


var routeNodes=this._routeNodes.set(index,new RouteNode(route));
return this._update(index,routeNodes);
}},{key:'forEach',value:function forEach(


callback,context){
var ii=0;
var nodes=this._routeNodes;
while(ii<nodes.size){
var node=nodes.get(ii);
callback.call(context,node.value,ii,node.key);
ii++;
}
}},{key:'mapToArray',value:function mapToArray(

callback,context){
var result=[];
this.forEach(function(route,index,key){
result.push(callback.call(context,route,index,key));
});
return result;
}},{key:'subtract',value:function subtract(




stack){
var items=[];
this._routeNodes.forEach(function(node,index){
if(!stack._routeNodes.contains(node)){
items.push(
new StackDiffRecord({
route:node.value,
index:index,
key:node.key}));


}
});
return new _immutable.Set(items);
}},{key:'_update',value:function _update(

index,routeNodes){
if(this._index===index&&this._routeNodes===routeNodes){
return this;
}
return new RouteStack(index,routeNodes);
}},{key:'size',get:function get(){return this._routeNodes.size;}},{key:'index',get:function get(){return this._index;}}]);return RouteStack;}();var






NavigationRouteStack=function(_RouteStack){_inherits(NavigationRouteStack,_RouteStack);
function NavigationRouteStack(index,routeNodes){_classCallCheck(this,NavigationRouteStack);




var nodes=routeNodes.map(function(route){
(0,_invariant2.default)(!isRouteEmpty(route),'route must not be mepty');
return new RouteNode(route);
});return _possibleConstructorReturn(this,(NavigationRouteStack.__proto__||Object.getPrototypeOf(NavigationRouteStack)).call(this,

index,new _immutable.List(nodes)));
}return NavigationRouteStack;}(RouteStack);


module.exports=NavigationRouteStack;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIk5hdmlnYXRpb25Sb3V0ZVN0YWNrLmpzIl0sIm5hbWVzIjpbImlzUm91dGVFbXB0eSIsInJvdXRlIiwidW5kZWZpbmVkIiwiX25leHRJRCIsIlJvdXRlTm9kZSIsImtleSIsIlN0cmluZyIsInZhbHVlIiwiU3RhY2tEaWZmUmVjb3JkIiwiaW5kZXgiLCJSb3V0ZVN0YWNrIiwicm91dGVOb2RlcyIsInNpemUiLCJfcm91dGVOb2RlcyIsIl9pbmRleCIsInJlc3VsdCIsImlpIiwibm9kZXMiLCJwdXNoIiwiZ2V0IiwiaW5kZXhPZiIsImZpbmRlciIsIm5vZGUiLCJmaW5kSW5kZXgiLCJiZWdpbiIsImVuZCIsInNsaWNlIiwiTWF0aCIsIm1pbiIsIl91cGRhdGUiLCJ3aXRoTXV0YXRpb25zIiwibGlzdCIsInNldCIsImNhbGxiYWNrIiwiY29udGV4dCIsImNhbGwiLCJmb3JFYWNoIiwic3RhY2siLCJpdGVtcyIsImNvbnRhaW5zIiwiTmF2aWdhdGlvblJvdXRlU3RhY2siLCJtYXAiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBVUEsYTs7O0FBR0E7QUFDQSw2Qzs7Ozs7QUFLQSxRQUFTQSxhQUFULENBQXNCQyxLQUF0QixDQUEyQztBQUN6QyxNQUFRQSxTQUFVQyxTQUFWLEVBQXVCRCxRQUFVLElBQWpDLEVBQXlDQSxRQUFVLEVBQXBELEVBQTJELEtBQWxFO0FBQ0Q7O0FBRUQsR0FBSUUsU0FBVSxDQUFkLEM7O0FBRU1DLFM7OztBQUdKLG1CQUFZSCxLQUFaLENBQXdCOzs7O0FBSXRCLEtBQUtJLEdBQUwsQ0FBV0MsT0FBT0gsU0FBUCxDQUFYOztBQUVBLEtBQUtJLEtBQUwsQ0FBYU4sS0FBYjtBQUNELEM7OztBQUdILEdBQUlPLGlCQUFrQixzQkFBTztBQUMzQkgsSUFBSyxJQURzQjtBQUUzQkosTUFBTyxJQUZvQjtBQUczQlEsTUFBTyxJQUhvQixDQUFQLENBQXRCLEM7Ozs7OztBQVNNQyxVOzs7OztBQUtKLG9CQUFZRCxL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QixDQUFQO0FBQ0QsQyxnQ0FqTGtCLENBQ2pCLE1BQU8sTUFBS0UsV0FBTCxDQUFpQkQsSUFBeEIsQ0FDRCxDLGlDQUdtQixDQUNsQixNQUFPLE1BQUtFLE1BQVosQ0FDRCxDOzs7Ozs7O0FBaUxHMEIsb0I7QUFDSiw4QkFBWS9CLEtBQVosQ0FBMkJFLFVBQTNCLENBQW1EOzs7OztBQUtqRCxHQUFJTSxPQUFRTixXQUFXOEIsR0FBWCxDQUFlLFNBQUN4QyxLQUFELENBQVc7QUFDcEMsd0JBQVUsQ0FBQ0QsYUFBYUMsS0FBYixDQUFYLENBQWdDLHlCQUFoQztBQUNBLE1BQU8sSUFBSUcsVUFBSixDQUFjSCxLQUFkLENBQVA7QUFDRCxDQUhXLENBQVosQ0FMaUQ7O0FBVTNDUSxLQVYyQyxDQVVwQyxvQkFBU1EsS0FBVCxDQVZvQztBQVdsRCxDLDhCQVpnQ1AsVTs7O0FBZW5DZ0MsT0FBT0MsT0FBUCxDQUFpQkgsb0JBQWpCIiwiZmlsZSI6Ik5hdmlnYXRpb25Sb3V0ZVN0YWNrLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTUtcHJlc2VudCwgQWxpYmFiYSBHcm91cCBIb2xkaW5nIExpbWl0ZWQuXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICpcbiAqIENvcHlyaWdodCAoYykgMjAxNS1wcmVzZW50LCBGYWNlYm9vaywgSW5jLlxuICogQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqXG4gKiBAcHJvdmlkZXNNb2R1bGUgTmF2aWdhdGlvblJvdXRlU3RhY2tcbiAqIEBmbG93XG4gKi9cbid1c2Ugc3RyaWN0Jztcbi8qIGVzbGludCBuZXctY2FwOiAwKi9cblxuaW1wb3J0IHsgTGlzdCwgU2V0LCBSZWNvcmQgfSBmcm9tICdpbW11dGFibGUnO1xuaW1wb3J0IGludmFyaWFudCBmcm9tICdmYmpzL2xpYi9pbnZhcmlhbnQnO1xuXG50eXBlIEl0ZXJhdGlvbkNhbGxiYWNrID0gKHJvdXRlOiBhbnksIGluZGV4OiBudW1iZXIsIGtleTogc3RyaW5nKSA9PiB2b2lkO1xuXG5cbmZ1bmN0aW9uIGlzUm91dGVFbXB0eShyb3V0ZTogYW55KTogYm9vbGVhbiB7XG4gIHJldHVybiAocm91dGUgPT09IHVuZGVmaW5lZCB8fCByb3V0ZSA9PT0gbnVsbCB8fCByb3V0ZSA9PT0gJycpIHx8IGZhbHNlO1xufVxuXG52YXIgX25leHRJRCA9IDA7XG5cbmNsYXNzIFJvdXRlTm9kZSB7XG4gIGtleTogc3RyaW5nO1xuICB2YWx1ZTogYW55O1xuICBjb25zdHJ1Y3Rvcihyb3V0ZTogYW55KSB7XG4gICAgLy8gS2V5IHZhbHVlIGdldHMgYmlnZ2VyIGluY3JlbWVudGFsbHkuIERldmVsb3BlciBjYW4gY29tcGFyZSB0aGVcbiAgICAvLyBrZXlzIG9mIHR3byByb3V0ZXMgdGhlbiBrbm93IHdoaWNoIHJvdXRlIGlzIGFkZGVkIHRvIHRoZSBzdGFja1xuICAgIC8vIGVhcmxpZXIuXG4gICAgdGhpcy5rZXkgPSBTdHJpbmcoX25leHRJRCsrKTtcblxuICAgIHRoaXMudmFsdWUgPSByb3V0ZTtcbiAgfVxufVxuXG52YXIgU3RhY2tEaWZmUmVjb3JkID0gUmVjb3JkKHtcbiAga2V5OiBudWxsLFxuICByb3V0ZTogbnVsbCxcbiAgaW5kZXg6IG51bGwsXG59KTtcblxuLyoqXG4gKiBUaGUgaW1tdXRhYmxlIHJvdXRlIHN0YWNrLlxuICovXG5jbGFzcyBSb3V0ZVN0YWNrIHtcbiAgX2luZGV4OiBudW1iZXI7XG5cbiAgX3JvdXRlTm9kZXM6IExpc3Q8Um91dGVOb2RlPjtcblxuICBjb25zdHJ1Y3RvcihpbmRleDogbnVtYmVyLCByb3V0ZU5vZGVzOiBMaXN0PFJvdXRlTm9kZT4pIHtcbiAgICBpbnZhcmlhbnQoXG4gICAgICByb3V0ZU5vZGVzLnNpemUgPiAwLFxuICAgICAgJ3NpemUgbXVzdCBub3QgYmUgZW1wdHknXG4gICAgKTtcblxuICAgIGludmFyaWFudChcbiAgICAgIGluZGV4ID4gLTEgJiYgaW5kZXggPD0gcm91dGVOb2Rlcy5zaXplIC0gMSxcbiAgICAgICdpbmRleCBvdXQgb2YgYm91bmQnXG4gICAgKTtcblxuICAgIHRoaXMuX3JvdXRlTm9kZXMgPSByb3V0ZU5vZGVzO1xuICAgIHRoaXMuX2luZGV4ID0gaW5kZXg7XG4gIH1cblxuICAvKiAkRmxvd0ZpeE1lIC0gZ2V0L3NldCBwcm9wZXJ0aWVzIG5vdCB5ZXQgc3VwcG9ydGVkICovXG4gIGdldCBzaXplKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMuX3JvdXRlTm9kZXMuc2l6ZTtcbiAgfVxuXG4gIC8qICRGbG93Rml4TWUgLSBnZXQvc2V0IHByb3BlcnRpZXMgbm90IHlldCBzdXBwb3J0ZWQgKi9cbiAgZ2V0IGluZGV4KCk6IG51bWJlciB7XG4gICAgcmV0dXJuIHRoaXMuX2luZGV4O1xuICB9XG5cbiAgdG9BcnJheSgpOiBBcnJheTxhbnk+IHtcbiAgICB2YXIgcmVzdWx0ID0gW107XG4gICAgdmFyIGlpID0gMDtcbiAgICB2YXIgbm9kZXMgPSB0aGlzLl9yb3V0ZU5vZGVzO1xuICAgIHdoaWxlIChpaSA8IG5vZGVzLnNpemUpIHtcbiAgICAgIHJlc3VsdC5wdXNoKG5vZGVzLmdldChpaSkudmFsdWUpO1xuICAgICAgaWkrKztcbiAgICB9XG4gICAgcmV0dXJuIHJlc3VsdDtcbiAgfVxuXG4gIGdldChpbmRleDogbnVtYmVyKTogYW55IHtcbiAgICBpZiAoaW5kZXggPCAwIHx8IGluZGV4ID4gdGhpcy5fcm91dGVOb2Rlcy5zaXplIC0gMSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIHJldHVybiB0aGlzLl9yb3V0ZU5vZGVzLmdldChpbmRleCkudmFsdWU7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyB0aGUga2V5IGFzc29jaWF0ZWQgd2l0aCB0aGUgcm91dGUuXG4gICAqIFdoZW4gYSByb3V0ZSBpcyBhZGRlZCB0byBhIHN0YWNrLCB0aGUgc3RhY2sgY3JlYXRlcyBhIGtleSBmb3IgdGhpcyByb3V0ZS5cbiAgICogVGhlIGtleSB3aWxsIHBlcnNpc3QgdW50aWwgdGhlIGluaXRpYWwgc3RhY2sgYW5kIGl0cyBkZXJpdmVkIHN0YWNrXG4gICAqIG5vIGxvbmdlciBjb250YWlucyB0aGlzIHJvdXRlLlxuICAgKi9cbiAga2V5T2Yocm91dGU6IGFueSk6ID9zdHJpbmcge1xuICAgIGlmIChpc1JvdXRlRW1wdHkocm91dGUpKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG4gICAgdmFyIGluZGV4ID0gdGhpcy5pbmRleE9mKHJvdXRlKTtcbiAgICByZXR1cm4gaW5kZXggPiAtMSA/XG4gICAgICB0aGlzLl9yb3V0ZU5vZGVzLmdldChpbmRleCkua2V5IDpcbiAgICAgIG51bGw7XG4gIH1cblxuICBpbmRleE9mKHJvdXRlOiBhbnkpOiBudW1iZXIge1xuICAgIGlmIChpc1JvdXRlRW1wdHkocm91dGUpKSB7XG4gICAgICByZXR1cm4gLTE7XG4gICAgfVxuXG4gICAgdmFyIGZpbmRlciA9IChub2RlKSA9PiB7XG4gICAgICByZXR1cm4gKG5vZGU6IFJvdXRlTm9kZSkudmFsdWUgPT09IHJvdXRlO1xuICAgIH07XG5cbiAgICByZXR1cm4gdGhpcy5fcm91dGVOb2Rlcy5maW5kSW5kZXgoZmluZGVyLCB0aGlzKTtcbiAgfVxuXG4gIHNsaWNlKGJlZ2luOiA/bnVtYmVyLCBlbmQ6ID9udW1iZXIpOiBSb3V0ZVN0YWNrIHtcbiAgICB2YXIgcm91dGVOb2RlcyA9IHRoaXMuX3JvdXRlTm9kZXMuc2xpY2UoYmVnaW4sIGVuZCk7XG4gICAgdmFyIGluZGV4ID0gTWF0aC5taW4odGhpcy5faW5kZXgsIHJvdXRlTm9kZXMuc2l6ZSAtIDEpO1xuICAgIHJldHVybiB0aGlzLl91cGRhdGUoaW5kZXgsIHJvdXRlTm9kZXMpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgYSBuZXcgc3RhY2sgd2l0aCB0aGUgcHJvdmlkZWQgcm91dGUgYXBwZW5kZWQsXG4gICAqIHN0YXJ0aW5nIGF0IHRoaXMgc3RhY2sgc2l6ZS5cbiAgICovXG4gIHB1c2gocm91dGU6IGFueSk6IFJvdXRlU3RhY2sge1xuXG4gICAgaW52YXJpYW50KFxuICAgICAgIWlzUm91dGVFbXB0eShyb3V0ZSksXG4gICAgICAnTXVzdCBzdXBwbHkgcm91dGUgdG8gcHVzaCdcbiAgICApO1xuXG4gICAgaW52YXJpYW50KHRoaXMuX3JvdXRlTm9kZXMuaW5kZXhPZihyb3V0ZSkgPT09IC0xLCAncm91dGUgbXVzdCBiZSB1bmlxdWUnKTtcblxuICAgIC8vIFdoZW4gcHVzaGluZywgcmVtb3ZlcyB0aGUgcmVzdCBvZiB0aGUgcm91dGVzIHBhc3QgdGhlIGN1cnJlbnQgaW5kZXguXG4gICAgdmFyIHJvdXRlTm9kZXMgPSB0aGlzLl9yb3V0ZU5vZGVzLndpdGhNdXRhdGlvbnMoKGxpc3Q6IExpc3QpID0+IHtcbiAgICAgIGxpc3Quc2xpY2UoMCwgdGhpcy5faW5kZXggKyAxKS5wdXNoKG5ldyBSb3V0ZU5vZGUocm91dGUpKTtcbiAgICB9KTtcblxuICAgIHJldHVybiB0aGlzLl91cGRhdGUocm91dGVOb2Rlcy5zaXplIC0gMSwgcm91dGVOb2Rlcyk7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyBhIG5ldyBzdGFjayBhIHNpemUgb25lcyBsZXNzIHRoYW4gdGhpcyBzdGFjayxcbiAgICogZXhjbHVkaW5nIHRoZSBsYXN0IGluZGV4IGluIHRoaXMgc3RhY2suXG4gICAqL1xuICBwb3AoKTogUm91dGVTdGFjayB7XG4gICAgaW52YXJpYW50KHRoaXMuX3JvdXRlTm9kZXMuc2l6ZSA+IDEsICdzaG91ZCBub3QgcG9wIHJvdXRlTm9kZXMgc3RhY2sgdG8gZW1wdHknKTtcblxuICAgIC8vIFdoZW4gcG9wcGluZywgcmVtb3ZlcyB0aGUgcmVzdCBvZiB0aGUgcm91dGVzIHBhc3QgdGhlIGN1cnJlbnQgaW5kZXguXG4gICAgdmFyIHJvdXRlTm9kZXMgPSB0aGlzLl9yb3V0ZU5vZGVzLnNsaWNlKDAsIHRoaXMuX2luZGV4KTtcbiAgICByZXR1cm4gdGhpcy5fdXBkYXRlKHJvdXRlTm9kZXMuc2l6ZSAtIDEsIHJvdXRlTm9kZXMpO1xuICB9XG5cbiAganVtcFRvSW5kZXgoaW5kZXg6IG51bWJlcik6IFJvdXRlU3RhY2sge1xuICAgIGludmFyaWFudChcbiAgICAgIGluZGV4ID4gLTEgJiYgaW5kZXggPCB0aGlzLl9yb3V0ZU5vZGVzLnNpemUsXG4gICAgICAnaW5kZXggb3V0IG9mIGJvdW5kJ1xuICAgICk7XG5cbiAgICByZXR1cm4gdGhpcy5fdXBkYXRlKGluZGV4LCB0aGlzLl9yb3V0ZU5vZGVzKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXBsYWNlIGEgcm91dGUgaW4gdGhlIG5hdmlnYXRpb24gc3RhY2suXG4gICAqXG4gICAqIGBpbmRleGAgc3BlY2lmaWVzIHRoZSByb3V0ZSBpbiB0aGUgc3RhY2sgdGhhdCBzaG91bGQgYmUgcmVwbGFjZWQuXG4gICAqIElmIGl0J3MgbmVnYXRpdmUsIGl0IGNvdW50cyBmcm9tIHRoZSBiYWNrLlxuICAgKi9cbiAgcmVwbGFjZUF0SW5kZXgoaW5kZXg6IG51bWJlciwgcm91dGU6IGFueSk6IFJvdXRlU3RhY2sge1xuICAgIGludmFyaWFudChcbiAgICAgICFpc1JvdXRlRW1wdHkocm91dGUpLFxuICAgICAgJ011c3Qgc3VwcGx5IHJvdXRlIHRvIHJlcGxhY2UnXG4gICAgKTtcblxuICAgIGlmICh0aGlzLmdldChpbmRleCkgPT09IHJvdXRlKSB7XG4gICAgICByZXR1cm4gdGhpcztcbiAgICB9XG5cbiAgICBpbnZhcmlhbnQodGhpcy5pbmRleE9mKHJvdXRlKSA9PT0gLTEsICdyb3V0ZSBtdXN0IGJlIHVuaXF1ZScpO1xuXG4gICAgaWYgKGluZGV4IDwgMCkge1xuICAgICAgaW5kZXggKz0gdGhpcy5fcm91dGVOb2Rlcy5zaXplO1xuICAgIH1cblxuICAgIGludmFyaWFudChcbiAgICAgIGluZGV4ID4gLTEgJiYgaW5kZXggPCB0aGlzLl9yb3V0ZU5vZGVzLnNpemUsXG4gICAgICAnaW5kZXggb3V0IG9mIGJvdW5kJ1xuICAgICk7XG5cbiAgICB2YXIgcm91dGVOb2RlcyA9IHRoaXMuX3JvdXRlTm9kZXMuc2V0KGluZGV4LCBuZXcgUm91dGVOb2RlKHJvdXRlKSk7XG4gICAgcmV0dXJuIHRoaXMuX3VwZGF0ZShpbmRleCwgcm91dGVOb2Rlcyk7XG4gIH1cblxuICAvLyBJdGVyYXRpb25zXG4gIGZvckVhY2goY2FsbGJhY2s6IEl0ZXJhdGlvbkNhbGxiYWNrLCBjb250ZXh0OiA/T2JqZWN0KTogdm9pZCB7XG4gICAgdmFyIGlpID0gMDtcbiAgICB2YXIgbm9kZXMgPSB0aGlzLl9yb3V0ZU5vZGVzO1xuICAgIHdoaWxlIChpaSA8IG5vZGVzLnNpemUpIHtcbiAgICAgIHZhciBub2RlID0gbm9kZXMuZ2V0KGlpKTtcbiAgICAgIGNhbGxiYWNrLmNhbGwoY29udGV4dCwgbm9kZS52YWx1ZSwgaWksIG5vZGUua2V5KTtcbiAgICAgIGlpKys7XG4gICAgfVxuICB9XG5cbiAgbWFwVG9BcnJheShjYWxsYmFjazogSXRlcmF0aW9uQ2FsbGJhY2ssIGNvbnRleHQ6ID9PYmplY3QpOiBBcnJheTxhbnk+IHtcbiAgICB2YXIgcmVzdWx0ID0gW107XG4gICAgdGhpcy5mb3JFYWNoKChyb3V0ZSwgaW5kZXgsIGtleSkgPT4ge1xuICAgICAgcmVzdWx0LnB1c2goY2FsbGJhY2suY2FsbChjb250ZXh0LCByb3V0ZSwgaW5kZXgsIGtleSkpO1xuICAgIH0pO1xuICAgIHJldHVybiByZXN1bHQ7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyBhIFNldCBleGNsdWRpbmcgYW55IHJvdXRlcyBjb250YWluZWQgd2l0aGluIHRoZSBzdGFjayBnaXZlbi5cbiAgICovXG4gIHN1YnRyYWN0KHN0YWNrOiBSb3V0ZVN0YWNrKTogU2V0PFN0YWNrRGlmZlJlY29yZD4ge1xuICAgIHZhciBpdGVtcyA9IFtdO1xuICAgIHRoaXMuX3JvdXRlTm9kZXMuZm9yRWFjaCgobm9kZTogUm91dGVOb2RlLCBpbmRleDogbnVtYmVyKSA9PiB7XG4gICAgICBpZiAoIXN0YWNrLl9yb3V0ZU5vZGVzLmNvbnRhaW5zKG5vZGUpKSB7XG4gICAgICAgIGl0ZW1zLnB1c2goXG4gICAgICAgICAgbmV3IFN0YWNrRGlmZlJlY29yZCh7XG4gICAgICAgICAgICByb3V0ZTogbm9kZS52YWx1ZSxcbiAgICAgICAgICAgIGluZGV4OiBpbmRleCxcbiAgICAgICAgICAgIGtleTogbm9kZS5rZXksXG4gICAgICAgICAgfSlcbiAgICAgICAgKTtcbiAgICAgIH1cbiAgICB9KTtcbiAgICByZXR1cm4gbmV3IFNldChpdGVtcyk7XG4gIH1cblxuICBfdXBkYXRlKGluZGV4OiBudW1iZXIsIHJvdXRlTm9kZXM6IExpc3QpOiBSb3V0ZVN0YWNrIHtcbiAgICBpZiAodGhpcy5faW5kZXggPT09IGluZGV4ICYmIHRoaXMuX3JvdXRlTm9kZXMgPT09IHJvdXRlTm9kZXMpIHtcbiAgICAgIHJldHVybiB0aGlzO1xuICAgIH1cbiAgICByZXR1cm4gbmV3IFJvdXRlU3RhY2soaW5kZXgsIHJvdXRlTm9kZXMpO1xuICB9XG59XG5cbi8qKlxuICogVGhlIGZpcnN0IGNsYXNzIGRhdGEgc3RydWN0dXJlIGZvciBOYXZpZ2F0aW9uQ29udGV4dCB0byBtYW5hZ2UgdGhlIG5hdmlnYXRpb25cbiAqIHN0YWNrIG9mIHJvdXRlcy5cbiAqL1xuY2xhc3MgTmF2aWdhdGlvblJvdXRlU3RhY2sgZXh0ZW5kcyBSb3V0ZVN0YWNrIHtcbiAgY29uc3RydWN0b3IoaW5kZXg6IG51bWJlciwgcm91dGVOb2RlczogQXJyYXk8YW55Pikge1xuICAgIC8vIEZvciBub3csIGBSb3V0ZVN0YWNrYCBpbnRlcm5hbGx5LCAgdXNlcyBhbiBpbW11dGFibGUgYExpc3RgIHRvIGtlZXBcbiAgICAvLyB0cmFjayBvZiByb3V0ZU5vZGVzLiBTaW5jZSB1c2luZyBgTGlzdGAgaXMgcmVhbGx5IGp1c3QgdGhlIGltcGxlbWVudGF0aW9uXG4gICAgLy8gZGV0YWlsLCB3ZSBkb24ndCB3YW50IHRvIGFjY2VwdCBgcm91dGVOb2Rlc2AgYXMgYGxpc3RgIGZyb20gY29uc3RydWN0b3JcbiAgICAvLyBmb3IgZGV2ZWxvcGVyLlxuICAgIHZhciBub2RlcyA9IHJvdXRlTm9kZXMubWFwKChyb3V0ZSkgPT4ge1xuICAgICAgaW52YXJpYW50KCFpc1JvdXRlRW1wdHkocm91dGUpLCAncm91dGUgbXVzdCBub3QgYmUgbWVwdHknKTtcbiAgICAgIHJldHVybiBuZXcgUm91dGVOb2RlKHJvdXRlKTtcbiAgICB9KTtcblxuICAgIHN1cGVyKGluZGV4LCBuZXcgTGlzdChub2RlcykpO1xuICB9XG59XG5cbm1vZHVsZS5leHBvcnRzID0gTmF2aWdhdGlvblJvdXRlU3RhY2s7XG4iXX0=