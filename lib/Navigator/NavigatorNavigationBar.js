








'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();

var _react=require('react');var _react2=_interopRequireDefault(_react);
var _ReactNavigatorNavigationBarStylesAndroid=require('./NavigatorNavigationBarStylesAndroid');var _ReactNavigatorNavigationBarStylesAndroid2=_interopRequireDefault(_ReactNavigatorNavigationBarStylesAndroid);
var _ReactNavigatorNavigationBarStylesIOS=require('./NavigatorNavigationBarStylesIOS');var _ReactNavigatorNavigationBarStylesIOS2=_interopRequireDefault(_ReactNavigatorNavigationBarStylesIOS);
var _ReactStyleSheet=require('../StyleSheet/StyleSheet.web');var _ReactStyleSheet2=_interopRequireDefault(_ReactStyleSheet);

var _ReactView=require('../View/View.web');var _ReactView2=_interopRequireDefault(_ReactView);
var _immutable=require('immutable');
var _autobindDecorator=require('autobind-decorator');var _autobindDecorator2=_interopRequireDefault(_autobindDecorator);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}

var COMPONENT_NAMES=['Title','LeftButton','RightButton'];

var NavigatorNavigationBarStyles=_ReactStyleSheet2.default.OS==='android'?_ReactNavigatorNavigationBarStylesAndroid2.default:_ReactNavigatorNavigationBarStylesIOS2.default;


var navStatePresentedIndex=function navStatePresentedIndex(navState){
if(navState.presentedIndex!==undefined){
return navState.presentedIndex;
}

return navState.observedTopOfStack;
};var

NavigatorNavigationBar=function(_Component){_inherits(NavigatorNavigationBar,_Component);

function NavigatorNavigationBar(props){_classCallCheck(this,NavigatorNavigationBar);var _this=_possibleConstructorReturn(this,(NavigatorNavigationBar.__proto__||Object.getPrototypeOf(NavigatorNavigationBar)).call(this,
props));

_this._components={};
_this._descriptors={};

COMPONENT_NAMES.forEach(function(componentName){
_this._components[componentName]=new _immutable.Map();
_this._descriptors[componentName]=new _immutable.Map();
});return _this;

}_createClass(NavigatorNavigationBar,[{key:'_getReusableProps',value:function _getReusableProps(



























componentName,
index)
{
if(!this._reusableProps){
this._reusableProps={};
}
var propStack=this._reusableProps[componentName];
if(!propStack){
propStack=this._reusableProps[componentName]=[];
}
var props=propStack[index];
if(!props){
props=propStack[index]={style:{}};
}
return props;
}},{key:'_updateIndexProgress',value:function _updateIndexProgress(


progress,
index,
fromIndex,
toIndex)
{
var amount=toIndex>fromIndex?progress:1-progress;
var oldDistToCenter=index-fromIndex;
var newDistToCenter=index-toIndex;
var interpolate;
if(oldDistToCenter>0&&newDistToCenter===0||
newDistToCenter>0&&oldDistToCenter===0){
interpolate=this.props.navigationStyles.Interpolators.RightToCenter;
}else if(oldDistToCenter<0&&newDistToCenter===0||
newDistToCenter<0&&oldDistToCenter===0){
interpolate=this.props.navigationStyles.Interpolators.CenterToLeft;
}else if(oldDistToCenter===newDistToCenter){
interpolate=this.props.navigationStyles.Interpolators.RightToCenter;
}else{
interpolate=this.props.navigationStyles.Interpolators.RightToLeft;
}

COMPONENT_NAMES.forEach(function(componentName){
var component=this._components[componentName].get(this.props.navState.routeStack[index]);
var props=this._getReusableProps(componentName,index);
if(component&&interpolate[componentName](props.style,amount)){
component.setNativeProps(props);
}
},this);
}},{key:'updateProgress',value:function updateProgress(


progress,
fromIndex,
toIndex)
{
var max=Math.max(fromIndex,toIndex);
var min=Math.min(fromIndex,toIndex);
for(var index=min;index<=max;index++){
this._updateIndexProgress(progress,index,fromIndex,toIndex);
}
}},{key:'render',value:function render()

{
var navBarStyle={
height:this.props.navigationStyles.General.TotalNavHeight};

var navState=this.props.navState;
var components=COMPONENT_NAMES.map(function(componentName){
return navState.routeStack.map(
this._getComponent.bind(this,componentName));

},this);

return(
_react2.default.createElement(_ReactView2.default,{style:[styles.navBarContainer,navBarStyle,this.props.style]},
components));


}},{key:'_getComponent',value:function _getComponent(


componentName,
route,
index)
{var _this2=this;
if(this._descriptors[componentName].includes(route)){
return this._descriptors[componentName].get(route);
}

var rendered=null;

var content=this.props.routeMapper[componentName](
this.props.navState.routeStack[index],
this.props.navigator,
index,
this.props.navState);

if(!content){
return null;
}

var initialStage=index===navStatePresentedIndex(this.props.navState)?
this.props.navigationStyles.Stages.Center:
this.props.navigationStyles.Stages.Left;
rendered=
_react2.default.createElement(_ReactView2.default,{
ref:function ref(_ref){
_this2._components[componentName]=_this2._components[componentName].set(route,_ref);
},
style:initialStage[componentName]},
content);



this._descriptors[componentName]=this._descriptors[componentName].set(route,rendered);
return rendered;
}}]);return NavigatorNavigationBar;}(_react.Component);NavigatorNavigationBar.propTypes={navigator:_react.PropTypes.object,routeMapper:_react.PropTypes.shape({Title:_react.PropTypes.func.isRequired,LeftButton:_react.PropTypes.func.isRequired,RightButton:_react.PropTypes.func.isRequired}).isRequired,navState:_react.PropTypes.shape({routeStack:_react.PropTypes.arrayOf(_react.PropTypes.object),presentedIndex:_react.PropTypes.number}),navigationStyles:_react.PropTypes.object,style:_ReactView2.default.propTypes.style};NavigatorNavigationBar.statics={Styles:NavigatorNavigationBarStyles,StylesAndroid:_ReactNavigatorNavigationBarStylesAndroid2.default,StylesIOS:_ReactNavigatorNavigationBarStylesIOS2.default};NavigatorNavigationBar.defaultProps={navigationStyles:NavigatorNavigationBarStyles};

;


var styles=_ReactStyleSheet2.default.create({
navBarContainer:{
position:'absolute',
top:0,
left:0,
right:0,
backgroundColor:'transparent'}});



(0,_autobindDecorator2.default)(NavigatorNavigationBar);

module.exports=NavigatorNavigationBar;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIk5hdmlnYXRvck5hdmlnYXRpb25CYXIuanMiXSwibmFtZXMiOlsiQ09NUE9ORU5UX05BTUVTIiwiTmF2aWdhdG9yTmF2aWdhdGlvbkJhclN0eWxlcyIsIk9TIiwibmF2U3RhdGVQcmVzZW50ZWRJbmRleCIsIm5hdlN0YXRlIiwicHJlc2VudGVkSW5kZXgiLCJ1bmRlZmluZWQiLCJvYnNlcnZlZFRvcE9mU3RhY2siLCJOYXZpZ2F0b3JOYXZpZ2F0aW9uQmFyIiwicHJvcHMiLCJfY29tcG9uZW50cyIsIl9kZXNjcmlwdG9ycyIsImZvckVhY2giLCJjb21wb25lbnROYW1lIiwiaW5kZXgiLCJfcmV1c2FibGVQcm9wcyIsInByb3BTdGFjayIsInN0eWxlIiwicHJvZ3Jlc3MiLCJmcm9tSW5kZXgiLCJ0b0luZGV4IiwiYW1vdW50Iiwib2xkRGlzdFRvQ2VudGVyIiwibmV3RGlzdFRvQ2VudGVyIiwiaW50ZXJwb2xhdGUiLCJuYXZpZ2F0aW9uU3R5bGVzIiwiSW50ZXJwb2xhdG9ycyIsIlJpZ2h0VG9DZW50ZXIiLCJDZW50ZXJUb0xlZnQiLCJSaWdodFRvTGVmdCIsImNvbXBvbmVudCIsImdldCIsInJvdXRlU3RhY2siLCJfZ2V0UmV1c2FibGVQcm9wcyIsInNldE5hdGl2ZVByb3BzIiwibWF4IiwiTWF0aCIsIm1pbiIsIl91cGRhdGVJbmRleFByb2dyZXNzIiwibmF2QmFyU3R5bGUiLCJoZWlnaHQiLCJHZW5lcmFsIiwiVG90YWxOYXZIZWlnaHQiLCJjb21wb25lbnRzIiwibWFwIiwiX2dldENvbXBvbmVudCIsImJpbmQiLCJzdHlsZXMiLCJuYXZCYXJDb250YWluZXIiLCJyb3V0ZSIsImluY2x1ZGVzIiwicmVuZGVyZWQiLCJjb250ZW50Iiwicm91dGVNYXBwZXIiLCJuYXZpZ2F0b3IiLCJpbml0aWFsU3RhZ2UiLCJTdGFnZXMiLCJDZW50ZXIiLCJMZWZ0IiwicmVmIiwic2V0IiwicHJvcFR5cGVzIiwib2JqZWN0Iiwic2hhcGUiLCJUaXRsZSIsImZ1bmMiLCJpc1JlcXVpcmVkIiwiTGVmdEJ1dHRvbiIsIlJpZ2h0QnV0dG9uIiwiYXJyYXlPZiIsIm51bWJlciIsInN0YXRpY3MiLCJTdHlsZXMiLCJTdHlsZXNBbmRyb2lkIiwiU3R5bGVzSU9TIiwiZGVmYXVsdFByb3BzIiwiY3JlYXRlIiwicG9zaXRpb24iLCJ0b3AiLCJsZWZ0IiwicmlnaHQiLCJiYWNrZ3JvdW5kQ29sb3IiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7QUFTQSxhOztBQUVBLDRCO0FBQ0EsK0Y7QUFDQSx1RjtBQUNBLDZEOztBQUVBLDJDO0FBQ0E7QUFDQSxxRDs7QUFFQSxHQUFJQSxpQkFBa0IsQ0FBQyxPQUFELENBQVUsWUFBVixDQUF3QixhQUF4QixDQUF0Qjs7QUFFQSxHQUFJQyw4QkFBK0IsMEJBQVNDLEVBQVQsR0FBZ0IsU0FBaEIsa0dBQW5DOzs7QUFHQSxHQUFJQyx3QkFBeUIsUUFBekJBLHVCQUF5QixDQUFTQyxRQUFULENBQW1CO0FBQzlDLEdBQUlBLFNBQVNDLGNBQVQsR0FBNEJDLFNBQWhDLENBQTJDO0FBQ3pDLE1BQU9GLFVBQVNDLGNBQWhCO0FBQ0Q7O0FBRUQsTUFBT0QsVUFBU0csa0JBQWhCO0FBQ0QsQ0FORCxDOztBQVFNQyxzQjs7QUFFSixnQ0FBWUMsS0FBWixDQUFtQjtBQUNYQSxLQURXOztBQUdqQixNQUFLQyxXQUFMLENBQW1CLEVBQW5CO0FBQ0EsTUFBS0MsWUFBTCxDQUFvQixFQUFwQjs7QUFFQVgsZ0JBQWdCWSxPQUFoQixDQUF3Qix1QkFBaUI7QUFDdkMsTUFBS0YsV0FBTCxDQUFpQkcsYUFBakIsRUFBa0Msb0JBQWxDO0FBQ0EsTUFBS0YsWUFBTCxDQUFrQkUsYUFBbEIsRUFBbUMsb0JBQW5DO0FBQ0QsQ0FIRCxFQU5pQjs7QUFXbEIsQzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQTRCYUEsYTtBQUNBQyxLO0FBQ0M7QUFDYixHQUFJLENBQUMsS0FBS0MsY0FBVixDQUEwQjtBQUN4QixLQUFLQSxjQUFMLENBQXNCLEVB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R2ZDLEtBQU0sQ0FIUztBQUlmQyxNQUFPLENBSlE7QUFLZkMsZ0JBQWlCLGFBTEYsQ0FEWSxDQUFsQixDQUFiOzs7O0FBVUEsZ0NBQVN6RSxzQkFBVDs7QUFFQTBFLE9BQU9DLE9BQVAsQ0FBaUIzRSxzQkFBakIiLCJmaWxlIjoiTmF2aWdhdG9yTmF2aWdhdGlvbkJhci5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSAyMDE1LXByZXNlbnQsIEFsaWJhYmEgR3JvdXAgSG9sZGluZyBMaW1pdGVkLlxuICogQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTUtcHJlc2VudCwgRmFjZWJvb2ssIEluYy5cbiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKlxuICogQHByb3ZpZGVzTW9kdWxlIFJlYWN0TmF2aWdhdG9yTmF2aWdhdGlvbkJhclxuICovXG4ndXNlIHN0cmljdCc7XG5cbmltcG9ydCBSZWFjdCwgeyBDb21wb25lbnQsIFByb3BUeXBlcyB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBOYXZpZ2F0b3JOYXZpZ2F0aW9uQmFyU3R5bGVzQW5kcm9pZCBmcm9tICdSZWFjdE5hdmlnYXRvck5hdmlnYXRpb25CYXJTdHlsZXNBbmRyb2lkJztcbmltcG9ydCBOYXZpZ2F0b3JOYXZpZ2F0aW9uQmFyU3R5bGVzSU9TIGZyb20gJ1JlYWN0TmF2aWdhdG9yTmF2aWdhdGlvbkJhclN0eWxlc0lPUyc7XG5pbXBvcnQgUGxhdGZvcm0gZnJvbSAnUmVhY3RTdHlsZVNoZWV0JztcbmltcG9ydCBTdHlsZVNoZWV0IGZyb20gJ1JlYWN0U3R5bGVTaGVldCc7XG5pbXBvcnQgVmlldyBmcm9tICdSZWFjdFZpZXcnO1xuaW1wb3J0IHsgTWFwIH0gZnJvbSAnaW1tdXRhYmxlJztcbmltcG9ydCBhdXRvYmluZCBmcm9tICdhdXRvYmluZC1kZWNvcmF0b3InO1xuXG52YXIgQ09NUE9ORU5UX05BTUVTID0gWydUaXRsZScsICdMZWZ0QnV0dG9uJywgJ1JpZ2h0QnV0dG9uJ107XG5cbnZhciBOYXZpZ2F0b3JOYXZpZ2F0aW9uQmFyU3R5bGVzID0gUGxhdGZvcm0uT1MgPT09ICdhbmRyb2lkJyA/XG4gIE5hdmlnYXRvck5hdmlnYXRpb25CYXJTdHlsZXNBbmRyb2lkIDogTmF2aWdhdG9yTmF2aWdhdGlvbkJhclN0eWxlc0lPUztcblxudmFyIG5hdlN0YXRlUHJlc2VudGVkSW5kZXggPSBmdW5jdGlvbihuYXZTdGF0ZSkge1xuICBpZiAobmF2U3RhdGUucHJlc2VudGVkSW5kZXggIT09IHVuZGVmaW5lZCkge1xuICAgIHJldHVybiBuYXZTdGF0ZS5wcmVzZW50ZWRJbmRleDtcbiAgfVxuICAvLyBUT0RPOiByZW5hbWUgYG9ic2VydmVkVG9wT2ZTdGFja2AgdG8gYHByZXNlbnRlZEluZGV4YCBpbiBgTmF2aWdhdG9ySU9TYFxuICByZXR1cm4gbmF2U3RhdGUub2JzZXJ2ZWRUb3BPZlN0YWNrO1xufTtcblxuY2xhc3MgTmF2aWdhdG9yTmF2aWdhdGlvbkJhciBleHRlbmRzIENvbXBvbmVudCB7XG5cbiAgY29uc3RydWN0b3IocHJvcHMpIHtcbiAgICBzdXBlcihwcm9wcyk7XG5cbiAgICB0aGlzLl9jb21wb25lbnRzID0ge307XG4gICAgdGhpcy5fZGVzY3JpcHRvcnMgPSB7fTtcblxuICAgIENPTVBPTkVOVF9OQU1FUy5mb3JFYWNoKGNvbXBvbmVudE5hbWUgPT4ge1xuICAgICAgdGhpcy5fY29tcG9uZW50c1tjb21wb25lbnROYW1lXSA9IG5ldyBNYXAoKTtcbiAgICAgIHRoaXMuX2Rlc2NyaXB0b3JzW2NvbXBvbmVudE5hbWVdID0gbmV3IE1hcCgpO1xuICAgIH0pO1xuXG4gIH1cblxuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgIG5hdmlnYXRvcjogUHJvcFR5cGVzLm9iamVjdCxcbiAgICByb3V0ZU1hcHBlcjogUHJvcFR5cGVzLnNoYXBlKHtcbiAgICAgIFRpdGxlOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgICAgTGVmdEJ1dHRvbjogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICAgIFJpZ2h0QnV0dG9uOiBQcm9wVHlwZXMuZnVuYy5pc1JlcXVpcmVkLFxuICAgIH0pLmlzUmVxdWlyZWQsXG4gICAgbmF2U3RhdGU6IFByb3BUeXBlcy5zaGFwZSh7XG4gICAgICByb3V0ZVN0YWNrOiBQcm9wVHlwZXMuYXJyYXlPZihQcm9wVHlwZXMub2JqZWN0KSxcbiAgICAgIHByZXNlbnRlZEluZGV4OiBQcm9wVHlwZXMubnVtYmVyLFxuICAgIH0pLFxuICAgIG5hdmlnYXRpb25TdHlsZXM6IFByb3BUeXBlcy5vYmplY3QsXG4gICAgc3R5bGU6IFZpZXcucHJvcFR5cGVzLnN0eWxlLFxuICB9XG5cbiAgc3RhdGljIHN0YXRpY3MgPSB7XG4gICAgU3R5bGVzOiBOYXZpZ2F0b3JOYXZpZ2F0aW9uQmFyU3R5bGVzLFxuICAgIFN0eWxlc0FuZHJvaWQ6IE5hdmlnYXRvck5hdmlnYXRpb25CYXJTdHlsZXNBbmRyb2lkLFxuICAgIFN0eWxlc0lPUzogTmF2aWdhdG9yTmF2aWdhdGlvbkJhclN0eWxlc0lPUyxcbiAgfVxuXG4gIHN0YXRpYyBkZWZhdWx0UHJvcHMgPSB7XG4gICAgbmF2aWdhdGlvblN0eWxlczogTmF2aWdhdG9yTmF2aWdhdGlvbkJhclN0eWxlcyxcbiAgfVxuXG4gIF9nZXRSZXVzYWJsZVByb3BzKFxuICAgIC8qIHN0cmluZyAqL2NvbXBvbmVudE5hbWUsXG4gICAgLyogbnVtYmVyICovaW5kZXhcbiAgKSAvKiBvYmplY3QgKi8ge1xuICAgIGlmICghdGhpcy5fcmV1c2FibGVQcm9wcykge1xuICAgICAgdGhpcy5fcmV1c2FibGVQcm9wcyA9IHt9O1xuICAgIH1cbiAgICB2YXIgcHJvcFN0YWNrID0gdGhpcy5fcmV1c2FibGVQcm9wc1tjb21wb25lbnROYW1lXTtcbiAgICBpZiAoIXByb3BTdGFjaykge1xuICAgICAgcHJvcFN0YWNrID0gdGhpcy5fcmV1c2FibGVQcm9wc1tjb21wb25lbnROYW1lXSA9IFtdO1xuICAgIH1cbiAgICB2YXIgcHJvcHMgPSBwcm9wU3RhY2tbaW5kZXhdO1xuICAgIGlmICghcHJvcHMpIHtcbiAgICAgIHByb3BzID0gcHJvcFN0YWNrW2luZGV4XSA9IHtzdHlsZTp7fX07XG4gICAgfVxuICAgIHJldHVybiBwcm9wcztcbiAgfVxuXG4gIF91cGRhdGVJbmRleFByb2dyZXNzKFxuICAgIC8qIG51bWJlciAqL3Byb2dyZXNzLFxuICAgIC8qIG51bWJlciAqL2luZGV4LFxuICAgIC8qIG51bWJlciAqL2Zyb21JbmRleCxcbiAgICAvKiBudW1iZXIgKi90b0luZGV4XG4gICkge1xuICAgIHZhciBhbW91bnQgPSB0b0luZGV4ID4gZnJvbUluZGV4ID8gcHJvZ3Jlc3MgOiAoMSAtIHByb2dyZXNzKTtcbiAgICB2YXIgb2xkRGlzdFRvQ2VudGVyID0gaW5kZXggLSBmcm9tSW5kZXg7XG4gICAgdmFyIG5ld0Rpc3RUb0NlbnRlciA9IGluZGV4IC0gdG9JbmRleDtcbiAgICB2YXIgaW50ZXJwb2xhdGU7XG4gICAgaWYgKG9sZERpc3RUb0NlbnRlciA+IDAgJiYgbmV3RGlzdFRvQ2VudGVyID09PSAwIHx8XG4gICAgICAgIG5ld0Rpc3RUb0NlbnRlciA+IDAgJiYgb2xkRGlzdFRvQ2VudGVyID09PSAwKSB7XG4gICAgICBpbnRlcnBvbGF0ZSA9IHRoaXMucHJvcHMubmF2aWdhdGlvblN0eWxlcy5JbnRlcnBvbGF0b3JzLlJpZ2h0VG9DZW50ZXI7XG4gICAgfSBlbHNlIGlmIChvbGREaXN0VG9DZW50ZXIgPCAwICYmIG5ld0Rpc3RUb0NlbnRlciA9PT0gMCB8fFxuICAgICAgICAgICAgICAgbmV3RGlzdFRvQ2VudGVyIDwgMCAmJiBvbGREaXN0VG9DZW50ZXIgPT09IDApIHtcbiAgICAgIGludGVycG9sYXRlID0gdGhpcy5wcm9wcy5uYXZpZ2F0aW9uU3R5bGVzLkludGVycG9sYXRvcnMuQ2VudGVyVG9MZWZ0O1xuICAgIH0gZWxzZSBpZiAob2xkRGlzdFRvQ2VudGVyID09PSBuZXdEaXN0VG9DZW50ZXIpIHtcbiAgICAgIGludGVycG9sYXRlID0gdGhpcy5wcm9wcy5uYXZpZ2F0aW9uU3R5bGVzLkludGVycG9sYXRvcnMuUmlnaHRUb0NlbnRlcjtcbiAgICB9IGVsc2Uge1xuICAgICAgaW50ZXJwb2xhdGUgPSB0aGlzLnByb3BzLm5hdmlnYXRpb25TdHlsZXMuSW50ZXJwb2xhdG9ycy5SaWdodFRvTGVmdDtcbiAgICB9XG5cbiAgICBDT01QT05FTlRfTkFNRVMuZm9yRWFjaChmdW5jdGlvbihjb21wb25lbnROYW1lKSB7XG4gICAgICB2YXIgY29tcG9uZW50ID0gdGhpcy5fY29tcG9uZW50c1tjb21wb25lbnROYW1lXS5nZXQodGhpcy5wcm9wcy5uYXZTdGF0ZS5yb3V0ZVN0YWNrW2luZGV4XSk7XG4gICAgICB2YXIgcHJvcHMgPSB0aGlzLl9nZXRSZXVzYWJsZVByb3BzKGNvbXBvbmVudE5hbWUsIGluZGV4KTtcbiAgICAgIGlmIChjb21wb25lbnQgJiYgaW50ZXJwb2xhdGVbY29tcG9uZW50TmFtZV0ocHJvcHMuc3R5bGUsIGFtb3VudCkpIHtcbiAgICAgICAgY29tcG9uZW50LnNldE5hdGl2ZVByb3BzKHByb3BzKTtcbiAgICAgIH1cbiAgICB9LCB0aGlzKTtcbiAgfVxuXG4gIHVwZGF0ZVByb2dyZXNzKFxuICAgIC8qIG51bWJlciAqL3Byb2dyZXNzLFxuICAgIC8qIG51bWJlciAqL2Zyb21JbmRleCxcbiAgICAvKiBudW1iZXIgKi90b0luZGV4XG4gICkge1xuICAgIHZhciBtYXggPSBNYXRoLm1heChmcm9tSW5kZXgsIHRvSW5kZXgpO1xuICAgIHZhciBtaW4gPSBNYXRoLm1pbihmcm9tSW5kZXgsIHRvSW5kZXgpO1xuICAgIGZvciAodmFyIGluZGV4ID0gbWluOyBpbmRleCA8PSBtYXg7IGluZGV4KyspIHtcbiAgICAgIHRoaXMuX3VwZGF0ZUluZGV4UHJvZ3Jlc3MocHJvZ3Jlc3MsIGluZGV4LCBmcm9tSW5kZXgsIHRvSW5kZXgpO1xuICAgIH1cbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICB2YXIgbmF2QmFyU3R5bGUgPSB7XG4gICAgICBoZWlnaHQ6IHRoaXMucHJvcHMubmF2aWdhdGlvblN0eWxlcy5HZW5lcmFsLlRvdGFsTmF2SGVpZ2h0LFxuICAgIH07XG4gICAgdmFyIG5hdlN0YXRlID0gdGhpcy5wcm9wcy5uYXZTdGF0ZTtcbiAgICB2YXIgY29tcG9uZW50cyA9IENPTVBPTkVOVF9OQU1FUy5tYXAoZnVuY3Rpb24oY29tcG9uZW50TmFtZSkge1xuICAgICAgcmV0dXJuIG5hdlN0YXRlLnJvdXRlU3RhY2subWFwKFxuICAgICAgICB0aGlzLl9nZXRDb21wb25lbnQuYmluZCh0aGlzLCBjb21wb25lbnROYW1lKVxuICAgICAgKTtcbiAgICB9LCB0aGlzKTtcblxuICAgIHJldHVybiAoXG4gICAgICA8VmlldyBzdHlsZT17W3N0eWxlcy5uYXZCYXJDb250YWluZXIsIG5hdkJhclN0eWxlLCB0aGlzLnByb3BzLnN0eWxlXX0+XG4gICAgICAgIHtjb21wb25lbnRzfVxuICAgICAgPC9WaWV3PlxuICAgICk7XG4gIH1cblxuICBfZ2V0Q29tcG9uZW50KFxuICAgIC8qIHN0cmluZyAqL2NvbXBvbmVudE5hbWUsXG4gICAgLyogb2JqZWN0ICovcm91dGUsXG4gICAgLyogbnVtYmVyICovaW5kZXhcbiAgKSAvKiA/T2JqZWN0ICovIHtcbiAgICBpZiAodGhpcy5fZGVzY3JpcHRvcnNbY29tcG9uZW50TmFtZV0uaW5jbHVkZXMocm91dGUpKSB7XG4gICAgICByZXR1cm4gdGhpcy5fZGVzY3JpcHRvcnNbY29tcG9uZW50TmFtZV0uZ2V0KHJvdXRlKTtcbiAgICB9XG5cbiAgICB2YXIgcmVuZGVyZWQgPSBudWxsO1xuXG4gICAgdmFyIGNvbnRlbnQgPSB0aGlzLnByb3BzLnJvdXRlTWFwcGVyW2NvbXBvbmVudE5hbWVdKFxuICAgICAgdGhpcy5wcm9wcy5uYXZTdGF0ZS5yb3V0ZVN0YWNrW2luZGV4XSxcbiAgICAgIHRoaXMucHJvcHMubmF2aWdhdG9yLFxuICAgICAgaW5kZXgsXG4gICAgICB0aGlzLnByb3BzLm5hdlN0YXRlXG4gICAgKTtcbiAgICBpZiAoIWNvbnRlbnQpIHtcbiAgICAgIHJldHVybiBudWxsO1xuICAgIH1cblxuICAgIHZhciBpbml0aWFsU3RhZ2UgPSBpbmRleCA9PT0gbmF2U3RhdGVQcmVzZW50ZWRJbmRleCh0aGlzLnByb3BzLm5hdlN0YXRlKSA/XG4gICAgICB0aGlzLnByb3BzLm5hdmlnYXRpb25TdHlsZXMuU3RhZ2VzLkNlbnRlciA6XG4gICAgICB0aGlzLnByb3BzLm5hdmlnYXRpb25TdHlsZXMuU3RhZ2VzLkxlZnQ7XG4gICAgcmVuZGVyZWQgPSAoXG4gICAgICA8Vmlld1xuICAgICAgICByZWY9eyhyZWYpID0+IHtcbiAgICAgICAgICB0aGlzLl9jb21wb25lbnRzW2NvbXBvbmVudE5hbWVdID0gdGhpcy5fY29tcG9uZW50c1tjb21wb25lbnROYW1lXS5zZXQocm91dGUsIHJlZik7XG4gICAgICAgIH19XG4gICAgICAgIHN0eWxlPXtpbml0aWFsU3RhZ2VbY29tcG9uZW50TmFtZV19PlxuICAgICAgICB7Y29udGVudH1cbiAgICAgIDwvVmlldz5cbiAgICApO1xuXG4gICAgdGhpcy5fZGVzY3JpcHRvcnNbY29tcG9uZW50TmFtZV0gPSB0aGlzLl9kZXNjcmlwdG9yc1tjb21wb25lbnROYW1lXS5zZXQocm91dGUsIHJlbmRlcmVkKTtcbiAgICByZXR1cm4gcmVuZGVyZWQ7XG4gIH1cblxufTtcblxuXG52YXIgc3R5bGVzID0gU3R5bGVTaGVldC5jcmVhdGUoe1xuICBuYXZCYXJDb250YWluZXI6IHtcbiAgICBwb3NpdGlvbjogJ2Fic29sdXRlJyxcbiAgICB0b3A6IDAsXG4gICAgbGVmdDogMCxcbiAgICByaWdodDogMCxcbiAgICBiYWNrZ3JvdW5kQ29sb3I6ICd0cmFuc3BhcmVudCcsXG4gIH0sXG59KTtcblxuYXV0b2JpbmQoTmF2aWdhdG9yTmF2aWdhdGlvbkJhcik7XG5cbm1vZHVsZS5leHBvcnRzID0gTmF2aWdhdG9yTmF2aWdhdGlvbkJhcjtcbiJdfQ==