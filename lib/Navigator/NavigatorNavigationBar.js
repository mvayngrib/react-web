








'use strict';var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();

var _react=require('react');var _react2=_interopRequireDefault(_react);
var _ReactNavigatorNavigationBarStylesAndroid=require('./NavigatorNavigationBarStylesAndroid');var _ReactNavigatorNavigationBarStylesAndroid2=_interopRequireDefault(_ReactNavigatorNavigationBarStylesAndroid);
var _ReactNavigatorNavigationBarStylesIOS=require('./NavigatorNavigationBarStylesIOS');var _ReactNavigatorNavigationBarStylesIOS2=_interopRequireDefault(_ReactNavigatorNavigationBarStylesIOS);
var _ReactStyleSheet=require('../StyleSheet/StyleSheet.web');var _ReactStyleSheet2=_interopRequireDefault(_ReactStyleSheet);

var _ReactView=require('../View/View.web');var _ReactView2=_interopRequireDefault(_ReactView);
var _ReactDimensions=require('../Dimensions/Dimensions.web');var _ReactDimensions2=_interopRequireDefault(_ReactDimensions);
var _immutable=require('immutable');
var _autobindDecorator=require('autobind-decorator');var _autobindDecorator2=_interopRequireDefault(_autobindDecorator);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}

var COMPONENT_NAMES=['Title','LeftButton','RightButton'];

var NavigatorNavigationBarStyles=_ReactStyleSheet2.default.OS==='android'?_ReactNavigatorNavigationBarStylesAndroid2.default:_ReactNavigatorNavigationBarStylesIOS2.default;


var navStatePresentedIndex=function navStatePresentedIndex(navState){
if(navState.presentedIndex!==undefined){
return navState.presentedIndex;
}

return navState.observedTopOfStack;
};var

NavigatorNavigationBar=function(_Component){_inherits(NavigatorNavigationBar,_Component);

function NavigatorNavigationBar(props){_classCallCheck(this,NavigatorNavigationBar);var _this=_possibleConstructorReturn(this,(NavigatorNavigationBar.__proto__||Object.getPrototypeOf(NavigatorNavigationBar)).call(this,
props));

_this._components={};
_this._descriptors={};

COMPONENT_NAMES.forEach(function(componentName){
_this._components[componentName]=new _immutable.Map();
_this._descriptors[componentName]=new _immutable.Map();
});

_this._handleResize=_this._handleResize.bind(_this);return _this;
}_createClass(NavigatorNavigationBar,[{key:'_getReusableProps',value:function _getReusableProps(



























componentName,
index)
{
if(!this._reusableProps){
this._reusableProps={};
}
var propStack=this._reusableProps[componentName];
if(!propStack){
propStack=this._reusableProps[componentName]=[];
}
var props=propStack[index];
if(!props){
props=propStack[index]={style:{}};
}
return props;
}},{key:'_updateIndexProgress',value:function _updateIndexProgress(


progress,
index,
fromIndex,
toIndex)
{
var amount=toIndex>fromIndex?progress:1-progress;
var oldDistToCenter=index-fromIndex;
var newDistToCenter=index-toIndex;
var interpolate;
if(oldDistToCenter>0&&newDistToCenter===0||
newDistToCenter>0&&oldDistToCenter===0){
interpolate=this.props.navigationStyles.Interpolators.RightToCenter;
}else if(oldDistToCenter<0&&newDistToCenter===0||
newDistToCenter<0&&oldDistToCenter===0){
interpolate=this.props.navigationStyles.Interpolators.CenterToLeft;
}else if(oldDistToCenter===newDistToCenter){
interpolate=this.props.navigationStyles.Interpolators.RightToCenter;
}else{
interpolate=this.props.navigationStyles.Interpolators.RightToLeft;
}

COMPONENT_NAMES.forEach(function(componentName){
var component=this._components[componentName].get(this.props.navState.routeStack[index]);
var props=this._getReusableProps(componentName,index);
if(component&&interpolate[componentName](props.style,amount)){
component.setNativeProps(props);
}
},this);
}},{key:'updateProgress',value:function updateProgress(


progress,
fromIndex,
toIndex)
{
var max=Math.max(fromIndex,toIndex);
var min=Math.min(fromIndex,toIndex);
for(var index=min;index<=max;index++){
this._updateIndexProgress(progress,index,fromIndex,toIndex);
}
}},{key:'componentWillMount',value:function componentWillMount()

{
window.addEventListener('resize',this._handleResize);
}},{key:'componentWillUnmount',value:function componentWillUnmount()

{
window.removeEventListener('resize',this._handleResize);
clearTimeout(this._resizeTimeout);
}},{key:'_handleResize',value:function _handleResize()

{
var self=this;
clearTimeout(this._resizeTimeout);

this._resizeTimeout=setTimeout(function(){
self.setState({dimensions:_ReactDimensions2.default.get('window')});
},100);
}},{key:'render',value:function render()

{
var navBarStyle={
height:this.props.navigationStyles.General.TotalNavHeight};

var navState=this.props.navState;
var components=COMPONENT_NAMES.map(function(componentName){
return navState.routeStack.map(
this._getComponent.bind(this,componentName));

},this);

return(
_react2.default.createElement(_ReactView2.default,{style:[styles.navBarContainer,navBarStyle,this.props.style]},
components));


}},{key:'_getComponent',value:function _getComponent(


componentName,
route,
index)
{var _this2=this;
if(this._descriptors[componentName].includes(route)){
return this._descriptors[componentName].get(route);
}

var rendered=null;

var content=this.props.routeMapper[componentName](
this.props.navState.routeStack[index],
this.props.navigator,
index,
this.props.navState);

if(!content){
return null;
}

var initialStage=index===navStatePresentedIndex(this.props.navState)?
this.props.navigationStyles.Stages.Center:
this.props.navigationStyles.Stages.Left;
rendered=
_react2.default.createElement(_ReactView2.default,{
ref:function ref(_ref){
_this2._components[componentName]=_this2._components[componentName].set(route,_ref);
},
style:initialStage[componentName]},
content);



this._descriptors[componentName]=this._descriptors[componentName].set(route,rendered);
return rendered;
}}]);return NavigatorNavigationBar;}(_react.Component);NavigatorNavigationBar.propTypes={navigator:_react.PropTypes.object,routeMapper:_react.PropTypes.shape({Title:_react.PropTypes.func.isRequired,LeftButton:_react.PropTypes.func.isRequired,RightButton:_react.PropTypes.func.isRequired}).isRequired,navState:_react.PropTypes.shape({routeStack:_react.PropTypes.arrayOf(_react.PropTypes.object),presentedIndex:_react.PropTypes.number}),navigationStyles:_react.PropTypes.object,style:_ReactView2.default.propTypes.style};NavigatorNavigationBar.statics={Styles:NavigatorNavigationBarStyles,StylesAndroid:_ReactNavigatorNavigationBarStylesAndroid2.default,StylesIOS:_ReactNavigatorNavigationBarStylesIOS2.default};NavigatorNavigationBar.defaultProps={navigationStyles:NavigatorNavigationBarStyles};

;


var styles=_ReactStyleSheet2.default.create({
navBarContainer:{
position:'absolute',
top:0,
left:0,
right:0,
backgroundColor:'transparent'}});



(0,_autobindDecorator2.default)(NavigatorNavigationBar);

module.exports=NavigatorNavigationBar;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIk5hdmlnYXRvck5hdmlnYXRpb25CYXIuanMiXSwibmFtZXMiOlsiQ09NUE9ORU5UX05BTUVTIiwiTmF2aWdhdG9yTmF2aWdhdGlvbkJhclN0eWxlcyIsIk9TIiwibmF2U3RhdGVQcmVzZW50ZWRJbmRleCIsIm5hdlN0YXRlIiwicHJlc2VudGVkSW5kZXgiLCJ1bmRlZmluZWQiLCJvYnNlcnZlZFRvcE9mU3RhY2siLCJOYXZpZ2F0b3JOYXZpZ2F0aW9uQmFyIiwicHJvcHMiLCJfY29tcG9uZW50cyIsIl9kZXNjcmlwdG9ycyIsImZvckVhY2giLCJjb21wb25lbnROYW1lIiwiX2hhbmRsZVJlc2l6ZSIsImJpbmQiLCJpbmRleCIsIl9yZXVzYWJsZVByb3BzIiwicHJvcFN0YWNrIiwic3R5bGUiLCJwcm9ncmVzcyIsImZyb21JbmRleCIsInRvSW5kZXgiLCJhbW91bnQiLCJvbGREaXN0VG9DZW50ZXIiLCJuZXdEaXN0VG9DZW50ZXIiLCJpbnRlcnBvbGF0ZSIsIm5hdmlnYXRpb25TdHlsZXMiLCJJbnRlcnBvbGF0b3JzIiwiUmlnaHRUb0NlbnRlciIsIkNlbnRlclRvTGVmdCIsIlJpZ2h0VG9MZWZ0IiwiY29tcG9uZW50IiwiZ2V0Iiwicm91dGVTdGFjayIsIl9nZXRSZXVzYWJsZVByb3BzIiwic2V0TmF0aXZlUHJvcHMiLCJtYXgiLCJNYXRoIiwibWluIiwiX3VwZGF0ZUluZGV4UHJvZ3Jlc3MiLCJ3aW5kb3ciLCJhZGRFdmVudExpc3RlbmVyIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImNsZWFyVGltZW91dCIsIl9yZXNpemVUaW1lb3V0Iiwic2VsZiIsInNldFRpbWVvdXQiLCJzZXRTdGF0ZSIsImRpbWVuc2lvbnMiLCJuYXZCYXJTdHlsZSIsImhlaWdodCIsIkdlbmVyYWwiLCJUb3RhbE5hdkhlaWdodCIsImNvbXBvbmVudHMiLCJtYXAiLCJfZ2V0Q29tcG9uZW50Iiwic3R5bGVzIiwibmF2QmFyQ29udGFpbmVyIiwicm91dGUiLCJpbmNsdWRlcyIsInJlbmRlcmVkIiwiY29udGVudCIsInJvdXRlTWFwcGVyIiwibmF2aWdhdG9yIiwiaW5pdGlhbFN0YWdlIiwiU3RhZ2VzIiwiQ2VudGVyIiwiTGVmdCIsInJlZiIsInNldCIsInByb3BUeXBlcyIsIm9iamVjdCIsInNoYXBlIiwiVGl0bGUiLCJmdW5jIiwiaXNSZXF1aXJlZCIsIkxlZnRCdXR0b24iLCJSaWdodEJ1dHRvbiIsImFycmF5T2YiLCJudW1iZXIiLCJzdGF0aWNzIiwiU3R5bGVzIiwiU3R5bGVzQW5kcm9pZCIsIlN0eWxlc0lPUyIsImRlZmF1bHRQcm9wcyIsImNyZWF0ZSIsInBvc2l0aW9uIiwidG9wIiwibGVmdCIsInJpZ2h0IiwiYmFja2dyb3VuZENvbG9yIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Ijs7Ozs7Ozs7O0FBU0EsYTs7QUFFQSw0QjtBQUNBLCtGO0FBQ0EsdUY7QUFDQSw2RDs7QUFFQSwyQztBQUNBLDZEO0FBQ0E7QUFDQSxxRDs7QUFFQSxHQUFJQSxpQkFBa0IsQ0FBQyxPQUFELENBQVUsWUFBVixDQUF3QixhQUF4QixDQUF0Qjs7QUFFQSxHQUFJQyw4QkFBK0IsMEJBQVNDLEVBQVQsR0FBZ0IsU0FBaEIsa0dBQW5DOzs7QUFHQSxHQUFJQyx3QkFBeUIsUUFBekJBLHVCQUF5QixDQUFTQyxRQUFULENBQW1CO0FBQzlDLEdBQUlBLFNBQVNDLGNBQVQsR0FBNEJDLFNBQWhDLENBQTJDO0FBQ3pDLE1BQU9GLFVBQVNDLGNBQWhCO0FBQ0Q7O0FBRUQsTUFBT0QsVUFBU0csa0JBQWhCO0FBQ0QsQ0FORCxDOztBQVFNQyxzQjs7QUFFSixnQ0FBWUMsS0FBWixDQUFtQjtBQUNYQSxLQURXOztBQUdqQixNQUFLQyxXQUFMLENBQW1CLEVBQW5CO0FBQ0EsTUFBS0MsWUFBTCxDQUFvQixFQUFwQjs7QUFFQVgsZ0JBQWdCWSxPQUFoQixDQUF3Qix1QkFBaUI7QUFDdkMsTUFBS0YsV0FBTCxDQUFpQkcsYUFBakIsRUFBa0Msb0JBQWxDO0FBQ0EsTUFBS0YsWUFBTCxDQUFrQkUsYUFBbEIsRUFBbUMsb0JBQW5DO0FBQ0QsQ0FIRDs7QUFLQSxNQUFLQyxhQUFMLENBQXFCLE1BQUtBLGFBQUwsQ0FBbUJDLElBQW5CLE9BQXJCLENBWGlCO0FBWWxCLEM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUE0QmFGLGE7QUFDQUcsSztBQUNDO0FBQ2IsR0FBSSxDQUFDLEtBQUtDLGNBQVYsQ0FBMEI7QUFDeEIsS0FBS0EsY0FBTCxDQUFzQixFQUF0QjtBQUNEO0FBQ0QsR0FBSUMsV0FBWSxLQUFLRCxjQUFMLENBQW9CSixhQUFwQixDQUFoQjtBQUNBLEdBQUksQ0FBQ0ssU0FBTCxDQUFnQjtBQUNkQSxVQUFZLEtBQUtELGNBQUwsQ0FBb0JKLGFBQXBCLEVBQXFDLEVBQWpEO0FBQ0Q7QUFDRCxHQUFJSixPQUFRUyxVQUFVRixLQUFWLENBQVo7QUFDQSxHQUFJLENBQUNQLEtBQUwsQ0FBWTtBQUNWQSxNQUFRUyxVQUFVRixLQUFWLEVBQW1CLENBQUNHLE1BQU0sRUFBUCxDQUEzQjtBQUNEO0FBQ0QsTUFBT1YsTUFBUDtBQUNELEM7OztBQUdhVyxRO0FBQ0FKLEs7QUFDQUssUztBQUNBQyxPO0FBQ1o7QUFDQSxHQUFJQyxRQUFTRCxRQUFVRCxTQUFWLENBQXNCRCxRQUF0QixDQUFrQyxFQUFJQSxRQUFuRDtBQUNBLEdBQUlJLGlCQUFrQlIsTUFBUUssU0FBOUI7QUFDQSxHQUFJSSxpQkFBa0JULE1BQVFNLE9BQTlCO0FBQ0EsR0FBSUksWUFBSjtBQUNBLEdBQUlGLGdCQUFrQixDQUFsQixFQUF1QkMsa0JBQW9CLENBQTNDO0FBQ0FBLGdCQUFrQixDQUFsQixFQUF1QkQsa0JBQW9CLENBRC9DLENBQ2tEO0FBQ2hERSxZQUFjLEtBQUtqQixLQUFMLENBQVdrQixnQkFBWCxDQUE0QkMsYUFBNUIsQ0FBMENDLGFBQXhEO0FBQ0QsQ0FIRCxJQUdPLElBQUlMLGdCQUFrQixDQUFsQixFQUF1QkMsa0JBQW9CLENBQTNDO0FBQ0FBLGdCQUFrQixDQUFsQixFQUF1QkQsa0JBQW9CLENBRC9DLENBQ2tEO0FBQ3ZERSxZQUFjLEtBQUtqQixLQUFMLENBQVdrQixnQkFBWCxDQUE0QkMsYUFBNUIsQ0FBMENFLFlBQXhEO0FBQ0QsQ0FITSxJQUdBLElBQUlOLGtCQUFvQkMsZUFBeEIsQ0FBeUM7QUFDOUNDLFlBQWMsS0FBS2pCLEtBQUwsQ0FBV2tCLGdCQUFYLENBQTRCQyxhQUE1QixDQUEwQ0MsYUFBeEQ7QUFDRCxDQUZNLElBRUE7QUFDTEgsWUFBYyxLQUFLakIsS0FBTCxDQUFXa0IsZ0JBQVgsQ0FBNEJDLGFBQTVCLENBQTBDRyxXQUF4RDtBQUNEOztBQUVEL0IsZ0JBQWdCWSxPQUFoQixDQUF3QixTQUFTQyxhQUFULENBQXdCO0FBQzlDLEdBQUltQixXQUFZLEtBQUt0QixXQUFMLENBQWlCRyxhQUFqQixFQUFnQ29CLEdBQWhDLENBQW9DLEtBQUt4QixLQUFMLENBQVdMLFFBQVgsQ0FBb0I4QixVQUFwQixDQUErQmxCLEtBQS9CLENBQXBDLENBQWhCO0FBQ0EsR0FBSVAsT0FBUSxLQUFLMEIsaUJBQUwsQ0FBdUJ0QixhQUF2QixDQUFzQ0csS0FBdEMsQ0FBWjtBQUNBLEdBQUlnQixXQUFhTixZQUFZYixhQUFaLEVBQTJCSixNQUFNVSxLQUFqQyxDQUF3Q0ksTUFBeEMsQ0FBakIsQ0FBa0U7QUFDaEVTLFVBQVVJLGNBQVYsQ0FBeUIzQixLQUF6QjtBQUNEO0FBQ0YsQ0FORCxDQU1HLElBTkg7QUFPRCxDOzs7QUFHYVcsUTtBQUNBQyxTO0FBQ0FDLE87QUFDWjtBQUNBLEdBQUllLEtBQU1DLEtBQUtELEdBQUwsQ0FBU2hCLFNBQVQsQ0FBb0JDLE9BQXBCLENBQVY7QUFDQSxHQUFJaUIsS0FBTUQsS0FBS0MsR0FBTCxDQUFTbEIsU0FBVCxDQUFvQkMsT0FBcEIsQ0FBVjtBQUNBLElBQUssR0FBSU4sT0FBUXVCLEdBQWpCLENBQXNCdkIsT0FBU3FCLEdBQS9CLENBQW9DckIsT0FBcEMsQ0FBNkM7QUFDM0MsS0FBS3dCLG9CQUFMLENBQTBCcEIsUUFBMUIsQ0FBb0NKLEtBQXBDLENBQTJDSyxTQUEzQyxDQUFzREMsT0FBdEQ7QUFDRDtBQUNGLEM7O0FBRW9CO0FBQ25CbUIsT0FBT0MsZ0JBQVAsQ0FBd0IsUUFBeEIsQ0FBa0MsS0FBSzVCLGFBQXZDO0FBQ0QsQzs7QUFFc0I7QUFDckIyQixPQUFPRSxtQkFBUCxDQUEyQixRQUEzQixDQUFxQyxLQUFLN0IsYUFBMUM7QUFDQThCLGFBQWEsS0FBS0MsY0FBbEI7QUFDRCxDOztBQUVlO0FBQ2QsR0FBTUMsTUFBTyxJQUFiO0FBQ0FGLGFBQWEsS0FBS0MsY0FBbEI7O0FBRUEsS0FBS0EsY0FBTCxDQUFzQkUsV0FBVyxVQUFZO0FBQzNDRCxLQUFLRSxRQUFMLENBQWMsQ0FBRUMsV0FBWSwwQkFBV2hCLEdBQVgsQ0FBZSxRQUFmLENBQWQsQ0FBZDtBQUNELENBRnFCLENBRW5CLEdBRm1CLENBQXRCO0FBR0QsQzs7QUFFUTtBQUNQLEdBQUlpQixhQUFjO0FBQ2hCQyxPQUFRLEtBQUsxQyxLQUFMLENBQVdrQixnQkFBWCxDQUE0QnlCLE9BQTVCLENBQW9DQyxjQUQ1QixDQUFsQjs7QUFHQSxHQUFJakQsVUFBVyxLQUFLSyxLQUFMLENBQVdMLFFBQTFCO0FBQ0EsR0FBSWtELFlBQWF0RCxnQkFBZ0J1RCxHQUFoQixDQUFvQixTQUFTMUMsYUFBVCxDQUF3QjtBQUMzRCxNQUFPVCxVQUFTOEIsVUFBVCxDQUFvQnFCLEdBQXBCO0FBQ0wsS0FBS0MsYUFBTCxDQUFtQnpDLElBQW5CLENBQXdCLElBQXhCLENBQThCRixhQUE5QixDQURLLENBQVA7O0FBR0QsQ0FKZ0IsQ0FJZCxJQUpjLENBQWpCOztBQU1BO0FBQ0UsbURBQU0sTUFBTyxDQUFDNEMsT0FBT0MsZUFBUixDQUF5QlIsV0FBekIsQ0FBc0MsS0FBS3pDLEtBQUwsQ0FBV1UsS0FBakQsQ0FBYjtBQUNHbUMsVUFESCxDQURGOzs7QUFLRCxDOzs7QUFHYXpDLGE7QUFDQThDLEs7QUFDQTNDLEs7QUFDRTtBQUNkLEdBQUksS0FBS0wsWUFBTCxDQUFrQkUsYUFBbEIsRUFBaUMrQyxRQUFqQyxDQUEwQ0QsS0FBMUMsQ0FBSixDQUFzRDtBQUNwRCxNQUFPLE1BQUtoRCxZQUFMLENBQWtCRSxhQUFsQixFQUFpQ29CLEdBQWpDLENBQXFDMEIsS0FBckMsQ0FBUDtBQUNEOztBQUVELEdBQUlFLFVBQVcsSUFBZjs7QUFFQSxHQUFJQyxTQUFVLEtBQUtyRCxLQUFMLENBQVdzRCxXQUFYLENBQXVCbEQsYUFBdkI7QUFDWixLQUFLSixLQUFMLENBQVdMLFFBQVgsQ0FBb0I4QixVQUFwQixDQUErQmxCLEtBQS9CLENBRFk7QUFFWixLQUFLUCxLQUFMLENBQVd1RCxTQUZDO0FBR1poRCxLQUhZO0FBSVosS0FBS1AsS0FBTCxDQUFXTCxRQUpDLENBQWQ7O0FBTUEsR0FBSSxDQUFDMEQsT0FBTCxDQUFjO0FBQ1osTUFBTyxLQUFQO0FBQ0Q7O0FBRUQsR0FBSUcsY0FBZWpELFFBQVViLHVCQUF1QixLQUFLTSxLQUFMLENBQVdMLFFBQWxDLENBQVY7QUFDakIsS0FBS0ssS0FBTCxDQUFXa0IsZ0JBQVgsQ0FBNEJ1QyxNQUE1QixDQUFtQ0MsTUFEbEI7QUFFakIsS0FBSzFELEtBQUwsQ0FBV2tCLGdCQUFYLENBQTRCdUMsTUFBNUIsQ0FBbUNFLElBRnJDO0FBR0FQO0FBQ0U7QUFDRSxJQUFLLGFBQUNRLElBQUQsQ0FBUztBQUNaLE9BQUszRCxXQUFMLENBQWlCRyxhQUFqQixFQUFrQyxPQUFLSCxXQUFMLENBQWlCRyxhQUFqQixFQUFnQ3lELEdBQWhDLENBQW9DWCxLQUFwQyxDQUEyQ1UsSUFBM0MsQ0FBbEM7QUFDRCxDQUhIO0FBSUUsTUFBT0osYUFBYXBELGFBQWIsQ0FKVDtBQUtHaUQsT0FMSCxDQURGOzs7O0FBVUEsS0FBS25ELFlBQUwsQ0FBa0JFLGFBQWxCLEVBQW1DLEtBQUtGLFlBQUwsQ0FBa0JFLGFBQWxCLEVBQWlDeUQsR0FBakMsQ0FBcUNYLEtBQXJDLENBQTRDRSxRQUE1QyxDQUFuQztBQUNBLE1BQU9BLFNBQVA7QUFDRCxDLHNEQTlLR3JELHNCLENBZ0JHK0QsUyxDQUFZLENBQ2pCUCxVQUFXLGlCQUFVUSxNQURKLENBRWpCVCxZQUFhLGlCQUFVVSxLQUFWLENBQWdCLENBQzNCQyxNQUFPLGlCQUFVQyxJQUFWLENBQWVDLFVBREssQ0FFM0JDLFdBQVksaUJBQVVGLElBQVYsQ0FBZUMsVUFGQSxDQUczQkUsWUFBYSxpQkFBVUgsSUFBVixDQUFlQyxVQUhELENBQWhCLEVBSVZBLFVBTmMsQ0FPakJ4RSxTQUFVLGlCQUFVcUUsS0FBVixDQUFnQixDQUN4QnZDLFdBQVksaUJBQVU2QyxPQUFWLENBQWtCLGlCQUFVUCxNQUE1QixDQURZLENBRXhCbkUsZUFBZ0IsaUJBQVUyRSxNQUZGLENBQWhCLENBUE8sQ0FXakJyRCxpQkFBa0IsaUJBQVU2QyxNQVhYLENBWWpCckQsTUFBTyxvQkFBS29ELFNBQUwsQ0FBZXBELEtBWkwsQyxDQWhCZlgsc0IsQ0ErQkd5RSxPLENBQVUsQ0FDZkMsT0FBUWpGLDRCQURPLENBRWZrRixnRUFGZSxDQUdmQyx3REFIZSxDLENBL0JiNUUsc0IsQ0FxQ0c2RSxZLENBQWUsQ0FDcEIxRCxpQkFBa0IxQiw0QkFERSxDOztBQTJJdkI7OztBQUdELEdBQUl3RCxRQUFTLDBCQUFXNkIsTUFBWCxDQUFrQjtBQUM3QjVCLGdCQUFpQjtBQUNmNkIsU0FBVSxVQURLO0FBRWZDLElBQUssQ0FGVTtBQUdmQyxLQUFNLENBSFM7QUFJZkMsTUFBTyxDQUpRO0FBS2ZDLGdCQUFpQixhQUxGLENBRFksQ0FBbEIsQ0FBYjs7OztBQVVBLGdDQUFTbkYsc0JBQVQ7O0FBRUFvRixPQUFPQyxPQUFQLENBQWlCckYsc0JBQWpCIiwiZmlsZSI6Ik5hdmlnYXRvck5hdmlnYXRpb25CYXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgMjAxNS1wcmVzZW50LCBBbGliYWJhIEdyb3VwIEhvbGRpbmcgTGltaXRlZC5cbiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKlxuICogQ29weXJpZ2h0IChjKSAyMDE1LXByZXNlbnQsIEZhY2Vib29rLCBJbmMuXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICpcbiAqIEBwcm92aWRlc01vZHVsZSBSZWFjdE5hdmlnYXRvck5hdmlnYXRpb25CYXJcbiAqL1xuJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgUmVhY3QsIHsgQ29tcG9uZW50LCBQcm9wVHlwZXMgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgTmF2aWdhdG9yTmF2aWdhdGlvbkJhclN0eWxlc0FuZHJvaWQgZnJvbSAnUmVhY3ROYXZpZ2F0b3JOYXZpZ2F0aW9uQmFyU3R5bGVzQW5kcm9pZCc7XG5pbXBvcnQgTmF2aWdhdG9yTmF2aWdhdGlvbkJhclN0eWxlc0lPUyBmcm9tICdSZWFjdE5hdmlnYXRvck5hdmlnYXRpb25CYXJTdHlsZXNJT1MnO1xuaW1wb3J0IFBsYXRmb3JtIGZyb20gJ1JlYWN0U3R5bGVTaGVldCc7XG5pbXBvcnQgU3R5bGVTaGVldCBmcm9tICdSZWFjdFN0eWxlU2hlZXQnO1xuaW1wb3J0IFZpZXcgZnJvbSAnUmVhY3RWaWV3JztcbmltcG9ydCBEaW1lbnNpb25zIGZyb20gJ1JlYWN0RGltZW5zaW9ucyc7XG5pbXBvcnQgeyBNYXAgfSBmcm9tICdpbW11dGFibGUnO1xuaW1wb3J0IGF1dG9iaW5kIGZyb20gJ2F1dG9iaW5kLWRlY29yYXRvcic7XG5cbnZhciBDT01QT05FTlRfTkFNRVMgPSBbJ1RpdGxlJywgJ0xlZnRCdXR0b24nLCAnUmlnaHRCdXR0b24nXTtcblxudmFyIE5hdmlnYXRvck5hdmlnYXRpb25CYXJTdHlsZXMgPSBQbGF0Zm9ybS5PUyA9PT0gJ2FuZHJvaWQnID9cbiAgTmF2aWdhdG9yTmF2aWdhdGlvbkJhclN0eWxlc0FuZHJvaWQgOiBOYXZpZ2F0b3JOYXZpZ2F0aW9uQmFyU3R5bGVzSU9TO1xuXG52YXIgbmF2U3RhdGVQcmVzZW50ZWRJbmRleCA9IGZ1bmN0aW9uKG5hdlN0YXRlKSB7XG4gIGlmIChuYXZTdGF0ZS5wcmVzZW50ZWRJbmRleCAhPT0gdW5kZWZpbmVkKSB7XG4gICAgcmV0dXJuIG5hdlN0YXRlLnByZXNlbnRlZEluZGV4O1xuICB9XG4gIC8vIFRPRE86IHJlbmFtZSBgb2JzZXJ2ZWRUb3BPZlN0YWNrYCB0byBgcHJlc2VudGVkSW5kZXhgIGluIGBOYXZpZ2F0b3JJT1NgXG4gIHJldHVybiBuYXZTdGF0ZS5vYnNlcnZlZFRvcE9mU3RhY2s7XG59O1xuXG5jbGFzcyBOYXZpZ2F0b3JOYXZpZ2F0aW9uQmFyIGV4dGVuZHMgQ29tcG9uZW50IHtcblxuICBjb25zdHJ1Y3Rvcihwcm9wcykge1xuICAgIHN1cGVyKHByb3BzKTtcblxuICAgIHRoaXMuX2NvbXBvbmVudHMgPSB7fTtcbiAgICB0aGlzLl9kZXNjcmlwdG9ycyA9IHt9O1xuXG4gICAgQ09NUE9ORU5UX05BTUVTLmZvckVhY2goY29tcG9uZW50TmFtZSA9PiB7XG4gICAgICB0aGlzLl9jb21wb25lbnRzW2NvbXBvbmVudE5hbWVdID0gbmV3IE1hcCgpO1xuICAgICAgdGhpcy5fZGVzY3JpcHRvcnNbY29tcG9uZW50TmFtZV0gPSBuZXcgTWFwKCk7XG4gICAgfSk7XG5cbiAgICB0aGlzLl9oYW5kbGVSZXNpemUgPSB0aGlzLl9oYW5kbGVSZXNpemUuYmluZCh0aGlzKVxuICB9XG5cbiAgc3RhdGljIHByb3BUeXBlcyA9IHtcbiAgICBuYXZpZ2F0b3I6IFByb3BUeXBlcy5vYmplY3QsXG4gICAgcm91dGVNYXBwZXI6IFByb3BUeXBlcy5zaGFwZSh7XG4gICAgICBUaXRsZTogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICAgIExlZnRCdXR0b246IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgICBSaWdodEJ1dHRvbjogUHJvcFR5cGVzLmZ1bmMuaXNSZXF1aXJlZCxcbiAgICB9KS5pc1JlcXVpcmVkLFxuICAgIG5hdlN0YXRlOiBQcm9wVHlwZXMuc2hhcGUoe1xuICAgICAgcm91dGVTdGFjazogUHJvcFR5cGVzLmFycmF5T2YoUHJvcFR5cGVzLm9iamVjdCksXG4gICAgICBwcmVzZW50ZWRJbmRleDogUHJvcFR5cGVzLm51bWJlcixcbiAgICB9KSxcbiAgICBuYXZpZ2F0aW9uU3R5bGVzOiBQcm9wVHlwZXMub2JqZWN0LFxuICAgIHN0eWxlOiBWaWV3LnByb3BUeXBlcy5zdHlsZSxcbiAgfVxuXG4gIHN0YXRpYyBzdGF0aWNzID0ge1xuICAgIFN0eWxlczogTmF2aWdhdG9yTmF2aWdhdGlvbkJhclN0eWxlcyxcbiAgICBTdHlsZXNBbmRyb2lkOiBOYXZpZ2F0b3JOYXZpZ2F0aW9uQmFyU3R5bGVzQW5kcm9pZCxcbiAgICBTdHlsZXNJT1M6IE5hdmlnYXRvck5hdmlnYXRpb25CYXJTdHlsZXNJT1MsXG4gIH1cblxuICBzdGF0aWMgZGVmYXVsdFByb3BzID0ge1xuICAgIG5hdmlnYXRpb25TdHlsZXM6IE5hdmlnYXRvck5hdmlnYXRpb25CYXJTdHlsZXMsXG4gIH1cblxuICBfZ2V0UmV1c2FibGVQcm9wcyhcbiAgICAvKiBzdHJpbmcgKi9jb21wb25lbnROYW1lLFxuICAgIC8qIG51bWJlciAqL2luZGV4XG4gICkgLyogb2JqZWN0ICovIHtcbiAgICBpZiAoIXRoaXMuX3JldXNhYmxlUHJvcHMpIHtcbiAgICAgIHRoaXMuX3JldXNhYmxlUHJvcHMgPSB7fTtcbiAgICB9XG4gICAgdmFyIHByb3BTdGFjayA9IHRoaXMuX3JldXNhYmxlUHJvcHNbY29tcG9uZW50TmFtZV07XG4gICAgaWYgKCFwcm9wU3RhY2spIHtcbiAgICAgIHByb3BTdGFjayA9IHRoaXMuX3JldXNhYmxlUHJvcHNbY29tcG9uZW50TmFtZV0gPSBbXTtcbiAgICB9XG4gICAgdmFyIHByb3BzID0gcHJvcFN0YWNrW2luZGV4XTtcbiAgICBpZiAoIXByb3BzKSB7XG4gICAgICBwcm9wcyA9IHByb3BTdGFja1tpbmRleF0gPSB7c3R5bGU6e319O1xuICAgIH1cbiAgICByZXR1cm4gcHJvcHM7XG4gIH1cblxuICBfdXBkYXRlSW5kZXhQcm9ncmVzcyhcbiAgICAvKiBudW1iZXIgKi9wcm9ncmVzcyxcbiAgICAvKiBudW1iZXIgKi9pbmRleCxcbiAgICAvKiBudW1iZXIgKi9mcm9tSW5kZXgsXG4gICAgLyogbnVtYmVyICovdG9JbmRleFxuICApIHtcbiAgICB2YXIgYW1vdW50ID0gdG9JbmRleCA+IGZyb21JbmRleCA/IHByb2dyZXNzIDogKDEgLSBwcm9ncmVzcyk7XG4gICAgdmFyIG9sZERpc3RUb0NlbnRlciA9IGluZGV4IC0gZnJvbUluZGV4O1xuICAgIHZhciBuZXdEaXN0VG9DZW50ZXIgPSBpbmRleCAtIHRvSW5kZXg7XG4gICAgdmFyIGludGVycG9sYXRlO1xuICAgIGlmIChvbGREaXN0VG9DZW50ZXIgPiAwICYmIG5ld0Rpc3RUb0NlbnRlciA9PT0gMCB8fFxuICAgICAgICBuZXdEaXN0VG9DZW50ZXIgPiAwICYmIG9sZERpc3RUb0NlbnRlciA9PT0gMCkge1xuICAgICAgaW50ZXJwb2xhdGUgPSB0aGlzLnByb3BzLm5hdmlnYXRpb25TdHlsZXMuSW50ZXJwb2xhdG9ycy5SaWdodFRvQ2VudGVyO1xuICAgIH0gZWxzZSBpZiAob2xkRGlzdFRvQ2VudGVyIDwgMCAmJiBuZXdEaXN0VG9DZW50ZXIgPT09IDAgfHxcbiAgICAgICAgICAgICAgIG5ld0Rpc3RUb0NlbnRlciA8IDAgJiYgb2xkRGlzdFRvQ2VudGVyID09PSAwKSB7XG4gICAgICBpbnRlcnBvbGF0ZSA9IHRoaXMucHJvcHMubmF2aWdhdGlvblN0eWxlcy5JbnRlcnBvbGF0b3JzLkNlbnRlclRvTGVmdDtcbiAgICB9IGVsc2UgaWYgKG9sZERpc3RUb0NlbnRlciA9PT0gbmV3RGlzdFRvQ2VudGVyKSB7XG4gICAgICBpbnRlcnBvbGF0ZSA9IHRoaXMucHJvcHMubmF2aWdhdGlvblN0eWxlcy5JbnRlcnBvbGF0b3JzLlJpZ2h0VG9DZW50ZXI7XG4gICAgfSBlbHNlIHtcbiAgICAgIGludGVycG9sYXRlID0gdGhpcy5wcm9wcy5uYXZpZ2F0aW9uU3R5bGVzLkludGVycG9sYXRvcnMuUmlnaHRUb0xlZnQ7XG4gICAgfVxuXG4gICAgQ09NUE9ORU5UX05BTUVTLmZvckVhY2goZnVuY3Rpb24oY29tcG9uZW50TmFtZSkge1xuICAgICAgdmFyIGNvbXBvbmVudCA9IHRoaXMuX2NvbXBvbmVudHNbY29tcG9uZW50TmFtZV0uZ2V0KHRoaXMucHJvcHMubmF2U3RhdGUucm91dGVTdGFja1tpbmRleF0pO1xuICAgICAgdmFyIHByb3BzID0gdGhpcy5fZ2V0UmV1c2FibGVQcm9wcyhjb21wb25lbnROYW1lLCBpbmRleCk7XG4gICAgICBpZiAoY29tcG9uZW50ICYmIGludGVycG9sYXRlW2NvbXBvbmVudE5hbWVdKHByb3BzLnN0eWxlLCBhbW91bnQpKSB7XG4gICAgICAgIGNvbXBvbmVudC5zZXROYXRpdmVQcm9wcyhwcm9wcyk7XG4gICAgICB9XG4gICAgfSwgdGhpcyk7XG4gIH1cblxuICB1cGRhdGVQcm9ncmVzcyhcbiAgICAvKiBudW1iZXIgKi9wcm9ncmVzcyxcbiAgICAvKiBudW1iZXIgKi9mcm9tSW5kZXgsXG4gICAgLyogbnVtYmVyICovdG9JbmRleFxuICApIHtcbiAgICB2YXIgbWF4ID0gTWF0aC5tYXgoZnJvbUluZGV4LCB0b0luZGV4KTtcbiAgICB2YXIgbWluID0gTWF0aC5taW4oZnJvbUluZGV4LCB0b0luZGV4KTtcbiAgICBmb3IgKHZhciBpbmRleCA9IG1pbjsgaW5kZXggPD0gbWF4OyBpbmRleCsrKSB7XG4gICAgICB0aGlzLl91cGRhdGVJbmRleFByb2dyZXNzKHByb2dyZXNzLCBpbmRleCwgZnJvbUluZGV4LCB0b0luZGV4KTtcbiAgICB9XG4gIH1cblxuICBjb21wb25lbnRXaWxsTW91bnQoKSB7XG4gICAgd2luZG93LmFkZEV2ZW50TGlzdGVuZXIoJ3Jlc2l6ZScsIHRoaXMuX2hhbmRsZVJlc2l6ZSlcbiAgfVxuXG4gIGNvbXBvbmVudFdpbGxVbm1vdW50KCkge1xuICAgIHdpbmRvdy5yZW1vdmVFdmVudExpc3RlbmVyKCdyZXNpemUnLCB0aGlzLl9oYW5kbGVSZXNpemUpXG4gICAgY2xlYXJUaW1lb3V0KHRoaXMuX3Jlc2l6ZVRpbWVvdXQpXG4gIH1cblxuICBfaGFuZGxlUmVzaXplKCkge1xuICAgIGNvbnN0IHNlbGYgPSB0aGlzXG4gICAgY2xlYXJUaW1lb3V0KHRoaXMuX3Jlc2l6ZVRpbWVvdXQpXG4gICAgLy8gZGVib3VuY2VcbiAgICB0aGlzLl9yZXNpemVUaW1lb3V0ID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7XG4gICAgICBzZWxmLnNldFN0YXRlKHsgZGltZW5zaW9uczogRGltZW5zaW9ucy5nZXQoJ3dpbmRvdycpIH0pXG4gICAgfSwgMTAwKVxuICB9XG5cbiAgcmVuZGVyKCkge1xuICAgIHZhciBuYXZCYXJTdHlsZSA9IHtcbiAgICAgIGhlaWdodDogdGhpcy5wcm9wcy5uYXZpZ2F0aW9uU3R5bGVzLkdlbmVyYWwuVG90YWxOYXZIZWlnaHQsXG4gICAgfTtcbiAgICB2YXIgbmF2U3RhdGUgPSB0aGlzLnByb3BzLm5hdlN0YXRlO1xuICAgIHZhciBjb21wb25lbnRzID0gQ09NUE9ORU5UX05BTUVTLm1hcChmdW5jdGlvbihjb21wb25lbnROYW1lKSB7XG4gICAgICByZXR1cm4gbmF2U3RhdGUucm91dGVTdGFjay5tYXAoXG4gICAgICAgIHRoaXMuX2dldENvbXBvbmVudC5iaW5kKHRoaXMsIGNvbXBvbmVudE5hbWUpXG4gICAgICApO1xuICAgIH0sIHRoaXMpO1xuXG4gICAgcmV0dXJuIChcbiAgICAgIDxWaWV3IHN0eWxlPXtbc3R5bGVzLm5hdkJhckNvbnRhaW5lciwgbmF2QmFyU3R5bGUsIHRoaXMucHJvcHMuc3R5bGVdfT5cbiAgICAgICAge2NvbXBvbmVudHN9XG4gICAgICA8L1ZpZXc+XG4gICAgKTtcbiAgfVxuXG4gIF9nZXRDb21wb25lbnQoXG4gICAgLyogc3RyaW5nICovY29tcG9uZW50TmFtZSxcbiAgICAvKiBvYmplY3QgKi9yb3V0ZSxcbiAgICAvKiBudW1iZXIgKi9pbmRleFxuICApIC8qID9PYmplY3QgKi8ge1xuICAgIGlmICh0aGlzLl9kZXNjcmlwdG9yc1tjb21wb25lbnROYW1lXS5pbmNsdWRlcyhyb3V0ZSkpIHtcbiAgICAgIHJldHVybiB0aGlzLl9kZXNjcmlwdG9yc1tjb21wb25lbnROYW1lXS5nZXQocm91dGUpO1xuICAgIH1cblxuICAgIHZhciByZW5kZXJlZCA9IG51bGw7XG5cbiAgICB2YXIgY29udGVudCA9IHRoaXMucHJvcHMucm91dGVNYXBwZXJbY29tcG9uZW50TmFtZV0oXG4gICAgICB0aGlzLnByb3BzLm5hdlN0YXRlLnJvdXRlU3RhY2tbaW5kZXhdLFxuICAgICAgdGhpcy5wcm9wcy5uYXZpZ2F0b3IsXG4gICAgICBpbmRleCxcbiAgICAgIHRoaXMucHJvcHMubmF2U3RhdGVcbiAgICApO1xuICAgIGlmICghY29udGVudCkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuXG4gICAgdmFyIGluaXRpYWxTdGFnZSA9IGluZGV4ID09PSBuYXZTdGF0ZVByZXNlbnRlZEluZGV4KHRoaXMucHJvcHMubmF2U3RhdGUpID9cbiAgICAgIHRoaXMucHJvcHMubmF2aWdhdGlvblN0eWxlcy5TdGFnZXMuQ2VudGVyIDpcbiAgICAgIHRoaXMucHJvcHMubmF2aWdhdGlvblN0eWxlcy5TdGFnZXMuTGVmdDtcbiAgICByZW5kZXJlZCA9IChcbiAgICAgIDxWaWV3XG4gICAgICAgIHJlZj17KHJlZikgPT4ge1xuICAgICAgICAgIHRoaXMuX2NvbXBvbmVudHNbY29tcG9uZW50TmFtZV0gPSB0aGlzLl9jb21wb25lbnRzW2NvbXBvbmVudE5hbWVdLnNldChyb3V0ZSwgcmVmKTtcbiAgICAgICAgfX1cbiAgICAgICAgc3R5bGU9e2luaXRpYWxTdGFnZVtjb21wb25lbnROYW1lXX0+XG4gICAgICAgIHtjb250ZW50fVxuICAgICAgPC9WaWV3PlxuICAgICk7XG5cbiAgICB0aGlzLl9kZXNjcmlwdG9yc1tjb21wb25lbnROYW1lXSA9IHRoaXMuX2Rlc2NyaXB0b3JzW2NvbXBvbmVudE5hbWVdLnNldChyb3V0ZSwgcmVuZGVyZWQpO1xuICAgIHJldHVybiByZW5kZXJlZDtcbiAgfVxuXG59O1xuXG5cbnZhciBzdHlsZXMgPSBTdHlsZVNoZWV0LmNyZWF0ZSh7XG4gIG5hdkJhckNvbnRhaW5lcjoge1xuICAgIHBvc2l0aW9uOiAnYWJzb2x1dGUnLFxuICAgIHRvcDogMCxcbiAgICBsZWZ0OiAwLFxuICAgIHJpZ2h0OiAwLFxuICAgIGJhY2tncm91bmRDb2xvcjogJ3RyYW5zcGFyZW50JyxcbiAgfSxcbn0pO1xuXG5hdXRvYmluZChOYXZpZ2F0b3JOYXZpZ2F0aW9uQmFyKTtcblxubW9kdWxlLmV4cG9ydHMgPSBOYXZpZ2F0b3JOYXZpZ2F0aW9uQmFyO1xuIl19