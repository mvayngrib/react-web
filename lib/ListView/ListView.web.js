







'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();

var _react=require('react');var _react2=_interopRequireDefault(_react);
var _reactDom=require('react-dom');var _reactDom2=_interopRequireDefault(_reactDom);
var _ReactListViewDataSource=require('./ListViewDataSource.web');var _ReactListViewDataSource2=_interopRequireDefault(_ReactListViewDataSource);
var _ReactScrollView=require('../ScrollView/ScrollView.web');var _ReactScrollView2=_interopRequireDefault(_ReactScrollView);
var _ReactScrollResponder=require('./ScrollResponder.web');var _ReactScrollResponder2=_interopRequireDefault(_ReactScrollResponder);
var _ReactStaticRenderer=require('./StaticRenderer.web');var _ReactStaticRenderer2=_interopRequireDefault(_ReactStaticRenderer);
var _reactTimerMixin=require('react-timer-mixin');var _reactTimerMixin2=_interopRequireDefault(_reactTimerMixin);
var _reactMixin=require('react-mixin');var _reactMixin2=_interopRequireDefault(_reactMixin);
var _objectAssign=require('object-assign');var _objectAssign2=_interopRequireDefault(_objectAssign);
var _autobindDecorator=require('autobind-decorator');var _autobindDecorator2=_interopRequireDefault(_autobindDecorator);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _objectWithoutProperties(obj,keys){var target={};for(var i in obj){if(keys.indexOf(i)>=0)continue;if(!Object.prototype.hasOwnProperty.call(obj,i))continue;target[i]=obj[i];}return target;}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}

var DEFAULT_PAGE_SIZE=1;
var DEFAULT_INITIAL_ROWS=10;
var DEFAULT_SCROLL_RENDER_AHEAD=1000;
var DEFAULT_END_REACHED_THRESHOLD=1000;
var DEFAULT_SCROLL_CALLBACK_THROTTLE=50;
var SCROLLVIEW_REF='listviewscroll';var
















































ListView=function(_Component){_inherits(ListView,_Component);function ListView(){var _ref;var _temp,_this,_ret;_classCallCheck(this,ListView);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}return _ret=(_temp=(_this=_possibleConstructorReturn(this,(_ref=ListView.__proto__||Object.getPrototypeOf(ListView)).call.apply(_ref,[this].concat(args))),_this),_this.



































































































































state={
curRenderedRowsCount:_this.props.initialListSize,
highlightedRow:{}},_temp),_possibleConstructorReturn(_this,_ret);}_createClass(ListView,[{key:'getMetrics',value:function getMetrics()





{
return{
contentLength:this.scrollProperties.contentLength,
totalRows:this.props.dataSource.getRowCount(),
renderedRows:this.state.curRenderedRowsCount,
visibleRows:Object.keys(this._visibleRows).length};

}},{key:'getScrollResponder',value:function getScrollResponder()






{
return this.refs[SCROLLVIEW_REF]&&
this.refs[SCROLLVIEW_REF].getScrollResponder&&
this.refs[SCROLLVIEW_REF].getScrollResponder();
}},{key:'scrollTo',value:function scrollTo()

{var _refs$SCROLLVIEW_REF;
this.refs[SCROLLVIEW_REF]&&
this.refs[SCROLLVIEW_REF].scrollTo&&
(_refs$SCROLLVIEW_REF=this.refs[SCROLLVIEW_REF]).scrollTo.apply(_refs$SCROLLVIEW_REF,arguments);
}},{key:'setNativeProps',value:function setNativeProps(

props){
this.refs[SCROLLVIEW_REF]&&
this.refs[SCROLLVIEW_REF].setNativeProps(props);
}},{key:'getInnerViewNode',value:function getInnerViewNode()

{
return this.refs[SCROLLVIEW_REF].getInnerViewNode();
}},{key:'componentWillMount',value:function componentWillMount()

{

this.scrollProperties={
visibleLength:null,
contentLength:null,
offset:0};

this._childFrames=[];
this._visibleRows={};
this._prevRenderedRowsCount=0;
this._sentEndForContentLength=null;
}},{key:'componentDidMount',value:function componentDidMount()

{var _this2=this;


this.requestAnimationFrame(function(){
_this2._measureAndUpdateScrollProps();
});
}},{key:'componentWillReceiveProps',value:function componentWillReceiveProps(

nextProps){var _this3=this;
if(this.props.dataSource!==nextProps.dataSource||
this.props.initialListSize!==nextProps.initialListSize){
this.setState(function(state,props){
_this3._prevRenderedRowsCount=0;
return{
curRenderedRowsCount:Math.min(
Math.max(
state.curRenderedRowsCount,
props.initialListSize),

props.dataSource.getRowCount())};


},function(){return _this3._renderMoreRowsIfNeeded();});
}
}},{key:'componentDidUpdate',value:function componentDidUpdate()

{var _this4=this;
this.requestAnimationFrame(function(){
_this4._measureAndUpdateScrollProps();
});
}},{key:'onRowHighlighted',value:function onRowHighlighted(

sectionID,rowID){
this.setState({highlightedRow:{sectionID:sectionID,rowID:rowID}});
}},{key:'render',value:function render()

{
var bodyComponents=[];

var dataSource=this.props.dataSource;
var allRowIDs=dataSource.rowIdentities;
var rowCount=0;
var sectionHeaderIndices=[];

var header=this.props.renderHeader&&this.props.renderHeader();
var footer=this.props.renderFooter&&this.props.renderFooter();
var totalIndex=header?1:0;

for(var sectionIdx=0;sectionIdx<allRowIDs.length;sectionIdx++){
var sectionID=dataSource.sectionIdentities[sectionIdx];
var rowIDs=allRowIDs[sectionIdx];
if(rowIDs.length===0){
continue;
}

if(this.props.renderSectionHeader){
var shouldUpdateHeader=rowCount>=this._prevRenderedRowsCount&&
dataSource.sectionHeaderShouldUpdate(sectionIdx);
bodyComponents.push(
_react2.default.createElement(_ReactStaticRenderer2.default,{
key:'s_'+sectionID,
shouldUpdate:!!shouldUpdateHeader,
render:this.props.renderSectionHeader.bind(
null,
dataSource.getSectionHeaderData(sectionIdx),
sectionID)}));



sectionHeaderIndices.push(totalIndex++);
}

for(var rowIdx=0;rowIdx<rowIDs.length;rowIdx++){
var rowID=rowIDs[rowIdx];
var comboID=sectionID+'_'+rowID;
var shouldUpdateRow=rowCount>=this._prevRenderedRowsCount&&
dataSource.rowShouldUpdate(sectionIdx,rowIdx);
var row=
_react2.default.createElement(_ReactStaticRenderer2.default,{
key:'r_'+comboID,
shouldUpdate:!!shouldUpdateRow,
render:this.props.renderRow.bind(
null,
dataSource.getRowData(sectionIdx,rowIdx),
sectionID,
rowID,
this.onRowHighlighted)});


bodyComponents.push(row);
totalIndex++;

if(this.props.renderSeparator&&(
rowIdx!==rowIDs.length-1||sectionIdx===allRowIDs.length-1)){
var adjacentRowHighlighted=
this.state.highlightedRow.sectionID===sectionID&&(
this.state.highlightedRow.rowID===rowID||
this.state.highlightedRow.rowID===rowIDs[rowIdx+1]);

var separator=this.props.renderSeparator(
sectionID,
rowID,
adjacentRowHighlighted);

if(separator){
bodyComponents.push(separator);
totalIndex++;
}
}
if(++rowCount===this.state.curRenderedRowsCount){
break;
}
}
if(rowCount>=this.state.curRenderedRowsCount){
break;
}
}var _props=




this.props;var renderScrollComponent=_props.renderScrollComponent;var props=_objectWithoutProperties(_props,['renderScrollComponent']);
if(!props.scrollEventThrottle){
props.scrollEventThrottle=DEFAULT_SCROLL_CALLBACK_THROTTLE;
}
if(props.removeClippedSubviews===undefined){
props.removeClippedSubviews=true;
}
(0,_objectAssign2.default)(props,{
onScroll:this._onScroll,
stickyHeaderIndices:this.props.stickyHeaderIndices.concat(sectionHeaderIndices),



onKeyboardWillShow:undefined,
onKeyboardWillHide:undefined,
onKeyboardDidShow:undefined,
onKeyboardDidHide:undefined});




return _react2.default.cloneElement(renderScrollComponent(props),{
ref:SCROLLVIEW_REF,
onContentSizeChange:this._onContentSizeChange,
onLayout:this._onLayout},
header,bodyComponents,footer);
}},{key:'_measureAndUpdateScrollProps',value:function _measureAndUpdateScrollProps()





{
var scrollComponent=this.getScrollResponder();
if(!scrollComponent||!scrollComponent.getInnerViewNode){
return;
}








}},{key:'_onContentSizeChange',value:function _onContentSizeChange(

width,height){
var contentLength=!this.props.horizontal?height:width;
if(contentLength!==this.scrollProperties.contentLength){
this.scrollProperties.contentLength=contentLength;
this._updateVisibleRows();
this._renderMoreRowsIfNeeded();
}
this.props.onContentSizeChange&&this.props.onContentSizeChange(width,height);
}},{key:'_onLayout',value:function _onLayout(

event){var _event$nativeEvent$la=
event.nativeEvent.layout;var width=_event$nativeEvent$la.width;var height=_event$nativeEvent$la.height;
var visibleLength=!this.props.horizontal?height:width;
if(visibleLength!==this.scrollProperties.visibleLength){
this.scrollProperties.visibleLength=visibleLength;
this._updateVisibleRows();
this._renderMoreRowsIfNeeded();
}
this.props.onLayout&&this.props.onLayout(event);
}},{key:'_maybeCallOnEndReached',value:function _maybeCallOnEndReached(

event){
if(this.props.onEndReached&&
this.scrollProperties.contentLength!==this._sentEndForContentLength&&
this._getDistanceFromEnd(this.scrollProperties)<this.props.onEndReachedThreshold&&
this.state.curRenderedRowsCount===this.props.dataSource.getRowCount()){
this._sentEndForContentLength=this.scrollProperties.contentLength;
this.props.onEndReached(event);
return true;
}
return false;
}},{key:'_renderMoreRowsIfNeeded',value:function _renderMoreRowsIfNeeded()

{
if(this.scrollProperties.contentLength===null||
this.scrollProperties.visibleLength===null||
this.state.curRenderedRowsCount===this.props.dataSource.getRowCount()){
this._maybeCallOnEndReached();
return;
}

var distanceFromEnd=this._getDistanceFromEnd(this.scrollProperties);
if(distanceFromEnd<this.props.scrollRenderAheadDistance){
this._pageInNewRows();
}
}},{key:'_pageInNewRows',value:function _pageInNewRows()

{var _this5=this;
this.setState(function(state,props){
var rowsToRender=Math.min(
state.curRenderedRowsCount+props.pageSize,
props.dataSource.getRowCount());

_this5._prevRenderedRowsCount=state.curRenderedRowsCount;
return{
curRenderedRowsCount:rowsToRender};

},function(){
_this5._measureAndUpdateScrollProps();
_this5._prevRenderedRowsCount=_this5.state.curRenderedRowsCount;
});
}},{key:'_getDistanceFromEnd',value:function _getDistanceFromEnd(

scrollProperties){
return scrollProperties.contentLength-scrollProperties.visibleLength-scrollProperties.offset;
}},{key:'_updateVisibleRows',value:function _updateVisibleRows(

updatedFrames){


































































}},{key:'_onScroll',value:function _onScroll(

e){
var isVertical=!this.props.horizontal;










var target=_reactDom2.default.findDOMNode(this.refs[SCROLLVIEW_REF]);
this.scrollProperties.visibleLength=target[
isVertical?'offsetHeight':'offsetWidth'];

this.scrollProperties.contentLength=target[
isVertical?'scrollHeight':'scrollWidth'];

this.scrollProperties.offset=target[
isVertical?'scrollTop':'scrollLeft'];


if(!this._maybeCallOnEndReached(e)){
this._renderMoreRowsIfNeeded();
}

if(this.props.onEndReached&&
this._getDistanceFromEnd(this.scrollProperties)>this.props.onEndReachedThreshold){

this._sentEndForContentLength=null;
}

this.props.onScroll&&this.props.onScroll(e);
}}]);return ListView;}(_react.Component);ListView.DataSource=_ReactListViewDataSource2.default;ListView.propTypes=_extends({},_ReactScrollView2.default.propTypes,{dataSource:_react.PropTypes.instanceOf(_ReactListViewDataSource2.default).isRequired,renderSeparator:_react.PropTypes.func,renderRow:_react.PropTypes.func.isRequired,initialListSize:_react.PropTypes.number,onEndReached:_react.PropTypes.func,onEndReachedThreshold:_react.PropTypes.number,pageSize:_react.PropTypes.number,renderFooter:_react.PropTypes.func,renderHeader:_react.PropTypes.func,renderSectionHeader:_react.PropTypes.func,renderScrollComponent:_react2.default.PropTypes.func.isRequired,scrollRenderAheadDistance:_react2.default.PropTypes.number,onChangeVisibleRows:_react2.default.PropTypes.func,removeClippedSubviews:_react2.default.PropTypes.bool,stickyHeaderIndices:_react.PropTypes.arrayOf(_react.PropTypes.number)});ListView.defaultProps={initialListSize:DEFAULT_INITIAL_ROWS,pageSize:DEFAULT_PAGE_SIZE,renderScrollComponent:function renderScrollComponent(props){return _react2.default.createElement(_ReactScrollView2.default,props);},scrollRenderAheadDistance:DEFAULT_SCROLL_RENDER_AHEAD,onEndReachedThreshold:DEFAULT_END_REACHED_THRESHOLD,stickyHeaderIndices:[]};


_reactMixin2.default.onClass(ListView,_ReactScrollResponder2.default.Mixin);
_reactMixin2.default.onClass(ListView,_reactTimerMixin2.default);
(0,_autobindDecorator2.default)(ListView);

ListView.isReactNativeComponent=true;exports.default=

ListView;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkxpc3RWaWV3LndlYi5qcyJdLCJuYW1lcyI6WyJERUZBVUxUX1BBR0VfU0laRSIsIkRFRkFVTFRfSU5JVElBTF9ST1dTIiwiREVGQVVMVF9TQ1JPTExfUkVOREVSX0FIRUFEIiwiREVGQVVMVF9FTkRfUkVBQ0hFRF9USFJFU0hPTEQiLCJERUZBVUxUX1NDUk9MTF9DQUxMQkFDS19USFJPVFRMRSIsIlNDUk9MTFZJRVdfUkVGIiwiTGlzdFZpZXciLCJzdGF0ZSIsImN1clJlbmRlcmVkUm93c0NvdW50IiwicHJvcHMiLCJpbml0aWFsTGlzdFNpemUiLCJoaWdobGlnaHRlZFJvdyIsImNvbnRlbnRMZW5ndGgiLCJzY3JvbGxQcm9wZXJ0aWVzIiwidG90YWxSb3dzIiwiZGF0YVNvdXJjZSIsImdldFJvd0NvdW50IiwicmVuZGVyZWRSb3dzIiwidmlzaWJsZVJvd3MiLCJPYmplY3QiLCJrZXlzIiwiX3Zpc2libGVSb3dzIiwibGVuZ3RoIiwicmVmcyIsImdldFNjcm9sbFJlc3BvbmRlciIsInNjcm9sbFRvIiwic2V0TmF0aXZlUHJvcHMiLCJnZXRJbm5lclZpZXdOb2RlIiwidmlzaWJsZUxlbmd0aCIsIm9mZnNldCIsIl9jaGlsZEZyYW1lcyIsIl9wcmV2UmVuZGVyZWRSb3dzQ291bnQiLCJfc2VudEVuZEZvckNvbnRlbnRMZW5ndGgiLCJyZXF1ZXN0QW5pbWF0aW9uRnJhbWUiLCJfbWVhc3VyZUFuZFVwZGF0ZVNjcm9sbFByb3BzIiwibmV4dFByb3BzIiwic2V0U3RhdGUiLCJNYXRoIiwibWluIiwibWF4IiwiX3JlbmRlck1vcmVSb3dzSWZOZWVkZWQiLCJzZWN0aW9uSUQiLCJyb3dJRCIsImJvZHlDb21wb25lbnRzIiwiYWxsUm93SURzIiwicm93SWRlbnRpdGllcyIsInJvd0NvdW50Iiwic2VjdGlvbkhlYWRlckluZGljZXMiLCJoZWFkZXIiLCJyZW5kZXJIZWFkZXIiLCJmb290ZXIiLCJyZW5kZXJGb290ZXIiLCJ0b3RhbEluZGV4Iiwic2VjdGlvbklkeCIsInNlY3Rpb25JZGVudGl0aWVzIiwicm93SURzIiwicmVuZGVyU2VjdGlvbkhlYWRlciIsInNob3VsZFVwZGF0ZUhlYWRlciIsInNlY3Rpb25IZWFkZXJTaG91bGRVcGRhdGUiLCJwdXNoIiwiYmluZCIsImdldFNlY3Rpb25IZWFkZXJEYXRhIiwicm93SWR4IiwiY29tYm9JRCIsInNob3VsZFVwZGF0ZVJvdyIsInJvd1Nob3VsZFVwZGF0ZSIsInJvdyIsInJlbmRlclJvdyIsImdldFJvd0RhdGEiLCJvblJvd0hpZ2hsaWdodGVkIiwicmVuZGVyU2VwYXJhdG9yIiwiYWRqYWNlbnRSb3dIaWdobGlnaHRlZCIsInNlcGFyYXRvciIsInJlbmRlclNjcm9sbENvbXBvbmVudCIsInNjcm9sbEV2ZW50VGhyb3R0bGUiLCJyZW1vdmVDbGlwcGVkU3Vidmlld3MiLCJ1bmRlZmluZWQiLCJvblNjcm9sbCIsIl9vblNjcm9sbCIsInN0aWNreUhlYWRlckluZGljZXMiLCJjb25jYXQiLCJvbktleWJvYXJkV2lsbFNob3ciLCJvbktleWJvYXJkV2lsbEhpZGUiLCJvbktleWJvYXJkRGlkU2hvdyIsIm9uS2V5Ym9hcmREaWRIaWRlIiwiY2xvbmVFbGVtZW50IiwicmVmIiwib25Db250ZW50U2l6ZUNoYW5nZSIsIl9vbkNvbnRlbnRTaXplQ2hhbmdlIiwib25MYXlvdXQiLCJfb25MYXlvdXQiLCJzY3JvbGxDb21wb25lbnQiLCJ3aWR0aCIsImhlaWdodCIsImhvcml6b250YWwiLCJfdXBkYXRlVmlzaWJsZVJvd3MiLCJldmVudCIsIm5hdGl2ZUV2ZW50IiwibGF5b3V0Iiwib25FbmRSZWFjaGVkIiwiX2dldERpc3RhbmNlRnJvbUVuZCIsIm9uRW5kUmVhY2hlZFRocmVzaG9sZCIsIl9tYXliZUNhbGxPbkVuZFJlYWNoZWQiLCJkaXN0YW5jZUZyb21FbmQiLCJzY3JvbGxSZW5kZXJBaGVhZERpc3RhbmNlIiwiX3BhZ2VJbk5ld1Jvd3MiLCJyb3dzVG9SZW5kZXIiLCJwYWdlU2l6ZSIsInVwZGF0ZWRGcmFtZXMiLCJlIiwiaXNWZXJ0aWNhbCIsInRhcmdldCIsImZpbmRET01Ob2RlIiwiRGF0YVNvdXJjZSIsInByb3BUeXBlcyIsImluc3RhbmNlT2YiLCJpc1JlcXVpcmVkIiwiZnVuYyIsIm51bWJlciIsIlByb3BUeXBlcyIsIm9uQ2hhbmdlVmlzaWJsZVJvd3MiLCJib29sIiwiYXJyYXlPZiIsImRlZmF1bHRQcm9wcyIsIm9uQ2xhc3MiLCJNaXhpbiIsImlzUmVhY3ROYXRpdmVDb21wb25lbnQiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBUUEsYTs7QUFFQSw0QjtBQUNBLG1DO0FBQ0EsaUU7QUFDQSw2RDtBQUNBLDJEO0FBQ0EseUQ7QUFDQSxrRDtBQUNBLHVDO0FBQ0EsMkM7QUFDQSxxRDs7QUFFQSxHQUFNQSxtQkFBb0IsQ0FBMUI7QUFDQSxHQUFNQyxzQkFBdUIsRUFBN0I7QUFDQSxHQUFNQyw2QkFBOEIsSUFBcEM7QUFDQSxHQUFNQywrQkFBZ0MsSUFBdEM7QUFDQSxHQUFNQyxrQ0FBbUMsRUFBekM7QUFDQSxHQUFNQyxnQkFBaUIsZ0JBQXZCLEM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7QUFpRE1DLFE7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQW9JSkMsSyxDQUFRO0FBQ05DLHFCQUFzQixNQUFLQyxLQUFMLENBQVdDLGVBRDNCO0FBRU5DLGVBQWdCLEVBRlYsQzs7Ozs7O0FBUUs7QUFDWCxNQUFPO0FBQ0xDLGNBQWUsS0FBS0MsZ0JBQUwsQ0FBc0JELGFBRGhDO0FBRUxFLFVBQVcsS0FBS0wsS0FBTCxDQUFXTSxVQUFYLENBQXNCQyxXQUF0QixFQUZOO0FBR0xDLGFBQWMsS0FBS1YsS0FBTCxDQUFXQyxvQkFIcEI7QUFJTFUsWUFBYUMsT0FBT0MsSUFBUCxDQUFZLEtBQUtD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TixDQUFnQkYsSSxDQU1yQzFDLHNCQUF1QixnQkFBTTRDLFNBQU4sQ0FBZ0JFLEksQ0FTdkMxQyxvQkFBcUIsaUJBQVUyQyxPQUFWLENBQWtCLGlCQUFVSixNQUE1QixDLEdBcEhuQmhILFEsQ0EySEdxSCxZLENBQWUsQ0FDcEJqSCxnQkFBaUJULG9CQURHLENBRXBCMEcsU0FBVTNHLGlCQUZVLENBR3BCeUUsc0JBQXVCLDRDQUFTLHlEQUFnQmhFLEtBQWhCLENBQVQsRUFISCxDQUlwQitGLDBCQUEyQnRHLDJCQUpQLENBS3BCbUcsc0JBQXVCbEcsNkJBTEgsQ0FNcEI0RSxvQkFBcUIsRUFORCxDOzs7QUFzWnhCLHFCQUFNNkMsT0FBTixDQUFjdEgsUUFBZCxDQUF3QiwrQkFBZ0J1SCxLQUF4QztBQUNBLHFCQUFNRCxPQUFOLENBQWN0SCxRQUFkO0FBQ0EsZ0NBQVNBLFFBQVQ7O0FBRUFBLFNBQVN3SCxzQkFBVCxDQUFrQyxJQUFsQyxDOztBQUVleEgsUSIsImZpbGUiOiJMaXN0Vmlldy53ZWIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgMjAxNS1wcmVzZW50LCBBbGliYWJhIEdyb3VwIEhvbGRpbmcgTGltaXRlZC5cbiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKlxuICogQ29weXJpZ2h0IChjKSAyMDE1LCBGYWNlYm9vaywgSW5jLiAgQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqXG4gKiBAcHJvdmlkZXNNb2R1bGUgUmVhY3RMaXN0Vmlld1xuICovXG4ndXNlIHN0cmljdCc7XG5cbmltcG9ydCBSZWFjdCwgeyBDb21wb25lbnQsIFByb3BUeXBlcyB9IGZyb20gJ3JlYWN0JztcbmltcG9ydCBSZWFjdERPTSBmcm9tICdyZWFjdC1kb20nO1xuaW1wb3J0IExpc3RWaWV3RGF0YVNvdXJjZSBmcm9tICdSZWFjdExpc3RWaWV3RGF0YVNvdXJjZSc7XG5pbXBvcnQgU2Nyb2xsVmlldyBmcm9tICdSZWFjdFNjcm9sbFZpZXcnO1xuaW1wb3J0IFNjcm9sbFJlc3BvbmRlciBmcm9tICdSZWFjdFNjcm9sbFJlc3BvbmRlcic7XG5pbXBvcnQgU3RhdGljUmVuZGVyZXIgZnJvbSAnUmVhY3RTdGF0aWNSZW5kZXJlcic7XG5pbXBvcnQgVGltZXJNaXhpbiBmcm9tICdyZWFjdC10aW1lci1taXhpbic7XG5pbXBvcnQgbWl4aW4gZnJvbSAncmVhY3QtbWl4aW4nO1xuaW1wb3J0IGFzc2lnbiBmcm9tICdvYmplY3QtYXNzaWduJztcbmltcG9ydCBhdXRvYmluZCBmcm9tICdhdXRvYmluZC1kZWNvcmF0b3InO1xuXG5jb25zdCBERUZBVUxUX1BBR0VfU0laRSA9IDE7XG5jb25zdCBERUZBVUxUX0lOSVRJQUxfUk9XUyA9IDEwO1xuY29uc3QgREVGQVVMVF9TQ1JPTExfUkVOREVSX0FIRUFEID0gMTAwMDtcbmNvbnN0IERFRkFVTFRfRU5EX1JFQUNIRURfVEhSRVNIT0xEID0gMTAwMDtcbmNvbnN0IERFRkFVTFRfU0NST0xMX0NBTExCQUNLX1RIUk9UVExFID0gNTA7XG5jb25zdCBTQ1JPTExWSUVXX1JFRiA9ICdsaXN0dmlld3Njcm9sbCc7XG5cbi8qKlxuICogTGlzdFZpZXcgLSBBIGNvcmUgY29tcG9uZW50IGRlc2lnbmVkIGZvciBlZmZpY2llbnQgZGlzcGxheSBvZiB2ZXJ0aWNhbGx5XG4gKiBzY3JvbGxpbmcgbGlzdHMgb2YgY2hhbmdpbmcgZGF0YS4gIFRoZSBtaW5pbWFsIEFQSSBpcyB0byBjcmVhdGUgYVxuICogYExpc3RWaWV3LkRhdGFTb3VyY2VgLCBwb3B1bGF0ZSBpdCB3aXRoIGEgc2ltcGxlIGFycmF5IG9mIGRhdGEgYmxvYnMsIGFuZFxuICogaW5zdGFudGlhdGUgYSBgTGlzdFZpZXdgIGNvbXBvbmVudCB3aXRoIHRoYXQgZGF0YSBzb3VyY2UgYW5kIGEgYHJlbmRlclJvd2BcbiAqIGNhbGxiYWNrIHdoaWNoIHRha2VzIGEgYmxvYiBmcm9tIHRoZSBkYXRhIGFycmF5IGFuZCByZXR1cm5zIGEgcmVuZGVyYWJsZVxuICogY29tcG9uZW50LlxuICpcbiAqIE1pbmltYWwgZXhhbXBsZTpcbiAqXG4gKiBgYGBcbiAqIGdldEluaXRpYWxTdGF0ZTogZnVuY3Rpb24oKSB7XG4gKiAgIGxldCBkcyA9IG5ldyBMaXN0Vmlldy5EYXRhU291cmNlKHtyb3dIYXNDaGFuZ2VkOiAocjEsIHIyKSA9PiByMSAhPT0gcjJ9KTtcbiAqICAgcmV0dXJuIHtcbiAqICAgICBkYXRhU291cmNlOiBkcy5jbG9uZVdpdGhSb3dzKFsncm93IDEnLCAncm93IDInXSksXG4gKiAgIH07XG4gKiB9LFxuICpcbiAqIHJlbmRlcjogZnVuY3Rpb24oKSB7XG4gKiAgIHJldHVybiAoXG4gKiAgICAgPExpc3RWaWV3XG4gKiAgICAgICBkYXRhU291cmNlPXt0aGlzLnN0YXRlLmRhdGFTb3VyY2V9XG4gKiAgICAgICByZW5kZXJSb3c9eyhyb3dEYXRhKSA9PiA8VGV4dD57cm93RGF0YX08L1RleHQ+fVxuICogICAgIC8+XG4gKiAgICk7XG4gKiB9LFxuICogYGBgXG4gKlxuICogTGlzdFZpZXcgYWxzbyBzdXBwb3J0cyBtb3JlIGFkdmFuY2VkIGZlYXR1cmVzLCBpbmNsdWRpbmcgc2VjdGlvbnMgd2l0aCBzdGlja3lcbiAqIHNlY3Rpb24gaGVhZGVycywgaGVhZGVyIGFuZCBmb290ZXIgc3VwcG9ydCwgY2FsbGJhY2tzIG9uIHJlYWNoaW5nIHRoZSBlbmQgb2ZcbiAqIHRoZSBhdmFpbGFibGUgZGF0YSAoYG9uRW5kUmVhY2hlZGApIGFuZCBvbiB0aGUgc2V0IG9mIHJvd3MgdGhhdCBhcmUgdmlzaWJsZVxuICogaW4gdGhlIGRldmljZSB2aWV3cG9ydCBjaGFuZ2UgKGBvbkNoYW5nZVZpc2libGVSb3dzYCksIGFuZCBzZXZlcmFsXG4gKiBwZXJmb3JtYW5jZSBvcHRpbWl6YXRpb25zLlxuICpcbiAqIFRoZXJlIGFyZSBhIGZldyBwZXJmb3JtYW5jZSBvcGVyYXRpb25zIGRlc2lnbmVkIHRvIG1ha2UgTGlzdFZpZXcgc2Nyb2xsXG4gKiBzbW9vdGhseSB3aGlsZSBkeW5hbWljYWxseSBsb2FkaW5nIHBvdGVudGlhbGx5IHZlcnkgbGFyZ2UgKG9yIGNvbmNlcHR1YWxseVxuICogaW5maW5pdGUpIGRhdGEgc2V0czpcbiAqXG4gKiAgKiBPbmx5IHJlLXJlbmRlciBjaGFuZ2VkIHJvd3MgLSB0aGUgcm93SGFzQ2hhbmdlZCBmdW5jdGlvbiBwcm92aWRlZCB0byB0aGVcbiAqICAgIGRhdGEgc291cmNlIHRlbGxzIHRoZSBMaXN0VmlldyBpZiBpdCBuZWVkcyB0byByZS1yZW5kZXIgYSByb3cgYmVjYXVzZSB0aGVcbiAqICAgIHNvdXJjZSBkYXRhIGhhcyBjaGFuZ2VkIC0gc2VlIExpc3RWaWV3RGF0YVNvdXJjZSBmb3IgbW9yZSBkZXRhaWxzLlxuICpcbiAqICAqIFJhdGUtbGltaXRlZCByb3cgcmVuZGVyaW5nIC0gQnkgZGVmYXVsdCwgb25seSBvbmUgcm93IGlzIHJlbmRlcmVkIHBlclxuICogICAgZXZlbnQtbG9vcCAoY3VzdG9taXphYmxlIHdpdGggdGhlIGBwYWdlU2l6ZWAgcHJvcCkuICBUaGlzIGJyZWFrcyB1cCB0aGVcbiAqICAgIHdvcmsgaW50byBzbWFsbGVyIGNodW5rcyB0byByZWR1Y2UgdGhlIGNoYW5jZSBvZiBkcm9wcGluZyBmcmFtZXMgd2hpbGVcbiAqICAgIHJlbmRlcmluZyByb3dzLlxuICovXG5jbGFzcyBMaXN0VmlldyBleHRlbmRzIENvbXBvbmVudCB7XG5cbiAgc3RhdGljIERhdGFTb3VyY2UgPSBMaXN0Vmlld0RhdGFTb3VyY2VcblxuICAvKipcbiAgICogWW91IG11c3QgcHJvdmlkZSBhIHJlbmRlclJvdyBmdW5jdGlvbi4gSWYgeW91IG9taXQgYW55IG9mIHRoZSBvdGhlciByZW5kZXJcbiAgICogZnVuY3Rpb25zLCBMaXN0VmlldyB3aWxsIHNpbXBseSBza2lwIHJlbmRlcmluZyB0aGVtLlxuICAgKlxuICAgKiAtIHJlbmRlclJvdyhyb3dEYXRhLCBzZWN0aW9uSUQsIHJvd0lELCBoaWdobGlnaHRSb3cpO1xuICAgKiAtIHJlbmRlclNlY3Rpb25IZWFkZXIoc2VjdGlvbkRhdGEsIHNlY3Rpb25JRCk7XG4gICAqL1xuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgIC4uLlNjcm9sbFZpZXcucHJvcFR5cGVzLFxuXG4gICAgZGF0YVNvdXJjZTogUHJvcFR5cGVzLmluc3RhbmNlT2YoTGlzdFZpZXdEYXRhU291cmNlKS5pc1JlcXVpcmVkLFxuICAgIC8qKlxuICAgICAqIChzZWN0aW9uSUQsIHJvd0lELCBhZGphY2VudFJvd0hpZ2hsaWdodGVkKSA9PiByZW5kZXJhYmxlXG4gICAgICpcbiAgICAgKiBJZiBwcm92aWRlZCwgYSByZW5kZXJhYmxlIGNvbXBvbmVudCB0byBiZSByZW5kZXJlZCBhcyB0aGUgc2VwYXJhdG9yXG4gICAgICogYmVsb3cgZWFjaCByb3cgYnV0IG5vdCB0aGUgbGFzdCByb3cgaWYgdGhlcmUgaXMgYSBzZWN0aW9uIGhlYWRlciBiZWxvdy5cbiAgICAgKiBUYWtlIGEgc2VjdGlvbklEIGFuZCByb3dJRCBvZiB0aGUgcm93IGFib3ZlIGFuZCB3aGV0aGVyIGl0cyBhZGphY2VudCByb3dcbiAgICAgKiBpcyBoaWdobGlnaHRlZC5cbiAgICAgKi9cbiAgICByZW5kZXJTZXBhcmF0b3I6IFByb3BUeXBlcy5mdW5jLFxuICAgIC8qKlxuICAgICAqIChyb3dEYXRhLCBzZWN0aW9uSUQsIHJvd0lELCBoaWdobGlnaHRSb3cpID0+IHJlbmRlcmFibGVcbiAgICAgKlxuICAgICAqIFRha2VzIGEgZGF0YSBlbnRyeSBmcm9tIHRoZSBkYXRhIHNvdXJjZSBhbmQgaXRzIGlkcyBhbmQgc2hvdWxkIHJldHVyblxuICAgICAqIGEgcmVuZGVyYWJsZSBjb21wb25lbnQgdG8gYmUgcmVuZGVyZWQgYXMgdGhlIHJvdy4gIEJ5IGRlZmF1bHQgdGhlIGRhdGFcbiAgICAgKiBpcyBleGFjdGx5IHdoYXQgd2FzIHB1dCBpbnRvIHRoZSBkYXRhIHNvdXJjZSwgYnV0IGl0J3MgYWxzbyBwb3NzaWJsZSB0b1xuICAgICAqIHByb3ZpZGUgY3VzdG9tIGV4dHJhY3RvcnMuIExpc3RWaWV3IGNhbiBiZSBub3RpZmllZCB3aGVuIGEgcm93IGlzXG4gICAgICogYmVpbmcgaGlnaGxpZ2h0ZWQgYnkgY2FsbGluZyBoaWdobGlnaHRSb3cgZnVuY3Rpb24uIFRoZSBzZXBhcmF0b3JzIGFib3ZlIGFuZFxuICAgICAqIGJlbG93IHdpbGwgYmUgaGlkZGVuIHdoZW4gYSByb3cgaXMgaGlnaGxpZ2h0ZWQuIFRoZSBoaWdobGlnaHRlZCBzdGF0ZSBvZlxuICAgICAqIGEgcm93IGNhbiBiZSByZXNldCBieSBjYWxsaW5nIGhpZ2hsaWdodFJvdyhudWxsKS5cbiAgICAgKi9cbiAgICByZW5kZXJSb3c6IFByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgLyoqXG4gICAgICogSG93IG1hbnkgcm93cyB0byByZW5kZXIgb24gaW5pdGlhbCBjb21wb25lbnQgbW91bnQuICBVc2UgdGhpcyB0byBtYWtlXG4gICAgICogaXQgc28gdGhhdCB0aGUgZmlyc3Qgc2NyZWVuIHdvcnRoIG9mIGRhdGEgYXBwZWFycyBhdCBvbmUgdGltZSBpbnN0ZWFkIG9mXG4gICAgICogb3ZlciB0aGUgY291cnNlIG9mIG11bHRpcGxlIGZyYW1lcy5cbiAgICAgKi9cbiAgICBpbml0aWFsTGlzdFNpemU6IFByb3BUeXBlcy5udW1iZXIsXG4gICAgLyoqXG4gICAgICogQ2FsbGVkIHdoZW4gYWxsIHJvd3MgaGF2ZSBiZWVuIHJlbmRlcmVkIGFuZCB0aGUgbGlzdCBoYXMgYmVlbiBzY3JvbGxlZFxuICAgICAqIHRvIHdpdGhpbiBvbkVuZFJlYWNoZWRUaHJlc2hvbGQgb2YgdGhlIGJvdHRvbS4gIFRoZSBuYXRpdmUgc2Nyb2xsXG4gICAgICogZXZlbnQgaXMgcHJvdmlkZWQuXG4gICAgICovXG4gICAgb25FbmRSZWFjaGVkOiBQcm9wVHlwZXMuZnVuYyxcbiAgICAvKipcbiAgICAgKiBUaHJlc2hvbGQgaW4gcGl4ZWxzICh2aXJ0dWFsLCBub3QgcGh5c2ljYWwpIGZvciBjYWxsaW5nIG9uRW5kUmVhY2hlZC5cbiAgICAgKi9cbiAgICBvbkVuZFJlYWNoZWRUaHJlc2hvbGQ6IFByb3BUeXBlcy5udW1iZXIsXG4gICAgLyoqXG4gICAgICogTnVtYmVyIG9mIHJvd3MgdG8gcmVuZGVyIHBlciBldmVudCBsb29wLiBOb3RlOiBpZiB5b3VyICdyb3dzJyBhcmUgYWN0dWFsbHlcbiAgICAgKiBjZWxscywgaS5lLiB0aGV5IGRvbid0IHNwYW4gdGhlIGZ1bGwgd2lkdGggb2YgeW91ciB2aWV3IChhcyBpbiB0aGVcbiAgICAgKiBMaXN0Vmlld0dyaWRMYXlvdXRFeGFtcGxlKSwgeW91IHNob3VsZCBzZXQgdGhlIHBhZ2VTaXplIHRvIGJlIGEgbXVsdGlwbGVcbiAgICAgKiBvZiB0aGUgbnVtYmVyIG9mIGNlbGxzIHBlciByb3csIG90aGVyd2lzZSB5b3UncmUgbGlrZWx5IHRvIHNlZSBnYXBzIGF0XG4gICAgICogdGhlIGVkZ2Ugb2YgdGhlIExpc3RWaWV3IGFzIG5ldyBwYWdlcyBhcmUgbG9hZGVkLlxuICAgICAqL1xuICAgIHBhZ2VTaXplOiBQcm9wVHlwZXMubnVtYmVyLFxuICAgIC8qKlxuICAgICAqICgpID0+IHJlbmRlcmFibGVcbiAgICAgKlxuICAgICAqIFRoZSBoZWFkZXIgYW5kIGZvb3RlciBhcmUgYWx3YXlzIHJlbmRlcmVkIChpZiB0aGVzZSBwcm9wcyBhcmUgcHJvdmlkZWQpXG4gICAgICogb24gZXZlcnkgcmVuZGVyIHBhc3MuICBJZiB0aGV5IGFyZSBleHBlbnNpdmUgdG8gcmUtcmVuZGVyLCB3cmFwIHRoZW1cbiAgICAgKiBpbiBTdGF0aWNDb250YWluZXIgb3Igb3RoZXIgbWVjaGFuaXNtIGFzIGFwcHJvcHJpYXRlLiAgRm9vdGVyIGlzIGFsd2F5c1xuICAgICAqIGF0IHRoZSBib3R0b20gb2YgdGhlIGxpc3QsIGFuZCBoZWFkZXIgYXQgdGhlIHRvcCwgb24gZXZlcnkgcmVuZGVyIHBhc3MuXG4gICAgICovXG4gICAgcmVuZGVyRm9vdGVyOiBQcm9wVHlwZXMuZnVuYyxcbiAgICByZW5kZXJIZWFkZXI6IFByb3BUeXBlcy5mdW5jLFxuICAgIC8qKlxuICAgICAqIChzZWN0aW9uRGF0YSwgc2VjdGlvbklEKSA9PiByZW5kZXJhYmxlXG4gICAgICpcbiAgICAgKiBJZiBwcm92aWRlZCwgYSBzdGlja3kgaGVhZGVyIGlzIHJlbmRlcmVkIGZvciB0aGlzIHNlY3Rpb24uICBUaGUgc3RpY2t5XG4gICAgICogYmVoYXZpb3IgbWVhbnMgdGhhdCBpdCB3aWxsIHNjcm9sbCB3aXRoIHRoZSBjb250ZW50IGF0IHRoZSB0b3Agb2YgdGhlXG4gICAgICogc2VjdGlvbiB1bnRpbCBpdCByZWFjaGVzIHRoZSB0b3Agb2YgdGhlIHNjcmVlbiwgYXQgd2hpY2ggcG9pbnQgaXQgd2lsbFxuICAgICAqIHN0aWNrIHRvIHRoZSB0b3AgdW50aWwgaXQgaXMgcHVzaGVkIG9mZiB0aGUgc2NyZWVuIGJ5IHRoZSBuZXh0IHNlY3Rpb25cbiAgICAgKiBoZWFkZXIuXG4gICAgICovXG4gICAgcmVuZGVyU2VjdGlvbkhlYWRlcjogUHJvcFR5cGVzLmZ1bmMsXG4gICAgLyoqXG4gICAgICogKHByb3BzKSA9PiByZW5kZXJhYmxlXG4gICAgICpcbiAgICAgKiBBIGZ1bmN0aW9uIHRoYXQgcmV0dXJucyB0aGUgc2Nyb2xsYWJsZSBjb21wb25lbnQgaW4gd2hpY2ggdGhlIGxpc3Qgcm93c1xuICAgICAqIGFyZSByZW5kZXJlZC4gRGVmYXVsdHMgdG8gcmV0dXJuaW5nIGEgU2Nyb2xsVmlldyB3aXRoIHRoZSBnaXZlbiBwcm9wcy5cbiAgICAgKi9cbiAgICByZW5kZXJTY3JvbGxDb21wb25lbnQ6IFJlYWN0LlByb3BUeXBlcy5mdW5jLmlzUmVxdWlyZWQsXG4gICAgLyoqXG4gICAgICogSG93IGVhcmx5IHRvIHN0YXJ0IHJlbmRlcmluZyByb3dzIGJlZm9yZSB0aGV5IGNvbWUgb24gc2NyZWVuLCBpblxuICAgICAqIHBpeGVscy5cbiAgICAgKi9cbiAgICBzY3JvbGxSZW5kZXJBaGVhZERpc3RhbmNlOiBSZWFjdC5Qcm9wVHlwZXMubnVtYmVyLFxuICAgIC8qKlxuICAgICAqICh2aXNpYmxlUm93cywgY2hhbmdlZFJvd3MpID0+IHZvaWRcbiAgICAgKlxuICAgICAqIENhbGxlZCB3aGVuIHRoZSBzZXQgb2YgdmlzaWJsZSByb3dzIGNoYW5nZXMuICBgdmlzaWJsZVJvd3NgIG1hcHNcbiAgICAgKiB7IHNlY3Rpb25JRDogeyByb3dJRDogdHJ1ZSB9fSBmb3IgYWxsIHRoZSB2aXNpYmxlIHJvd3MsIGFuZFxuICAgICAqIGBjaGFuZ2VkUm93c2AgbWFwcyB7IHNlY3Rpb25JRDogeyByb3dJRDogdHJ1ZSB8IGZhbHNlIH19IGZvciB0aGUgcm93c1xuICAgICAqIHRoYXQgaGF2ZSBjaGFuZ2VkIHRoZWlyIHZpc2liaWxpdHksIHdpdGggdHJ1ZSBpbmRpY2F0aW5nIHZpc2libGUsIGFuZFxuICAgICAqIGZhbHNlIGluZGljYXRpbmcgdGhlIHZpZXcgaGFzIG1vdmVkIG91dCBvZiB2aWV3LlxuICAgICAqL1xuICAgIG9uQ2hhbmdlVmlzaWJsZVJvd3M6IFJlYWN0LlByb3BUeXBlcy5mdW5jLFxuICAgIC8qKlxuICAgICAqIEEgcGVyZm9ybWFuY2Ugb3B0aW1pemF0aW9uIGZvciBpbXByb3Zpbmcgc2Nyb2xsIHBlcmYgb2ZcbiAgICAgKiBsYXJnZSBsaXN0cywgdXNlZCBpbiBjb25qdW5jdGlvbiB3aXRoIG92ZXJmbG93OiAnaGlkZGVuJyBvbiB0aGUgcm93XG4gICAgICogY29udGFpbmVycy4gIFRoaXMgaXMgZW5hYmxlZCBieSBkZWZhdWx0LlxuICAgICAqL1xuICAgIHJlbW92ZUNsaXBwZWRTdWJ2aWV3czogUmVhY3QuUHJvcFR5cGVzLmJvb2wsXG4gICAgLyoqXG4gICAgICogQW4gYXJyYXkgb2YgY2hpbGQgaW5kaWNlcyBkZXRlcm1pbmluZyB3aGljaCBjaGlsZHJlbiBnZXQgZG9ja2VkIHRvIHRoZVxuICAgICAqIHRvcCBvZiB0aGUgc2NyZWVuIHdoZW4gc2Nyb2xsaW5nLiBGb3IgZXhhbXBsZSwgcGFzc2luZ1xuICAgICAqIGBzdGlja3lIZWFkZXJJbmRpY2VzPXtbMF19YCB3aWxsIGNhdXNlIHRoZSBmaXJzdCBjaGlsZCB0byBiZSBmaXhlZCB0byB0aGVcbiAgICAgKiB0b3Agb2YgdGhlIHNjcm9sbCB2aWV3LiBUaGlzIHByb3BlcnR5IGlzIG5vdCBzdXBwb3J0ZWQgaW4gY29uanVuY3Rpb25cbiAgICAgKiB3aXRoIGBob3Jpem9udGFsPXt0cnVlfWAuXG4gICAgICogQHBsYXRmb3JtIGlvc1xuICAgICAqL1xuICAgIHN0aWNreUhlYWRlckluZGljZXM6IFByb3BUeXBlcy5hcnJheU9mKFByb3BUeXBlcy5udW1iZXIpLFxuICB9XG5cbiAgLyoqXG4gICAqIFJlYWN0IGxpZmUgY3ljbGUgaG9va3MuXG4gICAqL1xuXG4gIHN0YXRpYyBkZWZhdWx0UHJvcHMgPSB7XG4gICAgaW5pdGlhbExpc3RTaXplOiBERUZBVUxUX0lOSVRJQUxfUk9XUyxcbiAgICBwYWdlU2l6ZTogREVGQVVMVF9QQUdFX1NJWkUsXG4gICAgcmVuZGVyU2Nyb2xsQ29tcG9uZW50OiBwcm9wcyA9PiA8U2Nyb2xsVmlldyB7Li4ucHJvcHN9IC8+LFxuICAgIHNjcm9sbFJlbmRlckFoZWFkRGlzdGFuY2U6IERFRkFVTFRfU0NST0xMX1JFTkRFUl9BSEVBRCxcbiAgICBvbkVuZFJlYWNoZWRUaHJlc2hvbGQ6IERFRkFVTFRfRU5EX1JFQUNIRURfVEhSRVNIT0xELFxuICAgIHN0aWNreUhlYWRlckluZGljZXM6IFtdLFxuICB9XG5cbiAgc3RhdGUgPSB7XG4gICAgY3VyUmVuZGVyZWRSb3dzQ291bnQ6IHRoaXMucHJvcHMuaW5pdGlhbExpc3RTaXplLFxuICAgIGhpZ2hsaWdodGVkUm93OiB7fSxcbiAgfVxuXG4gIC8qKlxuICAgKiBFeHBvcnRzIHNvbWUgZGF0YSwgZS5nLiBmb3IgcGVyZiBpbnZlc3RpZ2F0aW9ucyBvciBhbmFseXRpY3MuXG4gICAqL1xuICBnZXRNZXRyaWNzKCkge1xuICAgIHJldHVybiB7XG4gICAgICBjb250ZW50TGVuZ3RoOiB0aGlzLnNjcm9sbFByb3BlcnRpZXMuY29udGVudExlbmd0aCxcbiAgICAgIHRvdGFsUm93czogdGhpcy5wcm9wcy5kYXRhU291cmNlLmdldFJvd0NvdW50KCksXG4gICAgICByZW5kZXJlZFJvd3M6IHRoaXMuc3RhdGUuY3VyUmVuZGVyZWRSb3dzQ291bnQsXG4gICAgICB2aXNpYmxlUm93czogT2JqZWN0LmtleXModGhpcy5fdmlzaWJsZVJvd3MpLmxlbmd0aCxcbiAgICB9O1xuICB9XG5cbiAgLyoqXG4gICAqIFByb3ZpZGVzIGEgaGFuZGxlIHRvIHRoZSB1bmRlcmx5aW5nIHNjcm9sbCByZXNwb25kZXIuXG4gICAqIE5vdGUgdGhhdCB0aGUgdmlldyBpbiBgU0NST0xMVklFV19SRUZgIG1heSBub3QgYmUgYSBgU2Nyb2xsVmlld2AsIHNvIHdlXG4gICAqIG5lZWQgdG8gY2hlY2sgdGhhdCBpdCByZXNwb25kcyB0byBgZ2V0U2Nyb2xsUmVzcG9uZGVyYCBiZWZvcmUgY2FsbGluZyBpdC5cbiAgICovXG4gIGdldFNjcm9sbFJlc3BvbmRlcigpIHtcbiAgICByZXR1cm4gdGhpcy5yZWZzW1NDUk9MTFZJRVdfUkVGXSAmJlxuICAgICAgdGhpcy5yZWZzW1NDUk9MTFZJRVdfUkVGXS5nZXRTY3JvbGxSZXNwb25kZXIgJiZcbiAgICAgIHRoaXMucmVmc1tTQ1JPTExWSUVXX1JFRl0uZ2V0U2Nyb2xsUmVzcG9uZGVyKCk7XG4gIH1cblxuICBzY3JvbGxUbyguLi5hcmdzKSB7XG4gICAgdGhpcy5yZWZzW1NDUk9MTFZJRVdfUkVGXSAmJlxuICAgIHRoaXMucmVmc1tTQ1JPTExWSUVXX1JFRl0uc2Nyb2xsVG8gJiZcbiAgICB0aGlzLnJlZnNbU0NST0xMVklFV19SRUZdLnNjcm9sbFRvKC4uLmFyZ3MpO1xuICB9XG5cbiAgc2V0TmF0aXZlUHJvcHMocHJvcHMpIHtcbiAgICB0aGlzLnJlZnNbU0NST0xMVklFV19SRUZdICYmXG4gICAgdGhpcy5yZWZzW1NDUk9MTFZJRVdfUkVGXS5zZXROYXRpdmVQcm9wcyhwcm9wcyk7XG4gIH1cblxuICBnZXRJbm5lclZpZXdOb2RlKCkge1xuICAgIHJldHVybiB0aGlzLnJlZnNbU0NST0xMVklFV19SRUZdLmdldElubmVyVmlld05vZGUoKTtcbiAgfVxuXG4gIGNvbXBvbmVudFdpbGxNb3VudCgpIHtcbiAgICAvLyB0aGlzIGRhdGEgc2hvdWxkIG5ldmVyIHRyaWdnZXIgYSByZW5kZXIgcGFzcywgc28gZG9uJ3QgcHV0IGluIHN0YXRlXG4gICAgdGhpcy5zY3JvbGxQcm9wZXJ0aWVzID0ge1xuICAgICAgdmlzaWJsZUxlbmd0aDogbnVsbCxcbiAgICAgIGNvbnRlbnRMZW5ndGg6IG51bGwsXG4gICAgICBvZmZzZXQ6IDBcbiAgICB9O1xuICAgIHRoaXMuX2NoaWxkRnJhbWVzID0gW107XG4gICAgdGhpcy5fdmlzaWJsZVJvd3MgPSB7fTtcbiAgICB0aGlzLl9wcmV2UmVuZGVyZWRSb3dzQ291bnQgPSAwO1xuICAgIHRoaXMuX3NlbnRFbmRGb3JDb250ZW50TGVuZ3RoID0gbnVsbDtcbiAgfVxuXG4gIGNvbXBvbmVudERpZE1vdW50KCkge1xuICAgIC8vIGRvIHRoaXMgaW4gYW5pbWF0aW9uIGZyYW1lIHVudGlsIGNvbXBvbmVudERpZE1vdW50IGFjdHVhbGx5IHJ1bnMgYWZ0ZXJcbiAgICAvLyB0aGUgY29tcG9uZW50IGlzIGxhaWQgb3V0XG4gICAgdGhpcy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUoKCkgPT4ge1xuICAgICAgdGhpcy5fbWVhc3VyZUFuZFVwZGF0ZVNjcm9sbFByb3BzKCk7XG4gICAgfSk7XG4gIH1cblxuICBjb21wb25lbnRXaWxsUmVjZWl2ZVByb3BzKG5leHRQcm9wcykge1xuICAgIGlmICh0aGlzLnByb3BzLmRhdGFTb3VyY2UgIT09IG5leHRQcm9wcy5kYXRhU291cmNlIHx8XG4gICAgICAgIHRoaXMucHJvcHMuaW5pdGlhbExpc3RTaXplICE9PSBuZXh0UHJvcHMuaW5pdGlhbExpc3RTaXplKSB7XG4gICAgICB0aGlzLnNldFN0YXRlKChzdGF0ZSwgcHJvcHMpID0+IHtcbiAgICAgICAgdGhpcy5fcHJldlJlbmRlcmVkUm93c0NvdW50ID0gMDtcbiAgICAgICAgcmV0dXJuIHtcbiAgICAgICAgICBjdXJSZW5kZXJlZFJvd3NDb3VudDogTWF0aC5taW4oXG4gICAgICAgICAgICBNYXRoLm1heChcbiAgICAgICAgICAgICAgc3RhdGUuY3VyUmVuZGVyZWRSb3dzQ291bnQsXG4gICAgICAgICAgICAgIHByb3BzLmluaXRpYWxMaXN0U2l6ZVxuICAgICAgICAgICAgKSxcbiAgICAgICAgICAgIHByb3BzLmRhdGFTb3VyY2UuZ2V0Um93Q291bnQoKVxuICAgICAgICAgICksXG4gICAgICAgIH07XG4gICAgICB9LCAoKSA9PiB0aGlzLl9yZW5kZXJNb3JlUm93c0lmTmVlZGVkKCkpO1xuICAgIH1cbiAgfVxuXG4gIGNvbXBvbmVudERpZFVwZGF0ZSgpIHtcbiAgICB0aGlzLnJlcXVlc3RBbmltYXRpb25GcmFtZSgoKSA9PiB7XG4gICAgICB0aGlzLl9tZWFzdXJlQW5kVXBkYXRlU2Nyb2xsUHJvcHMoKTtcbiAgICB9KTtcbiAgfVxuXG4gIG9uUm93SGlnaGxpZ2h0ZWQoc2VjdGlvbklELCByb3dJRCkge1xuICAgIHRoaXMuc2V0U3RhdGUoe2hpZ2hsaWdodGVkUm93OiB7c2VjdGlvbklELCByb3dJRH19KTtcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBsZXQgYm9keUNvbXBvbmVudHMgPSBbXTtcblxuICAgIGxldCBkYXRhU291cmNlID0gdGhpcy5wcm9wcy5kYXRhU291cmNlO1xuICAgIGxldCBhbGxSb3dJRHMgPSBkYXRhU291cmNlLnJvd0lkZW50aXRpZXM7XG4gICAgbGV0IHJvd0NvdW50ID0gMDtcbiAgICBsZXQgc2VjdGlvbkhlYWRlckluZGljZXMgPSBbXTtcblxuICAgIGxldCBoZWFkZXIgPSB0aGlzLnByb3BzLnJlbmRlckhlYWRlciAmJiB0aGlzLnByb3BzLnJlbmRlckhlYWRlcigpO1xuICAgIGxldCBmb290ZXIgPSB0aGlzLnByb3BzLnJlbmRlckZvb3RlciAmJiB0aGlzLnByb3BzLnJlbmRlckZvb3RlcigpO1xuICAgIGxldCB0b3RhbEluZGV4ID0gaGVhZGVyID8gMSA6IDA7XG5cbiAgICBmb3IgKGxldCBzZWN0aW9uSWR4ID0gMDsgc2VjdGlvbklkeCA8IGFsbFJvd0lEcy5sZW5ndGg7IHNlY3Rpb25JZHgrKykge1xuICAgICAgbGV0IHNlY3Rpb25JRCA9IGRhdGFTb3VyY2Uuc2VjdGlvbklkZW50aXRpZXNbc2VjdGlvbklkeF07XG4gICAgICBsZXQgcm93SURzID0gYWxsUm93SURzW3NlY3Rpb25JZHhdO1xuICAgICAgaWYgKHJvd0lEcy5sZW5ndGggPT09IDApIHtcbiAgICAgICAgY29udGludWU7XG4gICAgICB9XG5cbiAgICAgIGlmICh0aGlzLnByb3BzLnJlbmRlclNlY3Rpb25IZWFkZXIpIHtcbiAgICAgICAgbGV0IHNob3VsZFVwZGF0ZUhlYWRlciA9IHJvd0NvdW50ID49IHRoaXMuX3ByZXZSZW5kZXJlZFJvd3NDb3VudCAmJlxuICAgICAgICAgIGRhdGFTb3VyY2Uuc2VjdGlvbkhlYWRlclNob3VsZFVwZGF0ZShzZWN0aW9uSWR4KTtcbiAgICAgICAgYm9keUNvbXBvbmVudHMucHVzaChcbiAgICAgICAgICA8U3RhdGljUmVuZGVyZXJcbiAgICAgICAgICAgIGtleT17J3NfJyArIHNlY3Rpb25JRH1cbiAgICAgICAgICAgIHNob3VsZFVwZGF0ZT17ISFzaG91bGRVcGRhdGVIZWFkZXJ9XG4gICAgICAgICAgICByZW5kZXI9e3RoaXMucHJvcHMucmVuZGVyU2VjdGlvbkhlYWRlci5iaW5kKFxuICAgICAgICAgICAgICBudWxsLFxuICAgICAgICAgICAgICBkYXRhU291cmNlLmdldFNlY3Rpb25IZWFkZXJEYXRhKHNlY3Rpb25JZHgpLFxuICAgICAgICAgICAgICBzZWN0aW9uSURcbiAgICAgICAgICAgICl9XG4gICAgICAgICAgLz5cbiAgICAgICAgKTtcbiAgICAgICAgc2VjdGlvbkhlYWRlckluZGljZXMucHVzaCh0b3RhbEluZGV4KyspO1xuICAgICAgfVxuXG4gICAgICBmb3IgKGxldCByb3dJZHggPSAwOyByb3dJZHggPCByb3dJRHMubGVuZ3RoOyByb3dJZHgrKykge1xuICAgICAgICBsZXQgcm93SUQgPSByb3dJRHNbcm93SWR4XTtcbiAgICAgICAgbGV0IGNvbWJvSUQgPSBzZWN0aW9uSUQgKyAnXycgKyByb3dJRDtcbiAgICAgICAgbGV0IHNob3VsZFVwZGF0ZVJvdyA9IHJvd0NvdW50ID49IHRoaXMuX3ByZXZSZW5kZXJlZFJvd3NDb3VudCAmJlxuICAgICAgICAgIGRhdGFTb3VyY2Uucm93U2hvdWxkVXBkYXRlKHNlY3Rpb25JZHgsIHJvd0lkeCk7XG4gICAgICAgIGxldCByb3cgPVxuICAgICAgICAgIDxTdGF0aWNSZW5kZXJlclxuICAgICAgICAgICAga2V5PXsncl8nICsgY29tYm9JRH1cbiAgICAgICAgICAgIHNob3VsZFVwZGF0ZT17ISFzaG91bGRVcGRhdGVSb3d9XG4gICAgICAgICAgICByZW5kZXI9e3RoaXMucHJvcHMucmVuZGVyUm93LmJpbmQoXG4gICAgICAgICAgICAgIG51bGwsXG4gICAgICAgICAgICAgIGRhdGFTb3VyY2UuZ2V0Um93RGF0YShzZWN0aW9uSWR4LCByb3dJZHgpLFxuICAgICAgICAgICAgICBzZWN0aW9uSUQsXG4gICAgICAgICAgICAgIHJvd0lELFxuICAgICAgICAgICAgICB0aGlzLm9uUm93SGlnaGxpZ2h0ZWRcbiAgICAgICAgICAgICl9XG4gICAgICAgICAgLz47XG4gICAgICAgIGJvZHlDb21wb25lbnRzLnB1c2gocm93KTtcbiAgICAgICAgdG90YWxJbmRleCsrO1xuXG4gICAgICAgIGlmICh0aGlzLnByb3BzLnJlbmRlclNlcGFyYXRvciAmJlxuICAgICAgICAgICAgKHJvd0lkeCAhPT0gcm93SURzLmxlbmd0aCAtIDEgfHwgc2VjdGlvbklkeCA9PT0gYWxsUm93SURzLmxlbmd0aCAtIDEpKSB7XG4gICAgICAgICAgbGV0IGFkamFjZW50Um93SGlnaGxpZ2h0ZWQgPVxuICAgICAgICAgICAgdGhpcy5zdGF0ZS5oaWdobGlnaHRlZFJvdy5zZWN0aW9uSUQgPT09IHNlY3Rpb25JRCAmJiAoXG4gICAgICAgICAgICAgIHRoaXMuc3RhdGUuaGlnaGxpZ2h0ZWRSb3cucm93SUQgPT09IHJvd0lEIHx8XG4gICAgICAgICAgICAgIHRoaXMuc3RhdGUuaGlnaGxpZ2h0ZWRSb3cucm93SUQgPT09IHJvd0lEc1tyb3dJZHggKyAxXVxuICAgICAgICAgICAgKTtcbiAgICAgICAgICBsZXQgc2VwYXJhdG9yID0gdGhpcy5wcm9wcy5yZW5kZXJTZXBhcmF0b3IoXG4gICAgICAgICAgICBzZWN0aW9uSUQsXG4gICAgICAgICAgICByb3dJRCxcbiAgICAgICAgICAgIGFkamFjZW50Um93SGlnaGxpZ2h0ZWRcbiAgICAgICAgICApO1xuICAgICAgICAgIGlmIChzZXBhcmF0b3IpIHtcbiAgICAgICAgICAgIGJvZHlDb21wb25lbnRzLnB1c2goc2VwYXJhdG9yKTtcbiAgICAgICAgICAgIHRvdGFsSW5kZXgrKztcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgICAgaWYgKCsrcm93Q291bnQgPT09IHRoaXMuc3RhdGUuY3VyUmVuZGVyZWRSb3dzQ291bnQpIHtcbiAgICAgICAgICBicmVhaztcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgaWYgKHJvd0NvdW50ID49IHRoaXMuc3RhdGUuY3VyUmVuZGVyZWRSb3dzQ291bnQpIHtcbiAgICAgICAgYnJlYWs7XG4gICAgICB9XG4gICAgfVxuXG4gICAgbGV0IHtcbiAgICAgIHJlbmRlclNjcm9sbENvbXBvbmVudCxcbiAgICAgIC4uLnByb3BzLFxuICAgIH0gPSB0aGlzLnByb3BzO1xuICAgIGlmICghcHJvcHMuc2Nyb2xsRXZlbnRUaHJvdHRsZSkge1xuICAgICAgcHJvcHMuc2Nyb2xsRXZlbnRUaHJvdHRsZSA9IERFRkFVTFRfU0NST0xMX0NBTExCQUNLX1RIUk9UVExFO1xuICAgIH1cbiAgICBpZiAocHJvcHMucmVtb3ZlQ2xpcHBlZFN1YnZpZXdzID09PSB1bmRlZmluZWQpIHtcbiAgICAgIHByb3BzLnJlbW92ZUNsaXBwZWRTdWJ2aWV3cyA9IHRydWU7XG4gICAgfVxuICAgIGFzc2lnbihwcm9wcywge1xuICAgICAgb25TY3JvbGw6IHRoaXMuX29uU2Nyb2xsLFxuICAgICAgc3RpY2t5SGVhZGVySW5kaWNlczogdGhpcy5wcm9wcy5zdGlja3lIZWFkZXJJbmRpY2VzLmNvbmNhdChzZWN0aW9uSGVhZGVySW5kaWNlcyksXG5cbiAgICAgIC8vIERvIG5vdCBwYXNzIHRoZXNlIGV2ZW50cyBkb3duc3RyZWFtIHRvIFNjcm9sbFZpZXcgc2luY2UgdGhleSB3aWxsIGJlXG4gICAgICAvLyByZWdpc3RlcmVkIGluIExpc3RWaWV3J3Mgb3duIFNjcm9sbFJlc3BvbmRlci5NaXhpblxuICAgICAgb25LZXlib2FyZFdpbGxTaG93OiB1bmRlZmluZWQsXG4gICAgICBvbktleWJvYXJkV2lsbEhpZGU6IHVuZGVmaW5lZCxcbiAgICAgIG9uS2V5Ym9hcmREaWRTaG93OiB1bmRlZmluZWQsXG4gICAgICBvbktleWJvYXJkRGlkSGlkZTogdW5kZWZpbmVkLFxuICAgIH0pO1xuXG4gICAgLy8gVE9ETyhpZGUpOiBVc2UgZnVuY3Rpb24gcmVmcyBzbyB3ZSBjYW4gY29tcG9zZSB3aXRoIHRoZSBzY3JvbGxcbiAgICAvLyBjb21wb25lbnQncyBvcmlnaW5hbCByZWYgaW5zdGVhZCBvZiBjbG9iYmVyaW5nIGl0XG4gICAgcmV0dXJuIFJlYWN0LmNsb25lRWxlbWVudChyZW5kZXJTY3JvbGxDb21wb25lbnQocHJvcHMpLCB7XG4gICAgICByZWY6IFNDUk9MTFZJRVdfUkVGLFxuICAgICAgb25Db250ZW50U2l6ZUNoYW5nZTogdGhpcy5fb25Db250ZW50U2l6ZUNoYW5nZSxcbiAgICAgIG9uTGF5b3V0OiB0aGlzLl9vbkxheW91dCxcbiAgICB9LCBoZWFkZXIsIGJvZHlDb21wb25lbnRzLCBmb290ZXIpO1xuICB9XG5cbiAgLyoqXG4gICAqIFByaXZhdGUgbWV0aG9kc1xuICAgKi9cblxuICBfbWVhc3VyZUFuZFVwZGF0ZVNjcm9sbFByb3BzKCkge1xuICAgIGxldCBzY3JvbGxDb21wb25lbnQgPSB0aGlzLmdldFNjcm9sbFJlc3BvbmRlcigpO1xuICAgIGlmICghc2Nyb2xsQ29tcG9uZW50IHx8ICFzY3JvbGxDb21wb25lbnQuZ2V0SW5uZXJWaWV3Tm9kZSkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cblxuICAgIC8vIFJDVFNjcm9sbFZpZXdNYW5hZ2VyLmNhbGN1bGF0ZUNoaWxkRnJhbWVzIGlzIG5vdCBhdmFpbGFibGUgb25cbiAgICAvLyBldmVyeSBwbGF0Zm9ybVxuICAgIC8vIFJDVFNjcm9sbFZpZXdNYW5hZ2VyICYmIFJDVFNjcm9sbFZpZXdNYW5hZ2VyLmNhbGN1bGF0ZUNoaWxkRnJhbWVzICYmXG4gICAgLy8gICBSQ1RTY3JvbGxWaWV3TWFuYWdlci5jYWxjdWxhdGVDaGlsZEZyYW1lcyhcbiAgICAvLyAgICAgUmVhY3QuZmluZE5vZGVIYW5kbGUoc2Nyb2xsQ29tcG9uZW50KSxcbiAgICAvLyAgICAgdGhpcy5fdXBkYXRlVmlzaWJsZVJvd3MsXG4gICAgLy8gICApO1xuICB9XG5cbiAgX29uQ29udGVudFNpemVDaGFuZ2Uod2lkdGgsIGhlaWdodCkge1xuICAgIGxldCBjb250ZW50TGVuZ3RoID0gIXRoaXMucHJvcHMuaG9yaXpvbnRhbCA/IGhlaWdodCA6IHdpZHRoO1xuICAgIGlmIChjb250ZW50TGVuZ3RoICE9PSB0aGlzLnNjcm9sbFByb3BlcnRpZXMuY29udGVudExlbmd0aCkge1xuICAgICAgdGhpcy5zY3JvbGxQcm9wZXJ0aWVzLmNvbnRlbnRMZW5ndGggPSBjb250ZW50TGVuZ3RoO1xuICAgICAgdGhpcy5fdXBkYXRlVmlzaWJsZVJvd3MoKTtcbiAgICAgIHRoaXMuX3JlbmRlck1vcmVSb3dzSWZOZWVkZWQoKTtcbiAgICB9XG4gICAgdGhpcy5wcm9wcy5vbkNvbnRlbnRTaXplQ2hhbmdlICYmIHRoaXMucHJvcHMub25Db250ZW50U2l6ZUNoYW5nZSh3aWR0aCwgaGVpZ2h0KTtcbiAgfVxuXG4gIF9vbkxheW91dChldmVudCkge1xuICAgIGxldCB7d2lkdGgsIGhlaWdodH0gPSBldmVudC5uYXRpdmVFdmVudC5sYXlvdXQ7XG4gICAgbGV0IHZpc2libGVMZW5ndGggPSAhdGhpcy5wcm9wcy5ob3Jpem9udGFsID8gaGVpZ2h0IDogd2lkdGg7XG4gICAgaWYgKHZpc2libGVMZW5ndGggIT09IHRoaXMuc2Nyb2xsUHJvcGVydGllcy52aXNpYmxlTGVuZ3RoKSB7XG4gICAgICB0aGlzLnNjcm9sbFByb3BlcnRpZXMudmlzaWJsZUxlbmd0aCA9IHZpc2libGVMZW5ndGg7XG4gICAgICB0aGlzLl91cGRhdGVWaXNpYmxlUm93cygpO1xuICAgICAgdGhpcy5fcmVuZGVyTW9yZVJvd3NJZk5lZWRlZCgpO1xuICAgIH1cbiAgICB0aGlzLnByb3BzLm9uTGF5b3V0ICYmIHRoaXMucHJvcHMub25MYXlvdXQoZXZlbnQpO1xuICB9XG5cbiAgX21heWJlQ2FsbE9uRW5kUmVhY2hlZChldmVudCkge1xuICAgIGlmICh0aGlzLnByb3BzLm9uRW5kUmVhY2hlZCAmJlxuICAgICAgICB0aGlzLnNjcm9sbFByb3BlcnRpZXMuY29udGVudExlbmd0aCAhPT0gdGhpcy5fc2VudEVuZEZvckNvbnRlbnRMZW5ndGggJiZcbiAgICAgICAgdGhpcy5fZ2V0RGlzdGFuY2VGcm9tRW5kKHRoaXMuc2Nyb2xsUHJvcGVydGllcykgPCB0aGlzLnByb3BzLm9uRW5kUmVhY2hlZFRocmVzaG9sZCAmJlxuICAgICAgICB0aGlzLnN0YXRlLmN1clJlbmRlcmVkUm93c0NvdW50ID09PSB0aGlzLnByb3BzLmRhdGFTb3VyY2UuZ2V0Um93Q291bnQoKSkge1xuICAgICAgdGhpcy5fc2VudEVuZEZvckNvbnRlbnRMZW5ndGggPSB0aGlzLnNjcm9sbFByb3BlcnRpZXMuY29udGVudExlbmd0aDtcbiAgICAgIHRoaXMucHJvcHMub25FbmRSZWFjaGVkKGV2ZW50KTtcbiAgICAgIHJldHVybiB0cnVlO1xuICAgIH1cbiAgICByZXR1cm4gZmFsc2U7XG4gIH1cblxuICBfcmVuZGVyTW9yZVJvd3NJZk5lZWRlZCgpIHtcbiAgICBpZiAodGhpcy5zY3JvbGxQcm9wZXJ0aWVzLmNvbnRlbnRMZW5ndGggPT09IG51bGwgfHxcbiAgICAgIHRoaXMuc2Nyb2xsUHJvcGVydGllcy52aXNpYmxlTGVuZ3RoID09PSBudWxsIHx8XG4gICAgICB0aGlzLnN0YXRlLmN1clJlbmRlcmVkUm93c0NvdW50ID09PSB0aGlzLnByb3BzLmRhdGFTb3VyY2UuZ2V0Um93Q291bnQoKSkge1xuICAgICAgdGhpcy5fbWF5YmVDYWxsT25FbmRSZWFjaGVkKCk7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgbGV0IGRpc3RhbmNlRnJvbUVuZCA9IHRoaXMuX2dldERpc3RhbmNlRnJvbUVuZCh0aGlzLnNjcm9sbFByb3BlcnRpZXMpO1xuICAgIGlmIChkaXN0YW5jZUZyb21FbmQgPCB0aGlzLnByb3BzLnNjcm9sbFJlbmRlckFoZWFkRGlzdGFuY2UpIHtcbiAgICAgIHRoaXMuX3BhZ2VJbk5ld1Jvd3MoKTtcbiAgICB9XG4gIH1cblxuICBfcGFnZUluTmV3Um93cygpIHtcbiAgICB0aGlzLnNldFN0YXRlKChzdGF0ZSwgcHJvcHMpID0+IHtcbiAgICAgIGxldCByb3dzVG9SZW5kZXIgPSBNYXRoLm1pbihcbiAgICAgICAgc3RhdGUuY3VyUmVuZGVyZWRSb3dzQ291bnQgKyBwcm9wcy5wYWdlU2l6ZSxcbiAgICAgICAgcHJvcHMuZGF0YVNvdXJjZS5nZXRSb3dDb3VudCgpXG4gICAgICApO1xuICAgICAgdGhpcy5fcHJldlJlbmRlcmVkUm93c0NvdW50ID0gc3RhdGUuY3VyUmVuZGVyZWRSb3dzQ291bnQ7XG4gICAgICByZXR1cm4ge1xuICAgICAgICBjdXJSZW5kZXJlZFJvd3NDb3VudDogcm93c1RvUmVuZGVyXG4gICAgICB9O1xuICAgIH0sICgpID0+IHtcbiAgICAgIHRoaXMuX21lYXN1cmVBbmRVcGRhdGVTY3JvbGxQcm9wcygpO1xuICAgICAgdGhpcy5fcHJldlJlbmRlcmVkUm93c0NvdW50ID0gdGhpcy5zdGF0ZS5jdXJSZW5kZXJlZFJvd3NDb3VudDtcbiAgICB9KTtcbiAgfVxuXG4gIF9nZXREaXN0YW5jZUZyb21FbmQoc2Nyb2xsUHJvcGVydGllcykge1xuICAgIHJldHVybiBzY3JvbGxQcm9wZXJ0aWVzLmNvbnRlbnRMZW5ndGggLSBzY3JvbGxQcm9wZXJ0aWVzLnZpc2libGVMZW5ndGggLSBzY3JvbGxQcm9wZXJ0aWVzLm9mZnNldDtcbiAgfVxuXG4gIF91cGRhdGVWaXNpYmxlUm93cyh1cGRhdGVkRnJhbWVzKSB7XG4gICAgLy8gaWYgKCF0aGlzLnByb3BzLm9uQ2hhbmdlVmlzaWJsZVJvd3MpIHtcbiAgICAvLyAgIHJldHVybjsgLy8gTm8gbmVlZCB0byBjb21wdXRlIHZpc2libGUgcm93cyBpZiB0aGVyZSBpcyBubyBjYWxsYmFja1xuICAgIC8vIH1cbiAgICAvLyBpZiAodXBkYXRlZEZyYW1lcykge1xuICAgIC8vICAgdXBkYXRlZEZyYW1lcy5mb3JFYWNoKChuZXdGcmFtZSkgPT4ge1xuICAgIC8vICAgICB0aGlzLl9jaGlsZEZyYW1lc1tuZXdGcmFtZS5pbmRleF0gPSBtZXJnZShuZXdGcmFtZSk7XG4gICAgLy8gICB9KTtcbiAgICAvLyB9XG4gICAgLy8gbGV0IGlzVmVydGljYWwgPSAhdGhpcy5wcm9wcy5ob3Jpem9udGFsO1xuICAgIC8vIGxldCBkYXRhU291cmNlID0gdGhpcy5wcm9wcy5kYXRhU291cmNlO1xuICAgIC8vIGxldCB2aXNpYmxlTWluID0gdGhpcy5zY3JvbGxQcm9wZXJ0aWVzLm9mZnNldDtcbiAgICAvLyBsZXQgdmlzaWJsZU1heCA9IHZpc2libGVNaW4gKyB0aGlzLnNjcm9sbFByb3BlcnRpZXMudmlzaWJsZUxlbmd0aDtcbiAgICAvLyBsZXQgYWxsUm93SURzID0gZGF0YVNvdXJjZS5yb3dJZGVudGl0aWVzO1xuICAgIC8vXG4gICAgLy8gbGV0IGhlYWRlciA9IHRoaXMucHJvcHMucmVuZGVySGVhZGVyICYmIHRoaXMucHJvcHMucmVuZGVySGVhZGVyKCk7XG4gICAgLy8gbGV0IHRvdGFsSW5kZXggPSBoZWFkZXIgPyAxIDogMDtcbiAgICAvLyBsZXQgdmlzaWJpbGl0eUNoYW5nZWQgPSBmYWxzZTtcbiAgICAvLyBsZXQgY2hhbmdlZFJvd3MgPSB7fTtcbiAgICAvLyBmb3IgKGxldCBzZWN0aW9uSWR4ID0gMDsgc2VjdGlvbklkeCA8IGFsbFJvd0lEcy5sZW5ndGg7IHNlY3Rpb25JZHgrKykge1xuICAgIC8vICAgbGV0IHJvd0lEcyA9IGFsbFJvd0lEc1tzZWN0aW9uSWR4XTtcbiAgICAvLyAgIGlmIChyb3dJRHMubGVuZ3RoID09PSAwKSB7XG4gICAgLy8gICAgIGNvbnRpbnVlO1xuICAgIC8vICAgfVxuICAgIC8vICAgbGV0IHNlY3Rpb25JRCA9IGRhdGFTb3VyY2Uuc2VjdGlvbklkZW50aXRpZXNbc2VjdGlvbklkeF07XG4gICAgLy8gICBpZiAodGhpcy5wcm9wcy5yZW5kZXJTZWN0aW9uSGVhZGVyKSB7XG4gICAgLy8gICAgIHRvdGFsSW5kZXgrKztcbiAgICAvLyAgIH1cbiAgICAvLyAgIGxldCB2aXNpYmxlU2VjdGlvbiA9IHRoaXMuX3Zpc2libGVSb3dzW3NlY3Rpb25JRF07XG4gICAgLy8gICBpZiAoIXZpc2libGVTZWN0aW9uKSB7XG4gICAgLy8gICAgIHZpc2libGVTZWN0aW9uID0ge307XG4gICAgLy8gICB9XG4gICAgLy8gICBmb3IgKGxldCByb3dJZHggPSAwOyByb3dJZHggPCByb3dJRHMubGVuZ3RoOyByb3dJZHgrKykge1xuICAgIC8vICAgICBsZXQgcm93SUQgPSByb3dJRHNbcm93SWR4XTtcbiAgICAvLyAgICAgbGV0IGZyYW1lID0gdGhpcy5fY2hpbGRGcmFtZXNbdG90YWxJbmRleF07XG4gICAgLy8gICAgIHRvdGFsSW5kZXgrKztcbiAgICAvLyAgICAgaWYgKCFmcmFtZSkge1xuICAgIC8vICAgICAgIGJyZWFrO1xuICAgIC8vICAgICB9XG4gICAgLy8gICAgIGxldCByb3dWaXNpYmxlID0gdmlzaWJsZVNlY3Rpb25bcm93SURdO1xuICAgIC8vICAgICBsZXQgbWluID0gaXNWZXJ0aWNhbCA/IGZyYW1lLnkgOiBmcmFtZS54O1xuICAgIC8vICAgICBsZXQgbWF4ID0gbWluICsgKGlzVmVydGljYWwgPyBmcmFtZS5oZWlnaHQgOiBmcmFtZS53aWR0aCk7XG4gICAgLy8gICAgIGlmIChtaW4gPiB2aXNpYmxlTWF4IHx8IG1heCA8IHZpc2libGVNaW4pIHtcbiAgICAvLyAgICAgICBpZiAocm93VmlzaWJsZSkge1xuICAgIC8vICAgICAgICAgdmlzaWJpbGl0eUNoYW5nZWQgPSB0cnVlO1xuICAgIC8vICAgICAgICAgZGVsZXRlIHZpc2libGVTZWN0aW9uW3Jvd0lEXTtcbiAgICAvLyAgICAgICAgIGlmICghY2hhbmdlZFJvd3Nbc2VjdGlvbklEXSkge1xuICAgIC8vICAgICAgICAgICBjaGFuZ2VkUm93c1tzZWN0aW9uSURdID0ge307XG4gICAgLy8gICAgICAgICB9XG4gICAgLy8gICAgICAgICBjaGFuZ2VkUm93c1tzZWN0aW9uSURdW3Jvd0lEXSA9IGZhbHNlO1xuICAgIC8vICAgICAgIH1cbiAgICAvLyAgICAgfSBlbHNlIGlmICghcm93VmlzaWJsZSkge1xuICAgIC8vICAgICAgIHZpc2liaWxpdHlDaGFuZ2VkID0gdHJ1ZTtcbiAgICAvLyAgICAgICB2aXNpYmxlU2VjdGlvbltyb3dJRF0gPSB0cnVlO1xuICAgIC8vICAgICAgIGlmICghY2hhbmdlZFJvd3Nbc2VjdGlvbklEXSkge1xuICAgIC8vICAgICAgICAgY2hhbmdlZFJvd3Nbc2VjdGlvbklEXSA9IHt9O1xuICAgIC8vICAgICAgIH1cbiAgICAvLyAgICAgICBjaGFuZ2VkUm93c1tzZWN0aW9uSURdW3Jvd0lEXSA9IHRydWU7XG4gICAgLy8gICAgIH1cbiAgICAvLyAgIH1cbiAgICAvLyAgIGlmICghaXNFbXB0eSh2aXNpYmxlU2VjdGlvbikpIHtcbiAgICAvLyAgICAgdGhpcy5fdmlzaWJsZVJvd3Nbc2VjdGlvbklEXSA9IHZpc2libGVTZWN0aW9uO1xuICAgIC8vICAgfSBlbHNlIGlmICh0aGlzLl92aXNpYmxlUm93c1tzZWN0aW9uSURdKSB7XG4gICAgLy8gICAgIGRlbGV0ZSB0aGlzLl92aXNpYmxlUm93c1tzZWN0aW9uSURdO1xuICAgIC8vICAgfVxuICAgIC8vIH1cbiAgICAvLyB2aXNpYmlsaXR5Q2hhbmdlZCAmJiB0aGlzLnByb3BzLm9uQ2hhbmdlVmlzaWJsZVJvd3ModGhpcy5fdmlzaWJsZVJvd3MsIGNoYW5nZWRSb3dzKTtcbiAgfVxuXG4gIF9vblNjcm9sbChlKSB7XG4gICAgbGV0IGlzVmVydGljYWwgPSAhdGhpcy5wcm9wcy5ob3Jpem9udGFsO1xuICAgIC8vIHRoaXMuc2Nyb2xsUHJvcGVydGllcy52aXNpYmxlTGVuZ3RoID0gZS5uYXRpdmVFdmVudC5sYXlvdXRNZWFzdXJlbWVudFtcbiAgICAvLyAgIGlzVmVydGljYWwgPyAnaGVpZ2h0JyA6ICd3aWR0aCdcbiAgICAvLyBdO1xuICAgIC8vIHRoaXMuc2Nyb2xsUHJvcGVydGllcy5jb250ZW50TGVuZ3RoID0gZS5uYXRpdmVFdmVudC5jb250ZW50U2l6ZVtcbiAgICAvLyAgIGlzVmVydGljYWwgPyAnaGVpZ2h0JyA6ICd3aWR0aCdcbiAgICAvLyBdO1xuICAgIC8vIHRoaXMuc2Nyb2xsUHJvcGVydGllcy5vZmZzZXQgPSBlLm5hdGl2ZUV2ZW50LmNvbnRlbnRPZmZzZXRbXG4gICAgLy8gICBpc1ZlcnRpY2FsID8gJ3knIDogJ3gnXG4gICAgLy8gXTtcblxuICAgIGxldCB0YXJnZXQgPSBSZWFjdERPTS5maW5kRE9NTm9kZSh0aGlzLnJlZnNbU0NST0xMVklFV19SRUZdKTtcbiAgICB0aGlzLnNjcm9sbFByb3BlcnRpZXMudmlzaWJsZUxlbmd0aCA9IHRhcmdldFtcbiAgICAgIGlzVmVydGljYWwgPyAnb2Zmc2V0SGVpZ2h0JyA6ICdvZmZzZXRXaWR0aCdcbiAgICBdO1xuICAgIHRoaXMuc2Nyb2xsUHJvcGVydGllcy5jb250ZW50TGVuZ3RoID0gdGFyZ2V0W1xuICAgICAgaXNWZXJ0aWNhbCA/ICdzY3JvbGxIZWlnaHQnIDogJ3Njcm9sbFdpZHRoJ1xuICAgIF07XG4gICAgdGhpcy5zY3JvbGxQcm9wZXJ0aWVzLm9mZnNldCA9IHRhcmdldFtcbiAgICAgIGlzVmVydGljYWwgPyAnc2Nyb2xsVG9wJyA6ICdzY3JvbGxMZWZ0J1xuICAgIF07XG4gICAgLy8gdGhpcy5fdXBkYXRlVmlzaWJsZVJvd3MoZS5uYXRpdmVFdmVudC51cGRhdGVkQ2hpbGRGcmFtZXMpO1xuICAgIGlmICghdGhpcy5fbWF5YmVDYWxsT25FbmRSZWFjaGVkKGUpKSB7XG4gICAgICB0aGlzLl9yZW5kZXJNb3JlUm93c0lmTmVlZGVkKCk7XG4gICAgfVxuXG4gICAgaWYgKHRoaXMucHJvcHMub25FbmRSZWFjaGVkICYmXG4gICAgICAgIHRoaXMuX2dldERpc3RhbmNlRnJvbUVuZCh0aGlzLnNjcm9sbFByb3BlcnRpZXMpID4gdGhpcy5wcm9wcy5vbkVuZFJlYWNoZWRUaHJlc2hvbGQpIHtcbiAgICAgIC8vIFNjcm9sbGVkIG91dCBvZiB0aGUgZW5kIHpvbmUsIHNvIGl0IHNob3VsZCBiZSBhYmxlIHRvIHRyaWdnZXIgYWdhaW4uXG4gICAgICB0aGlzLl9zZW50RW5kRm9yQ29udGVudExlbmd0aCA9IG51bGw7XG4gICAgfVxuXG4gICAgdGhpcy5wcm9wcy5vblNjcm9sbCAmJiB0aGlzLnByb3BzLm9uU2Nyb2xsKGUpO1xuICB9XG59XG5cbm1peGluLm9uQ2xhc3MoTGlzdFZpZXcsIFNjcm9sbFJlc3BvbmRlci5NaXhpbik7XG5taXhpbi5vbkNsYXNzKExpc3RWaWV3LCBUaW1lck1peGluKTtcbmF1dG9iaW5kKExpc3RWaWV3KTtcblxuTGlzdFZpZXcuaXNSZWFjdE5hdGl2ZUNvbXBvbmVudCA9IHRydWU7XG5cbmV4cG9ydCBkZWZhdWx0IExpc3RWaWV3O1xuIl19