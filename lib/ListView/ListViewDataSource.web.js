







'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();

var _invariant=require('fbjs/lib/invariant');var _invariant2=_interopRequireDefault(_invariant);
var _isEmpty=require('fbjs/lib/isEmpty');var _isEmpty2=_interopRequireDefault(_isEmpty);
var _warning=require('fbjs/lib/warning');var _warning2=_interopRequireDefault(_warning);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}

function defaultGetRowData(
dataBlob,
sectionID,
rowID)
{
return dataBlob[sectionID][rowID];
}

function defaultGetSectionHeaderData(
dataBlob,
sectionID)
{
return dataBlob[sectionID];
}var












































ListViewDataSource=function(){


























function ListViewDataSource(params){_classCallCheck(this,ListViewDataSource);
(0,_invariant2.default)(
params&&typeof params.rowHasChanged==='function',
'Must provide a rowHasChanged function.');

this._rowHasChanged=params.rowHasChanged;
this._getRowData=params.getRowData||defaultGetRowData;
this._sectionHeaderHasChanged=params.sectionHeaderHasChanged;
this._getSectionHeaderData=
params.getSectionHeaderData||defaultGetSectionHeaderData;

this._dataBlob=null;
this._dirtyRows=[];
this._dirtySections=[];
this._cachedRowCount=0;



this.rowIdentities=[];
this.sectionIdentities=[];
}_createClass(ListViewDataSource,[{key:'cloneWithRows',value:function cloneWithRows(


















dataBlob,
rowIdentities)
{
var rowIds=rowIdentities?[rowIdentities]:null;
if(!this._sectionHeaderHasChanged){
this._sectionHeaderHasChanged=function(){return false;};
}
return this.cloneWithRowsAndSections({s1:dataBlob},['s1'],rowIds);
}},{key:'cloneWithRowsAndSections',value:function cloneWithRowsAndSections(













dataBlob,
sectionIdentities,
rowIdentities)
{
(0,_invariant2.default)(
typeof this._sectionHeaderHasChanged==='function',
'Must provide a sectionHeaderHasChanged function with section data.');

(0,_invariant2.default)(
!sectionIdentities||!rowIdentities||sectionIdentities.length===rowIdentities.length,
'row and section ids lengths must be the same');


var newSource=new ListViewDataSource({
getRowData:this._getRowData,
getSectionHeaderData:this._getSectionHeaderData,
rowHasChanged:this._rowHasChanged,
sectionHeaderHasChanged:this._sectionHeaderHasChanged});

newSource._dataBlob=dataBlob;
if(sectionIdentities){
newSource.sectionIdentities=sectionIdentities;
}else{
newSource.sectionIdentities=Object.keys(dataBlob);
}
if(rowIdentities){
newSource.rowIdentities=rowIdentities;
}else{
newSource.rowIdentities=[];
newSource.sectionIdentities.forEach(function(sectionID){
newSource.rowIdentities.push(Object.keys(dataBlob[sectionID]));
});
}
newSource._cachedRowCount=countRows(newSource.rowIdentities);

newSource._calculateDirtyArrays(
this._dataBlob,
this.sectionIdentities,
this.rowIdentities);


return newSource;
}},{key:'getRowCount',value:function getRowCount()

{
return this._cachedRowCount;
}},{key:'getRowAndSectionCount',value:function getRowAndSectionCount()

{
return this._cachedRowCount+this.sectionIdentities.length;
}},{key:'rowShouldUpdate',value:function rowShouldUpdate(




sectionIndex,rowIndex){
var needsUpdate=this._dirtyRows[sectionIndex][rowIndex];
(0,_warning2.default)(needsUpdate!==undefined,
'missing dirtyBit for section, row: '+sectionIndex+', '+rowIndex);
return needsUpdate;
}},{key:'getRowData',value:function getRowData(




sectionIndex,rowIndex){
var sectionID=this.sectionIdentities[sectionIndex];
var rowID=this.rowIdentities[sectionIndex][rowIndex];
(0,_warning2.default)(
sectionID!==undefined&&rowID!==undefined,
'rendering invalid section, row: '+sectionIndex+', '+rowIndex);

return this._getRowData(this._dataBlob,sectionID,rowID);
}},{key:'getRowIDForFlatIndex',value:function getRowIDForFlatIndex(





index){
var accessIndex=index;
for(var ii=0;ii<this.sectionIdentities.length;ii++){
if(accessIndex>=this.rowIdentities[ii].length){
accessIndex-=this.rowIdentities[ii].length;
}else{
return this.rowIdentities[ii][accessIndex];
}
}
return null;
}},{key:'getSectionIDForFlatIndex',value:function getSectionIDForFlatIndex(





index){
var accessIndex=index;
for(var ii=0;ii<this.sectionIdentities.length;ii++){
if(accessIndex>=this.rowIdentities[ii].length){
accessIndex-=this.rowIdentities[ii].length;
}else{
return this.sectionIdentities[ii];
}
}
return null;
}},{key:'getSectionLengths',value:function getSectionLengths()




{
var results=[];
for(var ii=0;ii<this.sectionIdentities.length;ii++){
results.push(this.rowIdentities[ii].length);
}
return results;
}},{key:'sectionHeaderShouldUpdate',value:function sectionHeaderShouldUpdate(




sectionIndex){
var needsUpdate=this._dirtySections[sectionIndex];
(0,_warning2.default)(needsUpdate!==undefined,
'missing dirtyBit for section: '+sectionIndex);
return needsUpdate;
}},{key:'getSectionHeaderData',value:function getSectionHeaderData(




sectionIndex){
if(!this._getSectionHeaderData){
return null;
}
var sectionID=this.sectionIdentities[sectionIndex];
(0,_warning2.default)(sectionID!==undefined,
'renderSection called on invalid section: '+sectionIndex);
return this._getSectionHeaderData(this._dataBlob,sectionID);
}},{key:'_calculateDirtyArrays',value:function _calculateDirtyArrays(





















prevDataBlob,
prevSectionIDs,
prevRowIDs)
{

var prevSectionsHash=keyedDictionaryFromArray(prevSectionIDs);
var prevRowsHash={};
for(var ii=0;ii<prevRowIDs.length;ii++){
var sectionID=prevSectionIDs[ii];
(0,_warning2.default)(
!prevRowsHash[sectionID],
'SectionID appears more than once: '+sectionID);

prevRowsHash[sectionID]=keyedDictionaryFromArray(prevRowIDs[ii]);
}


this._dirtySections=[];
this._dirtyRows=[];

var dirty;
for(var sIndex=0;sIndex<this.sectionIdentities.length;sIndex++){
var sectionID=this.sectionIdentities[sIndex];

dirty=!prevSectionsHash[sectionID];
var sectionHeaderHasChanged=this._sectionHeaderHasChanged;
if(!dirty&&sectionHeaderHasChanged){
dirty=sectionHeaderHasChanged(
this._getSectionHeaderData(prevDataBlob,sectionID),
this._getSectionHeaderData(this._dataBlob,sectionID));

}
this._dirtySections.push(!!dirty);

this._dirtyRows[sIndex]=[];
for(var rIndex=0;rIndex<this.rowIdentities[sIndex].length;rIndex++){
var rowID=this.rowIdentities[sIndex][rIndex];

dirty=
!prevSectionsHash[sectionID]||
!prevRowsHash[sectionID][rowID]||
this._rowHasChanged(
this._getRowData(prevDataBlob,sectionID,rowID),
this._getRowData(this._dataBlob,sectionID,rowID));

this._dirtyRows[sIndex].push(!!dirty);
}
}
}}]);return ListViewDataSource;}();


function countRows(allRowIDs){
var totalRows=0;
for(var sectionIdx=0;sectionIdx<allRowIDs.length;sectionIdx++){
var rowIDs=allRowIDs[sectionIdx];
totalRows+=rowIDs.length;
}
return totalRows;
}

function keyedDictionaryFromArray(arr){
if((0,_isEmpty2.default)(arr)){
return{};
}
var result={};
for(var ii=0;ii<arr.length;ii++){
var key=arr[ii];
(0,_warning2.default)(!result[key],'Value appears more than once in array: '+key);
result[key]=true;
}
return result;
}exports.default=

ListViewDataSource;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkxpc3RWaWV3RGF0YVNvdXJjZS53ZWIuanMiXSwibmFtZXMiOlsiZGVmYXVsdEdldFJvd0RhdGEiLCJkYXRhQmxvYiIsInNlY3Rpb25JRCIsInJvd0lEIiwiZGVmYXVsdEdldFNlY3Rpb25IZWFkZXJEYXRhIiwiTGlzdFZpZXdEYXRhU291cmNlIiwicGFyYW1zIiwicm93SGFzQ2hhbmdlZCIsIl9yb3dIYXNDaGFuZ2VkIiwiX2dldFJvd0RhdGEiLCJnZXRSb3dEYXRhIiwiX3NlY3Rpb25IZWFkZXJIYXNDaGFuZ2VkIiwic2VjdGlvbkhlYWRlckhhc0NoYW5nZWQiLCJfZ2V0U2VjdGlvbkhlYWRlckRhdGEiLCJnZXRTZWN0aW9uSGVhZGVyRGF0YSIsIl9kYXRhQmxvYiIsIl9kaXJ0eVJvd3MiLCJfZGlydHlTZWN0aW9ucyIsIl9jYWNoZWRSb3dDb3VudCIsInJvd0lkZW50aXRpZXMiLCJzZWN0aW9uSWRlbnRpdGllcyIsInJvd0lkcyIsImNsb25lV2l0aFJvd3NBbmRTZWN0aW9ucyIsInMxIiwibGVuZ3RoIiwibmV3U291cmNlIiwiT2JqZWN0Iiwia2V5cyIsImZvckVhY2giLCJwdXNoIiwiY291bnRSb3dzIiwiX2NhbGN1bGF0ZURpcnR5QXJyYXlzIiwic2VjdGlvbkluZGV4Iiwicm93SW5kZXgiLCJuZWVkc1VwZGF0ZSIsInVuZGVmaW5lZCIsImluZGV4IiwiYWNjZXNzSW5kZXgiLCJpaSIsInJlc3VsdHMiLCJwcmV2RGF0YUJsb2IiLCJwcmV2U2VjdGlvbklEcyIsInByZXZSb3dJRHMiLCJwcmV2U2VjdGlvbnNIYXNoIiwia2V5ZWREaWN0aW9uYXJ5RnJvbUFycmF5IiwicHJldlJvd3NIYXNoIiwiZGlydHkiLCJzSW5kZXgiLCJySW5kZXgiLCJhbGxSb3dJRHMiLCJ0b3RhbFJvd3MiLCJzZWN0aW9uSWR4Iiwicm93SURzIiwiYXJyIiwicmVzdWx0Iiwia2V5Il0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQVFBLGE7O0FBRUEsNkM7QUFDQSx5QztBQUNBLHlD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QUFLLENBQWQsQ0FBaUJBLEdBQUtlLElBQUk3QixNQUExQixDQUFrQ2MsSUFBbEMsQ0FBd0M7QUFDdEMsR0FBSWlCLEtBQU1GLElBQUlmLEVBQUosQ0FBVjtBQUNBLHNCQUFRLENBQUNnQixPQUFPQyxHQUFQLENBQVQsQ0FBc0IsMENBQTRDQSxHQUFsRTtBQUNBRCxPQUFPQyxHQUFQLEVBQWMsSUFBZDtBQUNEO0FBQ0QsTUFBT0QsT0FBUDtBQUNELEM7O0FBRWNqRCxrQiIsImZpbGUiOiJMaXN0Vmlld0RhdGFTb3VyY2Uud2ViLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTUtcHJlc2VudCwgQWxpYmFiYSBHcm91cCBIb2xkaW5nIExpbWl0ZWQuXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICpcbiAqIENvcHlyaWdodCAoYykgMjAxNSwgRmFjZWJvb2ssIEluYy4gIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKlxuICogQHByb3ZpZGVzTW9kdWxlIFJlYWN0TGlzdFZpZXdEYXRhU291cmNlXG4gKi9cbid1c2Ugc3RyaWN0JztcblxuaW1wb3J0IGludmFyaWFudCBmcm9tICdmYmpzL2xpYi9pbnZhcmlhbnQnO1xuaW1wb3J0IGlzRW1wdHkgZnJvbSAnZmJqcy9saWIvaXNFbXB0eSc7XG5pbXBvcnQgd2FybmluZyBmcm9tICdmYmpzL2xpYi93YXJuaW5nJztcblxuZnVuY3Rpb24gZGVmYXVsdEdldFJvd0RhdGEoXG4gIGRhdGFCbG9iOiBhbnksXG4gIHNlY3Rpb25JRDogbnVtYmVyIHwgc3RyaW5nLFxuICByb3dJRDogbnVtYmVyIHwgc3RyaW5nXG4pOiBhbnkge1xuICByZXR1cm4gZGF0YUJsb2Jbc2VjdGlvbklEXVtyb3dJRF07XG59XG5cbmZ1bmN0aW9uIGRlZmF1bHRHZXRTZWN0aW9uSGVhZGVyRGF0YShcbiAgZGF0YUJsb2I6IGFueSxcbiAgc2VjdGlvbklEOiBudW1iZXIgfCBzdHJpbmdcbik6IGFueSB7XG4gIHJldHVybiBkYXRhQmxvYltzZWN0aW9uSURdO1xufVxuXG50eXBlIGRpZmZlclR5cGUgPSAoZGF0YTE6IGFueSwgZGF0YTI6IGFueSkgPT4gYm9vbDtcblxudHlwZSBQYXJhbVR5cGUgPSB7XG4gIHJvd0hhc0NoYW5nZWQ6IGRpZmZlclR5cGU7XG4gIGdldFJvd0RhdGE6ID90eXBlb2YgZGVmYXVsdEdldFJvd0RhdGE7XG4gIHNlY3Rpb25IZWFkZXJIYXNDaGFuZ2VkOiA/ZGlmZmVyVHlwZTtcbiAgZ2V0U2VjdGlvbkhlYWRlckRhdGE6ID90eXBlb2YgZGVmYXVsdEdldFNlY3Rpb25IZWFkZXJEYXRhO1xufVxuXG4vKipcbiAqIFByb3ZpZGVzIGVmZmljaWVudCBkYXRhIHByb2Nlc3NpbmcgYW5kIGFjY2VzcyB0byB0aGVcbiAqIGBMaXN0Vmlld2AgY29tcG9uZW50LiAgQSBgTGlzdFZpZXdEYXRhU291cmNlYCBpcyBjcmVhdGVkIHdpdGggZnVuY3Rpb25zIGZvclxuICogZXh0cmFjdGluZyBkYXRhIGZyb20gdGhlIGlucHV0IGJsb2IsIGFuZCBjb21wYXJpbmcgZWxlbWVudHMgKHdpdGggZGVmYXVsdFxuICogaW1wbGVtZW50YXRpb25zIGZvciBjb252ZW5pZW5jZSkuICBUaGUgaW5wdXQgYmxvYiBjYW4gYmUgYXMgc2ltcGxlIGFzIGFuXG4gKiBhcnJheSBvZiBzdHJpbmdzLCBvciBhbiBvYmplY3Qgd2l0aCByb3dzIG5lc3RlZCBpbnNpZGUgc2VjdGlvbiBvYmplY3RzLlxuICpcbiAqIFRvIHVwZGF0ZSB0aGUgZGF0YSBpbiB0aGUgZGF0YXNvdXJjZSwgdXNlIGBjbG9uZVdpdGhSb3dzYCAob3JcbiAqIGBjbG9uZVdpdGhSb3dzQW5kU2VjdGlvbnNgIGlmIHlvdSBjYXJlIGFib3V0IHNlY3Rpb25zKS4gIFRoZSBkYXRhIGluIHRoZVxuICogZGF0YSBzb3VyY2UgaXMgaW1tdXRhYmxlLCBzbyB5b3UgY2FuJ3QgbW9kaWZ5IGl0IGRpcmVjdGx5LiAgVGhlIGNsb25lIG1ldGhvZHNcbiAqIHN1Y2sgaW4gdGhlIG5ldyBkYXRhIGFuZCBjb21wdXRlIGEgZGlmZiBmb3IgZWFjaCByb3cgc28gTGlzdFZpZXcga25vd3NcbiAqIHdoZXRoZXIgdG8gcmUtcmVuZGVyIGl0IG9yIG5vdC5cbiAqXG4gKiBJbiB0aGlzIGV4YW1wbGUsIGEgY29tcG9uZW50IHJlY2VpdmVzIGRhdGEgaW4gY2h1bmtzLCBoYW5kbGVkIGJ5XG4gKiBgX29uRGF0YUFycml2ZWRgLCB3aGljaCBjb25jYXRzIHRoZSBuZXcgZGF0YSBvbnRvIHRoZSBvbGQgZGF0YSBhbmQgdXBkYXRlcyB0aGVcbiAqIGRhdGEgc291cmNlLiAgV2UgdXNlIGBjb25jYXRgIHRvIGNyZWF0ZSBhIG5ldyBhcnJheSAtIG11dGF0aW5nIGB0aGlzLl9kYXRhYCxcbiAqIGUuZy4gd2l0aCBgdGhpcy5fZGF0YS5wdXNoKG5ld1Jvd0RhdGEpYCwgd291bGQgYmUgYW4gZXJyb3IuIGBfcm93SGFzQ2hhbmdlZGBcbiAqIHVuZGVyc3RhbmRzIHRoZSBzaGFwZSBvZiB0aGUgcm93IGRhdGEgYW5kIGtub3dzIGhvdyB0byBlZmZpY2llbnRseSBjb21wYXJlXG4gKiBpdC5cbiAqXG4gKiBgYGBcbiAqIGdldEluaXRpYWxTdGF0ZTogZnVuY3Rpb24oKSB7XG4gKiAgIHZhciBkcyA9IG5ldyBMaXN0Vmlld0RhdGFTb3VyY2Uoe3Jvd0hhc0NoYW5nZWQ6IHRoaXMuX3Jvd0hhc0NoYW5nZWR9KTtcbiAqICAgcmV0dXJuIHtkc307XG4gKiB9LFxuICogX29uRGF0YUFycml2ZWQobmV3RGF0YSkge1xuICogICB0aGlzLl9kYXRhID0gdGhpcy5fZGF0YS5jb25jYXQobmV3RGF0YSk7XG4gKiAgIHRoaXMuc2V0U3RhdGUoe1xuICogICAgIGRzOiB0aGlzLnN0YXRlLmRzLmNsb25lV2l0aFJvd3ModGhpcy5fZGF0YSlcbiAqICAgfSk7XG4gKiB9XG4gKiBgYGBcbiAqL1xuXG5jbGFzcyBMaXN0Vmlld0RhdGFTb3VyY2Uge1xuXG4gIC8qKlxuICAgKiBZb3UgY2FuIHByb3ZpZGUgY3VzdG9tIGV4dHJhY3Rpb24gYW5kIGBoYXNDaGFuZ2VkYCBmdW5jdGlvbnMgZm9yIHNlY3Rpb25cbiAgICogaGVhZGVycyBhbmQgcm93cy4gIElmIGFic2VudCwgZGF0YSB3aWxsIGJlIGV4dHJhY3RlZCB3aXRoIHRoZVxuICAgKiBgZGVmYXVsdEdldFJvd0RhdGFgIGFuZCBgZGVmYXVsdEdldFNlY3Rpb25IZWFkZXJEYXRhYCBmdW5jdGlvbnMuXG4gICAqXG4gICAqIFRoZSBkZWZhdWx0IGV4dHJhY3RvciBleHBlY3RzIGRhdGEgb2Ygb25lIG9mIHRoZSBmb2xsb3dpbmcgZm9ybXM6XG4gICAqXG4gICAqICAgICAgeyBzZWN0aW9uSURfMTogeyByb3dJRF8xOiA8cm93RGF0YTE+LCAuLi4gfSwgLi4uIH1cbiAgICpcbiAgICogICAgb3JcbiAgICpcbiAgICogICAgICB7IHNlY3Rpb25JRF8xOiBbIDxyb3dEYXRhMT4sIDxyb3dEYXRhMj4sIC4uLiBdLCAuLi4gfVxuICAgKlxuICAgKiAgICBvclxuICAgKlxuICAgKiAgICAgIFsgWyA8cm93RGF0YTE+LCA8cm93RGF0YTI+LCAuLi4gXSwgLi4uIF1cbiAgICpcbiAgICogVGhlIGNvbnN0cnVjdG9yIHRha2VzIGluIGEgcGFyYW1zIGFyZ3VtZW50IHRoYXQgY2FuIGNvbnRhaW4gYW55IG9mIHRoZVxuICAgKiBmb2xsb3dpbmc6XG4gICAqXG4gICAqIC0gZ2V0Um93RGF0YShkYXRhQmxvYiwgc2VjdGlvbklELCByb3dJRCk7XG4gICAqIC0gZ2V0U2VjdGlvbkhlYWRlckRhdGEoZGF0YUJsb2IsIHNlY3Rpb25JRCk7XG4gICAqIC0gcm93SGFzQ2hhbmdlZChwcmV2Um93RGF0YSwgbmV4dFJvd0RhdGEpO1xuICAgKiAtIHNlY3Rpb25IZWFkZXJIYXNDaGFuZ2VkKHByZXZTZWN0aW9uRGF0YSwgbmV4dFNlY3Rpb25EYXRhKTtcbiAgICovXG4gIGNvbnN0cnVjdG9yKHBhcmFtczogUGFyYW1UeXBlKSB7XG4gICAgaW52YXJpYW50KFxuICAgICAgcGFyYW1zICYmIHR5cGVvZiBwYXJhbXMucm93SGFzQ2hhbmdlZCA9PT0gJ2Z1bmN0aW9uJyxcbiAgICAgICdNdXN0IHByb3ZpZGUgYSByb3dIYXNDaGFuZ2VkIGZ1bmN0aW9uLidcbiAgICApO1xuICAgIHRoaXMuX3Jvd0hhc0NoYW5nZWQgPSBwYXJhbXMucm93SGFzQ2hhbmdlZDtcbiAgICB0aGlzLl9nZXRSb3dEYXRhID0gcGFyYW1zLmdldFJvd0RhdGEgfHwgZGVmYXVsdEdldFJvd0RhdGE7XG4gICAgdGhpcy5fc2VjdGlvbkhlYWRlckhhc0NoYW5nZWQgPSBwYXJhbXMuc2VjdGlvbkhlYWRlckhhc0NoYW5nZWQ7XG4gICAgdGhpcy5fZ2V0U2VjdGlvbkhlYWRlckRhdGEgPVxuICAgICAgcGFyYW1zLmdldFNlY3Rpb25IZWFkZXJEYXRhIHx8IGRlZmF1bHRHZXRTZWN0aW9uSGVhZGVyRGF0YTtcblxuICAgIHRoaXMuX2RhdGFCbG9iID0gbnVsbDtcbiAgICB0aGlzLl9kaXJ0eVJvd3MgPSBbXTtcbiAgICB0aGlzLl9kaXJ0eVNlY3Rpb25zID0gW107XG4gICAgdGhpcy5fY2FjaGVkUm93Q291bnQgPSAwO1xuXG4gICAgLy8gVGhlc2UgdHdvIHByaXZhdGUgdmFyaWFibGVzIGFyZSBhY2Nlc3NlZCBieSBvdXRzaWRlcnMgYmVjYXVzZSBMaXN0Vmlld1xuICAgIC8vIHVzZXMgdGhlbSB0byBpdGVyYXRlIG92ZXIgdGhlIGRhdGEgaW4gdGhpcyBjbGFzcy5cbiAgICB0aGlzLnJvd0lkZW50aXRpZXMgPSBbXTtcbiAgICB0aGlzLnNlY3Rpb25JZGVudGl0aWVzID0gW107XG4gIH1cblxuICAvKipcbiAgICogQ2xvbmVzIHRoaXMgYExpc3RWaWV3RGF0YVNvdXJjZWAgd2l0aCB0aGUgc3BlY2lmaWVkIGBkYXRhQmxvYmAgYW5kXG4gICAqIGByb3dJZGVudGl0aWVzYC4gVGhlIGBkYXRhQmxvYmAgaXMganVzdCBhbiBhcmJpdHJhcnkgYmxvYiBvZiBkYXRhLiBBdFxuICAgKiBjb25zdHJ1Y3Rpb24gYW4gZXh0cmFjdG9yIHRvIGdldCB0aGUgaW50ZXJlc3RpbmcgaW5mb3JtYXRpb24gd2FzIGRlZmluZWRcbiAgICogKG9yIHRoZSBkZWZhdWx0IHdhcyB1c2VkKS5cbiAgICpcbiAgICogVGhlIGByb3dJZGVudGl0aWVzYCBpcyBpcyBhIDJEIGFycmF5IG9mIGlkZW50aWZpZXJzIGZvciByb3dzLlxuICAgKiBpZS4gW1snYTEnLCAnYTInXSwgWydiMScsICdiMicsICdiMyddLCAuLi5dLiAgSWYgbm90IHByb3ZpZGVkLCBpdCdzXG4gICAqIGFzc3VtZWQgdGhhdCB0aGUga2V5cyBvZiB0aGUgc2VjdGlvbiBkYXRhIGFyZSB0aGUgcm93IGlkZW50aXRpZXMuXG4gICAqXG4gICAqIE5vdGU6IFRoaXMgZnVuY3Rpb24gZG9lcyBOT1QgY2xvbmUgdGhlIGRhdGEgaW4gdGhpcyBkYXRhIHNvdXJjZS4gSXQgc2ltcGx5XG4gICAqIHBhc3NlcyB0aGUgZnVuY3Rpb25zIGRlZmluZWQgYXQgY29uc3RydWN0aW9uIHRvIGEgbmV3IGRhdGEgc291cmNlIHdpdGhcbiAgICogdGhlIGRhdGEgc3BlY2lmaWVkLiBJZiB5b3Ugd2lzaCB0byBtYWludGFpbiB0aGUgZXhpc3RpbmcgZGF0YSB5b3UgbXVzdFxuICAgKiBoYW5kbGUgbWVyZ2luZyBvZiBvbGQgYW5kIG5ldyBkYXRhIHNlcGFyYXRlbHkgYW5kIHRoZW4gcGFzcyB0aGF0IGludG9cbiAgICogdGhpcyBmdW5jdGlvbiBhcyB0aGUgYGRhdGFCbG9iYC5cbiAgICovXG4gIGNsb25lV2l0aFJvd3MoXG4gICAgICAgZGF0YUJsb2I6IEFycmF5PGFueT4gfCB7W2tleTogc3RyaW5nXTogYW55fSxcbiAgICAgICByb3dJZGVudGl0aWVzOiA/QXJyYXk8c3RyaW5nPlxuICAgKTogTGlzdFZpZXdEYXRhU291cmNlIHtcbiAgICB2YXIgcm93SWRzID0gcm93SWRlbnRpdGllcyA/IFtyb3dJZGVudGl0aWVzXSA6IG51bGw7XG4gICAgaWYgKCF0aGlzLl9zZWN0aW9uSGVhZGVySGFzQ2hhbmdlZCkge1xuICAgICAgdGhpcy5fc2VjdGlvbkhlYWRlckhhc0NoYW5nZWQgPSAoKSA9PiBmYWxzZTtcbiAgICB9XG4gICAgcmV0dXJuIHRoaXMuY2xvbmVXaXRoUm93c0FuZFNlY3Rpb25zKHtzMTogZGF0YUJsb2J9LCBbJ3MxJ10sIHJvd0lkcyk7XG4gIH1cblxuICAvKipcbiAgICogVGhpcyBwZXJmb3JtcyB0aGUgc2FtZSBmdW5jdGlvbiBhcyB0aGUgYGNsb25lV2l0aFJvd3NgIGZ1bmN0aW9uIGJ1dCBoZXJlXG4gICAqIHlvdSBhbHNvIHNwZWNpZnkgd2hhdCB5b3VyIGBzZWN0aW9uSWRlbnRpdGllc2AgYXJlLiBJZiB5b3UgZG9uJ3QgY2FyZVxuICAgKiBhYm91dCBzZWN0aW9ucyB5b3Ugc2hvdWxkIHNhZmVseSBiZSBhYmxlIHRvIHVzZSBgY2xvbmVXaXRoUm93c2AuXG4gICAqXG4gICAqIGBzZWN0aW9uSWRlbnRpdGllc2AgaXMgYW4gYXJyYXkgb2YgaWRlbnRpZmllcnMgZm9yICBzZWN0aW9ucy5cbiAgICogaWUuIFsnczEnLCAnczInLCAuLi5dLiAgSWYgbm90IHByb3ZpZGVkLCBpdCdzIGFzc3VtZWQgdGhhdCB0aGVcbiAgICoga2V5cyBvZiBkYXRhQmxvYiBhcmUgdGhlIHNlY3Rpb24gaWRlbnRpdGllcy5cbiAgICpcbiAgICogTm90ZTogdGhpcyByZXR1cm5zIGEgbmV3IG9iamVjdCFcbiAgICovXG4gIGNsb25lV2l0aFJvd3NBbmRTZWN0aW9ucyhcbiAgICAgIGRhdGFCbG9iOiBhbnksXG4gICAgICBzZWN0aW9uSWRlbnRpdGllczogP0FycmF5PHN0cmluZz4sXG4gICAgICByb3dJZGVudGl0aWVzOiA/QXJyYXk8QXJyYXk8c3RyaW5nPj5cbiAgKTogTGlzdFZpZXdEYXRhU291cmNlIHtcbiAgICBpbnZhcmlhbnQoXG4gICAgICB0eXBlb2YgdGhpcy5fc2VjdGlvbkhlYWRlckhhc0NoYW5nZWQgPT09ICdmdW5jdGlvbicsXG4gICAgICAnTXVzdCBwcm92aWRlIGEgc2VjdGlvbkhlYWRlckhhc0NoYW5nZWQgZnVuY3Rpb24gd2l0aCBzZWN0aW9uIGRhdGEuJ1xuICAgICk7XG4gICAgaW52YXJpYW50KFxuICAgICAgIXNlY3Rpb25JZGVudGl0aWVzIHx8ICFyb3dJZGVudGl0aWVzIHx8IHNlY3Rpb25JZGVudGl0aWVzLmxlbmd0aCA9PT0gcm93SWRlbnRpdGllcy5sZW5ndGgsXG4gICAgICAncm93IGFuZCBzZWN0aW9uIGlkcyBsZW5ndGhzIG11c3QgYmUgdGhlIHNhbWUnXG4gICAgKTtcblxuICAgIHZhciBuZXdTb3VyY2UgPSBuZXcgTGlzdFZpZXdEYXRhU291cmNlKHtcbiAgICAgIGdldFJvd0RhdGE6IHRoaXMuX2dldFJvd0RhdGEsXG4gICAgICBnZXRTZWN0aW9uSGVhZGVyRGF0YTogdGhpcy5fZ2V0U2VjdGlvbkhlYWRlckRhdGEsXG4gICAgICByb3dIYXNDaGFuZ2VkOiB0aGlzLl9yb3dIYXNDaGFuZ2VkLFxuICAgICAgc2VjdGlvbkhlYWRlckhhc0NoYW5nZWQ6IHRoaXMuX3NlY3Rpb25IZWFkZXJIYXNDaGFuZ2VkLFxuICAgIH0pO1xuICAgIG5ld1NvdXJjZS5fZGF0YUJsb2IgPSBkYXRhQmxvYjtcbiAgICBpZiAoc2VjdGlvbklkZW50aXRpZXMpIHtcbiAgICAgIG5ld1NvdXJjZS5zZWN0aW9uSWRlbnRpdGllcyA9IHNlY3Rpb25JZGVudGl0aWVzO1xuICAgIH0gZWxzZSB7XG4gICAgICBuZXdTb3VyY2Uuc2VjdGlvbklkZW50aXRpZXMgPSBPYmplY3Qua2V5cyhkYXRhQmxvYik7XG4gICAgfVxuICAgIGlmIChyb3dJZGVudGl0aWVzKSB7XG4gICAgICBuZXdTb3VyY2Uucm93SWRlbnRpdGllcyA9IHJvd0lkZW50aXRpZXM7XG4gICAgfSBlbHNlIHtcbiAgICAgIG5ld1NvdXJjZS5yb3dJZGVudGl0aWVzID0gW107XG4gICAgICBuZXdTb3VyY2Uuc2VjdGlvbklkZW50aXRpZXMuZm9yRWFjaCgoc2VjdGlvbklEKSA9PiB7XG4gICAgICAgIG5ld1NvdXJjZS5yb3dJZGVudGl0aWVzLnB1c2goT2JqZWN0LmtleXMoZGF0YUJsb2Jbc2VjdGlvbklEXSkpO1xuICAgICAgfSk7XG4gICAgfVxuICAgIG5ld1NvdXJjZS5fY2FjaGVkUm93Q291bnQgPSBjb3VudFJvd3MobmV3U291cmNlLnJvd0lkZW50aXRpZXMpO1xuXG4gICAgbmV3U291cmNlLl9jYWxjdWxhdGVEaXJ0eUFycmF5cyhcbiAgICAgIHRoaXMuX2RhdGFCbG9iLFxuICAgICAgdGhpcy5zZWN0aW9uSWRlbnRpdGllcyxcbiAgICAgIHRoaXMucm93SWRlbnRpdGllc1xuICAgICk7XG5cbiAgICByZXR1cm4gbmV3U291cmNlO1xuICB9XG5cbiAgZ2V0Um93Q291bnQoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gdGhpcy5fY2FjaGVkUm93Q291bnQ7XG4gIH1cblxuICBnZXRSb3dBbmRTZWN0aW9uQ291bnQoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gKHRoaXMuX2NhY2hlZFJvd0NvdW50ICsgdGhpcy5zZWN0aW9uSWRlbnRpdGllcy5sZW5ndGgpO1xuICB9XG5cbiAgLyoqXG4gICAqIFJldHVybnMgaWYgdGhlIHJvdyBpcyBkaXJ0aWVkIGFuZCBuZWVkcyB0byBiZSByZXJlbmRlcmVkXG4gICAqL1xuICByb3dTaG91bGRVcGRhdGUoc2VjdGlvbkluZGV4OiBudW1iZXIsIHJvd0luZGV4OiBudW1iZXIpOiBib29sIHtcbiAgICB2YXIgbmVlZHNVcGRhdGUgPSB0aGlzLl9kaXJ0eVJvd3Nbc2VjdGlvbkluZGV4XVtyb3dJbmRleF07XG4gICAgd2FybmluZyhuZWVkc1VwZGF0ZSAhPT0gdW5kZWZpbmVkLFxuICAgICAgJ21pc3NpbmcgZGlydHlCaXQgZm9yIHNlY3Rpb24sIHJvdzogJyArIHNlY3Rpb25JbmRleCArICcsICcgKyByb3dJbmRleCk7XG4gICAgcmV0dXJuIG5lZWRzVXBkYXRlO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIGRhdGEgcmVxdWlyZWQgdG8gcmVuZGVyIHRoZSByb3cuXG4gICAqL1xuICBnZXRSb3dEYXRhKHNlY3Rpb25JbmRleDogbnVtYmVyLCByb3dJbmRleDogbnVtYmVyKTogYW55IHtcbiAgICB2YXIgc2VjdGlvbklEID0gdGhpcy5zZWN0aW9uSWRlbnRpdGllc1tzZWN0aW9uSW5kZXhdO1xuICAgIHZhciByb3dJRCA9IHRoaXMucm93SWRlbnRpdGllc1tzZWN0aW9uSW5kZXhdW3Jvd0luZGV4XTtcbiAgICB3YXJuaW5nKFxuICAgICAgc2VjdGlvbklEICE9PSB1bmRlZmluZWQgJiYgcm93SUQgIT09IHVuZGVmaW5lZCxcbiAgICAgICdyZW5kZXJpbmcgaW52YWxpZCBzZWN0aW9uLCByb3c6ICcgKyBzZWN0aW9uSW5kZXggKyAnLCAnICsgcm93SW5kZXhcbiAgICApO1xuICAgIHJldHVybiB0aGlzLl9nZXRSb3dEYXRhKHRoaXMuX2RhdGFCbG9iLCBzZWN0aW9uSUQsIHJvd0lEKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBHZXRzIHRoZSByb3dJRCBhdCBpbmRleCBwcm92aWRlZCBpZiB0aGUgZGF0YVNvdXJjZSBhcnJheXMgd2VyZSBmbGF0dGVuZWQsXG4gICAqIG9yIG51bGwgb2Ygb3V0IG9mIHJhbmdlIGluZGV4ZXMuXG4gICAqL1xuICBnZXRSb3dJREZvckZsYXRJbmRleChpbmRleDogbnVtYmVyKTogP3N0cmluZyB7XG4gICAgdmFyIGFjY2Vzc0luZGV4ID0gaW5kZXg7XG4gICAgZm9yICh2YXIgaWkgPSAwOyBpaSA8IHRoaXMuc2VjdGlvbklkZW50aXRpZXMubGVuZ3RoOyBpaSsrKSB7XG4gICAgICBpZiAoYWNjZXNzSW5kZXggPj0gdGhpcy5yb3dJZGVudGl0aWVzW2lpXS5sZW5ndGgpIHtcbiAgICAgICAgYWNjZXNzSW5kZXggLT0gdGhpcy5yb3dJZGVudGl0aWVzW2lpXS5sZW5ndGg7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICByZXR1cm4gdGhpcy5yb3dJZGVudGl0aWVzW2lpXVthY2Nlc3NJbmRleF07XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiBudWxsO1xuICB9XG5cbiAgLyoqXG4gICAqIEdldHMgdGhlIHNlY3Rpb25JRCBhdCBpbmRleCBwcm92aWRlZCBpZiB0aGUgZGF0YVNvdXJjZSBhcnJheXMgd2VyZSBmbGF0dGVuZWQsXG4gICAqIG9yIG51bGwgZm9yIG91dCBvZiByYW5nZSBpbmRleGVzLlxuICAgKi9cbiAgZ2V0U2VjdGlvbklERm9yRmxhdEluZGV4KGluZGV4OiBudW1iZXIpOiA/c3RyaW5nIHtcbiAgICB2YXIgYWNjZXNzSW5kZXggPSBpbmRleDtcbiAgICBmb3IgKHZhciBpaSA9IDA7IGlpIDwgdGhpcy5zZWN0aW9uSWRlbnRpdGllcy5sZW5ndGg7IGlpKyspIHtcbiAgICAgIGlmIChhY2Nlc3NJbmRleCA+PSB0aGlzLnJvd0lkZW50aXRpZXNbaWldLmxlbmd0aCkge1xuICAgICAgICBhY2Nlc3NJbmRleCAtPSB0aGlzLnJvd0lkZW50aXRpZXNbaWldLmxlbmd0aDtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiB0aGlzLnNlY3Rpb25JZGVudGl0aWVzW2lpXTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICAvKipcbiAgICogUmV0dXJucyBhbiBhcnJheSBjb250YWluaW5nIHRoZSBudW1iZXIgb2Ygcm93cyBpbiBlYWNoIHNlY3Rpb25cbiAgICovXG4gIGdldFNlY3Rpb25MZW5ndGhzKCk6IEFycmF5PG51bWJlcj4ge1xuICAgIHZhciByZXN1bHRzID0gW107XG4gICAgZm9yICh2YXIgaWkgPSAwOyBpaSA8IHRoaXMuc2VjdGlvbklkZW50aXRpZXMubGVuZ3RoOyBpaSsrKSB7XG4gICAgICByZXN1bHRzLnB1c2godGhpcy5yb3dJZGVudGl0aWVzW2lpXS5sZW5ndGgpO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0cztcbiAgfVxuXG4gIC8qKlxuICAgKiBSZXR1cm5zIGlmIHRoZSBzZWN0aW9uIGhlYWRlciBpcyBkaXJ0aWVkIGFuZCBuZWVkcyB0byBiZSByZXJlbmRlcmVkXG4gICAqL1xuICBzZWN0aW9uSGVhZGVyU2hvdWxkVXBkYXRlKHNlY3Rpb25JbmRleDogbnVtYmVyKTogYm9vbCB7XG4gICAgdmFyIG5lZWRzVXBkYXRlID0gdGhpcy5fZGlydHlTZWN0aW9uc1tzZWN0aW9uSW5kZXhdO1xuICAgIHdhcm5pbmcobmVlZHNVcGRhdGUgIT09IHVuZGVmaW5lZCxcbiAgICAgICdtaXNzaW5nIGRpcnR5Qml0IGZvciBzZWN0aW9uOiAnICsgc2VjdGlvbkluZGV4KTtcbiAgICByZXR1cm4gbmVlZHNVcGRhdGU7XG4gIH1cblxuICAvKipcbiAgICogR2V0cyB0aGUgZGF0YSByZXF1aXJlZCB0byByZW5kZXIgdGhlIHNlY3Rpb24gaGVhZGVyXG4gICAqL1xuICBnZXRTZWN0aW9uSGVhZGVyRGF0YShzZWN0aW9uSW5kZXg6IG51bWJlcik6IGFueSB7XG4gICAgaWYgKCF0aGlzLl9nZXRTZWN0aW9uSGVhZGVyRGF0YSkge1xuICAgICAgcmV0dXJuIG51bGw7XG4gICAgfVxuICAgIHZhciBzZWN0aW9uSUQgPSB0aGlzLnNlY3Rpb25JZGVudGl0aWVzW3NlY3Rpb25JbmRleF07XG4gICAgd2FybmluZyhzZWN0aW9uSUQgIT09IHVuZGVmaW5lZCxcbiAgICAgICdyZW5kZXJTZWN0aW9uIGNhbGxlZCBvbiBpbnZhbGlkIHNlY3Rpb246ICcgKyBzZWN0aW9uSW5kZXgpO1xuICAgIHJldHVybiB0aGlzLl9nZXRTZWN0aW9uSGVhZGVyRGF0YSh0aGlzLl9kYXRhQmxvYiwgc2VjdGlvbklEKTtcbiAgfVxuXG4gIC8qKlxuICAgKiBQcml2YXRlIG1lbWJlcnMgYW5kIG1ldGhvZHMuXG4gICAqL1xuXG4gIF9nZXRSb3dEYXRhOiB0eXBlb2YgZGVmYXVsdEdldFJvd0RhdGE7XG4gIF9nZXRTZWN0aW9uSGVhZGVyRGF0YTogdHlwZW9mIGRlZmF1bHRHZXRTZWN0aW9uSGVhZGVyRGF0YTtcbiAgX3Jvd0hhc0NoYW5nZWQ6IGRpZmZlclR5cGU7XG4gIF9zZWN0aW9uSGVhZGVySGFzQ2hhbmdlZDogP2RpZmZlclR5cGU7XG5cbiAgX2RhdGFCbG9iOiBhbnk7XG4gIF9kaXJ0eVJvd3M6IEFycmF5PEFycmF5PGJvb2w+PjtcbiAgX2RpcnR5U2VjdGlvbnM6IEFycmF5PGJvb2w+O1xuICBfY2FjaGVkUm93Q291bnQ6IG51bWJlcjtcblxuICAvLyBUaGVzZSB0d28gJ3Byb3RlY3RlZCcgdmFyaWFibGVzIGFyZSBhY2Nlc3NlZCBieSBMaXN0VmlldyB0byBpdGVyYXRlIG92ZXJcbiAgLy8gdGhlIGRhdGEgaW4gdGhpcyBjbGFzcy5cbiAgcm93SWRlbnRpdGllczogQXJyYXk8QXJyYXk8c3RyaW5nPj47XG4gIHNlY3Rpb25JZGVudGl0aWVzOiBBcnJheTxzdHJpbmc+O1xuXG4gIF9jYWxjdWxhdGVEaXJ0eUFycmF5cyhcbiAgICBwcmV2RGF0YUJsb2I6IGFueSxcbiAgICBwcmV2U2VjdGlvbklEczogQXJyYXk8c3RyaW5nPixcbiAgICBwcmV2Um93SURzOiBBcnJheTxBcnJheTxzdHJpbmc+PlxuICApOiB2b2lkIHtcbiAgICAvLyBjb25zdHJ1Y3QgYSBoYXNobWFwIG9mIHRoZSBleGlzdGluZyAob2xkKSBpZCBhcnJheXNcbiAgICB2YXIgcHJldlNlY3Rpb25zSGFzaCA9IGtleWVkRGljdGlvbmFyeUZyb21BcnJheShwcmV2U2VjdGlvbklEcyk7XG4gICAgdmFyIHByZXZSb3dzSGFzaCA9IHt9O1xuICAgIGZvciAodmFyIGlpID0gMDsgaWkgPCBwcmV2Um93SURzLmxlbmd0aDsgaWkrKykge1xuICAgICAgdmFyIHNlY3Rpb25JRCA9IHByZXZTZWN0aW9uSURzW2lpXTtcbiAgICAgIHdhcm5pbmcoXG4gICAgICAgICFwcmV2Um93c0hhc2hbc2VjdGlvbklEXSxcbiAgICAgICAgJ1NlY3Rpb25JRCBhcHBlYXJzIG1vcmUgdGhhbiBvbmNlOiAnICsgc2VjdGlvbklEXG4gICAgICApO1xuICAgICAgcHJldlJvd3NIYXNoW3NlY3Rpb25JRF0gPSBrZXllZERpY3Rpb25hcnlGcm9tQXJyYXkocHJldlJvd0lEc1tpaV0pO1xuICAgIH1cblxuICAgIC8vIGNvbXBhcmUgdGhlIDIgaWRlbnRpdHkgYXJyYXkgYW5kIGdldCB0aGUgZGlydGllZCByb3dzXG4gICAgdGhpcy5fZGlydHlTZWN0aW9ucyA9IFtdO1xuICAgIHRoaXMuX2RpcnR5Um93cyA9IFtdO1xuXG4gICAgdmFyIGRpcnR5O1xuICAgIGZvciAodmFyIHNJbmRleCA9IDA7IHNJbmRleCA8IHRoaXMuc2VjdGlvbklkZW50aXRpZXMubGVuZ3RoOyBzSW5kZXgrKykge1xuICAgICAgdmFyIHNlY3Rpb25JRCA9IHRoaXMuc2VjdGlvbklkZW50aXRpZXNbc0luZGV4XTtcbiAgICAgIC8vIGRpcnR5IGlmIHRoZSBzZWN0aW9uSGVhZGVyIGlzIG5ldyBvciBfc2VjdGlvbkhhc0NoYW5nZWQgaXMgdHJ1ZVxuICAgICAgZGlydHkgPSAhcHJldlNlY3Rpb25zSGFzaFtzZWN0aW9uSURdO1xuICAgICAgdmFyIHNlY3Rpb25IZWFkZXJIYXNDaGFuZ2VkID0gdGhpcy5fc2VjdGlvbkhlYWRlckhhc0NoYW5nZWQ7XG4gICAgICBpZiAoIWRpcnR5ICYmIHNlY3Rpb25IZWFkZXJIYXNDaGFuZ2VkKSB7XG4gICAgICAgIGRpcnR5ID0gc2VjdGlvbkhlYWRlckhhc0NoYW5nZWQoXG4gICAgICAgICAgdGhpcy5fZ2V0U2VjdGlvbkhlYWRlckRhdGEocHJldkRhdGFCbG9iLCBzZWN0aW9uSUQpLFxuICAgICAgICAgIHRoaXMuX2dldFNlY3Rpb25IZWFkZXJEYXRhKHRoaXMuX2RhdGFCbG9iLCBzZWN0aW9uSUQpXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgICB0aGlzLl9kaXJ0eVNlY3Rpb25zLnB1c2goISFkaXJ0eSk7XG5cbiAgICAgIHRoaXMuX2RpcnR5Um93c1tzSW5kZXhdID0gW107XG4gICAgICBmb3IgKHZhciBySW5kZXggPSAwOyBySW5kZXggPCB0aGlzLnJvd0lkZW50aXRpZXNbc0luZGV4XS5sZW5ndGg7IHJJbmRleCsrKSB7XG4gICAgICAgIHZhciByb3dJRCA9IHRoaXMucm93SWRlbnRpdGllc1tzSW5kZXhdW3JJbmRleF07XG4gICAgICAgIC8vIGRpcnR5IGlmIHRoZSBzZWN0aW9uIGlzIG5ldywgcm93IGlzIG5ldyBvciBfcm93SGFzQ2hhbmdlZCBpcyB0cnVlXG4gICAgICAgIGRpcnR5ID1cbiAgICAgICAgICAhcHJldlNlY3Rpb25zSGFzaFtzZWN0aW9uSURdIHx8XG4gICAgICAgICAgIXByZXZSb3dzSGFzaFtzZWN0aW9uSURdW3Jvd0lEXSB8fFxuICAgICAgICAgIHRoaXMuX3Jvd0hhc0NoYW5nZWQoXG4gICAgICAgICAgICB0aGlzLl9nZXRSb3dEYXRhKHByZXZEYXRhQmxvYiwgc2VjdGlvbklELCByb3dJRCksXG4gICAgICAgICAgICB0aGlzLl9nZXRSb3dEYXRhKHRoaXMuX2RhdGFCbG9iLCBzZWN0aW9uSUQsIHJvd0lEKVxuICAgICAgICAgICk7XG4gICAgICAgIHRoaXMuX2RpcnR5Um93c1tzSW5kZXhdLnB1c2goISFkaXJ0eSk7XG4gICAgICB9XG4gICAgfVxuICB9XG59XG5cbmZ1bmN0aW9uIGNvdW50Um93cyhhbGxSb3dJRHMpIHtcbiAgdmFyIHRvdGFsUm93cyA9IDA7XG4gIGZvciAodmFyIHNlY3Rpb25JZHggPSAwOyBzZWN0aW9uSWR4IDwgYWxsUm93SURzLmxlbmd0aDsgc2VjdGlvbklkeCsrKSB7XG4gICAgdmFyIHJvd0lEcyA9IGFsbFJvd0lEc1tzZWN0aW9uSWR4XTtcbiAgICB0b3RhbFJvd3MgKz0gcm93SURzLmxlbmd0aDtcbiAgfVxuICByZXR1cm4gdG90YWxSb3dzO1xufVxuXG5mdW5jdGlvbiBrZXllZERpY3Rpb25hcnlGcm9tQXJyYXkoYXJyKSB7XG4gIGlmIChpc0VtcHR5KGFycikpIHtcbiAgICByZXR1cm4ge307XG4gIH1cbiAgdmFyIHJlc3VsdCA9IHt9O1xuICBmb3IgKHZhciBpaSA9IDA7IGlpIDwgYXJyLmxlbmd0aDsgaWkrKykge1xuICAgIHZhciBrZXkgPSBhcnJbaWldO1xuICAgIHdhcm5pbmcoIXJlc3VsdFtrZXldLCAnVmFsdWUgYXBwZWFycyBtb3JlIHRoYW4gb25jZSBpbiBhcnJheTogJyArIGtleSk7XG4gICAgcmVzdWx0W2tleV0gPSB0cnVlO1xuICB9XG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmV4cG9ydCBkZWZhdWx0IExpc3RWaWV3RGF0YVNvdXJjZTtcbiJdfQ==