







'use strict';Object.defineProperty(exports,"__esModule",{value:true});

require('./injectResponderEventPlugin.web');
var _TouchHistoryMath=require('./TouchHistoryMath');var _TouchHistoryMath2=_interopRequireDefault(_TouchHistoryMath);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}

var currentCentroidXOfTouchesChangedAfter=
_TouchHistoryMath2.default.currentCentroidXOfTouchesChangedAfter;
var currentCentroidYOfTouchesChangedAfter=
_TouchHistoryMath2.default.currentCentroidYOfTouchesChangedAfter;
var previousCentroidXOfTouchesChangedAfter=
_TouchHistoryMath2.default.previousCentroidXOfTouchesChangedAfter;
var previousCentroidYOfTouchesChangedAfter=
_TouchHistoryMath2.default.previousCentroidYOfTouchesChangedAfter;
var currentCentroidX=_TouchHistoryMath2.default.currentCentroidX;
var currentCentroidY=_TouchHistoryMath2.default.currentCentroidY;















































































var PanResponder={
































































_initializeGestureState:function _initializeGestureState(gestureState){
gestureState.moveX=0;
gestureState.moveY=0;
gestureState.x0=0;
gestureState.y0=0;
gestureState.dx=0;
gestureState.dy=0;
gestureState.vx=0;
gestureState.vy=0;
gestureState.numberActiveTouches=0;

gestureState._accountsForMovesUpTo=0;
},

























_updateGestureStateOnMove:function _updateGestureStateOnMove(gestureState,touchHistory){
gestureState.numberActiveTouches=touchHistory.numberActiveTouches;
gestureState.moveX=currentCentroidXOfTouchesChangedAfter(
touchHistory,
gestureState._accountsForMovesUpTo);

gestureState.moveY=currentCentroidYOfTouchesChangedAfter(
touchHistory,
gestureState._accountsForMovesUpTo);

var movedAfter=gestureState._accountsForMovesUpTo;
var prevX=previousCentroidXOfTouchesChangedAfter(touchHistory,movedAfter);
var x=currentCentroidXOfTouchesChangedAfter(touchHistory,movedAfter);
var prevY=previousCentroidYOfTouchesChangedAfter(touchHistory,movedAfter);
var y=currentCentroidYOfTouchesChangedAfter(touchHistory,movedAfter);
var nextDX=gestureState.dx+(x-prevX);
var nextDY=gestureState.dy+(y-prevY);


var dt=
touchHistory.mostRecentTimeStamp-gestureState._accountsForMovesUpTo;
gestureState.vx=(nextDX-gestureState.dx)/dt;
gestureState.vy=(nextDY-gestureState.dy)/dt;

gestureState.dx=nextDX;
gestureState.dy=nextDY;
gestureState._accountsForMovesUpTo=touchHistory.mostRecentTimeStamp;
},

































create:function create(config){
var gestureState={

stateID:Math.random()};

PanResponder._initializeGestureState(gestureState);
var panHandlers={
onStartShouldSetResponder:function onStartShouldSetResponder(e){
return config.onStartShouldSetPanResponder===undefined?false:
config.onStartShouldSetPanResponder(e,gestureState);
},
onMoveShouldSetResponder:function onMoveShouldSetResponder(e){
return config.onMoveShouldSetPanResponder===undefined?false:
config.onMoveShouldSetPanResponder(e,gestureState);
},
onStartShouldSetResponderCapture:function onStartShouldSetResponderCapture(e){
if(!e.nativeEvent.touches){
return false;
}


if(e.nativeEvent.touches.length===1){
PanResponder._initializeGestureState(gestureState);
}
gestureState.numberActiveTouches=e.touchHistory.numberActiveTouches;
return config.onStartShouldSetPanResponderCapture!==undefined?
config.onStartShouldSetPanResponderCapture(e,gestureState):false;
},

onMoveShouldSetResponderCapture:function onMoveShouldSetResponderCapture(e){
var touchHistory=e.touchHistory;



if(gestureState._accountsForMovesUpTo===touchHistory.mostRecentTimeStamp){
return false;
}
PanResponder._updateGestureStateOnMove(gestureState,touchHistory);
return config.onMoveShouldSetPanResponderCapture?
config.onMoveShouldSetPanResponderCapture(e,gestureState):false;
},

onResponderGrant:function onResponderGrant(e){
gestureState.x0=currentCentroidX(e.touchHistory);
gestureState.y0=currentCentroidY(e.touchHistory);
gestureState.dx=0;
gestureState.dy=0;
config.onPanResponderGrant&&config.onPanResponderGrant(e,gestureState);

return config.onShouldBlockNativeResponder===undefined?true:
config.onShouldBlockNativeResponder();
},

onResponderReject:function onResponderReject(e){
config.onPanResponderReject&&config.onPanResponderReject(e,gestureState);
},

onResponderRelease:function onResponderRelease(e){
config.onPanResponderRelease&&config.onPanResponderRelease(e,gestureState);
PanResponder._initializeGestureState(gestureState);
},

onResponderStart:function onResponderStart(e){
var touchHistory=e.touchHistory;
gestureState.numberActiveTouches=touchHistory.numberActiveTouches;
config.onPanResponderStart&&config.onPanResponderStart(e,gestureState);
},

onResponderMove:function onResponderMove(e){
var touchHistory=e.touchHistory;


if(gestureState._accountsForMovesUpTo===touchHistory.mostRecentTimeStamp){
return;
}


PanResponder._updateGestureStateOnMove(gestureState,touchHistory);
config.onPanResponderMove&&config.onPanResponderMove(e,gestureState);
},

onResponderEnd:function onResponderEnd(e){
var touchHistory=e.touchHistory;
gestureState.numberActiveTouches=touchHistory.numberActiveTouches;
config.onPanResponderEnd&&config.onPanResponderEnd(e,gestureState);
},

onResponderTerminate:function onResponderTerminate(e){
config.onPanResponderTerminate&&
config.onPanResponderTerminate(e,gestureState);
PanResponder._initializeGestureState(gestureState);
},

onResponderTerminationRequest:function onResponderTerminationRequest(e){
return config.onPanResponderTerminationRequest===undefined?true:
config.onPanResponderTerminationRequest(e,gestureState);
}};

return{panHandlers:panHandlers};
}};exports.default=


PanResponder;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlBhblJlc3BvbmRlci53ZWIuanMiXSwibmFtZXMiOlsiY3VycmVudENlbnRyb2lkWE9mVG91Y2hlc0NoYW5nZWRBZnRlciIsImN1cnJlbnRDZW50cm9pZFlPZlRvdWNoZXNDaGFuZ2VkQWZ0ZXIiLCJwcmV2aW91c0NlbnRyb2lkWE9mVG91Y2hlc0NoYW5nZWRBZnRlciIsInByZXZpb3VzQ2VudHJvaWRZT2ZUb3VjaGVzQ2hhbmdlZEFmdGVyIiwiY3VycmVudENlbnRyb2lkWCIsImN1cnJlbnRDZW50cm9pZFkiLCJQYW5SZXNwb25kZXIiLCJfaW5pdGlhbGl6ZUdlc3R1cmVTdGF0ZSIsImdlc3R1cmVTdGF0ZSIsIm1vdmVYIiwibW92ZVkiLCJ4MCIsInkwIiwiZHgiLCJkeSIsInZ4IiwidnkiLCJudW1iZXJBY3RpdmVUb3VjaGVzIiwiX2FjY291bnRzRm9yTW92ZXNVcFRvIiwiX3VwZGF0ZUdlc3R1cmVTdGF0ZU9uTW92ZSIsInRvdWNoSGlzdG9yeSIsIm1vdmVkQWZ0ZXIiLCJwcmV2WCIsIngiLCJwcmV2WSIsInkiLCJuZXh0RFgiLCJuZXh0RFkiLCJkdCIsIm1vc3RSZWNlbnRUaW1lU3RhbXAiLCJjcmVhdGUiLCJjb25maWciLCJzdGF0ZUlEIiwiTWF0aCIsInJhbmRvbSIsInBhbkhhbmRsZXJzIiwib25TdGFydFNob3VsZFNldFJlc3BvbmRlciIsImUiLCJvblN0YXJ0U2hvdWxkU2V0UGFuUmVzcG9uZGVyIiwidW5kZWZpbmVkIiwib25Nb3ZlU2hvdWxkU2V0UmVzcG9uZGVyIiwib25Nb3ZlU2hvdWxkU2V0UGFuUmVzcG9uZGVyIiwib25TdGFydFNob3VsZFNldFJlc3BvbmRlckNhcHR1cmUiLCJuYXRpdmVFdmVudCIsInRvdWNoZXMiLCJsZW5ndGgiLCJvblN0YXJ0U2hvdWxkU2V0UGFuUmVzcG9uZGVyQ2FwdHVyZSIsIm9uTW92ZVNob3VsZFNldFJlc3BvbmRlckNhcHR1cmUiLCJvbk1vdmVTaG91bGRTZXRQYW5SZXNwb25kZXJDYXB0dXJlIiwib25SZXNwb25kZXJHcmFudCIsIm9uUGFuUmVzcG9uZGVyR3JhbnQiLCJvblNob3VsZEJsb2NrTmF0aXZlUmVzcG9uZGVyIiwib25SZXNwb25kZXJSZWplY3QiLCJvblBhblJlc3BvbmRlclJlamVjdCIsIm9uUmVzcG9uZGVyUmVsZWFzZSIsIm9uUGFuUmVzcG9uZGVyUmVsZWFzZSIsIm9uUmVzcG9uZGVyU3RhcnQiLCJvblBhblJlc3BvbmRlclN0YXJ0Iiwib25SZXNwb25kZXJNb3ZlIiwib25QYW5SZXNwb25kZXJNb3ZlIiwib25SZXNwb25kZXJFbmQiLCJvblBhblJlc3BvbmRlckVuZCIsIm9uUmVzcG9uZGVyVGVybWluYXRlIiwib25QYW5SZXNwb25kZXJUZXJtaW5hdGUiLCJvblJlc3BvbmRlclRlcm1pbmF0aW9uUmVxdWVzdCIsIm9uUGFuUmVzcG9uZGVyVGVybWluYXRpb25SZXF1ZXN0Il0sIm1hcHBpbmdzIjoiOzs7Ozs7OztBQVFBLGE7O0FBRUE7QUFDQSxvRDs7QUFFQSxHQUFJQTtBQUNGLDJCQUFpQkEscUNBRG5CO0FBRUEsR0FBSUM7QUFDRiwyQkFBaUJBLHFDQURuQjtBQUVBLEdBQUlDO0FBQ0YsMkJBQWlCQSxzQ0FEbkI7QUFFQSxHQUFJQztBQUNGLDJCQUFpQkEsc0NBRG5CO0FBRUEsR0FBSUMsa0JBQW1CLDJCQUFpQkEsZ0JBQXhDO0FBQ0EsR0FBSUMsa0JBQW1CLDJCQUFpQkEsZ0JBQXhDOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWdGQSxHQUFJQyxjQUFlOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQWlFakJDLHVCQWpFaUIsa0NBaUVPQyxZQWpFUCxDQWlFcUI7QUFDcENBLGFBQWFDLEtBQWIsQ0FBcUIsQ0FBckI7QUFDQUQsYUFBYUUsS0FBYixDQUFxQixDQUFyQjtBQUNBRixhQUFhRyxFQUFiLENBQWtC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QzdCLFlBQWxDLENBREY7QUFFQUYsYUFBYUMsdUJBQWIsQ0FBcUNDLFlBQXJDO0FBQ0QsQ0FyRmU7O0FBdUZoQndELDZCQXZGZ0Isd0NBdUZjM0IsQ0F2RmQsQ0F1RmlCO0FBQy9CLE1BQU9OLFFBQU9rQyxnQ0FBUCxHQUE0QzFCLFNBQTVDLENBQXdELElBQXhEO0FBQ0xSLE9BQU9rQyxnQ0FBUCxDQUF3QzVCLENBQXhDLENBQTJDN0IsWUFBM0MsQ0FERjtBQUVELENBMUZlLENBQWxCOztBQTRGQSxNQUFPLENBQUMyQixZQUFhQSxXQUFkLENBQVA7QUFDRCxDQXZRZ0IsQ0FBbkIsQzs7O0FBMFFlN0IsWSIsImZpbGUiOiJQYW5SZXNwb25kZXIud2ViLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTUtcHJlc2VudCwgQWxpYmFiYSBHcm91cCBIb2xkaW5nIExpbWl0ZWQuXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICpcbiAqIENvcHlyaWdodCAoYykgMjAxNSwgRmFjZWJvb2ssIEluYy4gIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKlxuICogQHByb3ZpZGVzTW9kdWxlIFJlYWN0UGFuUmVzcG9uZGVyXG4gKi9cbid1c2Ugc3RyaWN0JztcblxuaW1wb3J0ICcuL2luamVjdFJlc3BvbmRlckV2ZW50UGx1Z2luLndlYic7XG5pbXBvcnQgVG91Y2hIaXN0b3J5TWF0aCBmcm9tICcuL1RvdWNoSGlzdG9yeU1hdGgnO1xuXG5sZXQgY3VycmVudENlbnRyb2lkWE9mVG91Y2hlc0NoYW5nZWRBZnRlciA9XG4gIFRvdWNoSGlzdG9yeU1hdGguY3VycmVudENlbnRyb2lkWE9mVG91Y2hlc0NoYW5nZWRBZnRlcjtcbmxldCBjdXJyZW50Q2VudHJvaWRZT2ZUb3VjaGVzQ2hhbmdlZEFmdGVyID1cbiAgVG91Y2hIaXN0b3J5TWF0aC5jdXJyZW50Q2VudHJvaWRZT2ZUb3VjaGVzQ2hhbmdlZEFmdGVyO1xubGV0IHByZXZpb3VzQ2VudHJvaWRYT2ZUb3VjaGVzQ2hhbmdlZEFmdGVyID1cbiAgVG91Y2hIaXN0b3J5TWF0aC5wcmV2aW91c0NlbnRyb2lkWE9mVG91Y2hlc0NoYW5nZWRBZnRlcjtcbmxldCBwcmV2aW91c0NlbnRyb2lkWU9mVG91Y2hlc0NoYW5nZWRBZnRlciA9XG4gIFRvdWNoSGlzdG9yeU1hdGgucHJldmlvdXNDZW50cm9pZFlPZlRvdWNoZXNDaGFuZ2VkQWZ0ZXI7XG5sZXQgY3VycmVudENlbnRyb2lkWCA9IFRvdWNoSGlzdG9yeU1hdGguY3VycmVudENlbnRyb2lkWDtcbmxldCBjdXJyZW50Q2VudHJvaWRZID0gVG91Y2hIaXN0b3J5TWF0aC5jdXJyZW50Q2VudHJvaWRZO1xuXG4vKipcbiAqIGBQYW5SZXNwb25kZXJgIHJlY29uY2lsZXMgc2V2ZXJhbCB0b3VjaGVzIGludG8gYSBzaW5nbGUgZ2VzdHVyZS4gSXQgbWFrZXNcbiAqIHNpbmdsZS10b3VjaCBnZXN0dXJlcyByZXNpbGllbnQgdG8gZXh0cmEgdG91Y2hlcywgYW5kIGNhbiBiZSB1c2VkIHRvXG4gKiByZWNvZ25pemUgc2ltcGxlIG11bHRpLXRvdWNoIGdlc3R1cmVzLlxuICpcbiAqIEl0IHByb3ZpZGVzIGEgcHJlZGljdGFibGUgd3JhcHBlciBvZiB0aGUgcmVzcG9uZGVyIGhhbmRsZXJzIHByb3ZpZGVkIGJ5IHRoZVxuICogW2dlc3R1cmUgcmVzcG9uZGVyIHN5c3RlbV0oL3JlYWN0LW5hdGl2ZS9kb2NzL2dlc3R1cmUtcmVzcG9uZGVyLXN5c3RlbS5odG1sKS5cbiAqIEZvciBlYWNoIGhhbmRsZXIsIGl0IHByb3ZpZGVzIGEgbmV3IGBnZXN0dXJlU3RhdGVgIG9iamVjdCBhbG9uZ3NpZGUgdGhlXG4gKiBub3JtYWwgZXZlbnQuXG4gKlxuICogQSBgZ2VzdHVyZVN0YXRlYCBvYmplY3QgaGFzIHRoZSBmb2xsb3dpbmc6XG4gKlxuICogIC0gYHN0YXRlSURgIC0gSUQgb2YgdGhlIGdlc3R1cmVTdGF0ZS0gcGVyc2lzdGVkIGFzIGxvbmcgYXMgdGhlcmUgYXQgbGVhc3RcbiAqICAgICBvbmUgdG91Y2ggb24gc2NyZWVuXG4gKiAgLSBgbW92ZVhgIC0gdGhlIGxhdGVzdCBzY3JlZW4gY29vcmRpbmF0ZXMgb2YgdGhlIHJlY2VudGx5LW1vdmVkIHRvdWNoXG4gKiAgLSBgbW92ZVlgIC0gdGhlIGxhdGVzdCBzY3JlZW4gY29vcmRpbmF0ZXMgb2YgdGhlIHJlY2VudGx5LW1vdmVkIHRvdWNoXG4gKiAgLSBgeDBgIC0gdGhlIHNjcmVlbiBjb29yZGluYXRlcyBvZiB0aGUgcmVzcG9uZGVyIGdyYW50XG4gKiAgLSBgeTBgIC0gdGhlIHNjcmVlbiBjb29yZGluYXRlcyBvZiB0aGUgcmVzcG9uZGVyIGdyYW50XG4gKiAgLSBgZHhgIC0gYWNjdW11bGF0ZWQgZGlzdGFuY2Ugb2YgdGhlIGdlc3R1cmUgc2luY2UgdGhlIHRvdWNoIHN0YXJ0ZWRcbiAqICAtIGBkeWAgLSBhY2N1bXVsYXRlZCBkaXN0YW5jZSBvZiB0aGUgZ2VzdHVyZSBzaW5jZSB0aGUgdG91Y2ggc3RhcnRlZFxuICogIC0gYHZ4YCAtIGN1cnJlbnQgdmVsb2NpdHkgb2YgdGhlIGdlc3R1cmVcbiAqICAtIGB2eWAgLSBjdXJyZW50IHZlbG9jaXR5IG9mIHRoZSBnZXN0dXJlXG4gKiAgLSBgbnVtYmVyQWN0aXZlVG91Y2hlc2AgLSBOdW1iZXIgb2YgdG91Y2hlcyBjdXJyZW50bHkgb24gc2NyZWVlblxuICpcbiAqICMjIyBCYXNpYyBVc2FnZVxuICpcbiAqIGBgYFxuICogICBjb21wb25lbnRXaWxsTW91bnQoKSB7XG4gKiAgICAgdGhpcy5fcGFuUmVzcG9uZGVyID0gUGFuUmVzcG9uZGVyLmNyZWF0ZSh7XG4gKiAgICAgICAvLyBBc2sgdG8gYmUgdGhlIHJlc3BvbmRlcjpcbiAqICAgICAgIG9uU3RhcnRTaG91bGRTZXRQYW5SZXNwb25kZXI6IChldnQsIGdlc3R1cmVTdGF0ZSkgPT4gdHJ1ZSxcbiAqICAgICAgIG9uU3RhcnRTaG91bGRTZXRQYW5SZXNwb25kZXJDYXB0dXJlOiAoZXZ0LCBnZXN0dXJlU3RhdGUpID0+IHRydWUsXG4gKiAgICAgICBvbk1vdmVTaG91bGRTZXRQYW5SZXNwb25kZXI6IChldnQsIGdlc3R1cmVTdGF0ZSkgPT4gdHJ1ZSxcbiAqICAgICAgIG9uTW92ZVNob3VsZFNldFBhblJlc3BvbmRlckNhcHR1cmU6IChldnQsIGdlc3R1cmVTdGF0ZSkgPT4gdHJ1ZSxcbiAqXG4gKiAgICAgICBvblBhblJlc3BvbmRlckdyYW50OiAoZXZ0LCBnZXN0dXJlU3RhdGUpID0+IHtcbiAqICAgICAgICAgLy8gVGhlIGd1ZXN0dXJlIGhhcyBzdGFydGVkLiBTaG93IHZpc3VhbCBmZWVkYmFjayBzbyB0aGUgdXNlciBrbm93c1xuICogICAgICAgICAvLyB3aGF0IGlzIGhhcHBlbmluZyFcbiAqXG4gKiAgICAgICAgIC8vIGdlc3R1cmVTdGF0ZS57eCx5fTAgd2lsbCBiZSBzZXQgdG8gemVybyBub3dcbiAqICAgICAgIH0sXG4gKiAgICAgICBvblBhblJlc3BvbmRlck1vdmU6IChldnQsIGdlc3R1cmVTdGF0ZSkgPT4ge1xuICogICAgICAgICAvLyBUaGUgbW9zdCByZWNlbnQgbW92ZSBkaXN0YW5jZSBpcyBnZXN0dXJlU3RhdGUubW92ZXtYLFl9XG4gKlxuICogICAgICAgICAvLyBUaGUgYWNjdW11bGF0ZWQgZ2VzdHVyZSBkaXN0YW5jZSBzaW5jZSBiZWNvbWluZyByZXNwb25kZXIgaXNcbiAqICAgICAgICAgLy8gZ2VzdHVyZVN0YXRlLmR7eCx5fVxuICogICAgICAgfSxcbiAqICAgICAgIG9uUGFuUmVzcG9uZGVyVGVybWluYXRpb25SZXF1ZXN0OiAoZXZ0LCBnZXN0dXJlU3RhdGUpID0+IHRydWUsXG4gKiAgICAgICBvblBhblJlc3BvbmRlclJlbGVhc2U6IChldnQsIGdlc3R1cmVTdGF0ZSkgPT4ge1xuICogICAgICAgICAvLyBUaGUgdXNlciBoYXMgcmVsZWFzZWQgYWxsIHRvdWNoZXMgd2hpbGUgdGhpcyB2aWV3IGlzIHRoZVxuICogICAgICAgICAvLyByZXNwb25kZXIuIFRoaXMgdHlwaWNhbGx5IG1lYW5zIGEgZ2VzdHVyZSBoYXMgc3VjY2VlZGVkXG4gKiAgICAgICB9LFxuICogICAgICAgb25QYW5SZXNwb25kZXJUZXJtaW5hdGU6IChldnQsIGdlc3R1cmVTdGF0ZSkgPT4ge1xuICogICAgICAgICAvLyBBbm90aGVyIGNvbXBvbmVudCBoYXMgYmVjb21lIHRoZSByZXNwb25kZXIsIHNvIHRoaXMgZ2VzdHVyZVxuICogICAgICAgICAvLyBzaG91bGQgYmUgY2FuY2VsbGVkXG4gKiAgICAgICB9LFxuICogICAgICAgb25TaG91bGRCbG9ja05hdGl2ZVJlc3BvbmRlcjogKGV2dCwgZ2VzdHVyZVN0YXRlKSA9PiB7XG4gKiAgICAgICAgIC8vIFJldHVybnMgd2hldGhlciB0aGlzIGNvbXBvbmVudCBzaG91bGQgYmxvY2sgbmF0aXZlIGNvbXBvbmVudHMgZnJvbSBiZWNvbWluZyB0aGUgSlNcbiAqICAgICAgICAgLy8gcmVzcG9uZGVyLiBSZXR1cm5zIHRydWUgYnkgZGVmYXVsdC4gSXMgY3VycmVudGx5IG9ubHkgc3VwcG9ydGVkIG9uIGFuZHJvaWQuXG4gKiAgICAgICAgIHJldHVybiB0cnVlO1xuICogICAgICAgfSxcbiAqICAgICB9KTtcbiAqICAgfSxcbiAqXG4gKiAgIHJlbmRlcigpIHtcbiAqICAgICByZXR1cm4gKFxuICogICAgICAgPFZpZXcgey4uLnRoaXMuX3BhblJlc3BvbmRlci5wYW5IYW5kbGVyc30gLz5cbiAqICAgICApO1xuICogICB9LFxuICpcbiAqIGBgYFxuICpcbiAqICMjIyBXb3JraW5nIEV4YW1wbGVcbiAqXG4gKiBUbyBzZWUgaXQgaW4gYWN0aW9uLCB0cnkgdGhlXG4gKiBbUGFuUmVzcG9uZGVyIGV4YW1wbGUgaW4gVUlFeHBsb3Jlcl0oaHR0cHM6Ly9naXRodWIuY29tL2ZhY2Vib29rL3JlYWN0LW5hdGl2ZS9ibG9iL21hc3Rlci9FeGFtcGxlcy9VSUV4cGxvcmVyL1Jlc3BvbmRlckV4YW1wbGUuanMpXG4gKi9cblxubGV0IFBhblJlc3BvbmRlciA9IHtcblxuICAvKipcbiAgICpcbiAgICogQSBncmFwaGljYWwgZXhwbGFuYXRpb24gb2YgdGhlIHRvdWNoIGRhdGEgZmxvdzpcbiAgICpcbiAgICogKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0rICAgICAgICAgICAgICstLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLStcbiAgICogfCBSZXNwb25kZXJUb3VjaEhpc3RvcnlTdG9yZSB8ICAgICAgICAgICAgIHxUb3VjaEhpc3RvcnlNYXRoICAgICAgICAgICAgICAgIHxcbiAgICogKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0rICAgICAgICAgICAgICstLS0tLS0tLS0tKy0tLS0tLS0tLS0tLS0tLS0tLS0tLStcbiAgICogfEdsb2JhbCBzdG9yZSBvZiB0b3VjaEhpc3Rvcnl8ICAgICAgICAgICAgIHxBbGxvY2F0aW9uLWxlc3MgbWF0aCB1dGlsICAgICAgIHxcbiAgICogfGluY2x1ZGluZyBhY3RpdmVuZXNzLCBzdGFydCB8ICAgICAgICAgICAgIHxvbiB0b3VjaCBoaXN0b3J5IChjZW50cm9pZHMgICAgIHxcbiAgICogfHBvc2l0aW9uLCBwcmV2L2N1ciBwb3NpdGlvbi58ICAgICAgICAgICAgIHxhbmQgbXVsdGl0b3VjaCBtb3ZlbWVudCBldGMpICAgIHxcbiAgICogfCAgICAgICAgICAgICAgICAgICAgICAgICAgICB8ICAgICAgICAgICAgIHwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHxcbiAgICogKy0tLS1eLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0rICAgICAgICAgICAgICstLS0tXi0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLStcbiAgICogICAgICB8ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfFxuICAgKiAgICAgIHwgKHJlY29yZHMgcmVsZXZhbnQgaGlzdG9yeSAgICAgICAgICAgICAgICB8XG4gICAqICAgICAgfCAgb2YgdG91Y2hlcyByZWxldmFudCBmb3IgICAgICAgICAgICAgICAgIHxcbiAgICogICAgICB8ICBpbXBsZW1lbnRpbmcgaGlnaGVyIGxldmVsICAgICAgICAgICAgICAgfFxuICAgKiAgICAgIHwgIGdlc3R1cmVzKSAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB8XG4gICAqICAgICAgfCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHxcbiAgICogKy0tLS0rLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0rICAgICAgICAgICAgICstLS0tfC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLStcbiAgICogfCBSZXNwb25kZXJFdmVudFBsdWdpbiAgICAgICB8ICAgICAgICAgICAgIHwgICAgfCAgIFlvdXIgQXBwL0NvbXBvbmVudCAgICAgIHxcbiAgICogKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0rICAgICAgICAgICAgICstLS0tfC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLStcbiAgICogfE5lZ290aWF0ZXMgd2hpY2ggdmlldyBnZXRzICB8IExvdyBsZXZlbCAgIHwgICAgfCAgICAgICAgICAgICBIaWdoIGxldmVsICAgIHxcbiAgICogfG9uUmVzcG9uZGVyTW92ZSBldmVudHMuICAgICB8IGV2ZW50cyB3LyAgIHwgICstKy0tLS0tLS0rICAgICBldmVudHMgdy8gICAgIHxcbiAgICogfEFsc28gcmVjb3JkcyBoaXN0b3J5IGludG8gICB8IHRvdWNoSGlzdG9yeXwgIHwgICBQYW4gICB8ICAgICBtdWx0aXRvdWNoICsgIHxcbiAgICogfFJlc3BvbmRlclRvdWNoSGlzdG9yeVN0b3JlLiArLS0tLS0tLS0tLS0tLS0tLT5SZXNwb25kZXIrLS0tLS0+IGFjY3VtdWxhdGl2ZXxcbiAgICogKy0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0rIGF0dGFjaGVkIHRvIHwgIHwgICAgICAgICB8ICAgICBkaXN0YW5jZSBhbmQgIHxcbiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlYWNoIGV2ZW50IHwgICstLS0tLS0tLS0rICAgICB2ZWxvY2l0eS4gICAgIHxcbiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHxcbiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHwgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHxcbiAgICogICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICstLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLStcbiAgICpcbiAgICpcbiAgICpcbiAgICogR2VzdHVyZSB0aGF0IGNhbGN1bGF0ZXMgY3VtdWxhdGl2ZSBtb3ZlbWVudCBvdmVyIHRpbWUgaW4gYSB3YXkgdGhhdCBqdXN0XG4gICAqIFwiZG9lcyB0aGUgcmlnaHQgdGhpbmdcIiBmb3IgbXVsdGlwbGUgdG91Y2hlcy4gVGhlIFwicmlnaHQgdGhpbmdcIiBpcyB2ZXJ5XG4gICAqIG51YW5jZWQuIFdoZW4gbW92aW5nIHR3byB0b3VjaGVzIGluIG9wcG9zaXRlIGRpcmVjdGlvbnMsIHRoZSBjdW11bGF0aXZlXG4gICAqIGRpc3RhbmNlIGlzIHplcm8gaW4gZWFjaCBkaW1lbnNpb24uIFdoZW4gdHdvIHRvdWNoZXMgbW92ZSBpbiBwYXJhbGxlbCBmaXZlXG4gICAqIHBpeGVscyBpbiB0aGUgc2FtZSBkaXJlY3Rpb24sIHRoZSBjdW11bGF0aXZlIGRpc3RhbmNlIGlzIGZpdmUsIG5vdCB0ZW4uIElmXG4gICAqIHR3byB0b3VjaGVzIHN0YXJ0LCBvbmUgbW92ZXMgZml2ZSBpbiBhIGRpcmVjdGlvbiwgdGhlbiBzdG9wcyBhbmQgdGhlIG90aGVyXG4gICAqIHRvdWNoIG1vdmVzIGZpdmVzIGluIHRoZSBzYW1lIGRpcmVjdGlvbiwgdGhlIGN1bXVsYXRpdmUgZGlzdGFuY2UgaXMgdGVuLlxuICAgKlxuICAgKiBUaGlzIGxvZ2ljIHJlcXVpcmVzIGEga2luZCBvZiBwcm9jZXNzaW5nIG9mIHRpbWUgXCJjbHVzdGVyc1wiIG9mIHRvdWNoIGV2ZW50c1xuICAgKiBzbyB0aGF0IHR3byB0b3VjaCBtb3ZlcyB0aGF0IGVzc2VudGlhbGx5IG9jY3VyIGluIHBhcmFsbGVsIGJ1dCBtb3ZlIGV2ZXJ5XG4gICAqIG90aGVyIGZyYW1lIHJlc3BlY3RpdmVseSwgYXJlIGNvbnNpZGVyZWQgcGFydCBvZiB0aGUgc2FtZSBtb3ZlbWVudC5cbiAgICpcbiAgICogRXhwbGFuYXRpb24gb2Ygc29tZSBvZiB0aGUgbm9uLW9idmlvdXMgZmllbGRzOlxuICAgKlxuICAgKiAtIG1vdmVYL21vdmVZOiBJZiBubyBtb3ZlIGV2ZW50IGhhcyBiZWVuIG9ic2VydmVkLCB0aGVuIGAobW92ZVgsIG1vdmVZKWAgaXNcbiAgICogICBpbnZhbGlkLiBJZiBhIG1vdmUgZXZlbnQgaGFzIGJlZW4gb2JzZXJ2ZWQsIGAobW92ZVgsIG1vdmVZKWAgaXMgdGhlXG4gICAqICAgY2VudHJvaWQgb2YgdGhlIG1vc3QgcmVjZW50bHkgbW92ZWQgXCJjbHVzdGVyXCIgb2YgYWN0aXZlIHRvdWNoZXMuXG4gICAqICAgKEN1cnJlbnRseSBhbGwgbW92ZSBoYXZlIHRoZSBzYW1lIHRpbWVTdGFtcCwgYnV0IGxhdGVyIHdlIHNob3VsZCBhZGQgc29tZVxuICAgKiAgIHRocmVzaG9sZCBmb3Igd2hhdCBpcyBjb25zaWRlcmVkIHRvIGJlIFwibW92aW5nXCIpLiBJZiBhIHBhbG0gaXNcbiAgICogICBhY2NpZGVudGFsbHkgY291bnRlZCBhcyBhIHRvdWNoLCBidXQgYSBmaW5nZXIgaXMgbW92aW5nIGdyZWF0bHksIHRoZSBwYWxtXG4gICAqICAgd2lsbCBtb3ZlIHNsaWdodGx5LCBidXQgd2Ugb25seSB3YW50IHRvIGNvdW50IHRoZSBzaW5nbGUgbW92aW5nIHRvdWNoLlxuICAgKiAtIHgwL3kwOiBDZW50cm9pZCBsb2NhdGlvbiAobm9uLWN1bXVsYXRpdmUpIGF0IHRoZSB0aW1lIG9mIGJlY29taW5nXG4gICAqICAgcmVzcG9uZGVyLlxuICAgKiAtIGR4L2R5OiBDdW11bGF0aXZlIHRvdWNoIGRpc3RhbmNlIC0gbm90IHRoZSBzYW1lIHRoaW5nIGFzIHN1bSBvZiBlYWNoIHRvdWNoXG4gICAqICAgZGlzdGFuY2UuIEFjY291bnRzIGZvciB0b3VjaCBtb3ZlcyB0aGF0IGFyZSBjbHVzdGVyZWQgdG9nZXRoZXIgaW4gdGltZSxcbiAgICogICBtb3ZpbmcgdGhlIHNhbWUgZGlyZWN0aW9uLiBPbmx5IHZhbGlkIHdoZW4gY3VycmVudGx5IHJlc3BvbmRlciAob3RoZXJ3aXNlLFxuICAgKiAgIGl0IG9ubHkgcmVwcmVzZW50cyB0aGUgZHJhZyBkaXN0YW5jZSBiZWxvdyB0aGUgdGhyZXNob2xkKS5cbiAgICogLSB2eC92eTogVmVsb2NpdHkuXG4gICAqL1xuXG4gIF9pbml0aWFsaXplR2VzdHVyZVN0YXRlKGdlc3R1cmVTdGF0ZSkge1xuICAgIGdlc3R1cmVTdGF0ZS5tb3ZlWCA9IDA7XG4gICAgZ2VzdHVyZVN0YXRlLm1vdmVZID0gMDtcbiAgICBnZXN0dXJlU3RhdGUueDAgPSAwO1xuICAgIGdlc3R1cmVTdGF0ZS55MCA9IDA7XG4gICAgZ2VzdHVyZVN0YXRlLmR4ID0gMDtcbiAgICBnZXN0dXJlU3RhdGUuZHkgPSAwO1xuICAgIGdlc3R1cmVTdGF0ZS52eCA9IDA7XG4gICAgZ2VzdHVyZVN0YXRlLnZ5ID0gMDtcbiAgICBnZXN0dXJlU3RhdGUubnVtYmVyQWN0aXZlVG91Y2hlcyA9IDA7XG4gICAgLy8gQWxsIGBnZXN0dXJlU3RhdGVgIGFjY291bnRzIGZvciB0aW1lU3RhbXBzIHVwIHVudGlsOlxuICAgIGdlc3R1cmVTdGF0ZS5fYWNjb3VudHNGb3JNb3Zlc1VwVG8gPSAwO1xuICB9LFxuXG4gIC8qKlxuICAgKiBUaGlzIGlzIG51YW5jZWQgYW5kIGlzIG5lY2Vzc2FyeS4gSXQgaXMgaW5jb3JyZWN0IHRvIGNvbnRpbnVvdXNseSB0YWtlIGFsbFxuICAgKiBhY3RpdmUgKmFuZCogcmVjZW50bHkgbW92ZWQgdG91Y2hlcywgZmluZCB0aGUgY2VudHJvaWQsIGFuZCB0cmFjayBob3cgdGhhdFxuICAgKiByZXN1bHQgY2hhbmdlcyBvdmVyIHRpbWUuIEluc3RlYWQsIHdlIG11c3QgdGFrZSBhbGwgcmVjZW50bHkgbW92ZWRcbiAgICogdG91Y2hlcywgYW5kIGNhbGN1bGF0ZSBob3cgdGhlIGNlbnRyb2lkIGhhcyBjaGFuZ2VkIGp1c3QgZm9yIHRob3NlXG4gICAqIHJlY2VudGx5IG1vdmVkIHRvdWNoZXMsIGFuZCBhcHBlbmQgdGhhdCBjaGFuZ2UgdG8gYW4gYWNjdW11bGF0b3IuIFRoaXMgaXNcbiAgICogdG8gKGF0IGxlYXN0KSBoYW5kbGUgdGhlIGNhc2Ugd2hlcmUgdGhlIHVzZXIgaXMgbW92aW5nIHRocmVlIGZpbmdlcnMsIGFuZFxuICAgKiB0aGVuIG9uZSBvZiB0aGUgZmluZ2VycyBzdG9wcyBidXQgdGhlIG90aGVyIHR3byBjb250aW51ZS5cbiAgICpcbiAgICogVGhpcyBpcyB2ZXJ5IGRpZmZlcmVudCB0aGFuIHRha2luZyBhbGwgb2YgdGhlIHJlY2VudGx5IG1vdmVkIHRvdWNoZXMgYW5kXG4gICAqIHN0b3JpbmcgdGhlaXIgY2VudHJvaWQgYXMgYGR4L2R5YC4gRm9yIGNvcnJlY3RuZXNzLCB3ZSBtdXN0ICphY2N1bXVsYXRlXG4gICAqIGNoYW5nZXMqIGluIHRoZSBjZW50cm9pZCBvZiByZWNlbnRseSBtb3ZlZCB0b3VjaGVzLlxuICAgKlxuICAgKiBUaGVyZSBpcyBhbHNvIHNvbWUgbnVhbmNlIHdpdGggaG93IHdlIGhhbmRsZSBtdWx0aXBsZSBtb3ZlZCB0b3VjaGVzIGluIGFcbiAgICogc2luZ2xlIGV2ZW50LiBXaXRoIHRoZSB3YXkgYFJlYWN0TmF0aXZlRXZlbnRFbWl0dGVyYCBkaXNwYXRjaGVzIHRvdWNoZXMgYXNcbiAgICogaW5kaXZpZHVhbCBldmVudHMsIG11bHRpcGxlIHRvdWNoZXMgZ2VuZXJhdGUgdHdvICdtb3ZlJyBldmVudHMsIGVhY2ggb2ZcbiAgICogdGhlbSB0cmlnZ2VyaW5nIGBvblJlc3BvbmRlck1vdmVgLiBCdXQgd2l0aCB0aGUgd2F5IGBQYW5SZXNwb25kZXJgIHdvcmtzLFxuICAgKiBhbGwgb2YgdGhlIGdlc3R1cmUgaW5mZXJlbmNlIGlzIHBlcmZvcm1lZCBvbiB0aGUgZmlyc3QgZGlzcGF0Y2gsIHNpbmNlIGl0XG4gICAqIGxvb2tzIGF0IGFsbCBvZiB0aGUgdG91Y2hlcyAoZXZlbiB0aGUgb25lcyBmb3Igd2hpY2ggdGhlcmUgaGFzbid0IGJlZW4gYVxuICAgKiBuYXRpdmUgZGlzcGF0Y2ggeWV0KS4gVGhlcmVmb3JlLCBgUGFuUmVzcG9uZGVyYCBkb2VzIG5vdCBjYWxsXG4gICAqIGBvblJlc3BvbmRlck1vdmVgIHBhc3NlZCB0aGUgZmlyc3QgZGlzcGF0Y2guIFRoaXMgZGl2ZXJnZXMgZnJvbSB0aGVcbiAgICogdHlwaWNhbCByZXNwb25kZXIgY2FsbGJhY2sgcGF0dGVybiAod2l0aG91dCB1c2luZyBgUGFuUmVzcG9uZGVyYCksIGJ1dFxuICAgKiBhdm9pZHMgbW9yZSBkaXNwYXRjaGVzIHRoYW4gbmVjZXNzYXJ5LlxuICAgKi9cbiAgX3VwZGF0ZUdlc3R1cmVTdGF0ZU9uTW92ZShnZXN0dXJlU3RhdGUsIHRvdWNoSGlzdG9yeSkge1xuICAgIGdlc3R1cmVTdGF0ZS5udW1iZXJBY3RpdmVUb3VjaGVzID0gdG91Y2hIaXN0b3J5Lm51bWJlckFjdGl2ZVRvdWNoZXM7XG4gICAgZ2VzdHVyZVN0YXRlLm1vdmVYID0gY3VycmVudENlbnRyb2lkWE9mVG91Y2hlc0NoYW5nZWRBZnRlcihcbiAgICAgIHRvdWNoSGlzdG9yeSxcbiAgICAgIGdlc3R1cmVTdGF0ZS5fYWNjb3VudHNGb3JNb3Zlc1VwVG9cbiAgICApO1xuICAgIGdlc3R1cmVTdGF0ZS5tb3ZlWSA9IGN1cnJlbnRDZW50cm9pZFlPZlRvdWNoZXNDaGFuZ2VkQWZ0ZXIoXG4gICAgICB0b3VjaEhpc3RvcnksXG4gICAgICBnZXN0dXJlU3RhdGUuX2FjY291bnRzRm9yTW92ZXNVcFRvXG4gICAgKTtcbiAgICBsZXQgbW92ZWRBZnRlciA9IGdlc3R1cmVTdGF0ZS5fYWNjb3VudHNGb3JNb3Zlc1VwVG87XG4gICAgbGV0IHByZXZYID0gcHJldmlvdXNDZW50cm9pZFhPZlRvdWNoZXNDaGFuZ2VkQWZ0ZXIodG91Y2hIaXN0b3J5LCBtb3ZlZEFmdGVyKTtcbiAgICBsZXQgeCA9IGN1cnJlbnRDZW50cm9pZFhPZlRvdWNoZXNDaGFuZ2VkQWZ0ZXIodG91Y2hIaXN0b3J5LCBtb3ZlZEFmdGVyKTtcbiAgICBsZXQgcHJldlkgPSBwcmV2aW91c0NlbnRyb2lkWU9mVG91Y2hlc0NoYW5nZWRBZnRlcih0b3VjaEhpc3RvcnksIG1vdmVkQWZ0ZXIpO1xuICAgIGxldCB5ID0gY3VycmVudENlbnRyb2lkWU9mVG91Y2hlc0NoYW5nZWRBZnRlcih0b3VjaEhpc3RvcnksIG1vdmVkQWZ0ZXIpO1xuICAgIGxldCBuZXh0RFggPSBnZXN0dXJlU3RhdGUuZHggKyAoeCAtIHByZXZYKTtcbiAgICBsZXQgbmV4dERZID0gZ2VzdHVyZVN0YXRlLmR5ICsgKHkgLSBwcmV2WSk7XG5cbiAgICAvLyBUT0RPOiBUaGlzIG11c3QgYmUgZmlsdGVyZWQgaW50ZWxsaWdlbnRseS5cbiAgICBsZXQgZHQgPVxuICAgICAgKHRvdWNoSGlzdG9yeS5tb3N0UmVjZW50VGltZVN0YW1wIC0gZ2VzdHVyZVN0YXRlLl9hY2NvdW50c0Zvck1vdmVzVXBUbyk7XG4gICAgZ2VzdHVyZVN0YXRlLnZ4ID0gKG5leHREWCAtIGdlc3R1cmVTdGF0ZS5keCkgLyBkdDtcbiAgICBnZXN0dXJlU3RhdGUudnkgPSAobmV4dERZIC0gZ2VzdHVyZVN0YXRlLmR5KSAvIGR0O1xuXG4gICAgZ2VzdHVyZVN0YXRlLmR4ID0gbmV4dERYO1xuICAgIGdlc3R1cmVTdGF0ZS5keSA9IG5leHREWTtcbiAgICBnZXN0dXJlU3RhdGUuX2FjY291bnRzRm9yTW92ZXNVcFRvID0gdG91Y2hIaXN0b3J5Lm1vc3RSZWNlbnRUaW1lU3RhbXA7XG4gIH0sXG5cbiAgLyoqXG4gICAqIEBwYXJhbSB7b2JqZWN0fSBjb25maWcgRW5oYW5jZWQgdmVyc2lvbnMgb2YgYWxsIG9mIHRoZSByZXNwb25kZXIgY2FsbGJhY2tzXG4gICAqIHRoYXQgcHJvdmlkZSBub3Qgb25seSB0aGUgdHlwaWNhbCBgUmVzcG9uZGVyU3ludGhldGljRXZlbnRgLCBidXQgYWxzbyB0aGVcbiAgICogYFBhblJlc3BvbmRlcmAgZ2VzdHVyZSBzdGF0ZS4gIFNpbXBseSByZXBsYWNlIHRoZSB3b3JkIGBSZXNwb25kZXJgIHdpdGhcbiAgICogYFBhblJlc3BvbmRlcmAgaW4gZWFjaCBvZiB0aGUgdHlwaWNhbCBgb25SZXNwb25kZXIqYCBjYWxsYmFja3MuIEZvclxuICAgKiBleGFtcGxlLCB0aGUgYGNvbmZpZ2Agb2JqZWN0IHdvdWxkIGxvb2sgbGlrZTpcbiAgICpcbiAgICogIC0gYG9uTW92ZVNob3VsZFNldFBhblJlc3BvbmRlcjogKGUsIGdlc3R1cmVTdGF0ZSkgPT4gey4uLn1gXG4gICAqICAtIGBvbk1vdmVTaG91bGRTZXRQYW5SZXNwb25kZXJDYXB0dXJlOiAoZSwgZ2VzdHVyZVN0YXRlKSA9PiB7Li4ufWBcbiAgICogIC0gYG9uU3RhcnRTaG91bGRTZXRQYW5SZXNwb25kZXI6IChlLCBnZXN0dXJlU3RhdGUpID0+IHsuLi59YFxuICAgKiAgLSBgb25TdGFydFNob3VsZFNldFBhblJlc3BvbmRlckNhcHR1cmU6IChlLCBnZXN0dXJlU3RhdGUpID0+IHsuLi59YFxuICAgKiAgLSBgb25QYW5SZXNwb25kZXJSZWplY3Q6IChlLCBnZXN0dXJlU3RhdGUpID0+IHsuLi59YFxuICAgKiAgLSBgb25QYW5SZXNwb25kZXJHcmFudDogKGUsIGdlc3R1cmVTdGF0ZSkgPT4gey4uLn1gXG4gICAqICAtIGBvblBhblJlc3BvbmRlclN0YXJ0OiAoZSwgZ2VzdHVyZVN0YXRlKSA9PiB7Li4ufWBcbiAgICogIC0gYG9uUGFuUmVzcG9uZGVyRW5kOiAoZSwgZ2VzdHVyZVN0YXRlKSA9PiB7Li4ufWBcbiAgICogIC0gYG9uUGFuUmVzcG9uZGVyUmVsZWFzZTogKGUsIGdlc3R1cmVTdGF0ZSkgPT4gey4uLn1gXG4gICAqICAtIGBvblBhblJlc3BvbmRlck1vdmU6IChlLCBnZXN0dXJlU3RhdGUpID0+IHsuLi59YFxuICAgKiAgLSBgb25QYW5SZXNwb25kZXJUZXJtaW5hdGU6IChlLCBnZXN0dXJlU3RhdGUpID0+IHsuLi59YFxuICAgKiAgLSBgb25QYW5SZXNwb25kZXJUZXJtaW5hdGlvblJlcXVlc3Q6IChlLCBnZXN0dXJlU3RhdGUpID0+IHsuLi59YFxuICAgKiAgLSAnb25TaG91bGRCbG9ja05hdGl2ZVJlc3BvbmRlcjogKGUsIGdlc3R1cmVTdGF0ZSkgPT4gey4uLn0nXG4gICAqXG4gICAqICBJbiBnZW5lcmFsLCBmb3IgZXZlbnRzIHRoYXQgaGF2ZSBjYXB0dXJlIGVxdWl2YWxlbnRzLCB3ZSB1cGRhdGUgdGhlXG4gICAqICBnZXN0dXJlU3RhdGUgb25jZSBpbiB0aGUgY2FwdHVyZSBwaGFzZSBhbmQgY2FuIHVzZSBpdCBpbiB0aGUgYnViYmxlIHBoYXNlXG4gICAqICBhcyB3ZWxsLlxuICAgKlxuICAgKiAgQmUgY2FyZWZ1bCB3aXRoIG9uU3RhcnRTaG91bGQqIGNhbGxiYWNrcy4gVGhleSBvbmx5IHJlZmxlY3QgdXBkYXRlZFxuICAgKiAgYGdlc3R1cmVTdGF0ZWAgZm9yIHN0YXJ0L2VuZCBldmVudHMgdGhhdCBidWJibGUvY2FwdHVyZSB0byB0aGUgTm9kZS5cbiAgICogIE9uY2UgdGhlIG5vZGUgaXMgdGhlIHJlc3BvbmRlciwgeW91IGNhbiByZWx5IG9uIGV2ZXJ5IHN0YXJ0L2VuZCBldmVudFxuICAgKiAgYmVpbmcgcHJvY2Vzc2VkIGJ5IHRoZSBnZXN0dXJlIGFuZCBgZ2VzdHVyZVN0YXRlYCBiZWluZyB1cGRhdGVkXG4gICAqICBhY2NvcmRpbmdseS4gKG51bWJlckFjdGl2ZVRvdWNoZXMpIG1heSBub3QgYmUgdG90YWxseSBhY2N1cmF0ZSB1bmxlc3MgeW91XG4gICAqICBhcmUgdGhlIHJlc3BvbmRlci5cbiAgICovXG4gIGNyZWF0ZShjb25maWcpIHtcbiAgICBsZXQgZ2VzdHVyZVN0YXRlID0ge1xuICAgICAgLy8gVXNlZnVsIGZvciBkZWJ1Z2dpbmdcbiAgICAgIHN0YXRlSUQ6IE1hdGgucmFuZG9tKCksXG4gICAgfTtcbiAgICBQYW5SZXNwb25kZXIuX2luaXRpYWxpemVHZXN0dXJlU3RhdGUoZ2VzdHVyZVN0YXRlKTtcbiAgICBsZXQgcGFuSGFuZGxlcnMgPSB7XG4gICAgICBvblN0YXJ0U2hvdWxkU2V0UmVzcG9uZGVyKGUpIHtcbiAgICAgICAgcmV0dXJuIGNvbmZpZy5vblN0YXJ0U2hvdWxkU2V0UGFuUmVzcG9uZGVyID09PSB1bmRlZmluZWQgPyBmYWxzZSA6XG4gICAgICAgICAgY29uZmlnLm9uU3RhcnRTaG91bGRTZXRQYW5SZXNwb25kZXIoZSwgZ2VzdHVyZVN0YXRlKTtcbiAgICAgIH0sXG4gICAgICBvbk1vdmVTaG91bGRTZXRSZXNwb25kZXIoZSkge1xuICAgICAgICByZXR1cm4gY29uZmlnLm9uTW92ZVNob3VsZFNldFBhblJlc3BvbmRlciA9PT0gdW5kZWZpbmVkID8gZmFsc2UgOlxuICAgICAgICAgIGNvbmZpZy5vbk1vdmVTaG91bGRTZXRQYW5SZXNwb25kZXIoZSwgZ2VzdHVyZVN0YXRlKTtcbiAgICAgIH0sXG4gICAgICBvblN0YXJ0U2hvdWxkU2V0UmVzcG9uZGVyQ2FwdHVyZShlKSB7XG4gICAgICAgIGlmICghZS5uYXRpdmVFdmVudC50b3VjaGVzKSB7XG4gICAgICAgICAgcmV0dXJuIGZhbHNlO1xuICAgICAgICB9XG4gICAgICAgIC8vIFRPRE86IEFjdHVhbGx5LCB3ZSBzaG91bGQgcmVpbml0aWFsaXplIHRoZSBzdGF0ZSBhbnkgdGltZVxuICAgICAgICAvLyB0b3VjaGVzLmxlbmd0aCBpbmNyZWFzZXMgZnJvbSAwIGFjdGl2ZSB0byA+IDAgYWN0aXZlLlxuICAgICAgICBpZiAoZS5uYXRpdmVFdmVudC50b3VjaGVzLmxlbmd0aCA9PT0gMSkge1xuICAgICAgICAgIFBhblJlc3BvbmRlci5faW5pdGlhbGl6ZUdlc3R1cmVTdGF0ZShnZXN0dXJlU3RhdGUpO1xuICAgICAgICB9XG4gICAgICAgIGdlc3R1cmVTdGF0ZS5udW1iZXJBY3RpdmVUb3VjaGVzID0gZS50b3VjaEhpc3RvcnkubnVtYmVyQWN0aXZlVG91Y2hlcztcbiAgICAgICAgcmV0dXJuIGNvbmZpZy5vblN0YXJ0U2hvdWxkU2V0UGFuUmVzcG9uZGVyQ2FwdHVyZSAhPT0gdW5kZWZpbmVkID9cbiAgICAgICAgICBjb25maWcub25TdGFydFNob3VsZFNldFBhblJlc3BvbmRlckNhcHR1cmUoZSwgZ2VzdHVyZVN0YXRlKSA6IGZhbHNlO1xuICAgICAgfSxcblxuICAgICAgb25Nb3ZlU2hvdWxkU2V0UmVzcG9uZGVyQ2FwdHVyZShlKSB7XG4gICAgICAgIGxldCB0b3VjaEhpc3RvcnkgPSBlLnRvdWNoSGlzdG9yeTtcbiAgICAgICAgLy8gUmVzcG9uZGVyIHN5c3RlbSBpbmNvcnJlY3RseSBkaXNwYXRjaGVzIHNob3VsZCogdG8gY3VycmVudCByZXNwb25kZXJcbiAgICAgICAgLy8gRmlsdGVyIG91dCBhbnkgdG91Y2ggbW92ZXMgcGFzdCB0aGUgZmlyc3Qgb25lIC0gd2Ugd291bGQgaGF2ZVxuICAgICAgICAvLyBhbHJlYWR5IHByb2Nlc3NlZCBtdWx0aS10b3VjaCBnZW9tZXRyeSBkdXJpbmcgdGhlIGZpcnN0IGV2ZW50LlxuICAgICAgICBpZiAoZ2VzdHVyZVN0YXRlLl9hY2NvdW50c0Zvck1vdmVzVXBUbyA9PT0gdG91Y2hIaXN0b3J5Lm1vc3RSZWNlbnRUaW1lU3RhbXApIHtcbiAgICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICAgIH1cbiAgICAgICAgUGFuUmVzcG9uZGVyLl91cGRhdGVHZXN0dXJlU3RhdGVPbk1vdmUoZ2VzdHVyZVN0YXRlLCB0b3VjaEhpc3RvcnkpO1xuICAgICAgICByZXR1cm4gY29uZmlnLm9uTW92ZVNob3VsZFNldFBhblJlc3BvbmRlckNhcHR1cmUgP1xuICAgICAgICAgIGNvbmZpZy5vbk1vdmVTaG91bGRTZXRQYW5SZXNwb25kZXJDYXB0dXJlKGUsIGdlc3R1cmVTdGF0ZSkgOiBmYWxzZTtcbiAgICAgIH0sXG5cbiAgICAgIG9uUmVzcG9uZGVyR3JhbnQoZSkge1xuICAgICAgICBnZXN0dXJlU3RhdGUueDAgPSBjdXJyZW50Q2VudHJvaWRYKGUudG91Y2hIaXN0b3J5KTtcbiAgICAgICAgZ2VzdHVyZVN0YXRlLnkwID0gY3VycmVudENlbnRyb2lkWShlLnRvdWNoSGlzdG9yeSk7XG4gICAgICAgIGdlc3R1cmVTdGF0ZS5keCA9IDA7XG4gICAgICAgIGdlc3R1cmVTdGF0ZS5keSA9IDA7XG4gICAgICAgIGNvbmZpZy5vblBhblJlc3BvbmRlckdyYW50ICYmIGNvbmZpZy5vblBhblJlc3BvbmRlckdyYW50KGUsIGdlc3R1cmVTdGF0ZSk7XG4gICAgICAgIC8vIFRPRE86IHQ3NDY3MTI0IGludmVzdGlnYXRlIGlmIHRoaXMgY2FuIGJlIHJlbW92ZWRcbiAgICAgICAgcmV0dXJuIGNvbmZpZy5vblNob3VsZEJsb2NrTmF0aXZlUmVzcG9uZGVyID09PSB1bmRlZmluZWQgPyB0cnVlIDpcbiAgICAgICAgICBjb25maWcub25TaG91bGRCbG9ja05hdGl2ZVJlc3BvbmRlcigpO1xuICAgICAgfSxcblxuICAgICAgb25SZXNwb25kZXJSZWplY3QoZSkge1xuICAgICAgICBjb25maWcub25QYW5SZXNwb25kZXJSZWplY3QgJiYgY29uZmlnLm9uUGFuUmVzcG9uZGVyUmVqZWN0KGUsIGdlc3R1cmVTdGF0ZSk7XG4gICAgICB9LFxuXG4gICAgICBvblJlc3BvbmRlclJlbGVhc2UoZSkge1xuICAgICAgICBjb25maWcub25QYW5SZXNwb25kZXJSZWxlYXNlICYmIGNvbmZpZy5vblBhblJlc3BvbmRlclJlbGVhc2UoZSwgZ2VzdHVyZVN0YXRlKTtcbiAgICAgICAgUGFuUmVzcG9uZGVyLl9pbml0aWFsaXplR2VzdHVyZVN0YXRlKGdlc3R1cmVTdGF0ZSk7XG4gICAgICB9LFxuXG4gICAgICBvblJlc3BvbmRlclN0YXJ0KGUpIHtcbiAgICAgICAgbGV0IHRvdWNoSGlzdG9yeSA9IGUudG91Y2hIaXN0b3J5O1xuICAgICAgICBnZXN0dXJlU3RhdGUubnVtYmVyQWN0aXZlVG91Y2hlcyA9IHRvdWNoSGlzdG9yeS5udW1iZXJBY3RpdmVUb3VjaGVzO1xuICAgICAgICBjb25maWcub25QYW5SZXNwb25kZXJTdGFydCAmJiBjb25maWcub25QYW5SZXNwb25kZXJTdGFydChlLCBnZXN0dXJlU3RhdGUpO1xuICAgICAgfSxcblxuICAgICAgb25SZXNwb25kZXJNb3ZlKGUpIHtcbiAgICAgICAgbGV0IHRvdWNoSGlzdG9yeSA9IGUudG91Y2hIaXN0b3J5O1xuICAgICAgICAvLyBHdWFyZCBhZ2FpbnN0IHRoZSBkaXNwYXRjaCBvZiB0d28gdG91Y2ggbW92ZXMgd2hlbiB0aGVyZSBhcmUgdHdvXG4gICAgICAgIC8vIHNpbXVsdGFuZW91c2x5IGNoYW5nZWQgdG91Y2hlcy5cbiAgICAgICAgaWYgKGdlc3R1cmVTdGF0ZS5fYWNjb3VudHNGb3JNb3Zlc1VwVG8gPT09IHRvdWNoSGlzdG9yeS5tb3N0UmVjZW50VGltZVN0YW1wKSB7XG4gICAgICAgICAgcmV0dXJuO1xuICAgICAgICB9XG4gICAgICAgIC8vIEZpbHRlciBvdXQgYW55IHRvdWNoIG1vdmVzIHBhc3QgdGhlIGZpcnN0IG9uZSAtIHdlIHdvdWxkIGhhdmVcbiAgICAgICAgLy8gYWxyZWFkeSBwcm9jZXNzZWQgbXVsdGktdG91Y2ggZ2VvbWV0cnkgZHVyaW5nIHRoZSBmaXJzdCBldmVudC5cbiAgICAgICAgUGFuUmVzcG9uZGVyLl91cGRhdGVHZXN0dXJlU3RhdGVPbk1vdmUoZ2VzdHVyZVN0YXRlLCB0b3VjaEhpc3RvcnkpO1xuICAgICAgICBjb25maWcub25QYW5SZXNwb25kZXJNb3ZlICYmIGNvbmZpZy5vblBhblJlc3BvbmRlck1vdmUoZSwgZ2VzdHVyZVN0YXRlKTtcbiAgICAgIH0sXG5cbiAgICAgIG9uUmVzcG9uZGVyRW5kKGUpIHtcbiAgICAgICAgbGV0IHRvdWNoSGlzdG9yeSA9IGUudG91Y2hIaXN0b3J5O1xuICAgICAgICBnZXN0dXJlU3RhdGUubnVtYmVyQWN0aXZlVG91Y2hlcyA9IHRvdWNoSGlzdG9yeS5udW1iZXJBY3RpdmVUb3VjaGVzO1xuICAgICAgICBjb25maWcub25QYW5SZXNwb25kZXJFbmQgJiYgY29uZmlnLm9uUGFuUmVzcG9uZGVyRW5kKGUsIGdlc3R1cmVTdGF0ZSk7XG4gICAgICB9LFxuXG4gICAgICBvblJlc3BvbmRlclRlcm1pbmF0ZShlKSB7XG4gICAgICAgIGNvbmZpZy5vblBhblJlc3BvbmRlclRlcm1pbmF0ZSAmJlxuICAgICAgICAgIGNvbmZpZy5vblBhblJlc3BvbmRlclRlcm1pbmF0ZShlLCBnZXN0dXJlU3RhdGUpO1xuICAgICAgICBQYW5SZXNwb25kZXIuX2luaXRpYWxpemVHZXN0dXJlU3RhdGUoZ2VzdHVyZVN0YXRlKTtcbiAgICAgIH0sXG5cbiAgICAgIG9uUmVzcG9uZGVyVGVybWluYXRpb25SZXF1ZXN0KGUpIHtcbiAgICAgICAgcmV0dXJuIGNvbmZpZy5vblBhblJlc3BvbmRlclRlcm1pbmF0aW9uUmVxdWVzdCA9PT0gdW5kZWZpbmVkID8gdHJ1ZSA6XG4gICAgICAgICAgY29uZmlnLm9uUGFuUmVzcG9uZGVyVGVybWluYXRpb25SZXF1ZXN0KGUsIGdlc3R1cmVTdGF0ZSk7XG4gICAgICB9LFxuICAgIH07XG4gICAgcmV0dXJuIHtwYW5IYW5kbGVyczogcGFuSGFuZGxlcnN9O1xuICB9LFxufTtcblxuZXhwb3J0IGRlZmF1bHQgUGFuUmVzcG9uZGVyO1xuIl19