






'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key];}}}return target;};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();

var _react=require('react');var _react2=_interopRequireDefault(_react);
var _objectAssign=require('object-assign');var _objectAssign2=_interopRequireDefault(_objectAssign);
var _ReactView=require('../View/View.web');var _ReactView2=_interopRequireDefault(_ReactView);
var _ReactAnimated=require('../Animated/Animated.web');var _ReactAnimated2=_interopRequireDefault(_ReactAnimated);
var _ReactDimensions=require('../Dimensions/Dimensions.web');var _ReactDimensions2=_interopRequireDefault(_ReactDimensions);
var _ReactPanResponder=require('../PanResponder/PanResponder.web');var _ReactPanResponder2=_interopRequireDefault(_ReactPanResponder);
var _ReactDismissKeyboard=require('../Utilties/dismissKeyboard.web');var _ReactDismissKeyboard2=_interopRequireDefault(_ReactDismissKeyboard);
var _NativeMethodsMixin=require('../Utilties/NativeMethodsMixin.web');
var _reactMixin=require('react-mixin');var _reactMixin2=_interopRequireDefault(_reactMixin);
var _autobindDecorator=require('autobind-decorator');var _autobindDecorator2=_interopRequireDefault(_autobindDecorator);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}function _possibleConstructorReturn(self,call){if(!self){throw new ReferenceError("this hasn't been initialised - super() hasn't been called");}return call&&(typeof call==="object"||typeof call==="function")?call:self;}function _inherits(subClass,superClass){if(typeof superClass!=="function"&&superClass!==null){throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);}subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:false,writable:true,configurable:true}});if(superClass)Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass;}

var deviceSize=_ReactDimensions2.default.get('window');
var VIEWPAGER_REF='viewpager';var

ViewPager=function(_React$Component){_inherits(ViewPager,_React$Component);function ViewPager(){var _ref;var _temp,_this,_ret;_classCallCheck(this,ViewPager);for(var _len=arguments.length,args=Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}return _ret=(_temp=(_this=_possibleConstructorReturn(this,(_ref=ViewPager.__proto__||Object.getPrototypeOf(ViewPager)).call.apply(_ref,[this].concat(args))),_this),_this.










































state={
selectedPage:_this.props.initialPage,
pageWidth:deviceSize.width,
pageCount:_this.props.children.length,
offsetLeft:new _ReactAnimated2.default.Value(0)},_temp),_possibleConstructorReturn(_this,_ret);}_createClass(ViewPager,[{key:'getInnerViewNode',value:function getInnerViewNode()


{
return this.refs[VIEWPAGER_REF].childNodes[0];
}},{key:'componentWillMount',value:function componentWillMount()

{












this._panResponder=_ReactPanResponder2.default.create({
onStartShouldSetResponder:function onStartShouldSetResponder(){return true;},
onMoveShouldSetPanResponder:this._shouldSetPanResponder,
onPanResponderGrant:function onPanResponderGrant(){},
onPanResponderMove:this._panResponderMove,
onPanResponderTerminationRequest:function onPanResponderTerminationRequest(){return true;},
onPanResponderRelease:this._panResponderRelease,
onPanResponderTerminate:function onPanResponderTerminate(){}});

}},{key:'componentDidMount',value:function componentDidMount()

{
this.setPage(this.state.selectedPage);
}},{key:'_childrenWithOverridenStyle',value:function _childrenWithOverridenStyle()

{



return _react2.default.Children.map(this.props.children,function(child){
var style=(0,_objectAssign2.default)({},child.props.style,{width:deviceSize.width});
var newProps={
style:style,
collapsable:false};

return(0,_react.cloneElement)(child,(0,_objectAssign2.default)({},child.props,newProps));
});
}},{key:'render',value:function render()

{
var children=this._childrenWithOverridenStyle();var _state=

this.state;var offsetLeft=_state.offsetLeft;var pageWidth=_state.pageWidth;var pageCount=_state.pageCount;
var width=pageWidth*pageCount;
var count=pageCount-1;

var translateX=offsetLeft.interpolate({
inputRange:[0,count],
outputRange:[0,-(pageWidth*count)],
extrapolate:'clamp'});


return _react2.default.createElement(_ReactView2.default,_extends({ref:VIEWPAGER_REF,
style:this.props.style},
this._panResponder.panHandlers),

_react2.default.createElement(_ReactAnimated2.default.View,{style:{
width:width,
position:'absolute',
top:0,
left:translateX,
bottom:0,
flexDirection:'row'}},

children));


}},{key:'_onPageScroll',value:function _onPageScroll(

event){
if(this.props.onPageScroll){
this.props.onPageScroll(event);
}
if(this.props.keyboardDismissMode==='on-drag'){
(0,_ReactDismissKeyboard2.default)();
}
}},{key:'_shouldSetPanResponder',value:function _shouldSetPanResponder()

{var _this2=this;
if(this._scrolling){
this.state.offsetLeft.stopAnimation(function(){
_this2._scrolling=false;
});
return false;
}

return true;
}},{key:'_panResponderMove',value:function _panResponderMove(

ev,_ref2){var dx=_ref2.dx;
var val=this.state.selectedPage+dx/this.state.pageWidth*-1;
this.state.offsetLeft.setValue(val);
}},{key:'_panResponderRelease',value:function _panResponderRelease(

ev,_ref3){var dx=_ref3.dx;var _state2=
this.state;var selectedPage=_state2.selectedPage;var pageWidth=_state2.pageWidth;
var range=Math.abs(dx)/pageWidth;
var threshold=1/5;

if(range>threshold){
if(dx>0){
selectedPage-=1;
}else{
selectedPage+=1;
}
}

this.setPage(selectedPage);
}},{key:'setPage',value:function setPage(

index){var _this3=this;
if(index<0){
index=0;
}else if(index>=this.state.pageCount){
index=this.state.pageCount-1;
}

this._scrolling=true;

_ReactAnimated2.default.spring(this.state.offsetLeft,{
toValue:index,
bounciness:0,
restSpeedThreshold:1}).
start(function(){

_this3._onPageScroll({
nativeEvent:{
position:index,
offset:0}});



_this3._scrolling=false;

_this3.setState({
selectedPage:index},
function(){
_this3.props.onPageSelected&&_this3.props.onPageSelected({nativeEvent:{position:index}});
});
});
}}]);return ViewPager;}(_react2.default.Component);ViewPager.propTypes={initialPage:_react.PropTypes.number,onPageScroll:_react.PropTypes.func,onPageSelected:_react.PropTypes.func,keyboardDismissMode:_react.PropTypes.oneOf(['none','on-drag'])};ViewPager.defaultProps={initialPage:0};

;

_reactMixin2.default.onClass(ViewPager,_NativeMethodsMixin.Mixin);
(0,_autobindDecorator2.default)(ViewPager);

ViewPager.isReactNativeComponent=true;exports.default=

ViewPager;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIlZpZXdQYWdlci53ZWIuanMiXSwibmFtZXMiOlsiZGV2aWNlU2l6ZSIsImdldCIsIlZJRVdQQUdFUl9SRUYiLCJWaWV3UGFnZXIiLCJzdGF0ZSIsInNlbGVjdGVkUGFnZSIsInByb3BzIiwiaW5pdGlhbFBhZ2UiLCJwYWdlV2lkdGgiLCJ3aWR0aCIsInBhZ2VDb3VudCIsImNoaWxkcmVuIiwibGVuZ3RoIiwib2Zmc2V0TGVmdCIsIlZhbHVlIiwicmVmcyIsImNoaWxkTm9kZXMiLCJfcGFuUmVzcG9uZGVyIiwiY3JlYXRlIiwib25TdGFydFNob3VsZFNldFJlc3BvbmRlciIsIm9uTW92ZVNob3VsZFNldFBhblJlc3BvbmRlciIsIl9zaG91bGRTZXRQYW5SZXNwb25kZXIiLCJvblBhblJlc3BvbmRlckdyYW50Iiwib25QYW5SZXNwb25kZXJNb3ZlIiwiX3BhblJlc3BvbmRlck1vdmUiLCJvblBhblJlc3BvbmRlclRlcm1pbmF0aW9uUmVxdWVzdCIsIm9uUGFuUmVzcG9uZGVyUmVsZWFzZSIsIl9wYW5SZXNwb25kZXJSZWxlYXNlIiwib25QYW5SZXNwb25kZXJUZXJtaW5hdGUiLCJzZXRQYWdlIiwiQ2hpbGRyZW4iLCJtYXAiLCJjaGlsZCIsInN0eWxlIiwibmV3UHJvcHMiLCJjb2xsYXBzYWJsZSIsIl9jaGlsZHJlbldpdGhPdmVycmlkZW5TdHlsZSIsImNvdW50IiwidHJhbnNsYXRlWCIsImludGVycG9sYXRlIiwiaW5wdXRSYW5nZSIsIm91dHB1dFJhbmdlIiwiZXh0cmFwb2xhdGUiLCJwYW5IYW5kbGVycyIsInBvc2l0aW9uIiwidG9wIiwibGVmdCIsImJvdHRvbSIsImZsZXhEaXJlY3Rpb24iLCJldmVudCIsIm9uUGFnZVNjcm9sbCIsImtleWJvYXJkRGlzbWlzc01vZGUiLCJfc2Nyb2xsaW5nIiwic3RvcEFuaW1hdGlvbiIsImV2IiwiZHgiLCJ2YWwiLCJzZXRWYWx1ZSIsInJhbmdlIiwiTWF0aCIsImFicyIsInRocmVzaG9sZCIsImluZGV4Iiwic3ByaW5nIiwidG9WYWx1ZSIsImJvdW5jaW5lc3MiLCJyZXN0U3BlZWRUaHJlc2hvbGQiLCJzdGFydCIsIl9vblBhZ2VTY3JvbGwiLCJuYXRpdmVFdmVudCIsIm9mZnNldCIsInNldFN0YXRlIiwib25QYWdlU2VsZWN0ZWQiLCJDb21wb25lbnQiLCJwcm9wVHlwZXMiLCJudW1iZXIiLCJmdW5jIiwib25lT2YiLCJkZWZhdWx0UHJvcHMiLCJvbkNsYXNzIiwiaXNSZWFjdE5hdGl2ZUNvbXBvbmVudCJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQU9BLGE7O0FBRUEsNEI7QUFDQSwyQztBQUNBLDJDO0FBQ0EsdUQ7QUFDQSw2RDtBQUNBLG1FO0FBQ0EscUU7QUFDQTtBQUNBLHVDO0FBQ0EscUQ7O0FBRUEsR0FBTUEsWUFBYSwwQkFBV0MsR0FBWCxDQUFlLFFBQWYsQ0FBbkI7QUFDQSxHQUFNQyxlQUFnQixXQUF0QixDOztBQUVNQyxTOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBMkNKQyxLLENBQVE7QUFDTkMsYUFBYyxNQUFLQyxLQUFMLENBQVdDLFdBRG5CO0FBRU5DLFVBQVdSLFdBQVdTLEtBRmhCO0FBR05DLFVBQVcsTUFBS0osS0FBTCxDQUFXSyxRQUFYLENBQW9CQyxNQUh6QjtBQUlOQyxXQUFZLEdBQUkseUJBQVNDLEtBQWIsQ0FBbUIsQ0FBbkIsQ0FKTixDOzs7QUFPVztBQUNqQixNQUFPLE1BQUtDLElBQUwsQ0FBVWIsYUFBVixFQUF5QmMsVUFBekIsQ0FBb0MsQ0FBcEMsQ0FBUDtBQUNELEM7O0FBRW9COzs7Ozs7Ozs7Ozs7O0FBYW5CLEtBQUtDLGFBQUwsQ0FBcUIsNEJBQWFDLE1BQWIsQ0FBb0I7QUFDdkNDLDBCQUEyQiwyQ0FBTSxLQUFOLEVBRFk7QUFFdkNDLDRCQUE2QixLQUFLQyxzQkFGSztBQUd2Q0Msb0JBQXFCLDhCQUFNLENBQUcsQ0FIUztBQUl2Q0MsbUJBQW9CLEtBQUtDLGlCQUpjO0FBS3ZDQyxpQ0FBa0Msa0RBQU0sS0FBTixFQUxLO0FBTXZDQyxz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TE4sQ0FnQmpCekIsYUFBYyxpQkFBVTBCLElBaEJQLENBd0JqQkosZUFBZ0IsaUJBQVVJLElBeEJULENBK0JqQnpCLG9CQUFxQixpQkFBVTBCLEtBQVYsQ0FBZ0IsQ0FDbkMsTUFEbUMsQ0FFbkMsU0FGbUMsQ0FBaEIsQ0EvQkosQyxDQUZmMUUsUyxDQXVDRzJFLFksQ0FBZSxDQUNwQnZFLFlBQWEsQ0FETyxDOztBQWdLdkI7O0FBRUQscUJBQU13RSxPQUFOLENBQWM1RSxTQUFkO0FBQ0EsZ0NBQVNBLFNBQVQ7O0FBRUFBLFVBQVU2RSxzQkFBVixDQUFtQyxJQUFuQyxDOztBQUVlN0UsUyIsImZpbGUiOiJWaWV3UGFnZXIud2ViLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTUtcHJlc2VudCwgQWxpYmFiYSBHcm91cCBIb2xkaW5nIExpbWl0ZWQuXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICpcbiAqIEBwcm92aWRlc01vZHVsZSBSZWFjdFZpZXdQYWdlclxuICpcbiAqL1xuJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgUmVhY3QsIHsgUHJvcFR5cGVzLCBjbG9uZUVsZW1lbnQgfSBmcm9tICdyZWFjdCc7XG5pbXBvcnQgYXNzaWduIGZyb20gJ29iamVjdC1hc3NpZ24nO1xuaW1wb3J0IFZpZXcgZnJvbSAnUmVhY3RWaWV3JztcbmltcG9ydCBBbmltYXRlZCBmcm9tICdSZWFjdEFuaW1hdGVkJztcbmltcG9ydCBEaW1lbnNpb25zIGZyb20gJ1JlYWN0RGltZW5zaW9ucyc7XG5pbXBvcnQgUGFuUmVzcG9uZGVyIGZyb20gJ1JlYWN0UGFuUmVzcG9uZGVyJztcbmltcG9ydCBkaXNtaXNzS2V5Ym9hcmQgZnJvbSAnUmVhY3REaXNtaXNzS2V5Ym9hcmQnO1xuaW1wb3J0IHsgTWl4aW4gYXMgTmF0aXZlTWV0aG9kc01peGluIH0gZnJvbSAnTmF0aXZlTWV0aG9kc01peGluJztcbmltcG9ydCBtaXhpbiBmcm9tICdyZWFjdC1taXhpbic7XG5pbXBvcnQgYXV0b2JpbmQgZnJvbSAnYXV0b2JpbmQtZGVjb3JhdG9yJztcblxuY29uc3QgZGV2aWNlU2l6ZSA9IERpbWVuc2lvbnMuZ2V0KCd3aW5kb3cnKTtcbmNvbnN0IFZJRVdQQUdFUl9SRUYgPSAndmlld3BhZ2VyJztcblxuY2xhc3MgVmlld1BhZ2VyIGV4dGVuZHMgUmVhY3QuQ29tcG9uZW50IHtcblxuICBzdGF0aWMgcHJvcFR5cGVzID0ge1xuICAgIC8qKlxuICAgICAqIEluZGV4IG9mIGluaXRpYWwgcGFnZSB0aGF0IHNob3VsZCBiZSBzZWxlY3RlZC4gVXNlIGBzZXRQYWdlYCBtZXRob2QgdG9cbiAgICAgKiB1cGRhdGUgdGhlIHBhZ2UsIGFuZCBgb25QYWdlU2VsZWN0ZWRgIHRvIG1vbml0b3IgcGFnZSBjaGFuZ2VzXG4gICAgICovXG4gICAgaW5pdGlhbFBhZ2U6IFByb3BUeXBlcy5udW1iZXIsXG5cbiAgICAvKipcbiAgICAgKiBFeGVjdXRlZCB3aGVuIHRyYW5zaXRpb25pbmcgYmV0d2VlbiBwYWdlcyAoZXRoZXIgYmVjYXVzZSBvZiBhbmltYXRpb24gZm9yXG4gICAgICogdGhlIHJlcXVlc3RlZCBwYWdlIGNoYW5nZSBvciB3aGVuIHVzZXIgaXMgc3dpcGluZy9kcmFnZ2luZyBiZXR3ZWVuIHBhZ2VzKVxuICAgICAqIFRoZSBgZXZlbnQubmF0aXZlRXZlbnRgIG9iamVjdCBmb3IgdGhpcyBjYWxsYmFjayB3aWxsIGNhcnJ5IGZvbGxvd2luZyBkYXRhOlxuICAgICAqICAtIHBvc2l0aW9uIC0gaW5kZXggb2YgZmlyc3QgcGFnZSBmcm9tIHRoZSBsZWZ0IHRoYXQgaXMgY3VycmVudGx5IHZpc2libGVcbiAgICAgKiAgLSBvZmZzZXQgLSB2YWx1ZSBmcm9tIHJhbmdlIFswLDEpIGRlc2NyaWJpbmcgc3RhZ2UgYmV0d2VlbiBwYWdlIHRyYW5zaXRpb25zLlxuICAgICAqICAgIFZhbHVlIHggbWVhbnMgdGhhdCAoMSAtIHgpIGZyYWN0aW9uIG9mIHRoZSBwYWdlIGF0IFwicG9zaXRpb25cIiBpbmRleCBpc1xuICAgICAqICAgIHZpc2libGUsIGFuZCB4IGZyYWN0aW9uIG9mIHRoZSBuZXh0IHBhZ2UgaXMgdmlzaWJsZS5cbiAgICAgKi9cbiAgICBvblBhZ2VTY3JvbGw6IFByb3BUeXBlcy5mdW5jLFxuXG4gICAgLyoqXG4gICAgICogVGhpcyBjYWxsYmFjayB3aWxsIGJlIGNhbGVsZCBvbmNlIFZpZXdQYWdlciBmaW5pc2ggbmF2aWdhdGluZyB0byBzZWxlY3RlZCBwYWdlXG4gICAgICogKHdoZW4gdXNlciBzd2lwZXMgYmV0d2VlbiBwYWdlcykuIFRoZSBgZXZlbnQubmF0aXZlRXZlbnRgIG9iamVjdCBwYXNzZWQgdG8gdGhpc1xuICAgICAqIGNhbGxiYWNrIHdpbGwgaGF2ZSBmb2xsb3dpbmcgZmllbGRzOlxuICAgICAqICAtIHBvc2l0aW9uIC0gaW5kZXggb2YgcGFnZSB0aGF0IGhhcyBiZWVuIHNlbGVjdGVkXG4gICAgICovXG4gICAgb25QYWdlU2VsZWN0ZWQ6IFByb3BUeXBlcy5mdW5jLFxuXG4gICAgLyoqXG4gICAgICogRGV0ZXJtaW5lcyB3aGV0aGVyIHRoZSBrZXlib2FyZCBnZXRzIGRpc21pc3NlZCBpbiByZXNwb25zZSB0byBhIGRyYWcuXG4gICAgICogICAtICdub25lJyAodGhlIGRlZmF1bHQpLCBkcmFncyBkbyBub3QgZGlzbWlzcyB0aGUga2V5Ym9hcmQuXG4gICAgICogICAtICdvbi1kcmFnJywgdGhlIGtleWJvYXJkIGlzIGRpc21pc3NlZCB3aGVuIGEgZHJhZyBiZWdpbnMuXG4gICAgICovXG4gICAga2V5Ym9hcmREaXNtaXNzTW9kZTogUHJvcFR5cGVzLm9uZU9mKFtcbiAgICAgICdub25lJywgLy8gZGVmYXVsdFxuICAgICAgJ29uLWRyYWcnXG4gICAgXSlcbiAgfVxuXG4gIHN0YXRpYyBkZWZhdWx0UHJvcHMgPSB7XG4gICAgaW5pdGlhbFBhZ2U6IDBcbiAgfVxuXG4gIHN0YXRlID0ge1xuICAgIHNlbGVjdGVkUGFnZTogdGhpcy5wcm9wcy5pbml0aWFsUGFnZSxcbiAgICBwYWdlV2lkdGg6IGRldmljZVNpemUud2lkdGgsXG4gICAgcGFnZUNvdW50OiB0aGlzLnByb3BzLmNoaWxkcmVuLmxlbmd0aCxcbiAgICBvZmZzZXRMZWZ0OiBuZXcgQW5pbWF0ZWQuVmFsdWUoMClcbiAgfVxuXG4gIGdldElubmVyVmlld05vZGUoKSB7XG4gICAgcmV0dXJuIHRoaXMucmVmc1tWSUVXUEFHRVJfUkVGXS5jaGlsZE5vZGVzWzBdO1xuICB9XG5cbiAgY29tcG9uZW50V2lsbE1vdW50KCkge1xuICAgIC8vIGxldCB7IG9mZnNldExlZnQsIHNlbGVjdGVkUGFnZSB9ID0gdGhpcy5zdGF0ZTtcblxuICAgIC8vIG9mZnNldExlZnQuYWRkTGlzdGVuZXIoKHt2YWx1ZX0pID0+IHtcbiAgICAgIC8vIGJhZCBwZXJmb3JtYW5jZVxuICAgICAgLy8gdGhpcy5fb25QYWdlU2Nyb2xsKHtcbiAgICAgIC8vICBuYXRpdmVFdmVudDoge1xuICAgICAgLy8gICAgcG9zaXRpb246IHNlbGVjdGVkUGFnZSxcbiAgICAgIC8vICAgIG9mZnNldDogdmFsdWUgLSBzZWxlY3RlZFBhZ2VcbiAgICAgIC8vICB9XG4gICAgICAvLyB9KTtcbiAgICAvLyB9KTtcblxuICAgIHRoaXMuX3BhblJlc3BvbmRlciA9IFBhblJlc3BvbmRlci5jcmVhdGUoe1xuICAgICAgb25TdGFydFNob3VsZFNldFJlc3BvbmRlcjogKCkgPT4gdHJ1ZSxcbiAgICAgIG9uTW92ZVNob3VsZFNldFBhblJlc3BvbmRlcjogdGhpcy5fc2hvdWxkU2V0UGFuUmVzcG9uZGVyLFxuICAgICAgb25QYW5SZXNwb25kZXJHcmFudDogKCkgPT4geyB9LFxuICAgICAgb25QYW5SZXNwb25kZXJNb3ZlOiB0aGlzLl9wYW5SZXNwb25kZXJNb3ZlLFxuICAgICAgb25QYW5SZXNwb25kZXJUZXJtaW5hdGlvblJlcXVlc3Q6ICgpID0+IHRydWUsXG4gICAgICBvblBhblJlc3BvbmRlclJlbGVhc2U6IHRoaXMuX3BhblJlc3BvbmRlclJlbGVhc2UsXG4gICAgICBvblBhblJlc3BvbmRlclRlcm1pbmF0ZTogKCkgPT4geyB9XG4gICAgfSk7XG4gIH1cblxuICBjb21wb25lbnREaWRNb3VudCgpIHtcbiAgICB0aGlzLnNldFBhZ2UodGhpcy5zdGF0ZS5zZWxlY3RlZFBhZ2UpO1xuICB9XG5cbiAgX2NoaWxkcmVuV2l0aE92ZXJyaWRlblN0eWxlKCkge1xuICAgIC8vIE92ZXJyaWRlIHN0eWxlcyBzbyB0aGF0IGVhY2ggcGFnZSB3aWxsIGZpbGwgdGhlIHBhcmVudC4gTmF0aXZlIGNvbXBvbmVudFxuICAgIC8vIHdpbGwgaGFuZGxlIHBvc2l0aW9uaW5nIG9mIGVsZW1lbnRzLCBzbyBpdCdzIG5vdCBpbXBvcnRhbnQgdG8gb2Zmc2V0XG4gICAgLy8gdGhlbSBjb3JyZWN0bHkuXG4gICAgcmV0dXJuIFJlYWN0LkNoaWxkcmVuLm1hcCh0aGlzLnByb3BzLmNoaWxkcmVuLCBmdW5jdGlvbihjaGlsZCkge1xuICAgICAgbGV0IHN0eWxlID0gYXNzaWduKHt9LCBjaGlsZC5wcm9wcy5zdHlsZSwge3dpZHRoOiBkZXZpY2VTaXplLndpZHRofSk7XG4gICAgICBsZXQgbmV3UHJvcHMgPSB7XG4gICAgICAgIHN0eWxlOiBzdHlsZSxcbiAgICAgICAgY29sbGFwc2FibGU6IGZhbHNlXG4gICAgICB9O1xuICAgICAgcmV0dXJuIGNsb25lRWxlbWVudChjaGlsZCwgYXNzaWduKHt9LCBjaGlsZC5wcm9wcywgbmV3UHJvcHMpKTtcbiAgICB9KTtcbiAgfVxuXG4gIHJlbmRlcigpIHtcbiAgICBsZXQgY2hpbGRyZW4gPSB0aGlzLl9jaGlsZHJlbldpdGhPdmVycmlkZW5TdHlsZSgpO1xuXG4gICAgbGV0IHsgb2Zmc2V0TGVmdCwgcGFnZVdpZHRoLCBwYWdlQ291bnQgfSA9IHRoaXMuc3RhdGU7XG4gICAgbGV0IHdpZHRoID0gcGFnZVdpZHRoICogcGFnZUNvdW50O1xuICAgIGxldCBjb3VudCA9IHBhZ2VDb3VudCAtIDE7XG5cbiAgICBsZXQgdHJhbnNsYXRlWCA9IG9mZnNldExlZnQuaW50ZXJwb2xhdGUoe1xuICAgICAgaW5wdXRSYW5nZTogWzAsIGNvdW50XSxcbiAgICAgIG91dHB1dFJhbmdlOiBbMCwgLShwYWdlV2lkdGggKiBjb3VudCldLFxuICAgICAgZXh0cmFwb2xhdGU6ICdjbGFtcCdcbiAgICB9KTtcblxuICAgIHJldHVybiAoPFZpZXcgcmVmPXtWSUVXUEFHRVJfUkVGfVxuICAgICAgc3R5bGU9e3RoaXMucHJvcHMuc3R5bGV9XG4gICAgICB7Li4udGhpcy5fcGFuUmVzcG9uZGVyLnBhbkhhbmRsZXJzfVxuICAgID5cbiAgICAgIDxBbmltYXRlZC5WaWV3IHN0eWxlPXt7XG4gICAgICAgIHdpZHRoOiB3aWR0aCxcbiAgICAgICAgcG9zaXRpb246ICdhYnNvbHV0ZScsXG4gICAgICAgIHRvcDogMCxcbiAgICAgICAgbGVmdDogdHJhbnNsYXRlWCxcbiAgICAgICAgYm90dG9tOiAwLFxuICAgICAgICBmbGV4RGlyZWN0aW9uOiAncm93J1xuICAgICAgfX0+XG4gICAgICAgIHtjaGlsZHJlbn1cbiAgICAgIDwvQW5pbWF0ZWQuVmlldz5cbiAgICA8L1ZpZXc+KTtcbiAgfVxuXG4gIF9vblBhZ2VTY3JvbGwoZXZlbnQpIHtcbiAgICBpZiAodGhpcy5wcm9wcy5vblBhZ2VTY3JvbGwpIHtcbiAgICAgIHRoaXMucHJvcHMub25QYWdlU2Nyb2xsKGV2ZW50KTtcbiAgICB9XG4gICAgaWYgKHRoaXMucHJvcHMua2V5Ym9hcmREaXNtaXNzTW9kZSA9PT0gJ29uLWRyYWcnKSB7XG4gICAgICBkaXNtaXNzS2V5Ym9hcmQoKTtcbiAgICB9XG4gIH1cblxuICBfc2hvdWxkU2V0UGFuUmVzcG9uZGVyKCkge1xuICAgIGlmICh0aGlzLl9zY3JvbGxpbmcpIHtcbiAgICAgIHRoaXMuc3RhdGUub2Zmc2V0TGVmdC5zdG9wQW5pbWF0aW9uKCgpPT4ge1xuICAgICAgICB0aGlzLl9zY3JvbGxpbmcgPSBmYWxzZTtcbiAgICAgIH0pO1xuICAgICAgcmV0dXJuIGZhbHNlO1xuICAgIH1cblxuICAgIHJldHVybiB0cnVlO1xuICB9XG5cbiAgX3BhblJlc3BvbmRlck1vdmUoZXYsIHtkeH0pIHtcbiAgICBsZXQgdmFsID0gdGhpcy5zdGF0ZS5zZWxlY3RlZFBhZ2UgKyBkeCAvIHRoaXMuc3RhdGUucGFnZVdpZHRoICogLTE7XG4gICAgdGhpcy5zdGF0ZS5vZmZzZXRMZWZ0LnNldFZhbHVlKHZhbCk7XG4gIH1cblxuICBfcGFuUmVzcG9uZGVyUmVsZWFzZShldiwge2R4fSkge1xuICAgIGxldCB7IHNlbGVjdGVkUGFnZSwgcGFnZVdpZHRoIH0gPSB0aGlzLnN0YXRlO1xuICAgIGxldCByYW5nZSA9IE1hdGguYWJzKGR4KSAvIHBhZ2VXaWR0aDtcbiAgICBsZXQgdGhyZXNob2xkID0gMSAvIDU7XG5cbiAgICBpZiAocmFuZ2UgPiB0aHJlc2hvbGQpIHtcbiAgICAgIGlmIChkeCA+IDApIHtcbiAgICAgICAgc2VsZWN0ZWRQYWdlIC09IDE7IC8vIFRPRE8gc3RlcD9cbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHNlbGVjdGVkUGFnZSArPSAxO1xuICAgICAgfVxuICAgIH1cblxuICAgIHRoaXMuc2V0UGFnZShzZWxlY3RlZFBhZ2UpO1xuICB9XG5cbiAgc2V0UGFnZShpbmRleCkge1xuICAgIGlmIChpbmRleCA8IDApIHtcbiAgICAgIGluZGV4ID0gMDtcbiAgICB9IGVsc2UgaWYgKGluZGV4ID49IHRoaXMuc3RhdGUucGFnZUNvdW50KSB7XG4gICAgICBpbmRleCA9IHRoaXMuc3RhdGUucGFnZUNvdW50IC0gMTtcbiAgICB9XG5cbiAgICB0aGlzLl9zY3JvbGxpbmcgPSB0cnVlO1xuXG4gICAgQW5pbWF0ZWQuc3ByaW5nKHRoaXMuc3RhdGUub2Zmc2V0TGVmdCwge1xuICAgICAgdG9WYWx1ZTogaW5kZXgsXG4gICAgICBib3VuY2luZXNzOiAwLFxuICAgICAgcmVzdFNwZWVkVGhyZXNob2xkOiAxXG4gICAgfSkuc3RhcnQoKCkgPT4ge1xuXG4gICAgICB0aGlzLl9vblBhZ2VTY3JvbGwoe1xuICAgICAgICBuYXRpdmVFdmVudDoge1xuICAgICAgICAgIHBvc2l0aW9uOiBpbmRleCxcbiAgICAgICAgICBvZmZzZXQ6IDBcbiAgICAgICAgfVxuICAgICAgfSk7XG5cbiAgICAgIHRoaXMuX3Njcm9sbGluZyA9IGZhbHNlO1xuXG4gICAgICB0aGlzLnNldFN0YXRlKHtcbiAgICAgICAgc2VsZWN0ZWRQYWdlOiBpbmRleFxuICAgICAgfSwgKCkgPT4ge1xuICAgICAgICB0aGlzLnByb3BzLm9uUGFnZVNlbGVjdGVkICYmIHRoaXMucHJvcHMub25QYWdlU2VsZWN0ZWQoe25hdGl2ZUV2ZW50OiB7cG9zaXRpb246IGluZGV4fX0pO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH1cblxufTtcblxubWl4aW4ub25DbGFzcyhWaWV3UGFnZXIsIE5hdGl2ZU1ldGhvZHNNaXhpbik7XG5hdXRvYmluZChWaWV3UGFnZXIpO1xuXG5WaWV3UGFnZXIuaXNSZWFjdE5hdGl2ZUNvbXBvbmVudCA9IHRydWU7XG5cbmV4cG9ydCBkZWZhdWx0IFZpZXdQYWdlcjtcbiJdfQ==