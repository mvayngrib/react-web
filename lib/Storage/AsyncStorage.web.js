







'use strict';

var _ReactPromise=require('../Promise/Promise.web');var _ReactPromise2=_interopRequireDefault(_ReactPromise);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}
var localStorage=window.localStorage;






function merge(obj1,obj2){
var obj3={};
for(var attrname in obj1){
obj3[attrname]=obj1[attrname];
}
for(var attrname in obj2){
obj3[attrname]=obj2[attrname];
}
return obj3;
}


var AsyncStorage={};


var bothMethods=[
'getItem','setItem','removeItem','clear'];







bothMethods.forEach(function(item){

var promiseMethod=function promiseMethod(){

var args=arguments;

return new _ReactPromise2.default(function(resolve,reject){

try{

var result=localStorage[item].apply(localStorage,args);
resolve(result);

}catch(err){


reject(err);

}

});
};
AsyncStorage[item]=promiseMethod;
});




AsyncStorage.mergeItem=function(key,value){

return new _ReactPromise2.default(function(resolve,reject){

try{
var oldValue=localStorage.getItem(key);
var oldObj=JSON.parse(oldValue);
var newObj=JSON.parse(value);


var mergedObj=merge(oldObj,newObj);

localStorage.setItem(key,JSON.stringify(mergedObj));
resolve();

}catch(err){
reject(err);
}

});

};




AsyncStorage.getAllKeys=function(){

var keys=[];

for(var i=0,len=localStorage.length;i<len;++i){
keys.push(localStorage.key(i));
}

return new _ReactPromise2.default(function(resolve,reject){
resolve(keys);
});

};

















AsyncStorage.multiGet=function(){

var keys=[].splice.call(arguments);
var results=null;

return new _ReactPromise2.default(function(resolve,reject){

try{

results=keys.map(function(key){
return[
key,localStorage.getItem(key)];

});

resolve(results);

}catch(err){
reject(err);
}

});
};







AsyncStorage.multiSet=function(){

var args=[].splice.call(arguments);

return new _ReactPromise2.default(function(resolve,reject){

try{

args.forEach(function(item){
return localStorage.setItem(item[0],item[1]);
});

resolve();

}catch(err){
reject(err);
}

});

};




AsyncStorage.multiRemove=function(){

var keys=[].splice.call(arguments);

return new _ReactPromise2.default(function(resolve,reject){

try{

keys.forEach(function(key){
return localStorage.removeItem(key);
});

resolve();

}catch(err){
reject(err);
}

});
};







AsyncStorage.multiMerge=function(){

var self=this;
var args=[].splice.call(arguments);

return new _ReactPromise2.default(function(resolve,reject){
try{
var promiseQueue=args.map(function(arg){
return self.mergeItem(arg[0],arg[1]);
});
resolve(_ReactPromise2.default.all(promiseQueue));
}catch(err){
reject(err);
}

});

};

module.exports=AsyncStorage;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIkFzeW5jU3RvcmFnZS53ZWIuanMiXSwibmFtZXMiOlsibG9jYWxTdG9yYWdlIiwid2luZG93IiwibWVyZ2UiLCJvYmoxIiwib2JqMiIsIm9iajMiLCJhdHRybmFtZSIsIkFzeW5jU3RvcmFnZSIsImJvdGhNZXRob2RzIiwiZm9yRWFjaCIsIml0ZW0iLCJwcm9taXNlTWV0aG9kIiwiYXJncyIsImFyZ3VtZW50cyIsInJlc29sdmUiLCJyZWplY3QiLCJyZXN1bHQiLCJhcHBseSIsImVyciIsIm1lcmdlSXRlbSIsImtleSIsInZhbHVlIiwib2xkVmFsdWUiLCJnZXRJdGVtIiwib2xkT2JqIiwiSlNPTiIsInBhcnNlIiwibmV3T2JqIiwibWVyZ2VkT2JqIiwic2V0SXRlbSIsInN0cmluZ2lmeSIsImdldEFsbEtleXMiLCJrZXlzIiwiaSIsImxlbiIsImxlbmd0aCIsInB1c2giLCJtdWx0aUdldCIsInNwbGljZSIsImNhbGwiLCJyZXN1bHRzIiwibWFwIiwibXVsdGlTZXQiLCJtdWx0aVJlbW92ZSIsInJlbW92ZUl0ZW0iLCJtdWx0aU1lcmdlIiwic2VsZiIsInByb21pc2VRdWV1ZSIsImFyZyIsImFsbCIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7Ozs7Ozs7O0FBUUE7O0FBRUEsb0Q7QUFDQSxHQUFJQSxjQUFlQyxPQUFPRCxZQUExQjs7Ozs7OztBQU9BLFFBQVNFLE1BQVQsQ0FBZUMsSUFBZixDQUFxQkMsSUFBckIsQ0FBMkI7QUFDekIsR0FBSUMsTUFBTyxFQUFYO0FBQ0EsSUFBSyxHQUFJQyxTQUFULEdBQXFCSCxLQUFyQixDQUEyQjtBQUN6QkUsS0FBS0MsUUFBTCxFQUFpQkgsS0FBS0csUUFBTCxDQUFqQjtBQUNEO0FBQ0QsSUFBSyxHQUFJQSxTQUFULEdBQXFCRixLQUFyQixDQUEyQjtBQUN6QkMsS0FBS0MsUUFBTCxFQUFpQkYsS0FBS0UsUUFBTCxDQUFqQjtBQUNEO0FBQ0QsTUFBT0QsS0FBUDtBQUNEOzs7QUFHRCxHQUFJRSxjQUFl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Q0FBWTtBQUNaSCxPQUFPRyxHQUFQO0FBQ0Q7O0FBRUYsQ0FWTSxDQUFQOztBQVlELENBakJEOztBQW1CQWdDLE9BQU9DLE9BQVAsQ0FBaUI1QyxZQUFqQiIsImZpbGUiOiJBc3luY1N0b3JhZ2Uud2ViLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTUtcHJlc2VudCwgQWxpYmFiYSBHcm91cCBIb2xkaW5nIExpbWl0ZWQuXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICpcbiAqIENvcHlyaWdodCAoYykgMjAxNSwgRmFjZWJvb2ssIEluYy4gIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKlxuICogQHByb3ZpZGVzTW9kdWxlIFJlYWN0QXN5bmNTdG9yYWdlXG4gKi9cbid1c2Ugc3RyaWN0JztcblxuaW1wb3J0IFByb21pc2UgZnJvbSAnUmVhY3RQcm9taXNlJztcbnZhciBsb2NhbFN0b3JhZ2UgPSB3aW5kb3cubG9jYWxTdG9yYWdlO1xuXG4vKipcbiAqIE92ZXJ3cml0ZXMgb2JqMSdzIHZhbHVlcyB3aXRoIG9iajIncyBhbmQgYWRkcyBvYmoyJ3MgaWYgbm9uIGV4aXN0ZW50IGluIG9iajFcbiAqXG4gKiBAcmV0dXJucyBvYmozIGEgbmV3IG9iamVjdCBiYXNlZCBvbiBvYmoxIGFuZCBvYmoyXG4gKi9cbmZ1bmN0aW9uIG1lcmdlKG9iajEsIG9iajIpIHtcbiAgdmFyIG9iajMgPSB7fTtcbiAgZm9yICh2YXIgYXR0cm5hbWUgaW4gb2JqMSkge1xuICAgIG9iajNbYXR0cm5hbWVdID0gb2JqMVthdHRybmFtZV07XG4gIH1cbiAgZm9yICh2YXIgYXR0cm5hbWUgaW4gb2JqMikge1xuICAgIG9iajNbYXR0cm5hbWVdID0gb2JqMlthdHRybmFtZV07XG4gIH1cbiAgcmV0dXJuIG9iajM7XG59XG5cbi8vIEFzeW5jU3RvcmFnZSBPYmplY3RcbnZhciBBc3luY1N0b3JhZ2UgPSB7fTtcblxuLy8gYm90aCBtZXRob2RzIGluIGxvY2FsU3RvcmFnZSBhbmQgQXN5bmNTdG9yYWdlXG52YXIgYm90aE1ldGhvZHMgPSBbXG4gICdnZXRJdGVtJywgJ3NldEl0ZW0nLCAncmVtb3ZlSXRlbScsICdjbGVhcidcbl07XG5cbi8qKlxuICogQWRkICdnZXRJdGVtJywgJ3NldEl0ZW0nLCAncmVtb3ZlSXRlbScsICdjbGVhcicgdG8gQXN5bmNTdG9yYWdlXG4gKlxuICogRXZlcnkgbWV0aG9kIHJldHVybnMgYSBgUHJvbWlzZWAgb2JqZWN0LlxuICovXG5ib3RoTWV0aG9kcy5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcblxuICB2YXIgcHJvbWlzZU1ldGhvZCA9IGZ1bmN0aW9uKCkge1xuXG4gICAgdmFyIGFyZ3MgPSBhcmd1bWVudHM7XG5cbiAgICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG5cbiAgICAgIHRyeSB7XG5cbiAgICAgICAgdmFyIHJlc3VsdCA9IGxvY2FsU3RvcmFnZVtpdGVtXS5hcHBseShsb2NhbFN0b3JhZ2UsIGFyZ3MpO1xuICAgICAgICByZXNvbHZlKHJlc3VsdCk7XG5cbiAgICAgIH0gY2F0Y2ggKGVycikge1xuXG4gICAgICAgIC8vIE1heWJlIGluIHRoZSBicm93c2VyIHByaXZhdGUgbW9kZSB3aWxsIGNhdXNlIHRoaXMgcHJvYmxlbVxuICAgICAgICByZWplY3QoZXJyKTtcblxuICAgICAgfVxuXG4gICAgfSk7XG4gIH07XG4gIEFzeW5jU3RvcmFnZVtpdGVtXSA9IHByb21pc2VNZXRob2Q7XG59KTtcblxuLyoqXG4gKiBNZXJnZXMgZXhpc3RpbmcgdmFsdWUgd2l0aCBpbnB1dCB2YWx1ZSwgYXNzdW1pbmcgdGhleSBhcmUgc3RyaW5naWZpZWQganNvbi4gUmV0dXJucyBhIGBQcm9taXNlYCBvYmplY3QuXG4gKi9cbkFzeW5jU3RvcmFnZS5tZXJnZUl0ZW0gPSBmdW5jdGlvbihrZXksIHZhbHVlKSB7XG5cbiAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuXG4gICAgdHJ5IHtcbiAgICAgIHZhciBvbGRWYWx1ZSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGtleSk7XG4gICAgICB2YXIgb2xkT2JqID0gSlNPTi5wYXJzZShvbGRWYWx1ZSk7XG4gICAgICB2YXIgbmV3T2JqID0gSlNPTi5wYXJzZSh2YWx1ZSk7XG5cbiAgICAgIC8vIG1lcmdlIGRlZmluZSBpbiB0aGUgZmlsZSBlbmRcbiAgICAgIHZhciBtZXJnZWRPYmogPSBtZXJnZShvbGRPYmosIG5ld09iaik7XG5cbiAgICAgIGxvY2FsU3RvcmFnZS5zZXRJdGVtKGtleSwgSlNPTi5zdHJpbmdpZnkobWVyZ2VkT2JqKSk7XG4gICAgICByZXNvbHZlKCk7XG5cbiAgICB9IGNhdGNoIChlcnIpIHtcbiAgICAgIHJlamVjdChlcnIpO1xuICAgIH1cblxuICB9KTtcblxufTtcblxuLyoqXG4gKiBHZXRzICphbGwqIGtleXMga25vd24gdG8gdGhlIHN5c3RlbSwgZm9yIGFsbCBjYWxsZXJzLCBsaWJyYXJpZXMsIGV0Yy4gUmV0dXJucyBhIGBQcm9taXNlYCBvYmplY3QuXG4gKi9cbkFzeW5jU3RvcmFnZS5nZXRBbGxLZXlzID0gZnVuY3Rpb24oKSB7XG5cbiAgdmFyIGtleXMgPSBbXTtcblxuICBmb3IgKHZhciBpID0gMCwgbGVuID0gbG9jYWxTdG9yYWdlLmxlbmd0aDsgaSA8IGxlbjsgKytpKSB7XG4gICAga2V5cy5wdXNoKGxvY2FsU3RvcmFnZS5rZXkoaSkpO1xuICB9XG5cbiAgcmV0dXJuIG5ldyBQcm9taXNlKGZ1bmN0aW9uKHJlc29sdmUsIHJlamVjdCkge1xuICAgIHJlc29sdmUoa2V5cyk7XG4gIH0pO1xuXG59O1xuXG4vKipcbiAqIFRoZSBmb2xsb3dpbmcgYmF0Y2hlZCBmdW5jdGlvbnMgYXJlIHVzZWZ1bCBmb3IgZXhlY3V0aW5nIGEgbG90IG9mXG4gKiBvcGVyYXRpb25zIGF0IG9uY2UsIGFsbG93aW5nIGZvciBuYXRpdmUgb3B0aW1pemF0aW9ucyBhbmQgcHJvdmlkZSB0aGVcbiAqIGNvbnZlbmllbmNlIG9mIGEgc2luZ2xlIGNhbGxiYWNrIGFmdGVyIGFsbCBvcGVyYXRpb25zIGFyZSBjb21wbGV0ZS5cbiAqXG4gKiBUaGVzZSBmdW5jdGlvbnMgcmV0dXJuIGFycmF5cyBvZiBlcnJvcnMsIHBvdGVudGlhbGx5IG9uZSBmb3IgZXZlcnkga2V5LlxuICogRm9yIGtleS1zcGVjaWZpYyBlcnJvcnMsIHRoZSBFcnJvciBvYmplY3Qgd2lsbCBoYXZlIGEga2V5IHByb3BlcnR5IHRvXG4gKiBpbmRpY2F0ZSB3aGljaCBrZXkgY2F1c2VkIHRoZSBlcnJvci5cbiAqL1xuXG4vKipcbiAqIG11bHRpR2V0IGludm9rZXMgY2FsbGJhY2sgd2l0aCBhbiBhcnJheSBvZiBrZXktdmFsdWUgcGFpciBhcnJheXMgdGhhdFxuICogbWF0Y2hlcyB0aGUgaW5wdXQgZm9ybWF0IG9mIG11bHRpU2V0LiBSZXR1cm5zIGEgYFByb21pc2VgIG9iamVjdC5cbiAqXG4gKiAgIG11bHRpR2V0KFsnazEnLCAnazInXSwgY2IpIC0+IGNiKFtbJ2sxJywgJ3ZhbDEnXSwgWydrMicsICd2YWwyJ11dKVxuICovXG5Bc3luY1N0b3JhZ2UubXVsdGlHZXQgPSBmdW5jdGlvbigpIHtcblxuICB2YXIga2V5cyA9IFtdLnNwbGljZS5jYWxsKGFyZ3VtZW50cyk7XG4gIHZhciByZXN1bHRzID0gbnVsbDtcblxuICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG5cbiAgICB0cnkge1xuXG4gICAgICByZXN1bHRzID0ga2V5cy5tYXAoZnVuY3Rpb24oa2V5KSB7XG4gICAgICAgIHJldHVybiBbXG4gICAgICAgICAga2V5LCBsb2NhbFN0b3JhZ2UuZ2V0SXRlbShrZXkpXG4gICAgICAgIF07XG4gICAgICB9KTtcblxuICAgICAgcmVzb2x2ZShyZXN1bHRzKTtcblxuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgcmVqZWN0KGVycik7XG4gICAgfVxuXG4gIH0pO1xufTtcblxuLyoqXG4gKiBtdWx0aVNldCBhbmQgbXVsdGlNZXJnZSB0YWtlIGFycmF5cyBvZiBrZXktdmFsdWUgYXJyYXkgcGFpcnMgdGhhdCBtYXRjaFxuICogdGhlIG91dHB1dCBvZiBtdWx0aUdldCwgZS5nLiBSZXR1cm5zIGEgYFByb21pc2VgIG9iamVjdC5cbiAqXG4gKiAgIG11bHRpU2V0KFtbJ2sxJywgJ3ZhbDEnXSwgWydrMicsICd2YWwyJ11dLCBjYik7XG4gKi9cbkFzeW5jU3RvcmFnZS5tdWx0aVNldCA9IGZ1bmN0aW9uKCkge1xuXG4gIHZhciBhcmdzID0gW10uc3BsaWNlLmNhbGwoYXJndW1lbnRzKTtcblxuICByZXR1cm4gbmV3IFByb21pc2UoZnVuY3Rpb24ocmVzb2x2ZSwgcmVqZWN0KSB7XG5cbiAgICB0cnkge1xuXG4gICAgICBhcmdzLmZvckVhY2goZnVuY3Rpb24oaXRlbSkge1xuICAgICAgICByZXR1cm4gbG9jYWxTdG9yYWdlLnNldEl0ZW0oaXRlbVswXSwgaXRlbVsxXSk7XG4gICAgICB9KTtcblxuICAgICAgcmVzb2x2ZSgpO1xuXG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICByZWplY3QoZXJyKTtcbiAgICB9XG5cbiAgfSk7XG5cbn07XG5cbi8qKlxuICogRGVsZXRlIGFsbCB0aGUga2V5cyBpbiB0aGUgYGtleXNgIGFycmF5LiBSZXR1cm5zIGEgYFByb21pc2VgIG9iamVjdC5cbiAqL1xuQXN5bmNTdG9yYWdlLm11bHRpUmVtb3ZlID0gZnVuY3Rpb24oKSB7XG5cbiAgdmFyIGtleXMgPSBbXS5zcGxpY2UuY2FsbChhcmd1bWVudHMpO1xuXG4gIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcblxuICAgIHRyeSB7XG5cbiAgICAgIGtleXMuZm9yRWFjaChmdW5jdGlvbihrZXkpIHtcbiAgICAgICAgcmV0dXJuIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKGtleSk7XG4gICAgICB9KTtcblxuICAgICAgcmVzb2x2ZSgpO1xuXG4gICAgfSBjYXRjaCAoZXJyKSB7XG4gICAgICByZWplY3QoZXJyKTtcbiAgICB9XG5cbiAgfSk7XG59O1xuXG4vKipcbiAqIE1lcmdlcyBleGlzdGluZyB2YWx1ZXMgd2l0aCBpbnB1dCB2YWx1ZXMsIGFzc3VtaW5nIHRoZXkgYXJlIHN0cmluZ2lmaWVkXG4gKiBqc29uLiBSZXR1cm5zIGEgYFByb21pc2VgIG9iamVjdC5cbiAqXG4gKiBOb3Qgc3VwcG9ydGVkIGJ5IGFsbCBuYXRpdmUgaW1wbGVtZW50YXRpb25zLlxuICovXG5Bc3luY1N0b3JhZ2UubXVsdGlNZXJnZSA9IGZ1bmN0aW9uKCkge1xuXG4gIHZhciBzZWxmID0gdGhpcztcbiAgdmFyIGFyZ3MgPSBbXS5zcGxpY2UuY2FsbChhcmd1bWVudHMpO1xuXG4gIHJldHVybiBuZXcgUHJvbWlzZShmdW5jdGlvbihyZXNvbHZlLCByZWplY3QpIHtcbiAgICB0cnkge1xuICAgICAgdmFyIHByb21pc2VRdWV1ZSA9IGFyZ3MubWFwKGZ1bmN0aW9uKGFyZykge1xuICAgICAgICByZXR1cm4gc2VsZi5tZXJnZUl0ZW0oYXJnWzBdLCBhcmdbMV0pO1xuICAgICAgfSk7XG4gICAgICByZXNvbHZlKFByb21pc2UuYWxsKHByb21pc2VRdWV1ZSkpO1xuICAgIH0gY2F0Y2ggKGVycikge1xuICAgICAgcmVqZWN0KGVycik7XG4gICAgfVxuXG4gIH0pO1xuXG59O1xuXG5tb2R1bGUuZXhwb3J0cyA9IEFzeW5jU3RvcmFnZTtcbiJdfQ==