




'use strict';

var _getVendorPropertyName=require('domkit/getVendorPropertyName');var _getVendorPropertyName2=_interopRequireDefault(_getVendorPropertyName);
var _CSSProperty=require('./CSSProperty');var _CSSProperty2=_interopRequireDefault(_CSSProperty);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}

var shorthandProperties={
margin:true,
padding:true,
borderWidth:true,
borderRadius:true};



var numberProperties={
lineHeight:true};


var boxProperties={
paddingHorizontal:true,
paddingVertical:true,
marginHorizontal:true,
marginVertical:true};


var borderProperties={
borderColor:true,
borderWidth:true,
borderTopColor:true,
borderRightColor:true,
borderBottomColor:true,
borderLeftColor:true,
borderTopWidth:true,
borderRightWidth:true,
borderBottomWidth:true,
borderLeftWidth:true};



var flexboxProperties={
flex:'WebkitBoxFlex',
order:'WebkitBoxOrdinalGroup',

flexDirection:'WebkitBoxOrient',

alignItems:'WebkitBoxAlign',

justifyContent:'WebkitBoxPack',
flexWrap:null,
alignSelf:null};


var oldFlexboxValues={
'flex-end':'end',
'flex-start':'start',
'space-between':'justify',
'space-around':'distribute'};


var builtinStyle=document.createElement('div').style;
var flexboxSpec;
if('alignSelf'in builtinStyle)flexboxSpec='final';else
if('webkitAlignSelf'in builtinStyle)flexboxSpec='finalVendor';else
flexboxSpec='2009';


var isUCBrowser=/UCBrowser/i.test(navigator.userAgent);
if(isUCBrowser)flexboxSpec='2009';

var isIE=

global.navigator.userAgent.indexOf("MSIE ")>0||

!global.ActiveXObject&&"ActiveXObject"in global;

var isSafari=
navigator.userAgent.indexOf('Safari')!==-1&&
navigator.userAgent.indexOf('Chrome')===-1;


function prefixOldFlexbox(property,value,result){

if(flexboxSpec==='2009'){
var oldValue=oldFlexboxValues[value]||value;
var oldProperty=flexboxProperties[property]||property;
if(oldProperty==='WebkitBoxOrient'){

if(value.indexOf('row')!=-1){
oldValue='horizontal';
}else{
oldValue='vertical';
}

var dir='';
if(value.indexOf('reverse')!=-1){
dir='reverse';
}else{
dir='normal';
}
result.WebkitBoxDirection=dir;
}
return result[oldProperty]=oldValue;

}else if(flexboxSpec==='finalVendor'){
return result[(0,_getVendorPropertyName2.default)(property)]=value;

}else{
return result[property]=value;

}
}








var FLEX_AUTO='1 1 auto';
var FLEX_INITIAL='0 1 auto';
var DEFAULT_BASIS=isIE||isSafari?'auto':'0%';
var DEFAULT_SHRINK=isSafari?'0':'1';

function getFlexExpansion(style){

var flex=style.flex;
if(flex==null){
if(style.flexGrow==null&&style.flexShrink==null&&style.flexBasis==null){
return FLEX_INITIAL;
}


var grow=style.flexGrow||'0';
var shrink=style.flexShrink||DEFAULT_SHRINK;
var basis=style.flexBasis||DEFAULT_BASIS;
return grow+' '+shrink+' '+basis;
}



if(!isNaN(flex)){
return flex+' '+DEFAULT_SHRINK+' '+DEFAULT_BASIS;
}


if(flex==='auto'){
return FLEX_AUTO;
}else if(flex==='initial'){
return FLEX_INITIAL;
}


return flex;
}

function defaultFlexExpansion(style,result){
result.flex=getFlexExpansion(style);
}

function extendBoxProperties(property,value,result){
var padding='padding';
var margin='margin';
var horizontal='Horizontal';
var vertical='Vertical';
var type=property.indexOf(margin)==0?margin:padding;
var directionType=property.indexOf(vertical)!==-1?vertical:horizontal;

if(directionType==horizontal){
result[type+'Left']=result[type+'Right']=value;
}else if(directionType==vertical){
result[type+'Top']=result[type+'Bottom']=value;
}
}

function isValidValue(value){
return value!==''&&value!==null&&value!==undefined;
}

function processValueForProp(value,prop){

if(typeof value=='number'){

if(!_CSSProperty2.default.isUnitlessNumber[prop]&&value>0&&value<1){
value=1;
}


if(numberProperties[prop]&&typeof value=='number'){
value+='px';
}
}






if(shorthandProperties[prop]&&typeof value=='string'){
value=value.replace(/\d*\.?\d+(rem|em|in|cm|mm|pt|pc|px|vh|vw|vmin|vmax|%)*/g,function(val,unit){
return unit?val:val+'px';
});
}

return value;
}

function defaultBorderStyle(style,result){
if(!style.borderStyle&&!result.borderStyle){
result.borderStyle='solid';
}

if(!style.borderWidth&&!result.borderWidth){
result.borderWidth=0;
}

if(!style.borderColor&&!result.borderColor){
result.borderColor='black';
}
}

function extendProperties(style){
var result={};

for(var property in style){
var value=style[property];
if(!isValidValue(value)){
continue;
}

if(borderProperties[property]){
defaultBorderStyle(style,result);
}

if(boxProperties[property]){
extendBoxProperties(property,value,result);
}else if(flexboxProperties[property]){
prefixOldFlexbox(property,value,result);
if(property==='flex'){
defaultFlexExpansion(style,result);
}
}else{
value=processValueForProp(value,property);
property=(0,_getVendorPropertyName2.default)(property);
result[property]=value;
}
}

return result;
}

module.exports=extendProperties;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImV4dGVuZFByb3BlcnRpZXMud2ViLmpzIl0sIm5hbWVzIjpbInNob3J0aGFuZFByb3BlcnRpZXMiLCJtYXJnaW4iLCJwYWRkaW5nIiwiYm9yZGVyV2lkdGgiLCJib3JkZXJSYWRpdXMiLCJudW1iZXJQcm9wZXJ0aWVzIiwibGluZUhlaWdodCIsImJveFByb3BlcnRpZXMiLCJwYWRkaW5nSG9yaXpvbnRhbCIsInBhZGRpbmdWZXJ0aWNhbCIsIm1hcmdpbkhvcml6b250YWwiLCJtYXJnaW5WZXJ0aWNhbCIsImJvcmRlclByb3BlcnRpZXMiLCJib3JkZXJDb2xvciIsImJvcmRlclRvcENvbG9yIiwiYm9yZGVyUmlnaHRDb2xvciIsImJvcmRlckJvdHRvbUNvbG9yIiwiYm9yZGVyTGVmdENvbG9yIiwiYm9yZGVyVG9wV2lkdGgiLCJib3JkZXJSaWdodFdpZHRoIiwiYm9yZGVyQm90dG9tV2lkdGgiLCJib3JkZXJMZWZ0V2lkdGgiLCJmbGV4Ym94UHJvcGVydGllcyIsImZsZXgiLCJvcmRlciIsImZsZXhEaXJlY3Rpb24iLCJhbGlnbkl0ZW1zIiwianVzdGlmeUNvbnRlbnQiLCJmbGV4V3JhcCIsImFsaWduU2VsZiIsIm9sZEZsZXhib3hWYWx1ZXMiLCJidWlsdGluU3R5bGUiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJzdHlsZSIsImZsZXhib3hTcGVjIiwiaXNVQ0Jyb3dzZXIiLCJ0ZXN0IiwibmF2aWdhdG9yIiwidXNlckFnZW50IiwiaXNJRSIsImdsb2JhbCIsImluZGV4T2YiLCJBY3RpdmVYT2JqZWN0IiwiaXNTYWZhcmkiLCJwcmVmaXhPbGRGbGV4Ym94IiwicHJvcGVydHkiLCJ2YWx1ZSIsInJlc3VsdCIsIm9sZFZhbHVlIiwib2xkUHJvcGVydHkiLCJkaXIiLCJXZWJraXRCb3hEaXJlY3Rpb24iLCJGTEVYX0FVVE8iLCJGTEVYX0lOSVRJQUwiLCJERUZBVUxUX0JBU0lTIiwiREVGQVVMVF9TSFJJTksiLCJnZXRGbGV4RXhwYW5zaW9uIiwiZmxleEdyb3ciLCJmbGV4U2hyaW5rIiwiZmxleEJhc2lzIiwiZ3JvdyIsInNocmluayIsImJhc2lzIiwiaXNOYU4iLCJkZWZhdWx0RmxleEV4cGFuc2lvbiIsImV4dGVuZEJveFByb3BlcnRpZXMiLCJob3Jpem9udGFsIiwidmVydGljYWwiLCJ0eXBlIiwiZGlyZWN0aW9uVHlwZSIsImlzVmFsaWRWYWx1ZSIsInVuZGVmaW5lZCIsInByb2Nlc3NWYWx1ZUZvclByb3AiLCJwcm9wIiwiaXNVbml0bGVzc051bWJlciIsInJlcGxhY2UiLCJ2YWwiLCJ1bml0IiwiZGVmYXVsdEJvcmRlclN0eWxlIiwiYm9yZGVyU3R5bGUiLCJleHRlbmRQcm9wZXJ0aWVzIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFLQTs7QUFFQSxtRTtBQUNBLDBDOztBQUVBLEdBQUlBLHFCQUFzQjtBQUN4QkMsT0FBUSxJQURnQjtBQUV4QkMsUUFBUyxJQUZlO0FBR3hCQyxZQUFhLElBSFc7QUFJeEJDLGFBQWMsSUFKVSxDQUExQjs7OztBQVFBLEdBQUlDLGtCQUFtQjtBQUNyQkMsV0FBWSxJQURTLENBQXZCOzs7QUFJQSxHQUFJQyxlQUFnQjtBQUNsQkMsa0JBQW1CLElBREQ7QUFFbEJDLGdCQUFpQixJQUZDO0FBR2xCQyxpQkFBa0IsSUFIQTtBQUlsQkMsZUFBZ0IsSUFKRSxDQUFwQjs7O0FBT0EsR0FBSUMsa0JBQW1CO0FBQ3JCQyxZQUFhLElBRFE7QUFFckJWLFlBQWEsSUFGUTtBQUdyQlcsZUFBZ0IsSUFISztBQUlyQkMsaUJBQWtCLElBSkc7QUFLckJDLGtCQUFtQixJQUxFO0FBTXJCQyxnQkFBaUIsSUFOSTtBQU9yQkMsZUFBZ0IsSUFQSztBQVFyQkMsaUJBQWtCLElBUkc7QUFTckJDLGtCQUFtQixJQVRFO0FBVXJCQyxnQkFBaUIsSUFWSSxDQUF2Qjs7OztBQWNBLEdBQUlDLG1CQUFvQjtBQUN0QkMsS0FBTSxlQURnQjtBQUV0QkMsTUFBTyx1QkFGZTs7QUFJdEJDLGNBQWUsaUJBSk87O0FBTXRCQyxX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OlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTUtcHJlc2VudCwgQWxpYmFiYSBHcm91cCBIb2xkaW5nIExpbWl0ZWQuXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICpcbiAqL1xuJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgZ2V0VmVuZG9yUHJvcGVydHlOYW1lIGZyb20gJ2RvbWtpdC9nZXRWZW5kb3JQcm9wZXJ0eU5hbWUnO1xuaW1wb3J0IENTU1Byb3BlcnR5IGZyb20gJ0NTU1Byb3BlcnR5JztcblxudmFyIHNob3J0aGFuZFByb3BlcnRpZXMgPSB7XG4gIG1hcmdpbjogdHJ1ZSxcbiAgcGFkZGluZzogdHJ1ZSxcbiAgYm9yZGVyV2lkdGg6IHRydWUsXG4gIGJvcmRlclJhZGl1czogdHJ1ZSxcbn07XG5cbi8vIHNvbWUgbnVtYmVyIHRoYXQgcmVhY3Qgbm90IGF1dG8gYWRkIHB4XG52YXIgbnVtYmVyUHJvcGVydGllcyA9IHtcbiAgbGluZUhlaWdodDogdHJ1ZVxufTtcblxudmFyIGJveFByb3BlcnRpZXMgPSB7XG4gIHBhZGRpbmdIb3Jpem9udGFsOiB0cnVlLFxuICBwYWRkaW5nVmVydGljYWw6IHRydWUsXG4gIG1hcmdpbkhvcml6b250YWw6IHRydWUsXG4gIG1hcmdpblZlcnRpY2FsOiB0cnVlLFxufTtcblxudmFyIGJvcmRlclByb3BlcnRpZXMgPSB7XG4gIGJvcmRlckNvbG9yOiB0cnVlLFxuICBib3JkZXJXaWR0aDogdHJ1ZSxcbiAgYm9yZGVyVG9wQ29sb3I6IHRydWUsXG4gIGJvcmRlclJpZ2h0Q29sb3I6IHRydWUsXG4gIGJvcmRlckJvdHRvbUNvbG9yOiB0cnVlLFxuICBib3JkZXJMZWZ0Q29sb3I6IHRydWUsXG4gIGJvcmRlclRvcFdpZHRoOiB0cnVlLFxuICBib3JkZXJSaWdodFdpZHRoOiB0cnVlLFxuICBib3JkZXJCb3R0b21XaWR0aDogdHJ1ZSxcbiAgYm9yZGVyTGVmdFdpZHRoOiB0cnVlLFxufTtcblxuLy8gcHJlZml4IDIwMDkgc3BlY1xudmFyIGZsZXhib3hQcm9wZXJ0aWVzID0ge1xuICBmbGV4OiAnV2Via2l0Qm94RmxleCcsXG4gIG9yZGVyOiAnV2Via2l0Qm94T3JkaW5hbEdyb3VwJyxcbiAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3Bvc3Rjc3MvYXV0b3ByZWZpeGVyL2Jsb2IvbWFzdGVyL2xpYi9oYWNrcy9mbGV4LWRpcmVjdGlvbi5jb2ZmZWVcbiAgZmxleERpcmVjdGlvbjogJ1dlYmtpdEJveE9yaWVudCcsXG4gIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9wb3N0Y3NzL2F1dG9wcmVmaXhlci9ibG9iL21hc3Rlci9saWIvaGFja3MvYWxpZ24taXRlbXMuY29mZmVlXG4gIGFsaWduSXRlbXM6ICdXZWJraXRCb3hBbGlnbicsXG4gIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9wb3N0Y3NzL2F1dG9wcmVmaXhlci9ibG9iL21hc3Rlci9saWIvaGFja3MvanVzdGlmeS1jb250ZW50LmNvZmZlZVxuICBqdXN0aWZ5Q29udGVudDogJ1dlYmtpdEJveFBhY2snLFxuICBmbGV4V3JhcDogbnVsbCxcbiAgYWxpZ25TZWxmOiBudWxsLFxufTtcblxudmFyIG9sZEZsZXhib3hWYWx1ZXMgPSB7XG4gICdmbGV4LWVuZCc6ICdlbmQnLFxuICAnZmxleC1zdGFydCc6ICdzdGFydCcsXG4gICdzcGFjZS1iZXR3ZWVuJzogJ2p1c3RpZnknLFxuICAnc3BhY2UtYXJvdW5kJzogJ2Rpc3RyaWJ1dGUnLFxufTtcblxudmFyIGJ1aWx0aW5TdHlsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpLnN0eWxlO1xudmFyIGZsZXhib3hTcGVjO1xuaWYgKCdhbGlnblNlbGYnIGluIGJ1aWx0aW5TdHlsZSkgZmxleGJveFNwZWMgPSAnZmluYWwnO1xuZWxzZSBpZiAoJ3dlYmtpdEFsaWduU2VsZicgaW4gYnVpbHRpblN0eWxlKSBmbGV4Ym94U3BlYyA9ICdmaW5hbFZlbmRvcic7XG5lbHNlIGZsZXhib3hTcGVjID0gJzIwMDknO1xuXG4vLyBGSVhNRTogVUNCcm93c2VyIGlzIGNoZWF0XG52YXIgaXNVQ0Jyb3dzZXIgPSAvVUNCcm93c2VyL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KTtcbmlmIChpc1VDQnJvd3NlcikgZmxleGJveFNwZWMgPSAnMjAwOSc7XG5cbnZhciBpc0lFID1cbiAgLy8gSUUgPD0gMTBcbiAgZ2xvYmFsLm5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZihcIk1TSUUgXCIpID4gMCB8fFxuICAvLyBJRTExXG4gICEoZ2xvYmFsLkFjdGl2ZVhPYmplY3QpICYmIFwiQWN0aXZlWE9iamVjdFwiIGluIGdsb2JhbFxuXG52YXIgaXNTYWZhcmkgPVxuICBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoJ1NhZmFyaScpICE9PSAtMSAmJlxuICBuYXZpZ2F0b3IudXNlckFnZW50LmluZGV4T2YoJ0Nocm9tZScpID09PSAtMVxuXG4vLyBUT0RPOiBjYWNoZSB0aGUgcmVzdWx0XG5mdW5jdGlvbiBwcmVmaXhPbGRGbGV4Ym94KHByb3BlcnR5LCB2YWx1ZSwgcmVzdWx0KSB7XG5cbiAgaWYgKGZsZXhib3hTcGVjID09PSAnMjAwOScpIHtcbiAgICB2YXIgb2xkVmFsdWUgPSBvbGRGbGV4Ym94VmFsdWVzW3ZhbHVlXSB8fCB2YWx1ZTtcbiAgICB2YXIgb2xkUHJvcGVydHkgPSBmbGV4Ym94UHJvcGVydGllc1twcm9wZXJ0eV0gfHwgcHJvcGVydHk7XG4gICAgaWYgKG9sZFByb3BlcnR5ID09PSAnV2Via2l0Qm94T3JpZW50Jykge1xuICAgICAgLy8gYm94T3JpZW50XG4gICAgICBpZiAodmFsdWUuaW5kZXhPZigncm93JykgIT0gLTEpIHtcbiAgICAgICAgb2xkVmFsdWUgPSAnaG9yaXpvbnRhbCc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBvbGRWYWx1ZSA9ICd2ZXJ0aWNhbCc7XG4gICAgICB9XG4gICAgICAvLyBib3hEaXJlY3Rpb25cbiAgICAgIHZhciBkaXIgPSAnJztcbiAgICAgIGlmICh2YWx1ZS5pbmRleE9mKCdyZXZlcnNlJykgIT0gLTEpIHtcbiAgICAgICAgZGlyID0gJ3JldmVyc2UnO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZGlyID0gJ25vcm1hbCc7XG4gICAgICB9XG4gICAgICByZXN1bHQuV2Via2l0Qm94RGlyZWN0aW9uID0gZGlyO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0W29sZFByb3BlcnR5XSA9IG9sZFZhbHVlO1xuXG4gIH0gZWxzZSBpZiAoZmxleGJveFNwZWMgPT09ICdmaW5hbFZlbmRvcicpIHtcbiAgICByZXR1cm4gcmVzdWx0W2dldFZlbmRvclByb3BlcnR5TmFtZShwcm9wZXJ0eSldID0gdmFsdWU7XG5cbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gcmVzdWx0W3Byb3BlcnR5XSA9IHZhbHVlO1xuXG4gIH1cbn1cblxuLy8gaHR0cHM6Ly9naXRodWIuY29tL3BoaWxpcHdhbHRvbi9mbGV4YnVnc1xuLy8gICAgIERlY2xhcmF0aW9uICAgICAgICAgICBXaGF0IGl0IHNob3VsZCBtZWFuICAgICBXaGF0IGl0IG1lYW5zIGluIElFIDEwXG4vLyAxLiAgKG5vIGZsZXggZGVjbGFyYXRpb24pIGZsZXg6IDAgMSBhdXRvICAgICAgICAgIGZsZXg6IDAgMCBhdXRvXG4vLyAyLiAgZmxleDogMSAgICAgICAgICAgICAgIGZsZXg6IDEgMSAwJSAgICAgICAgICAgIGZsZXg6IDEgMCAwcHhcbi8vIDMuICBmbGV4OiBhdXRvICAgICAgICAgICAgZmxleDogMSAxIGF1dG8gICAgICAgICAgZmxleDogMSAwIGF1dG9cbi8vIDQuICBmbGV4OiBpbml0aWFsICAgICAgICAgZmxleDogMCAxIGF1dG8gICAgICAgICAgZmxleDogMCAwIGF1dG9cblxuY29uc3QgRkxFWF9BVVRPID0gJzEgMSBhdXRvJ1xuY29uc3QgRkxFWF9JTklUSUFMID0gJzAgMSBhdXRvJ1xuY29uc3QgREVGQVVMVF9CQVNJUyA9IGlzSUUgfHwgaXNTYWZhcmkgPyAnYXV0bycgOiAnMCUnXG5jb25zdCBERUZBVUxUX1NIUklOSyA9IGlzU2FmYXJpID8gJzAnIDogJzEnXG5cbmZ1bmN0aW9uIGdldEZsZXhFeHBhbnNpb24gKHN0eWxlKSB7XG4gIC8vIGh0dHBzOi8vcm9sYW5kLmNvZGVzL2Jsb2cvaWUtZmxleC1jb2xsYXBzZS1idWcvXG4gIGNvbnN0IGZsZXggPSBzdHlsZS5mbGV4XG4gIGlmIChmbGV4ID09IG51bGwpIHtcbiAgICBpZiAoc3R5bGUuZmxleEdyb3cgPT0gbnVsbCAmJiBzdHlsZS5mbGV4U2hyaW5rID09IG51bGwgJiYgc3R5bGUuZmxleEJhc2lzID09IG51bGwpIHtcbiAgICAgIHJldHVybiBGTEVYX0lOSVRJQUxcbiAgICB9XG5cbiAgICAvLyBeIGxpbmUgMVxuICAgIGNvbnN0IGdyb3cgPSBzdHlsZS5mbGV4R3JvdyB8fCAnMCdcbiAgICBjb25zdCBzaHJpbmsgPSBzdHlsZS5mbGV4U2hyaW5rIHx8IERFRkFVTFRfU0hSSU5LXG4gICAgY29uc3QgYmFzaXMgPSBzdHlsZS5mbGV4QmFzaXMgfHwgREVGQVVMVF9CQVNJU1xuICAgIHJldHVybiBgJHtncm93fSAke3Nocmlua30gJHtiYXNpc31gXG4gIH1cblxuICAvLyBeIGxpbmUgMlxuICAvLyBpZiBmbGV4IGlzIGEgbnVtYmVyIG9yIGEgc3RyaW5naWZpZWQgbnVtYmVyXG4gIGlmICghaXNOYU4oZmxleCkpIHtcbiAgICByZXR1cm4gYCR7ZmxleH0gJHtERUZBVUxUX1NIUklOS30gJHtERUZBVUxUX0JBU0lTfWBcbiAgfVxuXG4gIC8vIF4gbGluZXMgMywgNFxuICBpZiAoZmxleCA9PT0gJ2F1dG8nKSB7XG4gICAgcmV0dXJuIEZMRVhfQVVUT1xuICB9IGVsc2UgaWYgKGZsZXggPT09ICdpbml0aWFsJykge1xuICAgIHJldHVybiBGTEVYX0lOSVRJQUxcbiAgfVxuXG4gIC8vIGZsZXggd2FzIHNldCBleHBsaWNpdGx5XG4gIHJldHVybiBmbGV4XG59XG5cbmZ1bmN0aW9uIGRlZmF1bHRGbGV4RXhwYW5zaW9uIChzdHlsZSwgcmVzdWx0KSB7XG4gIHJlc3VsdC5mbGV4ID0gZ2V0RmxleEV4cGFuc2lvbihzdHlsZSlcbn1cblxuZnVuY3Rpb24gZXh0ZW5kQm94UHJvcGVydGllcyhwcm9wZXJ0eSwgdmFsdWUsIHJlc3VsdCkge1xuICB2YXIgcGFkZGluZyA9ICdwYWRkaW5nJztcbiAgdmFyIG1hcmdpbiA9ICdtYXJnaW4nO1xuICB2YXIgaG9yaXpvbnRhbCA9ICdIb3Jpem9udGFsJztcbiAgdmFyIHZlcnRpY2FsID0gJ1ZlcnRpY2FsJztcbiAgdmFyIHR5cGUgPSBwcm9wZXJ0eS5pbmRleE9mKG1hcmdpbikgPT0gMCA/IG1hcmdpbiA6IHBhZGRpbmc7XG4gIHZhciBkaXJlY3Rpb25UeXBlID0gcHJvcGVydHkuaW5kZXhPZih2ZXJ0aWNhbCkgIT09IC0xID8gdmVydGljYWwgOiBob3Jpem9udGFsO1xuXG4gIGlmIChkaXJlY3Rpb25UeXBlID09IGhvcml6b250YWwpIHtcbiAgICByZXN1bHRbdHlwZSArICdMZWZ0J10gPSByZXN1bHRbdHlwZSArICdSaWdodCddID0gdmFsdWU7XG4gIH0gZWxzZSBpZiAoZGlyZWN0aW9uVHlwZSA9PSB2ZXJ0aWNhbCkge1xuICAgIHJlc3VsdFt0eXBlICsgJ1RvcCddID0gcmVzdWx0W3R5cGUgKyAnQm90dG9tJ10gPSB2YWx1ZTtcbiAgfVxufVxuXG5mdW5jdGlvbiBpc1ZhbGlkVmFsdWUodmFsdWUpIHtcbiAgcmV0dXJuIHZhbHVlICE9PSAnJyAmJiB2YWx1ZSAhPT0gbnVsbCAmJiB2YWx1ZSAhPT0gdW5kZWZpbmVkO1xufVxuXG5mdW5jdGlvbiBwcm9jZXNzVmFsdWVGb3JQcm9wKHZhbHVlLCBwcm9wKSB7XG5cbiAgaWYgKHR5cGVvZiB2YWx1ZSA9PSAnbnVtYmVyJykge1xuICAgIC8vIHRyYW5zZm9ybSBsZXNzIHRoZW4gMXB4IHZhbHVlIHRvIDFweCwgMC41IHRvIGJlIDFcbiAgICBpZiAoIUNTU1Byb3BlcnR5LmlzVW5pdGxlc3NOdW1iZXJbcHJvcF0gJiYgdmFsdWUgPiAwICYmIHZhbHVlIDwgMSkge1xuICAgICAgdmFsdWUgPSAxO1xuICAgIH1cblxuICAgIC8vIEFkZCBweCB0byBudW1lcmljIHZhbHVlc1xuICAgIGlmIChudW1iZXJQcm9wZXJ0aWVzW3Byb3BdICYmIHR5cGVvZiB2YWx1ZSA9PSAnbnVtYmVyJykge1xuICAgICAgdmFsdWUgKz0gJ3B4JztcbiAgICB9XG4gIH1cblxuICAvLyBbXG4gIC8vICAge3NjYWxlWDogMn0sXG4gIC8vICAge3NjYWxlWTogMn1cbiAgLy8gXSA9PiBzY2FsZVgoMikgc2NhbGVZKDIpXG5cbiAgaWYgKHNob3J0aGFuZFByb3BlcnRpZXNbcHJvcF0gJiYgdHlwZW9mIHZhbHVlID09ICdzdHJpbmcnKSB7XG4gICAgdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKC9cXGQqXFwuP1xcZCsocmVtfGVtfGlufGNtfG1tfHB0fHBjfHB4fHZofHZ3fHZtaW58dm1heHwlKSovZywgZnVuY3Rpb24odmFsLCB1bml0KSB7XG4gICAgICByZXR1cm4gdW5pdCA/IHZhbCA6IHZhbCArICdweCc7XG4gICAgfSk7XG4gIH1cblxuICByZXR1cm4gdmFsdWU7XG59XG5cbmZ1bmN0aW9uIGRlZmF1bHRCb3JkZXJTdHlsZShzdHlsZSwgcmVzdWx0KSB7XG4gIGlmICghc3R5bGUuYm9yZGVyU3R5bGUgJiYgIXJlc3VsdC5ib3JkZXJTdHlsZSkge1xuICAgIHJlc3VsdC5ib3JkZXJTdHlsZSA9ICdzb2xpZCc7XG4gIH1cblxuICBpZiAoIXN0eWxlLmJvcmRlcldpZHRoICYmICFyZXN1bHQuYm9yZGVyV2lkdGgpIHtcbiAgICByZXN1bHQuYm9yZGVyV2lkdGggPSAwO1xuICB9XG5cbiAgaWYgKCFzdHlsZS5ib3JkZXJDb2xvciAmJiAhcmVzdWx0LmJvcmRlckNvbG9yKSB7XG4gICAgcmVzdWx0LmJvcmRlckNvbG9yID0gJ2JsYWNrJztcbiAgfVxufVxuXG5mdW5jdGlvbiBleHRlbmRQcm9wZXJ0aWVzKHN0eWxlKSB7XG4gIHZhciByZXN1bHQgPSB7fTtcblxuICBmb3IgKHZhciBwcm9wZXJ0eSBpbiBzdHlsZSkge1xuICAgIHZhciB2YWx1ZSA9IHN0eWxlW3Byb3BlcnR5XTtcbiAgICBpZiAoIWlzVmFsaWRWYWx1ZSh2YWx1ZSkpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICAvLyBzZXQgYSBkZWZhdWx0IGJvcmRlciBzdHlsZSBpZiB0aGVyZSBoYXMgYm9yZGVyIGFib3V0IHByb3BlcnR5XG4gICAgaWYgKGJvcmRlclByb3BlcnRpZXNbcHJvcGVydHldKSB7XG4gICAgICBkZWZhdWx0Qm9yZGVyU3R5bGUoc3R5bGUsIHJlc3VsdCk7XG4gICAgfVxuXG4gICAgaWYgKGJveFByb3BlcnRpZXNbcHJvcGVydHldKSB7XG4gICAgICBleHRlbmRCb3hQcm9wZXJ0aWVzKHByb3BlcnR5LCB2YWx1ZSwgcmVzdWx0KTtcbiAgICB9IGVsc2UgaWYgKGZsZXhib3hQcm9wZXJ0aWVzW3Byb3BlcnR5XSkge1xuICAgICAgcHJlZml4T2xkRmxleGJveChwcm9wZXJ0eSwgdmFsdWUsIHJlc3VsdCk7XG4gICAgICBpZiAocHJvcGVydHkgPT09ICdmbGV4Jykge1xuICAgICAgICBkZWZhdWx0RmxleEV4cGFuc2lvbihzdHlsZSwgcmVzdWx0KTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgdmFsdWUgPSBwcm9jZXNzVmFsdWVGb3JQcm9wKHZhbHVlLCBwcm9wZXJ0eSk7XG4gICAgICBwcm9wZXJ0eSA9IGdldFZlbmRvclByb3BlcnR5TmFtZShwcm9wZXJ0eSk7XG4gICAgICByZXN1bHRbcHJvcGVydHldID0gdmFsdWU7XG4gICAgfVxuICB9XG5cbiAgcmV0dXJuIHJlc3VsdDtcbn1cblxubW9kdWxlLmV4cG9ydHMgPSBleHRlbmRQcm9wZXJ0aWVzO1xuIl19