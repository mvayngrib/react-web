




'use strict';

var _getVendorPropertyName=require('domkit/getVendorPropertyName');var _getVendorPropertyName2=_interopRequireDefault(_getVendorPropertyName);
var _CSSProperty=require('./CSSProperty');var _CSSProperty2=_interopRequireDefault(_CSSProperty);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}

var shorthandProperties={
margin:true,
padding:true,
borderWidth:true,
borderRadius:true};



var numberProperties={
lineHeight:true};


var boxProperties={
paddingHorizontal:true,
paddingVertical:true,
marginHorizontal:true,
marginVertical:true};


var borderProperties={
borderColor:true,
borderWidth:true,
borderTopColor:true,
borderRightColor:true,
borderBottomColor:true,
borderLeftColor:true,
borderTopWidth:true,
borderRightWidth:true,
borderBottomWidth:true,
borderLeftWidth:true};



var flexboxProperties={
flex:'WebkitBoxFlex',
order:'WebkitBoxOrdinalGroup',

flexDirection:'WebkitBoxOrient',

alignItems:'WebkitBoxAlign',

justifyContent:'WebkitBoxPack',
flexWrap:null,
alignSelf:null};


var oldFlexboxValues={
'flex-end':'end',
'flex-start':'start',
'space-between':'justify',
'space-around':'distribute'};


var builtinStyle=document.createElement('div').style;
var flexboxSpec;
if('alignSelf'in builtinStyle)flexboxSpec='final';else
if('webkitAlignSelf'in builtinStyle)flexboxSpec='finalVendor';else
flexboxSpec='2009';


var isUCBrowser=/UCBrowser/i.test(navigator.userAgent);
if(isUCBrowser)flexboxSpec='2009';


function prefixOldFlexbox(property,value,result){

if(flexboxSpec==='2009'){
var oldValue=oldFlexboxValues[value]||value;
var oldProperty=flexboxProperties[property]||property;
if(oldProperty==='WebkitBoxOrient'){

if(value.indexOf('row')!=-1){
oldValue='horizontal';
}else{
oldValue='vertical';
}

var dir='';
if(value.indexOf('reverse')!=-1){
dir='reverse';
}else{
dir='normal';
}
result.WebkitBoxDirection=dir;
}
return result[oldProperty]=oldValue;

}else if(flexboxSpec==='finalVendor'){
return result[(0,_getVendorPropertyName2.default)(property)]=value;

}else{
return result[property]=value;

}
}

function defaultFlexExpansion(style,result){
var grow=style.flex;
var shrink=style.flexShrink!=null?style.flexShrink:1;
var basis=style.flexBasis!=null?style.flexBasis:'auto';
result.flex=grow+' '+shrink+' '+basis;
}

function extendBoxProperties(property,value,result){
var padding='padding';
var margin='margin';
var horizontal='Horizontal';
var vertical='Vertical';
var type=property.indexOf(margin)==0?margin:padding;
var directionType=property.indexOf(vertical)!==-1?vertical:horizontal;

if(directionType==horizontal){
result[type+'Left']=result[type+'Right']=value;
}else if(directionType==vertical){
result[type+'Top']=result[type+'Bottom']=value;
}
}

function isValidValue(value){
return value!==''&&value!==null&&value!==undefined;
}

function processValueForProp(value,prop){

if(typeof value=='number'){

if(!_CSSProperty2.default.isUnitlessNumber[prop]&&value>0&&value<1){
value=1;
}


if(numberProperties[prop]&&typeof value=='number'){
value+='px';
}
}






if(shorthandProperties[prop]&&typeof value=='string'){
value=value.replace(/\d*\.?\d+(rem|em|in|cm|mm|pt|pc|px|vh|vw|vmin|vmax|%)*/g,function(val,unit){
return unit?val:val+'px';
});
}

return value;
}

function defaultBorderStyle(style,result){
if(!style.borderStyle&&!result.borderStyle){
result.borderStyle='solid';
}

if(!style.borderWidth&&!result.borderWidth){
result.borderWidth=0;
}

if(!style.borderColor&&!result.borderColor){
result.borderColor='black';
}
}

function extendProperties(style){
var result={};

for(var property in style){
var value=style[property];
if(!isValidValue(value)){
continue;
}

if(borderProperties[property]){
defaultBorderStyle(style,result);
}

if(boxProperties[property]){
extendBoxProperties(property,value,result);
}else if(flexboxProperties[property]){
prefixOldFlexbox(property,value,result);
if(property==='flex'){
defaultFlexExpansion(style,result);
}
}else{
value=processValueForProp(value,property);
property=(0,_getVendorPropertyName2.default)(property);
result[property]=value;
}
}

return result;
}

module.exports=extendProperties;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImV4dGVuZFByb3BlcnRpZXMud2ViLmpzIl0sIm5hbWVzIjpbInNob3J0aGFuZFByb3BlcnRpZXMiLCJtYXJnaW4iLCJwYWRkaW5nIiwiYm9yZGVyV2lkdGgiLCJib3JkZXJSYWRpdXMiLCJudW1iZXJQcm9wZXJ0aWVzIiwibGluZUhlaWdodCIsImJveFByb3BlcnRpZXMiLCJwYWRkaW5nSG9yaXpvbnRhbCIsInBhZGRpbmdWZXJ0aWNhbCIsIm1hcmdpbkhvcml6b250YWwiLCJtYXJnaW5WZXJ0aWNhbCIsImJvcmRlclByb3BlcnRpZXMiLCJib3JkZXJDb2xvciIsImJvcmRlclRvcENvbG9yIiwiYm9yZGVyUmlnaHRDb2xvciIsImJvcmRlckJvdHRvbUNvbG9yIiwiYm9yZGVyTGVmdENvbG9yIiwiYm9yZGVyVG9wV2lkdGgiLCJib3JkZXJSaWdodFdpZHRoIiwiYm9yZGVyQm90dG9tV2lkdGgiLCJib3JkZXJMZWZ0V2lkdGgiLCJmbGV4Ym94UHJvcGVydGllcyIsImZsZXgiLCJvcmRlciIsImZsZXhEaXJlY3Rpb24iLCJhbGlnbkl0ZW1zIiwianVzdGlmeUNvbnRlbnQiLCJmbGV4V3JhcCIsImFsaWduU2VsZiIsIm9sZEZsZXhib3hWYWx1ZXMiLCJidWlsdGluU3R5bGUiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJzdHlsZSIsImZsZXhib3hTcGVjIiwiaXNVQ0Jyb3dzZXIiLCJ0ZXN0IiwibmF2aWdhdG9yIiwidXNlckFnZW50IiwicHJlZml4T2xkRmxleGJveCIsInByb3BlcnR5IiwidmFsdWUiLCJyZXN1bHQiLCJvbGRWYWx1ZSIsIm9sZFByb3BlcnR5IiwiaW5kZXhPZiIsImRpciIsIldlYmtpdEJveERpcmVjdGlvbiIsImRlZmF1bHRGbGV4RXhwYW5zaW9uIiwiZ3JvdyIsInNocmluayIsImZsZXhTaHJpbmsiLCJiYXNpcyIsImZsZXhCYXNpcyIsImV4dGVuZEJveFByb3BlcnRpZXMiLCJob3Jpem9udGFsIiwidmVydGljYWwiLCJ0eXBlIiwiZGlyZWN0aW9uVHlwZSIsImlzVmFsaWRWYWx1ZSIsInVuZGVmaW5lZCIsInByb2Nlc3NWYWx1ZUZvclByb3AiLCJwcm9wIiwiaXNVbml0bGVzc051bWJlciIsInJlcGxhY2UiLCJ2YWwiLCJ1bml0IiwiZGVmYXVsdEJvcmRlclN0eWxlIiwiYm9yZGVyU3R5bGUiLCJleHRlbmRQcm9wZXJ0aWVzIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFLQTs7QUFFQSxtRTtBQUNBLDBDOztBQUVBLEdBQUlBLHFCQUFzQjtBQUN4QkMsT0FBUSxJQURnQjtBQUV4QkMsUUFBUyxJQUZlO0FBR3hCQyxZQUFhLElBSFc7QUFJeEJDLGFBQWMsSUFKVSxDQUExQjs7OztBQVFBLEdBQUlDLGtCQUFtQjtBQUNyQkMsV0FBWSxJQURTLENBQXZCOzs7QUFJQSxHQUFJQyxlQUFnQjtBQUNsQkMsa0JBQW1CLElBREQ7QUFFbEJDLGdCQUFpQixJQUZDO0FBR2xCQyxpQkFBa0IsSUFIQTtBQUlsQkMsZUFBZ0IsSUFKRSxDQUFwQjs7O0FBT0EsR0FBSUMsa0JBQW1CO0FBQ3JCQyxZQUFhLElBRFE7QUFFckJWLFlBQWEsSUFGUTtBQUdyQlcsZUFBZ0IsSUFISztBQUlyQkMsaUJBQWtCLElBSkc7QUFLckJDLGtCQUFtQixJQUxFO0FBTXJCQyxnQkFBaUIsSUFOSTtBQU9yQkMsZUFBZ0IsSUFQSztBQVFyQkMsaUJBQWtCLElBUkc7QUFTckJDLGtCQUFtQixJQVRFO0FBVXJCQyxnQkFBaUIsSUFWSSxDQUF2Qjs7OztBQWNBLEdBQUlDLG1CQUFvQjtBQUN0QkMsS0FBTSxlQURnQjtBQUV0QkMsTUFBTyx1QkFGZTs7QUFJdEJDLGNBQWUsaUJBSk87O0FBTXRCQyxXQUFZLGdCQU5VOztBQVF0QkMsZUFBZ0IsZUFSTTtBQVN0QkMsU0FBVSxJQVRZO0FBVXRCQyxVQUFXLElBVlcsQ0FBeEI7OztBQWFBLEdBQUlDLGtCQUFtQjtBQUNyQixXQUFZLEtBRFM7QUFFckIsYUFBYyxPQUZPO0FBR3JCLGdCQUFpQixTQUhJO0FB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LE9BQU85QixXQUFsQyxDQUErQztBQUM3QzhCLE9BQU85QixXQUFQLENBQXFCLE9BQXJCO0FBQ0Q7QUFDRjs7QUFFRCxRQUFTeUQsaUJBQVQsQ0FBMEJwQyxLQUExQixDQUFpQztBQUMvQixHQUFJUyxRQUFTLEVBQWI7O0FBRUEsSUFBSyxHQUFJRixTQUFULEdBQXFCUCxNQUFyQixDQUE0QjtBQUMxQixHQUFJUSxPQUFRUixNQUFNTyxRQUFOLENBQVo7QUFDQSxHQUFJLENBQUNtQixhQUFhbEIsS0FBYixDQUFMLENBQTBCO0FBQ3hCO0FBQ0Q7O0FBRUQsR0FBSTlCLGlCQUFpQjZCLFFBQWpCLENBQUosQ0FBZ0M7QUFDOUIyQixtQkFBbUJsQyxLQUFuQixDQUEwQlMsTUFBMUI7QUFDRDs7QUFFRCxHQUFJcEMsY0FBY2tDLFFBQWQsQ0FBSixDQUE2QjtBQUMzQmMsb0JBQW9CZCxRQUFwQixDQUE4QkMsS0FBOUIsQ0FBcUNDLE1BQXJDO0FBQ0QsQ0FGRCxJQUVPLElBQUlyQixrQkFBa0JtQixRQUFsQixDQUFKLENBQWlDO0FBQ3RDRCxpQkFBaUJDLFFBQWpCLENBQTJCQyxLQUEzQixDQUFrQ0MsTUFBbEM7QUFDQSxHQUFJRixXQUFhLE1BQWpCLENBQXlCO0FBQ3ZCUSxxQkFBcUJmLEtBQXJCLENBQTRCUyxNQUE1QjtBQUNEO0FBQ0YsQ0FMTSxJQUtBO0FBQ0xELE1BQVFvQixvQkFBb0JwQixLQUFwQixDQUEyQkQsUUFBM0IsQ0FBUjtBQUNBQSxTQUFXLG9DQUFzQkEsUUFBdEIsQ0FBWDtBQUNBRSxPQUFPRixRQUFQLEVBQW1CQyxLQUFuQjtBQUNEO0FBQ0Y7O0FBRUQsTUFBT0MsT0FBUDtBQUNEOztBQUVENEIsT0FBT0MsT0FBUCxDQUFpQkYsZ0JBQWpCIiwiZmlsZSI6ImV4dGVuZFByb3BlcnRpZXMud2ViLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTUtcHJlc2VudCwgQWxpYmFiYSBHcm91cCBIb2xkaW5nIExpbWl0ZWQuXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICpcbiAqL1xuJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgZ2V0VmVuZG9yUHJvcGVydHlOYW1lIGZyb20gJ2RvbWtpdC9nZXRWZW5kb3JQcm9wZXJ0eU5hbWUnO1xuaW1wb3J0IENTU1Byb3BlcnR5IGZyb20gJ0NTU1Byb3BlcnR5JztcblxudmFyIHNob3J0aGFuZFByb3BlcnRpZXMgPSB7XG4gIG1hcmdpbjogdHJ1ZSxcbiAgcGFkZGluZzogdHJ1ZSxcbiAgYm9yZGVyV2lkdGg6IHRydWUsXG4gIGJvcmRlclJhZGl1czogdHJ1ZSxcbn07XG5cbi8vIHNvbWUgbnVtYmVyIHRoYXQgcmVhY3Qgbm90IGF1dG8gYWRkIHB4XG52YXIgbnVtYmVyUHJvcGVydGllcyA9IHtcbiAgbGluZUhlaWdodDogdHJ1ZVxufTtcblxudmFyIGJveFByb3BlcnRpZXMgPSB7XG4gIHBhZGRpbmdIb3Jpem9udGFsOiB0cnVlLFxuICBwYWRkaW5nVmVydGljYWw6IHRydWUsXG4gIG1hcmdpbkhvcml6b250YWw6IHRydWUsXG4gIG1hcmdpblZlcnRpY2FsOiB0cnVlLFxufTtcblxudmFyIGJvcmRlclByb3BlcnRpZXMgPSB7XG4gIGJvcmRlckNvbG9yOiB0cnVlLFxuICBib3JkZXJXaWR0aDogdHJ1ZSxcbiAgYm9yZGVyVG9wQ29sb3I6IHRydWUsXG4gIGJvcmRlclJpZ2h0Q29sb3I6IHRydWUsXG4gIGJvcmRlckJvdHRvbUNvbG9yOiB0cnVlLFxuICBib3JkZXJMZWZ0Q29sb3I6IHRydWUsXG4gIGJvcmRlclRvcFdpZHRoOiB0cnVlLFxuICBib3JkZXJSaWdodFdpZHRoOiB0cnVlLFxuICBib3JkZXJCb3R0b21XaWR0aDogdHJ1ZSxcbiAgYm9yZGVyTGVmdFdpZHRoOiB0cnVlLFxufTtcblxuLy8gcHJlZml4IDIwMDkgc3BlY1xudmFyIGZsZXhib3hQcm9wZXJ0aWVzID0ge1xuICBmbGV4OiAnV2Via2l0Qm94RmxleCcsXG4gIG9yZGVyOiAnV2Via2l0Qm94T3JkaW5hbEdyb3VwJyxcbiAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3Bvc3Rjc3MvYXV0b3ByZWZpeGVyL2Jsb2IvbWFzdGVyL2xpYi9oYWNrcy9mbGV4LWRpcmVjdGlvbi5jb2ZmZWVcbiAgZmxleERpcmVjdGlvbjogJ1dlYmtpdEJveE9yaWVudCcsXG4gIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9wb3N0Y3NzL2F1dG9wcmVmaXhlci9ibG9iL21hc3Rlci9saWIvaGFja3MvYWxpZ24taXRlbXMuY29mZmVlXG4gIGFsaWduSXRlbXM6ICdXZWJraXRCb3hBbGlnbicsXG4gIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9wb3N0Y3NzL2F1dG9wcmVmaXhlci9ibG9iL21hc3Rlci9saWIvaGFja3MvanVzdGlmeS1jb250ZW50LmNvZmZlZVxuICBqdXN0aWZ5Q29udGVudDogJ1dlYmtpdEJveFBhY2snLFxuICBmbGV4V3JhcDogbnVsbCxcbiAgYWxpZ25TZWxmOiBudWxsLFxufTtcblxudmFyIG9sZEZsZXhib3hWYWx1ZXMgPSB7XG4gICdmbGV4LWVuZCc6ICdlbmQnLFxuICAnZmxleC1zdGFydCc6ICdzdGFydCcsXG4gICdzcGFjZS1iZXR3ZWVuJzogJ2p1c3RpZnknLFxuICAnc3BhY2UtYXJvdW5kJzogJ2Rpc3RyaWJ1dGUnLFxufTtcblxudmFyIGJ1aWx0aW5TdHlsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpLnN0eWxlO1xudmFyIGZsZXhib3hTcGVjO1xuaWYgKCdhbGlnblNlbGYnIGluIGJ1aWx0aW5TdHlsZSkgZmxleGJveFNwZWMgPSAnZmluYWwnO1xuZWxzZSBpZiAoJ3dlYmtpdEFsaWduU2VsZicgaW4gYnVpbHRpblN0eWxlKSBmbGV4Ym94U3BlYyA9ICdmaW5hbFZlbmRvcic7XG5lbHNlIGZsZXhib3hTcGVjID0gJzIwMDknO1xuXG4vLyBGSVhNRTogVUNCcm93c2VyIGlzIGNoZWF0XG52YXIgaXNVQ0Jyb3dzZXIgPSAvVUNCcm93c2VyL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KTtcbmlmIChpc1VDQnJvd3NlcikgZmxleGJveFNwZWMgPSAnMjAwOSc7XG5cbi8vIFRPRE86IGNhY2hlIHRoZSByZXN1bHRcbmZ1bmN0aW9uIHByZWZpeE9sZEZsZXhib3gocHJvcGVydHksIHZhbHVlLCByZXN1bHQpIHtcblxuICBpZiAoZmxleGJveFNwZWMgPT09ICcyMDA5Jykge1xuICAgIHZhciBvbGRWYWx1ZSA9IG9sZEZsZXhib3hWYWx1ZXNbdmFsdWVdIHx8IHZhbHVlO1xuICAgIHZhciBvbGRQcm9wZXJ0eSA9IGZsZXhib3hQcm9wZXJ0aWVzW3Byb3BlcnR5XSB8fCBwcm9wZXJ0eTtcbiAgICBpZiAob2xkUHJvcGVydHkgPT09ICdXZWJraXRCb3hPcmllbnQnKSB7XG4gICAgICAvLyBib3hPcmllbnRcbiAgICAgIGlmICh2YWx1ZS5pbmRleE9mKCdyb3cnKSAhPSAtMSkge1xuICAgICAgICBvbGRWYWx1ZSA9ICdob3Jpem9udGFsJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG9sZFZhbHVlID0gJ3ZlcnRpY2FsJztcbiAgICAgIH1cbiAgICAgIC8vIGJveERpcmVjdGlvblxuICAgICAgdmFyIGRpciA9ICcnO1xuICAgICAgaWYgKHZhbHVlLmluZGV4T2YoJ3JldmVyc2UnKSAhPSAtMSkge1xuICAgICAgICBkaXIgPSAncmV2ZXJzZSc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBkaXIgPSAnbm9ybWFsJztcbiAgICAgIH1cbiAgICAgIHJlc3VsdC5XZWJraXRCb3hEaXJlY3Rpb24gPSBkaXI7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHRbb2xkUHJvcGVydHldID0gb2xkVmFsdWU7XG5cbiAgfSBlbHNlIGlmIChmbGV4Ym94U3BlYyA9PT0gJ2ZpbmFsVmVuZG9yJykge1xuICAgIHJldHVybiByZXN1bHRbZ2V0VmVuZG9yUHJvcGVydHlOYW1lKHByb3BlcnR5KV0gPSB2YWx1ZTtcblxuICB9IGVsc2Uge1xuICAgIHJldHVybiByZXN1bHRbcHJvcGVydHldID0gdmFsdWU7XG5cbiAgfVxufVxuXG5mdW5jdGlvbiBkZWZhdWx0RmxleEV4cGFuc2lvbiAoc3R5bGUsIHJlc3VsdCkge1xuICBjb25zdCBncm93ID0gc3R5bGUuZmxleFxuICBjb25zdCBzaHJpbmsgPSBzdHlsZS5mbGV4U2hyaW5rICE9IG51bGwgPyBzdHlsZS5mbGV4U2hyaW5rIDogMVxuICBjb25zdCBiYXNpcyA9IHN0eWxlLmZsZXhCYXNpcyAhPSBudWxsID8gc3R5bGUuZmxleEJhc2lzIDogJ2F1dG8nXG4gIHJlc3VsdC5mbGV4ID0gYCR7Z3Jvd30gJHtzaHJpbmt9ICR7YmFzaXN9YFxufVxuXG5mdW5jdGlvbiBleHRlbmRCb3hQcm9wZXJ0aWVzKHByb3BlcnR5LCB2YWx1ZSwgcmVzdWx0KSB7XG4gIHZhciBwYWRkaW5nID0gJ3BhZGRpbmcnO1xuICB2YXIgbWFyZ2luID0gJ21hcmdpbic7XG4gIHZhciBob3Jpem9udGFsID0gJ0hvcml6b250YWwnO1xuICB2YXIgdmVydGljYWwgPSAnVmVydGljYWwnO1xuICB2YXIgdHlwZSA9IHByb3BlcnR5LmluZGV4T2YobWFyZ2luKSA9PSAwID8gbWFyZ2luIDogcGFkZGluZztcbiAgdmFyIGRpcmVjdGlvblR5cGUgPSBwcm9wZXJ0eS5pbmRleE9mKHZlcnRpY2FsKSAhPT0gLTEgPyB2ZXJ0aWNhbCA6IGhvcml6b250YWw7XG5cbiAgaWYgKGRpcmVjdGlvblR5cGUgPT0gaG9yaXpvbnRhbCkge1xuICAgIHJlc3VsdFt0eXBlICsgJ0xlZnQnXSA9IHJlc3VsdFt0eXBlICsgJ1JpZ2h0J10gPSB2YWx1ZTtcbiAgfSBlbHNlIGlmIChkaXJlY3Rpb25UeXBlID09IHZlcnRpY2FsKSB7XG4gICAgcmVzdWx0W3R5cGUgKyAnVG9wJ10gPSByZXN1bHRbdHlwZSArICdCb3R0b20nXSA9IHZhbHVlO1xuICB9XG59XG5cbmZ1bmN0aW9uIGlzVmFsaWRWYWx1ZSh2YWx1ZSkge1xuICByZXR1cm4gdmFsdWUgIT09ICcnICYmIHZhbHVlICE9PSBudWxsICYmIHZhbHVlICE9PSB1bmRlZmluZWQ7XG59XG5cbmZ1bmN0aW9uIHByb2Nlc3NWYWx1ZUZvclByb3AodmFsdWUsIHByb3ApIHtcblxuICBpZiAodHlwZW9mIHZhbHVlID09ICdudW1iZXInKSB7XG4gICAgLy8gdHJhbnNmb3JtIGxlc3MgdGhlbiAxcHggdmFsdWUgdG8gMXB4LCAwLjUgdG8gYmUgMVxuICAgIGlmICghQ1NTUHJvcGVydHkuaXNVbml0bGVzc051bWJlcltwcm9wXSAmJiB2YWx1ZSA+IDAgJiYgdmFsdWUgPCAxKSB7XG4gICAgICB2YWx1ZSA9IDE7XG4gICAgfVxuXG4gICAgLy8gQWRkIHB4IHRvIG51bWVyaWMgdmFsdWVzXG4gICAgaWYgKG51bWJlclByb3BlcnRpZXNbcHJvcF0gJiYgdHlwZW9mIHZhbHVlID09ICdudW1iZXInKSB7XG4gICAgICB2YWx1ZSArPSAncHgnO1xuICAgIH1cbiAgfVxuXG4gIC8vIFtcbiAgLy8gICB7c2NhbGVYOiAyfSxcbiAgLy8gICB7c2NhbGVZOiAyfVxuICAvLyBdID0+IHNjYWxlWCgyKSBzY2FsZVkoMilcblxuICBpZiAoc2hvcnRoYW5kUHJvcGVydGllc1twcm9wXSAmJiB0eXBlb2YgdmFsdWUgPT0gJ3N0cmluZycpIHtcbiAgICB2YWx1ZSA9IHZhbHVlLnJlcGxhY2UoL1xcZCpcXC4/XFxkKyhyZW18ZW18aW58Y218bW18cHR8cGN8cHh8dmh8dnd8dm1pbnx2bWF4fCUpKi9nLCBmdW5jdGlvbih2YWwsIHVuaXQpIHtcbiAgICAgIHJldHVybiB1bml0ID8gdmFsIDogdmFsICsgJ3B4JztcbiAgICB9KTtcbiAgfVxuXG4gIHJldHVybiB2YWx1ZTtcbn1cblxuZnVuY3Rpb24gZGVmYXVsdEJvcmRlclN0eWxlKHN0eWxlLCByZXN1bHQpIHtcbiAgaWYgKCFzdHlsZS5ib3JkZXJTdHlsZSAmJiAhcmVzdWx0LmJvcmRlclN0eWxlKSB7XG4gICAgcmVzdWx0LmJvcmRlclN0eWxlID0gJ3NvbGlkJztcbiAgfVxuXG4gIGlmICghc3R5bGUuYm9yZGVyV2lkdGggJiYgIXJlc3VsdC5ib3JkZXJXaWR0aCkge1xuICAgIHJlc3VsdC5ib3JkZXJXaWR0aCA9IDA7XG4gIH1cblxuICBpZiAoIXN0eWxlLmJvcmRlckNvbG9yICYmICFyZXN1bHQuYm9yZGVyQ29sb3IpIHtcbiAgICByZXN1bHQuYm9yZGVyQ29sb3IgPSAnYmxhY2snO1xuICB9XG59XG5cbmZ1bmN0aW9uIGV4dGVuZFByb3BlcnRpZXMoc3R5bGUpIHtcbiAgdmFyIHJlc3VsdCA9IHt9O1xuXG4gIGZvciAodmFyIHByb3BlcnR5IGluIHN0eWxlKSB7XG4gICAgdmFyIHZhbHVlID0gc3R5bGVbcHJvcGVydHldO1xuICAgIGlmICghaXNWYWxpZFZhbHVlKHZhbHVlKSkge1xuICAgICAgY29udGludWU7XG4gICAgfVxuICAgIC8vIHNldCBhIGRlZmF1bHQgYm9yZGVyIHN0eWxlIGlmIHRoZXJlIGhhcyBib3JkZXIgYWJvdXQgcHJvcGVydHlcbiAgICBpZiAoYm9yZGVyUHJvcGVydGllc1twcm9wZXJ0eV0pIHtcbiAgICAgIGRlZmF1bHRCb3JkZXJTdHlsZShzdHlsZSwgcmVzdWx0KTtcbiAgICB9XG5cbiAgICBpZiAoYm94UHJvcGVydGllc1twcm9wZXJ0eV0pIHtcbiAgICAgIGV4dGVuZEJveFByb3BlcnRpZXMocHJvcGVydHksIHZhbHVlLCByZXN1bHQpO1xuICAgIH0gZWxzZSBpZiAoZmxleGJveFByb3BlcnRpZXNbcHJvcGVydHldKSB7XG4gICAgICBwcmVmaXhPbGRGbGV4Ym94KHByb3BlcnR5LCB2YWx1ZSwgcmVzdWx0KTtcbiAgICAgIGlmIChwcm9wZXJ0eSA9PT0gJ2ZsZXgnKSB7XG4gICAgICAgIGRlZmF1bHRGbGV4RXhwYW5zaW9uKHN0eWxlLCByZXN1bHQpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICB2YWx1ZSA9IHByb2Nlc3NWYWx1ZUZvclByb3AodmFsdWUsIHByb3BlcnR5KTtcbiAgICAgIHByb3BlcnR5ID0gZ2V0VmVuZG9yUHJvcGVydHlOYW1lKHByb3BlcnR5KTtcbiAgICAgIHJlc3VsdFtwcm9wZXJ0eV0gPSB2YWx1ZTtcbiAgICB9XG4gIH1cblxuICByZXR1cm4gcmVzdWx0O1xufVxuXG5tb2R1bGUuZXhwb3J0cyA9IGV4dGVuZFByb3BlcnRpZXM7XG4iXX0=