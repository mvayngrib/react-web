




'use strict';

var _getVendorPropertyName=require('domkit/getVendorPropertyName');var _getVendorPropertyName2=_interopRequireDefault(_getVendorPropertyName);
var _CSSProperty=require('./CSSProperty');var _CSSProperty2=_interopRequireDefault(_CSSProperty);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}

var shorthandProperties={
margin:true,
padding:true,
borderWidth:true,
borderRadius:true};



var numberProperties={
lineHeight:true};


var boxProperties={
paddingHorizontal:true,
paddingVertical:true,
marginHorizontal:true,
marginVertical:true};


var borderProperties={
borderColor:true,
borderWidth:true,
borderTopColor:true,
borderRightColor:true,
borderBottomColor:true,
borderLeftColor:true,
borderTopWidth:true,
borderRightWidth:true,
borderBottomWidth:true,
borderLeftWidth:true};



var flexboxProperties={
flex:'WebkitBoxFlex',
order:'WebkitBoxOrdinalGroup',

flexDirection:'WebkitBoxOrient',

alignItems:'WebkitBoxAlign',

justifyContent:'WebkitBoxPack',
flexWrap:null,
alignSelf:null};


var oldFlexboxValues={
'flex-end':'end',
'flex-start':'start',
'space-between':'justify',
'space-around':'distribute'};


var builtinStyle=document.createElement('div').style;
var flexboxSpec;
if('alignSelf'in builtinStyle)flexboxSpec='final';else
if('webkitAlignSelf'in builtinStyle)flexboxSpec='finalVendor';else
flexboxSpec='2009';


var isUCBrowser=/UCBrowser/i.test(navigator.userAgent);
if(isUCBrowser)flexboxSpec='2009';

var isIE=

global.navigator.userAgent.indexOf("MSIE ")>0||

!global.ActiveXObject&&"ActiveXObject"in global;



function prefixOldFlexbox(property,value,result){

if(flexboxSpec==='2009'){
var oldValue=oldFlexboxValues[value]||value;
var oldProperty=flexboxProperties[property]||property;
if(oldProperty==='WebkitBoxOrient'){

if(value.indexOf('row')!=-1){
oldValue='horizontal';
}else{
oldValue='vertical';
}

var dir='';
if(value.indexOf('reverse')!=-1){
dir='reverse';
}else{
dir='normal';
}
result.WebkitBoxDirection=dir;
}
return result[oldProperty]=oldValue;

}else if(flexboxSpec==='finalVendor'){
return result[(0,_getVendorPropertyName2.default)(property)]=value;

}else{
return result[property]=value;

}
}








var FLEX_AUTO='1 1 auto';
var FLEX_INITIAL='0 1 auto';

function getFlexExpansion(style){

var defaultBasis=isIE?'auto':'0%';
var flex=style.flex;
if(flex==null){
if(style.flexGrow==null&&style.flexShrink==null&&style.flexBasis==null){
return FLEX_INITIAL;
}


var grow=style.flexGrow||'0';
var shrink=style.flexShrink||'1';
var basis=style.flexBasis||defaultBasis;
return grow+' '+shrink+' '+basis;
}



if(!isNaN(flex)){
return flex+' 1 '+defaultBasis;
}


if(flex==='auto'){
return FLEX_AUTO;
}else if(flex==='initial'){
return FLEX_INITIAL;
}


return flex;
}

function defaultFlexExpansion(style,result){
result.flex=getFlexExpansion(style);
}

function extendBoxProperties(property,value,result){
var padding='padding';
var margin='margin';
var horizontal='Horizontal';
var vertical='Vertical';
var type=property.indexOf(margin)==0?margin:padding;
var directionType=property.indexOf(vertical)!==-1?vertical:horizontal;

if(directionType==horizontal){
result[type+'Left']=result[type+'Right']=value;
}else if(directionType==vertical){
result[type+'Top']=result[type+'Bottom']=value;
}
}

function isValidValue(value){
return value!==''&&value!==null&&value!==undefined;
}

function processValueForProp(value,prop){

if(typeof value=='number'){

if(!_CSSProperty2.default.isUnitlessNumber[prop]&&value>0&&value<1){
value=1;
}


if(numberProperties[prop]&&typeof value=='number'){
value+='px';
}
}






if(shorthandProperties[prop]&&typeof value=='string'){
value=value.replace(/\d*\.?\d+(rem|em|in|cm|mm|pt|pc|px|vh|vw|vmin|vmax|%)*/g,function(val,unit){
return unit?val:val+'px';
});
}

return value;
}

function defaultBorderStyle(style,result){
if(!style.borderStyle&&!result.borderStyle){
result.borderStyle='solid';
}

if(!style.borderWidth&&!result.borderWidth){
result.borderWidth=0;
}

if(!style.borderColor&&!result.borderColor){
result.borderColor='black';
}
}

function extendProperties(style){
var result={};

for(var property in style){
var value=style[property];
if(!isValidValue(value)){
continue;
}

if(borderProperties[property]){
defaultBorderStyle(style,result);
}

if(boxProperties[property]){
extendBoxProperties(property,value,result);
}else if(flexboxProperties[property]){
prefixOldFlexbox(property,value,result);
if(property==='flex'){
defaultFlexExpansion(style,result);
}
}else{
value=processValueForProp(value,property);
property=(0,_getVendorPropertyName2.default)(property);
result[property]=value;
}
}

return result;
}

module.exports=extendProperties;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImV4dGVuZFByb3BlcnRpZXMud2ViLmpzIl0sIm5hbWVzIjpbInNob3J0aGFuZFByb3BlcnRpZXMiLCJtYXJnaW4iLCJwYWRkaW5nIiwiYm9yZGVyV2lkdGgiLCJib3JkZXJSYWRpdXMiLCJudW1iZXJQcm9wZXJ0aWVzIiwibGluZUhlaWdodCIsImJveFByb3BlcnRpZXMiLCJwYWRkaW5nSG9yaXpvbnRhbCIsInBhZGRpbmdWZXJ0aWNhbCIsIm1hcmdpbkhvcml6b250YWwiLCJtYXJnaW5WZXJ0aWNhbCIsImJvcmRlclByb3BlcnRpZXMiLCJib3JkZXJDb2xvciIsImJvcmRlclRvcENvbG9yIiwiYm9yZGVyUmlnaHRDb2xvciIsImJvcmRlckJvdHRvbUNvbG9yIiwiYm9yZGVyTGVmdENvbG9yIiwiYm9yZGVyVG9wV2lkdGgiLCJib3JkZXJSaWdodFdpZHRoIiwiYm9yZGVyQm90dG9tV2lkdGgiLCJib3JkZXJMZWZ0V2lkdGgiLCJmbGV4Ym94UHJvcGVydGllcyIsImZsZXgiLCJvcmRlciIsImZsZXhEaXJlY3Rpb24iLCJhbGlnbkl0ZW1zIiwianVzdGlmeUNvbnRlbnQiLCJmbGV4V3JhcCIsImFsaWduU2VsZiIsIm9sZEZsZXhib3hWYWx1ZXMiLCJidWlsdGluU3R5bGUiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJzdHlsZSIsImZsZXhib3hTcGVjIiwiaXNVQ0Jyb3dzZXIiLCJ0ZXN0IiwibmF2aWdhdG9yIiwidXNlckFnZW50IiwiaXNJRSIsImdsb2JhbCIsImluZGV4T2YiLCJBY3RpdmVYT2JqZWN0IiwicHJlZml4T2xkRmxleGJveCIsInByb3BlcnR5IiwidmFsdWUiLCJyZXN1bHQiLCJvbGRWYWx1ZSIsIm9sZFByb3BlcnR5IiwiZGlyIiwiV2Via2l0Qm94RGlyZWN0aW9uIiwiRkxFWF9BVVRPIiwiRkxFWF9JTklUSUFMIiwiZ2V0RmxleEV4cGFuc2lvbiIsImRlZmF1bHRCYXNpcyIsImZsZXhHcm93IiwiZmxleFNocmluayIsImZsZXhCYXNpcyIsImdyb3ciLCJzaHJpbmsiLCJiYXNpcyIsImlzTmFOIiwiZGVmYXVsdEZsZXhFeHBhbnNpb24iLCJleHRlbmRCb3hQcm9wZXJ0aWVzIiwiaG9yaXpvbnRhbCIsInZlcnRpY2FsIiwidHlwZSIsImRpcmVjdGlvblR5cGUiLCJpc1ZhbGlkVmFsdWUiLCJ1bmRlZmluZWQiLCJwcm9jZXNzVmFsdWVGb3JQcm9wIiwicHJvcCIsImlzVW5pdGxlc3NOdW1iZXIiLCJyZXBsYWNlIiwidmFsIiwidW5pdCIsImRlZmF1bHRCb3JkZXJTdHlsZSIsImJvcmRlclN0eWxlIiwiZXh0ZW5kUHJvcGVydGllcyIsIm1vZHVsZSIsImV4cG9ydHMiXSwibWFwcGluZ3MiOiI7Ozs7O0FBS0E7O0FBRUEsbUU7QUFDQSwwQzs7QUFFQSxHQUFJQSxxQkFBc0I7QUFDeEJDLE9BQVEsSUFEZ0I7QUFFeEJDLFFBQVMsSUFGZTtBQUd4QkMsWUFBYSxJQUhXO0FBSXhCQyxhQUFjLElBSlUsQ0FBMUI7Ozs7QUFRQSxHQUFJQyxrQkFBbUI7QUFDckJDLFdBQVksSUFEUyxDQUF2Qjs7O0FBSUEsR0FBSUMsZUFBZ0I7QUFDbEJDLGtCQUFtQixJQUREO0FBRWxCQyxnQkFBaUIsSUFGQztBQUdsQkMsaUJBQWtCLElBSEE7QUFJbEJDLGVBQWdCLElBSkUsQ0FBcEI7OztBQU9BLEdBQUlDLGtCQUFtQjtBQUNyQkMsWUFBYSxJQURRO0FBRXJCVixZQUFhLElBRlE7QUFHckJXLGVBQWdCLElBSEs7QUFJckJDLGlCQUFrQixJQUpHO0FBS3JCQyxrQkFBbUIsSUFMRTtBQU1yQkMsZ0JBQWlCLElBTkk7QUFPckJDLGVBQWdCLElBUEs7QUFRckJDLGlCQUFrQixJQVJHO0FBU3JCQyxrQkFBbUIsSUFURTtBQVVyQkMsZ0JBQWlCLElBVkksQ0FBdkI7Ozs7QUFjQSxHQUFJQyxtQkFBb0I7QUFDdEJDLEtBQU0sZUFEZ0I7QUFFdEJDLE1BQU8sdUJBRmU7O0FBSXRCQyxjQUFlLGlCQUpPOztBQU10QkMsV0FBWSxnQkFOVTs7QUFRdEJDLGVBQWdCLGVBUk07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LFNBQVQsR0FBcUJYLE1BQXJCLENBQTRCO0FBQzFCLEdBQUlZLE9BQVFaLE1BQU1XLFFBQU4sQ0FBWjtBQUNBLEdBQUksQ0FBQ3dCLGFBQWF2QixLQUFiLENBQUwsQ0FBMEI7QUFDeEI7QUFDRDs7QUFFRCxHQUFJbEMsaUJBQWlCaUMsUUFBakIsQ0FBSixDQUFnQztBQUM5QmdDLG1CQUFtQjNDLEtBQW5CLENBQTBCYSxNQUExQjtBQUNEOztBQUVELEdBQUl4QyxjQUFjc0MsUUFBZCxDQUFKLENBQTZCO0FBQzNCbUIsb0JBQW9CbkIsUUFBcEIsQ0FBOEJDLEtBQTlCLENBQXFDQyxNQUFyQztBQUNELENBRkQsSUFFTyxJQUFJekIsa0JBQWtCdUIsUUFBbEIsQ0FBSixDQUFpQztBQUN0Q0QsaUJBQWlCQyxRQUFqQixDQUEyQkMsS0FBM0IsQ0FBa0NDLE1BQWxDO0FBQ0EsR0FBSUYsV0FBYSxNQUFqQixDQUF5QjtBQUN2QmtCLHFCQUFxQjdCLEtBQXJCLENBQTRCYSxNQUE1QjtBQUNEO0FBQ0YsQ0FMTSxJQUtBO0FBQ0xELE1BQVF5QixvQkFBb0J6QixLQUFwQixDQUEyQkQsUUFBM0IsQ0FBUjtBQUNBQSxTQUFXLG9DQUFzQkEsUUFBdEIsQ0FBWDtBQUNBRSxPQUFPRixRQUFQLEVBQW1CQyxLQUFuQjtBQUNEO0FBQ0Y7O0FBRUQsTUFBT0MsT0FBUDtBQUNEOztBQUVEaUMsT0FBT0MsT0FBUCxDQUFpQkYsZ0JBQWpCIiwiZmlsZSI6ImV4dGVuZFByb3BlcnRpZXMud2ViLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLyoqXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTUtcHJlc2VudCwgQWxpYmFiYSBHcm91cCBIb2xkaW5nIExpbWl0ZWQuXG4gKiBBbGwgcmlnaHRzIHJlc2VydmVkLlxuICpcbiAqL1xuJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgZ2V0VmVuZG9yUHJvcGVydHlOYW1lIGZyb20gJ2RvbWtpdC9nZXRWZW5kb3JQcm9wZXJ0eU5hbWUnO1xuaW1wb3J0IENTU1Byb3BlcnR5IGZyb20gJ0NTU1Byb3BlcnR5JztcblxudmFyIHNob3J0aGFuZFByb3BlcnRpZXMgPSB7XG4gIG1hcmdpbjogdHJ1ZSxcbiAgcGFkZGluZzogdHJ1ZSxcbiAgYm9yZGVyV2lkdGg6IHRydWUsXG4gIGJvcmRlclJhZGl1czogdHJ1ZSxcbn07XG5cbi8vIHNvbWUgbnVtYmVyIHRoYXQgcmVhY3Qgbm90IGF1dG8gYWRkIHB4XG52YXIgbnVtYmVyUHJvcGVydGllcyA9IHtcbiAgbGluZUhlaWdodDogdHJ1ZVxufTtcblxudmFyIGJveFByb3BlcnRpZXMgPSB7XG4gIHBhZGRpbmdIb3Jpem9udGFsOiB0cnVlLFxuICBwYWRkaW5nVmVydGljYWw6IHRydWUsXG4gIG1hcmdpbkhvcml6b250YWw6IHRydWUsXG4gIG1hcmdpblZlcnRpY2FsOiB0cnVlLFxufTtcblxudmFyIGJvcmRlclByb3BlcnRpZXMgPSB7XG4gIGJvcmRlckNvbG9yOiB0cnVlLFxuICBib3JkZXJXaWR0aDogdHJ1ZSxcbiAgYm9yZGVyVG9wQ29sb3I6IHRydWUsXG4gIGJvcmRlclJpZ2h0Q29sb3I6IHRydWUsXG4gIGJvcmRlckJvdHRvbUNvbG9yOiB0cnVlLFxuICBib3JkZXJMZWZ0Q29sb3I6IHRydWUsXG4gIGJvcmRlclRvcFdpZHRoOiB0cnVlLFxuICBib3JkZXJSaWdodFdpZHRoOiB0cnVlLFxuICBib3JkZXJCb3R0b21XaWR0aDogdHJ1ZSxcbiAgYm9yZGVyTGVmdFdpZHRoOiB0cnVlLFxufTtcblxuLy8gcHJlZml4IDIwMDkgc3BlY1xudmFyIGZsZXhib3hQcm9wZXJ0aWVzID0ge1xuICBmbGV4OiAnV2Via2l0Qm94RmxleCcsXG4gIG9yZGVyOiAnV2Via2l0Qm94T3JkaW5hbEdyb3VwJyxcbiAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3Bvc3Rjc3MvYXV0b3ByZWZpeGVyL2Jsb2IvbWFzdGVyL2xpYi9oYWNrcy9mbGV4LWRpcmVjdGlvbi5jb2ZmZWVcbiAgZmxleERpcmVjdGlvbjogJ1dlYmtpdEJveE9yaWVudCcsXG4gIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9wb3N0Y3NzL2F1dG9wcmVmaXhlci9ibG9iL21hc3Rlci9saWIvaGFja3MvYWxpZ24taXRlbXMuY29mZmVlXG4gIGFsaWduSXRlbXM6ICdXZWJraXRCb3hBbGlnbicsXG4gIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9wb3N0Y3NzL2F1dG9wcmVmaXhlci9ibG9iL21hc3Rlci9saWIvaGFja3MvanVzdGlmeS1jb250ZW50LmNvZmZlZVxuICBqdXN0aWZ5Q29udGVudDogJ1dlYmtpdEJveFBhY2snLFxuICBmbGV4V3JhcDogbnVsbCxcbiAgYWxpZ25TZWxmOiBudWxsLFxufTtcblxudmFyIG9sZEZsZXhib3hWYWx1ZXMgPSB7XG4gICdmbGV4LWVuZCc6ICdlbmQnLFxuICAnZmxleC1zdGFydCc6ICdzdGFydCcsXG4gICdzcGFjZS1iZXR3ZWVuJzogJ2p1c3RpZnknLFxuICAnc3BhY2UtYXJvdW5kJzogJ2Rpc3RyaWJ1dGUnLFxufTtcblxudmFyIGJ1aWx0aW5TdHlsZSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2RpdicpLnN0eWxlO1xudmFyIGZsZXhib3hTcGVjO1xuaWYgKCdhbGlnblNlbGYnIGluIGJ1aWx0aW5TdHlsZSkgZmxleGJveFNwZWMgPSAnZmluYWwnO1xuZWxzZSBpZiAoJ3dlYmtpdEFsaWduU2VsZicgaW4gYnVpbHRpblN0eWxlKSBmbGV4Ym94U3BlYyA9ICdmaW5hbFZlbmRvcic7XG5lbHNlIGZsZXhib3hTcGVjID0gJzIwMDknO1xuXG4vLyBGSVhNRTogVUNCcm93c2VyIGlzIGNoZWF0XG52YXIgaXNVQ0Jyb3dzZXIgPSAvVUNCcm93c2VyL2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KTtcbmlmIChpc1VDQnJvd3NlcikgZmxleGJveFNwZWMgPSAnMjAwOSc7XG5cbnZhciBpc0lFID1cbiAgLy8gSUUgPD0gMTBcbiAgZ2xvYmFsLm5hdmlnYXRvci51c2VyQWdlbnQuaW5kZXhPZihcIk1TSUUgXCIpID4gMCB8fFxuICAvLyBJRTExXG4gICEoZ2xvYmFsLkFjdGl2ZVhPYmplY3QpICYmIFwiQWN0aXZlWE9iamVjdFwiIGluIGdsb2JhbFxuXG5cbi8vIFRPRE86IGNhY2hlIHRoZSByZXN1bHRcbmZ1bmN0aW9uIHByZWZpeE9sZEZsZXhib3gocHJvcGVydHksIHZhbHVlLCByZXN1bHQpIHtcblxuICBpZiAoZmxleGJveFNwZWMgPT09ICcyMDA5Jykge1xuICAgIHZhciBvbGRWYWx1ZSA9IG9sZEZsZXhib3hWYWx1ZXNbdmFsdWVdIHx8IHZhbHVlO1xuICAgIHZhciBvbGRQcm9wZXJ0eSA9IGZsZXhib3hQcm9wZXJ0aWVzW3Byb3BlcnR5XSB8fCBwcm9wZXJ0eTtcbiAgICBpZiAob2xkUHJvcGVydHkgPT09ICdXZWJraXRCb3hPcmllbnQnKSB7XG4gICAgICAvLyBib3hPcmllbnRcbiAgICAgIGlmICh2YWx1ZS5pbmRleE9mKCdyb3cnKSAhPSAtMSkge1xuICAgICAgICBvbGRWYWx1ZSA9ICdob3Jpem9udGFsJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG9sZFZhbHVlID0gJ3ZlcnRpY2FsJztcbiAgICAgIH1cbiAgICAgIC8vIGJveERpcmVjdGlvblxuICAgICAgdmFyIGRpciA9ICcnO1xuICAgICAgaWYgKHZhbHVlLmluZGV4T2YoJ3JldmVyc2UnKSAhPSAtMSkge1xuICAgICAgICBkaXIgPSAncmV2ZXJzZSc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBkaXIgPSAnbm9ybWFsJztcbiAgICAgIH1cbiAgICAgIHJlc3VsdC5XZWJraXRCb3hEaXJlY3Rpb24gPSBkaXI7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHRbb2xkUHJvcGVydHldID0gb2xkVmFsdWU7XG5cbiAgfSBlbHNlIGlmIChmbGV4Ym94U3BlYyA9PT0gJ2ZpbmFsVmVuZG9yJykge1xuICAgIHJldHVybiByZXN1bHRbZ2V0VmVuZG9yUHJvcGVydHlOYW1lKHByb3BlcnR5KV0gPSB2YWx1ZTtcblxuICB9IGVsc2Uge1xuICAgIHJldHVybiByZXN1bHRbcHJvcGVydHldID0gdmFsdWU7XG5cbiAgfVxufVxuXG4vLyBodHRwczovL2dpdGh1Yi5jb20vcGhpbGlwd2FsdG9uL2ZsZXhidWdzXG4vLyAgICAgRGVjbGFyYXRpb24gICAgICAgICAgIFdoYXQgaXQgc2hvdWxkIG1lYW4gICAgIFdoYXQgaXQgbWVhbnMgaW4gSUUgMTBcbi8vIDEuICAobm8gZmxleCBkZWNsYXJhdGlvbikgZmxleDogMCAxIGF1dG8gICAgICAgICAgZmxleDogMCAwIGF1dG9cbi8vIDIuICBmbGV4OiAxICAgICAgICAgICAgICAgZmxleDogMSAxIDAlICAgICAgICAgICAgZmxleDogMSAwIDBweFxuLy8gMy4gIGZsZXg6IGF1dG8gICAgICAgICAgICBmbGV4OiAxIDEgYXV0byAgICAgICAgICBmbGV4OiAxIDAgYXV0b1xuLy8gNC4gIGZsZXg6IGluaXRpYWwgICAgICAgICBmbGV4OiAwIDEgYXV0byAgICAgICAgICBmbGV4OiAwIDAgYXV0b1xuXG5jb25zdCBGTEVYX0FVVE8gPSAnMSAxIGF1dG8nXG5jb25zdCBGTEVYX0lOSVRJQUwgPSAnMCAxIGF1dG8nXG5cbmZ1bmN0aW9uIGdldEZsZXhFeHBhbnNpb24gKHN0eWxlKSB7XG4gIC8vIGh0dHBzOi8vcm9sYW5kLmNvZGVzL2Jsb2cvaWUtZmxleC1jb2xsYXBzZS1idWcvXG4gIGNvbnN0IGRlZmF1bHRCYXNpcyA9IGlzSUUgPyAnYXV0bycgOiAnMCUnXG4gIGNvbnN0IGZsZXggPSBzdHlsZS5mbGV4XG4gIGlmIChmbGV4ID09IG51bGwpIHtcbiAgICBpZiAoc3R5bGUuZmxleEdyb3cgPT0gbnVsbCAmJiBzdHlsZS5mbGV4U2hyaW5rID09IG51bGwgJiYgc3R5bGUuZmxleEJhc2lzID09IG51bGwpIHtcbiAgICAgIHJldHVybiBGTEVYX0lOSVRJQUxcbiAgICB9XG5cbiAgICAvLyBeIGxpbmUgMVxuICAgIGNvbnN0IGdyb3cgPSBzdHlsZS5mbGV4R3JvdyB8fCAnMCdcbiAgICBjb25zdCBzaHJpbmsgPSBzdHlsZS5mbGV4U2hyaW5rIHx8ICcxJ1xuICAgIGNvbnN0IGJhc2lzID0gc3R5bGUuZmxleEJhc2lzIHx8IGRlZmF1bHRCYXNpc1xuICAgIHJldHVybiBgJHtncm93fSAke3Nocmlua30gJHtiYXNpc31gXG4gIH1cblxuICAvLyBeIGxpbmUgMlxuICAvLyBpZiBmbGV4IGlzIGEgbnVtYmVyIG9mIGEgc3RyaW5naWZpZWQgbnVtYmVyXG4gIGlmICghaXNOYU4oZmxleCkpIHtcbiAgICByZXR1cm4gYCR7ZmxleH0gMSAke2RlZmF1bHRCYXNpc31gXG4gIH1cblxuICAvLyBeIGxpbmVzIDMsIDRcbiAgaWYgKGZsZXggPT09ICdhdXRvJykge1xuICAgIHJldHVybiBGTEVYX0FVVE9cbiAgfSBlbHNlIGlmIChmbGV4ID09PSAnaW5pdGlhbCcpIHtcbiAgICByZXR1cm4gRkxFWF9JTklUSUFMXG4gIH1cblxuICAvLyBmbGV4IHdhcyBzZXQgZXhwbGljaXRseVxuICByZXR1cm4gZmxleFxufVxuXG5mdW5jdGlvbiBkZWZhdWx0RmxleEV4cGFuc2lvbiAoc3R5bGUsIHJlc3VsdCkge1xuICByZXN1bHQuZmxleCA9IGdldEZsZXhFeHBhbnNpb24oc3R5bGUpXG59XG5cbmZ1bmN0aW9uIGV4dGVuZEJveFByb3BlcnRpZXMocHJvcGVydHksIHZhbHVlLCByZXN1bHQpIHtcbiAgdmFyIHBhZGRpbmcgPSAncGFkZGluZyc7XG4gIHZhciBtYXJnaW4gPSAnbWFyZ2luJztcbiAgdmFyIGhvcml6b250YWwgPSAnSG9yaXpvbnRhbCc7XG4gIHZhciB2ZXJ0aWNhbCA9ICdWZXJ0aWNhbCc7XG4gIHZhciB0eXBlID0gcHJvcGVydHkuaW5kZXhPZihtYXJnaW4pID09IDAgPyBtYXJnaW4gOiBwYWRkaW5nO1xuICB2YXIgZGlyZWN0aW9uVHlwZSA9IHByb3BlcnR5LmluZGV4T2YodmVydGljYWwpICE9PSAtMSA/IHZlcnRpY2FsIDogaG9yaXpvbnRhbDtcblxuICBpZiAoZGlyZWN0aW9uVHlwZSA9PSBob3Jpem9udGFsKSB7XG4gICAgcmVzdWx0W3R5cGUgKyAnTGVmdCddID0gcmVzdWx0W3R5cGUgKyAnUmlnaHQnXSA9IHZhbHVlO1xuICB9IGVsc2UgaWYgKGRpcmVjdGlvblR5cGUgPT0gdmVydGljYWwpIHtcbiAgICByZXN1bHRbdHlwZSArICdUb3AnXSA9IHJlc3VsdFt0eXBlICsgJ0JvdHRvbSddID0gdmFsdWU7XG4gIH1cbn1cblxuZnVuY3Rpb24gaXNWYWxpZFZhbHVlKHZhbHVlKSB7XG4gIHJldHVybiB2YWx1ZSAhPT0gJycgJiYgdmFsdWUgIT09IG51bGwgJiYgdmFsdWUgIT09IHVuZGVmaW5lZDtcbn1cblxuZnVuY3Rpb24gcHJvY2Vzc1ZhbHVlRm9yUHJvcCh2YWx1ZSwgcHJvcCkge1xuXG4gIGlmICh0eXBlb2YgdmFsdWUgPT0gJ251bWJlcicpIHtcbiAgICAvLyB0cmFuc2Zvcm0gbGVzcyB0aGVuIDFweCB2YWx1ZSB0byAxcHgsIDAuNSB0byBiZSAxXG4gICAgaWYgKCFDU1NQcm9wZXJ0eS5pc1VuaXRsZXNzTnVtYmVyW3Byb3BdICYmIHZhbHVlID4gMCAmJiB2YWx1ZSA8IDEpIHtcbiAgICAgIHZhbHVlID0gMTtcbiAgICB9XG5cbiAgICAvLyBBZGQgcHggdG8gbnVtZXJpYyB2YWx1ZXNcbiAgICBpZiAobnVtYmVyUHJvcGVydGllc1twcm9wXSAmJiB0eXBlb2YgdmFsdWUgPT0gJ251bWJlcicpIHtcbiAgICAgIHZhbHVlICs9ICdweCc7XG4gICAgfVxuICB9XG5cbiAgLy8gW1xuICAvLyAgIHtzY2FsZVg6IDJ9LFxuICAvLyAgIHtzY2FsZVk6IDJ9XG4gIC8vIF0gPT4gc2NhbGVYKDIpIHNjYWxlWSgyKVxuXG4gIGlmIChzaG9ydGhhbmRQcm9wZXJ0aWVzW3Byb3BdICYmIHR5cGVvZiB2YWx1ZSA9PSAnc3RyaW5nJykge1xuICAgIHZhbHVlID0gdmFsdWUucmVwbGFjZSgvXFxkKlxcLj9cXGQrKHJlbXxlbXxpbnxjbXxtbXxwdHxwY3xweHx2aHx2d3x2bWlufHZtYXh8JSkqL2csIGZ1bmN0aW9uKHZhbCwgdW5pdCkge1xuICAgICAgcmV0dXJuIHVuaXQgPyB2YWwgOiB2YWwgKyAncHgnO1xuICAgIH0pO1xuICB9XG5cbiAgcmV0dXJuIHZhbHVlO1xufVxuXG5mdW5jdGlvbiBkZWZhdWx0Qm9yZGVyU3R5bGUoc3R5bGUsIHJlc3VsdCkge1xuICBpZiAoIXN0eWxlLmJvcmRlclN0eWxlICYmICFyZXN1bHQuYm9yZGVyU3R5bGUpIHtcbiAgICByZXN1bHQuYm9yZGVyU3R5bGUgPSAnc29saWQnO1xuICB9XG5cbiAgaWYgKCFzdHlsZS5ib3JkZXJXaWR0aCAmJiAhcmVzdWx0LmJvcmRlcldpZHRoKSB7XG4gICAgcmVzdWx0LmJvcmRlcldpZHRoID0gMDtcbiAgfVxuXG4gIGlmICghc3R5bGUuYm9yZGVyQ29sb3IgJiYgIXJlc3VsdC5ib3JkZXJDb2xvcikge1xuICAgIHJlc3VsdC5ib3JkZXJDb2xvciA9ICdibGFjayc7XG4gIH1cbn1cblxuZnVuY3Rpb24gZXh0ZW5kUHJvcGVydGllcyhzdHlsZSkge1xuICB2YXIgcmVzdWx0ID0ge307XG5cbiAgZm9yICh2YXIgcHJvcGVydHkgaW4gc3R5bGUpIHtcbiAgICB2YXIgdmFsdWUgPSBzdHlsZVtwcm9wZXJ0eV07XG4gICAgaWYgKCFpc1ZhbGlkVmFsdWUodmFsdWUpKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgLy8gc2V0IGEgZGVmYXVsdCBib3JkZXIgc3R5bGUgaWYgdGhlcmUgaGFzIGJvcmRlciBhYm91dCBwcm9wZXJ0eVxuICAgIGlmIChib3JkZXJQcm9wZXJ0aWVzW3Byb3BlcnR5XSkge1xuICAgICAgZGVmYXVsdEJvcmRlclN0eWxlKHN0eWxlLCByZXN1bHQpO1xuICAgIH1cblxuICAgIGlmIChib3hQcm9wZXJ0aWVzW3Byb3BlcnR5XSkge1xuICAgICAgZXh0ZW5kQm94UHJvcGVydGllcyhwcm9wZXJ0eSwgdmFsdWUsIHJlc3VsdCk7XG4gICAgfSBlbHNlIGlmIChmbGV4Ym94UHJvcGVydGllc1twcm9wZXJ0eV0pIHtcbiAgICAgIHByZWZpeE9sZEZsZXhib3gocHJvcGVydHksIHZhbHVlLCByZXN1bHQpO1xuICAgICAgaWYgKHByb3BlcnR5ID09PSAnZmxleCcpIHtcbiAgICAgICAgZGVmYXVsdEZsZXhFeHBhbnNpb24oc3R5bGUsIHJlc3VsdCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHZhbHVlID0gcHJvY2Vzc1ZhbHVlRm9yUHJvcCh2YWx1ZSwgcHJvcGVydHkpO1xuICAgICAgcHJvcGVydHkgPSBnZXRWZW5kb3JQcm9wZXJ0eU5hbWUocHJvcGVydHkpO1xuICAgICAgcmVzdWx0W3Byb3BlcnR5XSA9IHZhbHVlO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiByZXN1bHQ7XG59XG5cbm1vZHVsZS5leHBvcnRzID0gZXh0ZW5kUHJvcGVydGllcztcbiJdfQ==