




'use strict';

var _getVendorPropertyName=require('domkit/getVendorPropertyName');var _getVendorPropertyName2=_interopRequireDefault(_getVendorPropertyName);
var _CSSProperty=require('./CSSProperty');var _CSSProperty2=_interopRequireDefault(_CSSProperty);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}

var shorthandProperties={
margin:true,
padding:true,
borderWidth:true,
borderRadius:true};



var numberProperties={
lineHeight:true};


var boxProperties={
paddingHorizontal:true,
paddingVertical:true,
marginHorizontal:true,
marginVertical:true};


var borderProperties={
borderColor:true,
borderWidth:true,
borderTopColor:true,
borderRightColor:true,
borderBottomColor:true,
borderLeftColor:true,
borderTopWidth:true,
borderRightWidth:true,
borderBottomWidth:true,
borderLeftWidth:true};



var flexboxProperties={
flex:'WebkitBoxFlex',
order:'WebkitBoxOrdinalGroup',

flexDirection:'WebkitBoxOrient',

alignItems:'WebkitBoxAlign',

justifyContent:'WebkitBoxPack',
flexWrap:null,
alignSelf:null};


var oldFlexboxValues={
'flex-end':'end',
'flex-start':'start',
'space-between':'justify',
'space-around':'distribute'};


var builtinStyle=document.createElement('div').style;
var flexboxSpec;
if('alignSelf'in builtinStyle)flexboxSpec='final';else
if('webkitAlignSelf'in builtinStyle)flexboxSpec='finalVendor';else
flexboxSpec='2009';


var isUCBrowser=/UCBrowser/i.test(navigator.userAgent);
if(isUCBrowser)flexboxSpec='2009';


function prefixOldFlexbox(property,value,result){

if(flexboxSpec==='2009'){
var oldValue=oldFlexboxValues[value]||value;
var oldProperty=flexboxProperties[property]||property;
if(oldProperty==='WebkitBoxOrient'){

if(value.indexOf('row')!=-1){
oldValue='horizontal';
}else{
oldValue='vertical';
}

var dir='';
if(value.indexOf('reverse')!=-1){
dir='reverse';
}else{
dir='normal';
}
result.WebkitBoxDirection=dir;
}
return result[oldProperty]=oldValue;

}else if(flexboxSpec==='finalVendor'){
return result[(0,_getVendorPropertyName2.default)(property)]=value;

}else{
return result[property]=value;

}
}

function extendBoxProperties(property,value,result){
var padding='padding';
var margin='margin';
var horizontal='Horizontal';
var vertical='Vertical';
var type=property.indexOf(margin)==0?margin:padding;
var directionType=property.indexOf(vertical)!==-1?vertical:horizontal;

if(directionType==horizontal){
result[type+'Left']=result[type+'Right']=value;
}else if(directionType==vertical){
result[type+'Top']=result[type+'Bottom']=value;
}
}

function isValidValue(value){
return value!==''&&value!==null&&value!==undefined;
}

function processValueForProp(value,prop){

if(typeof value=='number'){

if(!_CSSProperty2.default.isUnitlessNumber[prop]&&value>0&&value<1){
value=1;
}


if(numberProperties[prop]&&typeof value=='number'){
value+='px';
}
}






if(shorthandProperties[prop]&&typeof value=='string'){
value=value.replace(/\d*\.?\d+(rem|em|in|cm|mm|pt|pc|px|vh|vw|vmin|vmax|%)*/g,function(val,unit){
return unit?val:val+'px';
});
}

return value;
}

function defaultBorderStyle(style,result){
if(!style.borderStyle&&!result.borderStyle){
result.borderStyle='solid';
}

if(!style.borderWidth&&!result.borderWidth){
result.borderWidth=0;
}

if(!style.borderColor&&!result.borderColor){
result.borderColor='black';
}
}

function extendProperties(style){
var result={};

for(var property in style){
var value=style[property];
if(!isValidValue(value)){
continue;
}

if(borderProperties[property]){
defaultBorderStyle(style,result);
}

if(boxProperties[property]){
extendBoxProperties(property,value,result);
}else if(flexboxProperties[property]){
prefixOldFlexbox(property,value,result);
}else{
value=processValueForProp(value,property);
property=(0,_getVendorPropertyName2.default)(property);
result[property]=value;
}
}

return result;
}

module.exports=extendProperties;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImV4dGVuZFByb3BlcnRpZXMud2ViLmpzIl0sIm5hbWVzIjpbInNob3J0aGFuZFByb3BlcnRpZXMiLCJtYXJnaW4iLCJwYWRkaW5nIiwiYm9yZGVyV2lkdGgiLCJib3JkZXJSYWRpdXMiLCJudW1iZXJQcm9wZXJ0aWVzIiwibGluZUhlaWdodCIsImJveFByb3BlcnRpZXMiLCJwYWRkaW5nSG9yaXpvbnRhbCIsInBhZGRpbmdWZXJ0aWNhbCIsIm1hcmdpbkhvcml6b250YWwiLCJtYXJnaW5WZXJ0aWNhbCIsImJvcmRlclByb3BlcnRpZXMiLCJib3JkZXJDb2xvciIsImJvcmRlclRvcENvbG9yIiwiYm9yZGVyUmlnaHRDb2xvciIsImJvcmRlckJvdHRvbUNvbG9yIiwiYm9yZGVyTGVmdENvbG9yIiwiYm9yZGVyVG9wV2lkdGgiLCJib3JkZXJSaWdodFdpZHRoIiwiYm9yZGVyQm90dG9tV2lkdGgiLCJib3JkZXJMZWZ0V2lkdGgiLCJmbGV4Ym94UHJvcGVydGllcyIsImZsZXgiLCJvcmRlciIsImZsZXhEaXJlY3Rpb24iLCJhbGlnbkl0ZW1zIiwianVzdGlmeUNvbnRlbnQiLCJmbGV4V3JhcCIsImFsaWduU2VsZiIsIm9sZEZsZXhib3hWYWx1ZXMiLCJidWlsdGluU3R5bGUiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJzdHlsZSIsImZsZXhib3hTcGVjIiwiaXNVQ0Jyb3dzZXIiLCJ0ZXN0IiwibmF2aWdhdG9yIiwidXNlckFnZW50IiwicHJlZml4T2xkRmxleGJveCIsInByb3BlcnR5IiwidmFsdWUiLCJyZXN1bHQiLCJvbGRWYWx1ZSIsIm9sZFByb3BlcnR5IiwiaW5kZXhPZiIsImRpciIsIldlYmtpdEJveERpcmVjdGlvbiIsImV4dGVuZEJveFByb3BlcnRpZXMiLCJob3Jpem9udGFsIiwidmVydGljYWwiLCJ0eXBlIiwiZGlyZWN0aW9uVHlwZSIsImlzVmFsaWRWYWx1ZSIsInVuZGVmaW5lZCIsInByb2Nlc3NWYWx1ZUZvclByb3AiLCJwcm9wIiwiaXNVbml0bGVzc051bWJlciIsInJlcGxhY2UiLCJ2YWwiLCJ1bml0IiwiZGVmYXVsdEJvcmRlclN0eWxlIiwiYm9yZGVyU3R5bGUiLCJleHRlbmRQcm9wZXJ0aWVzIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Ijs7Ozs7QUFLQTs7QUFFQSxtRTtBQUNBLDBDOztBQUVBLEdBQUlBLHFCQUFzQjtBQUN4QkMsT0FBUSxJQURnQjtBQUV4QkMsUUFBUyxJQUZlO0FBR3hCQyxZQUFhLElBSFc7QUFJeEJDLGFBQWMsSUFKVSxDQUExQjs7OztBQVFBLEdBQUlDLGtCQUFtQjtBQUNyQkMsV0FBWSxJQURTLENBQXZCOzs7QUFJQSxHQUFJQyxlQUFnQjtBQUNsQkMsa0JBQW1CLElBREQ7QUFFbEJDLGdCQUFpQixJQUZDO0FBR2xCQyxpQkFBa0IsSUFIQTtBQUlsQkMsZUFBZ0IsSUFKRSxDQUFwQjs7O0FBT0EsR0FBSUMsa0JBQW1CO0FBQ3JCQyxZQUFhLElBRFE7QUFFckJWLFlBQWEsSUFGUTtBQUdyQlcsZUFBZ0IsSUFISztBQUlyQkMsaUJBQWtCLElBSkc7QUFLckJDLGtCQUFtQixJQUxFO0FBTXJCQyxnQkFBaUIsSUFOSTtBQU9yQkMsZUFBZ0IsSUFQSztBQVFyQkMsaUJBQWtCLElBUkc7QUFTckJDLGtCQUFtQixJQVRFO0FBVXJCQyxnQkFBaUIsSUFWSSxDQUF2Qjs7OztBQWNBLEdBQUlDLG1CQUFvQjtBQUN0QkMsS0FBTSxlQURnQjtBQUV0QkMsTUFBTyx1QkFGZTs7QUFJdEJDLGNBQWUsaUJBSk87O0FBTXRCQyxXQUFZLGdCQU5VOztBQVF0QkMsZUFBZ0IsZUFSTTtBQVN0QkMsU0FBVSxJQVRZO0FBVXRCQyxVQUFXLElBVlcsQ0FBeEI7OztBQWFBLEdBQUlDLGtCQUFtQjtBQUNyQixXQUFZLEtBRFM7QUFFckIsYUFBYyxPQUZPO0FBR3JCLGdCQUFpQixTQUhJO0FBSXJCLGVBQWdCLFlBSkssQ0FBdkI7OztBQU9BLEdBQUlDLGNBQWVDLFNBQVNDLGFBQVQsQ0FBdUIsS0FBdkIsRUFBOEJDLEtB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cEIsQ0FBOEJDLEtBQTlCLENBQXFDQyxNQUFyQztBQUNELENBRkQsSUFFTyxJQUFJckIsa0JBQWtCbUIsUUFBbEIsQ0FBSixDQUFpQztBQUN0Q0QsaUJBQWlCQyxRQUFqQixDQUEyQkMsS0FBM0IsQ0FBa0NDLE1BQWxDO0FBQ0QsQ0FGTSxJQUVBO0FBQ0xELE1BQVFjLG9CQUFvQmQsS0FBcEIsQ0FBMkJELFFBQTNCLENBQVI7QUFDQUEsU0FBVyxvQ0FBc0JBLFFBQXRCLENBQVg7QUFDQUUsT0FBT0YsUUFBUCxFQUFtQkMsS0FBbkI7QUFDRDtBQUNGOztBQUVELE1BQU9DLE9BQVA7QUFDRDs7QUFFRHNCLE9BQU9DLE9BQVAsQ0FBaUJGLGdCQUFqQiIsImZpbGUiOiJleHRlbmRQcm9wZXJ0aWVzLndlYi5qcyIsInNvdXJjZXNDb250ZW50IjpbIi8qKlxuICogQ29weXJpZ2h0IChjKSAyMDE1LXByZXNlbnQsIEFsaWJhYmEgR3JvdXAgSG9sZGluZyBMaW1pdGVkLlxuICogQWxsIHJpZ2h0cyByZXNlcnZlZC5cbiAqXG4gKi9cbid1c2Ugc3RyaWN0JztcblxuaW1wb3J0IGdldFZlbmRvclByb3BlcnR5TmFtZSBmcm9tICdkb21raXQvZ2V0VmVuZG9yUHJvcGVydHlOYW1lJztcbmltcG9ydCBDU1NQcm9wZXJ0eSBmcm9tICdDU1NQcm9wZXJ0eSc7XG5cbnZhciBzaG9ydGhhbmRQcm9wZXJ0aWVzID0ge1xuICBtYXJnaW46IHRydWUsXG4gIHBhZGRpbmc6IHRydWUsXG4gIGJvcmRlcldpZHRoOiB0cnVlLFxuICBib3JkZXJSYWRpdXM6IHRydWUsXG59O1xuXG4vLyBzb21lIG51bWJlciB0aGF0IHJlYWN0IG5vdCBhdXRvIGFkZCBweFxudmFyIG51bWJlclByb3BlcnRpZXMgPSB7XG4gIGxpbmVIZWlnaHQ6IHRydWVcbn07XG5cbnZhciBib3hQcm9wZXJ0aWVzID0ge1xuICBwYWRkaW5nSG9yaXpvbnRhbDogdHJ1ZSxcbiAgcGFkZGluZ1ZlcnRpY2FsOiB0cnVlLFxuICBtYXJnaW5Ib3Jpem9udGFsOiB0cnVlLFxuICBtYXJnaW5WZXJ0aWNhbDogdHJ1ZSxcbn07XG5cbnZhciBib3JkZXJQcm9wZXJ0aWVzID0ge1xuICBib3JkZXJDb2xvcjogdHJ1ZSxcbiAgYm9yZGVyV2lkdGg6IHRydWUsXG4gIGJvcmRlclRvcENvbG9yOiB0cnVlLFxuICBib3JkZXJSaWdodENvbG9yOiB0cnVlLFxuICBib3JkZXJCb3R0b21Db2xvcjogdHJ1ZSxcbiAgYm9yZGVyTGVmdENvbG9yOiB0cnVlLFxuICBib3JkZXJUb3BXaWR0aDogdHJ1ZSxcbiAgYm9yZGVyUmlnaHRXaWR0aDogdHJ1ZSxcbiAgYm9yZGVyQm90dG9tV2lkdGg6IHRydWUsXG4gIGJvcmRlckxlZnRXaWR0aDogdHJ1ZSxcbn07XG5cbi8vIHByZWZpeCAyMDA5IHNwZWNcbnZhciBmbGV4Ym94UHJvcGVydGllcyA9IHtcbiAgZmxleDogJ1dlYmtpdEJveEZsZXgnLFxuICBvcmRlcjogJ1dlYmtpdEJveE9yZGluYWxHcm91cCcsXG4gIC8vIGh0dHBzOi8vZ2l0aHViLmNvbS9wb3N0Y3NzL2F1dG9wcmVmaXhlci9ibG9iL21hc3Rlci9saWIvaGFja3MvZmxleC1kaXJlY3Rpb24uY29mZmVlXG4gIGZsZXhEaXJlY3Rpb246ICdXZWJraXRCb3hPcmllbnQnLFxuICAvLyBodHRwczovL2dpdGh1Yi5jb20vcG9zdGNzcy9hdXRvcHJlZml4ZXIvYmxvYi9tYXN0ZXIvbGliL2hhY2tzL2FsaWduLWl0ZW1zLmNvZmZlZVxuICBhbGlnbkl0ZW1zOiAnV2Via2l0Qm94QWxpZ24nLFxuICAvLyBodHRwczovL2dpdGh1Yi5jb20vcG9zdGNzcy9hdXRvcHJlZml4ZXIvYmxvYi9tYXN0ZXIvbGliL2hhY2tzL2p1c3RpZnktY29udGVudC5jb2ZmZWVcbiAganVzdGlmeUNvbnRlbnQ6ICdXZWJraXRCb3hQYWNrJyxcbiAgZmxleFdyYXA6IG51bGwsXG4gIGFsaWduU2VsZjogbnVsbCxcbn07XG5cbnZhciBvbGRGbGV4Ym94VmFsdWVzID0ge1xuICAnZmxleC1lbmQnOiAnZW5kJyxcbiAgJ2ZsZXgtc3RhcnQnOiAnc3RhcnQnLFxuICAnc3BhY2UtYmV0d2Vlbic6ICdqdXN0aWZ5JyxcbiAgJ3NwYWNlLWFyb3VuZCc6ICdkaXN0cmlidXRlJyxcbn07XG5cbnZhciBidWlsdGluU3R5bGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdkaXYnKS5zdHlsZTtcbnZhciBmbGV4Ym94U3BlYztcbmlmICgnYWxpZ25TZWxmJyBpbiBidWlsdGluU3R5bGUpIGZsZXhib3hTcGVjID0gJ2ZpbmFsJztcbmVsc2UgaWYgKCd3ZWJraXRBbGlnblNlbGYnIGluIGJ1aWx0aW5TdHlsZSkgZmxleGJveFNwZWMgPSAnZmluYWxWZW5kb3InO1xuZWxzZSBmbGV4Ym94U3BlYyA9ICcyMDA5JztcblxuLy8gRklYTUU6IFVDQnJvd3NlciBpcyBjaGVhdFxudmFyIGlzVUNCcm93c2VyID0gL1VDQnJvd3Nlci9pLnRlc3QobmF2aWdhdG9yLnVzZXJBZ2VudCk7XG5pZiAoaXNVQ0Jyb3dzZXIpIGZsZXhib3hTcGVjID0gJzIwMDknO1xuXG4vLyBUT0RPOiBjYWNoZSB0aGUgcmVzdWx0XG5mdW5jdGlvbiBwcmVmaXhPbGRGbGV4Ym94KHByb3BlcnR5LCB2YWx1ZSwgcmVzdWx0KSB7XG5cbiAgaWYgKGZsZXhib3hTcGVjID09PSAnMjAwOScpIHtcbiAgICB2YXIgb2xkVmFsdWUgPSBvbGRGbGV4Ym94VmFsdWVzW3ZhbHVlXSB8fCB2YWx1ZTtcbiAgICB2YXIgb2xkUHJvcGVydHkgPSBmbGV4Ym94UHJvcGVydGllc1twcm9wZXJ0eV0gfHwgcHJvcGVydHk7XG4gICAgaWYgKG9sZFByb3BlcnR5ID09PSAnV2Via2l0Qm94T3JpZW50Jykge1xuICAgICAgLy8gYm94T3JpZW50XG4gICAgICBpZiAodmFsdWUuaW5kZXhPZigncm93JykgIT0gLTEpIHtcbiAgICAgICAgb2xkVmFsdWUgPSAnaG9yaXpvbnRhbCc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBvbGRWYWx1ZSA9ICd2ZXJ0aWNhbCc7XG4gICAgICB9XG4gICAgICAvLyBib3hEaXJlY3Rpb25cbiAgICAgIHZhciBkaXIgPSAnJztcbiAgICAgIGlmICh2YWx1ZS5pbmRleE9mKCdyZXZlcnNlJykgIT0gLTEpIHtcbiAgICAgICAgZGlyID0gJ3JldmVyc2UnO1xuICAgICAgfSBlbHNlIHtcbiAgICAgICAgZGlyID0gJ25vcm1hbCc7XG4gICAgICB9XG4gICAgICByZXN1bHQuV2Via2l0Qm94RGlyZWN0aW9uID0gZGlyO1xuICAgIH1cbiAgICByZXR1cm4gcmVzdWx0W29sZFByb3BlcnR5XSA9IG9sZFZhbHVlO1xuXG4gIH0gZWxzZSBpZiAoZmxleGJveFNwZWMgPT09ICdmaW5hbFZlbmRvcicpIHtcbiAgICByZXR1cm4gcmVzdWx0W2dldFZlbmRvclByb3BlcnR5TmFtZShwcm9wZXJ0eSldID0gdmFsdWU7XG5cbiAgfSBlbHNlIHtcbiAgICByZXR1cm4gcmVzdWx0W3Byb3BlcnR5XSA9IHZhbHVlO1xuXG4gIH1cbn1cblxuZnVuY3Rpb24gZXh0ZW5kQm94UHJvcGVydGllcyhwcm9wZXJ0eSwgdmFsdWUsIHJlc3VsdCkge1xuICB2YXIgcGFkZGluZyA9ICdwYWRkaW5nJztcbiAgdmFyIG1hcmdpbiA9ICdtYXJnaW4nO1xuICB2YXIgaG9yaXpvbnRhbCA9ICdIb3Jpem9udGFsJztcbiAgdmFyIHZlcnRpY2FsID0gJ1ZlcnRpY2FsJztcbiAgdmFyIHR5cGUgPSBwcm9wZXJ0eS5pbmRleE9mKG1hcmdpbikgPT0gMCA/IG1hcmdpbiA6IHBhZGRpbmc7XG4gIHZhciBkaXJlY3Rpb25UeXBlID0gcHJvcGVydHkuaW5kZXhPZih2ZXJ0aWNhbCkgIT09IC0xID8gdmVydGljYWwgOiBob3Jpem9udGFsO1xuXG4gIGlmIChkaXJlY3Rpb25UeXBlID09IGhvcml6b250YWwpIHtcbiAgICByZXN1bHRbdHlwZSArICdMZWZ0J10gPSByZXN1bHRbdHlwZSArICdSaWdodCddID0gdmFsdWU7XG4gIH0gZWxzZSBpZiAoZGlyZWN0aW9uVHlwZSA9PSB2ZXJ0aWNhbCkge1xuICAgIHJlc3VsdFt0eXBlICsgJ1RvcCddID0gcmVzdWx0W3R5cGUgKyAnQm90dG9tJ10gPSB2YWx1ZTtcbiAgfVxufVxuXG5mdW5jdGlvbiBpc1ZhbGlkVmFsdWUodmFsdWUpIHtcbiAgcmV0dXJuIHZhbHVlICE9PSAnJyAmJiB2YWx1ZSAhPT0gbnVsbCAmJiB2YWx1ZSAhPT0gdW5kZWZpbmVkO1xufVxuXG5mdW5jdGlvbiBwcm9jZXNzVmFsdWVGb3JQcm9wKHZhbHVlLCBwcm9wKSB7XG5cbiAgaWYgKHR5cGVvZiB2YWx1ZSA9PSAnbnVtYmVyJykge1xuICAgIC8vIHRyYW5zZm9ybSBsZXNzIHRoZW4gMXB4IHZhbHVlIHRvIDFweCwgMC41IHRvIGJlIDFcbiAgICBpZiAoIUNTU1Byb3BlcnR5LmlzVW5pdGxlc3NOdW1iZXJbcHJvcF0gJiYgdmFsdWUgPiAwICYmIHZhbHVlIDwgMSkge1xuICAgICAgdmFsdWUgPSAxO1xuICAgIH1cblxuICAgIC8vIEFkZCBweCB0byBudW1lcmljIHZhbHVlc1xuICAgIGlmIChudW1iZXJQcm9wZXJ0aWVzW3Byb3BdICYmIHR5cGVvZiB2YWx1ZSA9PSAnbnVtYmVyJykge1xuICAgICAgdmFsdWUgKz0gJ3B4JztcbiAgICB9XG4gIH1cblxuICAvLyBbXG4gIC8vICAge3NjYWxlWDogMn0sXG4gIC8vICAge3NjYWxlWTogMn1cbiAgLy8gXSA9PiBzY2FsZVgoMikgc2NhbGVZKDIpXG5cbiAgaWYgKHNob3J0aGFuZFByb3BlcnRpZXNbcHJvcF0gJiYgdHlwZW9mIHZhbHVlID09ICdzdHJpbmcnKSB7XG4gICAgdmFsdWUgPSB2YWx1ZS5yZXBsYWNlKC9cXGQqXFwuP1xcZCsocmVtfGVtfGlufGNtfG1tfHB0fHBjfHB4fHZofHZ3fHZtaW58dm1heHwlKSovZywgZnVuY3Rpb24odmFsLCB1bml0KSB7XG4gICAgICByZXR1cm4gdW5pdCA/IHZhbCA6IHZhbCArICdweCc7XG4gICAgfSk7XG4gIH1cblxuICByZXR1cm4gdmFsdWU7XG59XG5cbmZ1bmN0aW9uIGRlZmF1bHRCb3JkZXJTdHlsZShzdHlsZSwgcmVzdWx0KSB7XG4gIGlmICghc3R5bGUuYm9yZGVyU3R5bGUgJiYgIXJlc3VsdC5ib3JkZXJTdHlsZSkge1xuICAgIHJlc3VsdC5ib3JkZXJTdHlsZSA9ICdzb2xpZCc7XG4gIH1cblxuICBpZiAoIXN0eWxlLmJvcmRlcldpZHRoICYmICFyZXN1bHQuYm9yZGVyV2lkdGgpIHtcbiAgICByZXN1bHQuYm9yZGVyV2lkdGggPSAwO1xuICB9XG5cbiAgaWYgKCFzdHlsZS5ib3JkZXJDb2xvciAmJiAhcmVzdWx0LmJvcmRlckNvbG9yKSB7XG4gICAgcmVzdWx0LmJvcmRlckNvbG9yID0gJ2JsYWNrJztcbiAgfVxufVxuXG5mdW5jdGlvbiBleHRlbmRQcm9wZXJ0aWVzKHN0eWxlKSB7XG4gIHZhciByZXN1bHQgPSB7fTtcblxuICBmb3IgKHZhciBwcm9wZXJ0eSBpbiBzdHlsZSkge1xuICAgIHZhciB2YWx1ZSA9IHN0eWxlW3Byb3BlcnR5XTtcbiAgICBpZiAoIWlzVmFsaWRWYWx1ZSh2YWx1ZSkpIHtcbiAgICAgIGNvbnRpbnVlO1xuICAgIH1cbiAgICAvLyBzZXQgYSBkZWZhdWx0IGJvcmRlciBzdHlsZSBpZiB0aGVyZSBoYXMgYm9yZGVyIGFib3V0IHByb3BlcnR5XG4gICAgaWYgKGJvcmRlclByb3BlcnRpZXNbcHJvcGVydHldKSB7XG4gICAgICBkZWZhdWx0Qm9yZGVyU3R5bGUoc3R5bGUsIHJlc3VsdCk7XG4gICAgfVxuXG4gICAgaWYgKGJveFByb3BlcnRpZXNbcHJvcGVydHldKSB7XG4gICAgICBleHRlbmRCb3hQcm9wZXJ0aWVzKHByb3BlcnR5LCB2YWx1ZSwgcmVzdWx0KTtcbiAgICB9IGVsc2UgaWYgKGZsZXhib3hQcm9wZXJ0aWVzW3Byb3BlcnR5XSkge1xuICAgICAgcHJlZml4T2xkRmxleGJveChwcm9wZXJ0eSwgdmFsdWUsIHJlc3VsdCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHZhbHVlID0gcHJvY2Vzc1ZhbHVlRm9yUHJvcCh2YWx1ZSwgcHJvcGVydHkpO1xuICAgICAgcHJvcGVydHkgPSBnZXRWZW5kb3JQcm9wZXJ0eU5hbWUocHJvcGVydHkpO1xuICAgICAgcmVzdWx0W3Byb3BlcnR5XSA9IHZhbHVlO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiByZXN1bHQ7XG59XG5cbm1vZHVsZS5leHBvcnRzID0gZXh0ZW5kUHJvcGVydGllcztcbiJdfQ==