




'use strict';

var _getVendorPropertyName=require('domkit/getVendorPropertyName');var _getVendorPropertyName2=_interopRequireDefault(_getVendorPropertyName);
var _CSSProperty=require('./CSSProperty');var _CSSProperty2=_interopRequireDefault(_CSSProperty);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}

var shorthandProperties={
margin:true,
padding:true,
borderWidth:true,
borderRadius:true};



var numberProperties={
lineHeight:true};


var boxProperties={
paddingHorizontal:true,
paddingVertical:true,
marginHorizontal:true,
marginVertical:true};


var borderProperties={
borderColor:true,
borderWidth:true,
borderTopColor:true,
borderRightColor:true,
borderBottomColor:true,
borderLeftColor:true,
borderTopWidth:true,
borderRightWidth:true,
borderBottomWidth:true,
borderLeftWidth:true};



var flexboxProperties={
flex:'WebkitBoxFlex',
order:'WebkitBoxOrdinalGroup',

flexDirection:'WebkitBoxOrient',

alignItems:'WebkitBoxAlign',

justifyContent:'WebkitBoxPack',
flexWrap:null,
alignSelf:null};


var oldFlexboxValues={
'flex-end':'end',
'flex-start':'start',
'space-between':'justify',
'space-around':'distribute'};


var builtinStyle=document.createElement('div').style;
var flexboxSpec;
if('alignSelf'in builtinStyle)flexboxSpec='final';else
if('webkitAlignSelf'in builtinStyle)flexboxSpec='finalVendor';else
flexboxSpec='2009';


var isUCBrowser=/UCBrowser/i.test(navigator.userAgent);
if(isUCBrowser)flexboxSpec='2009';

var isIE=/Trident/i.test(navigator.userAgent);
var isSafari=
navigator.userAgent.indexOf('Safari')!==-1&&
navigator.userAgent.indexOf('Chrome')===-1;

var FLEX_AUTO='1 1 auto';
var FLEX_INITIAL='0 1 auto';
var DEFAULT_BASIS=isIE||isSafari?'auto':'0%';
var DEFAULT_SHRINK=isSafari?'0':'1';


function prefixOldFlexbox(property,value,result){

if(flexboxSpec==='2009'){
var oldValue=oldFlexboxValues[value]||value;
var oldProperty=flexboxProperties[property]||property;
if(oldProperty==='WebkitBoxOrient'){

if(value.indexOf('row')!=-1){
oldValue='horizontal';
}else{
oldValue='vertical';
}

var dir='';
if(value.indexOf('reverse')!=-1){
dir='reverse';
}else{
dir='normal';
}
result.WebkitBoxDirection=dir;
}
return result[oldProperty]=oldValue;

}else if(flexboxSpec==='finalVendor'){
return result[(0,_getVendorPropertyName2.default)(property)]=value;

}else{
return result[property]=value;

}
}








function getFlexExpansion(style){

var flex=style.flex;
if(flex==null){
if(style.flexGrow==null&&style.flexShrink==null&&style.flexBasis==null){
return FLEX_INITIAL;
}


var grow=style.flexGrow||'0';
var shrink=style.flexShrink||DEFAULT_SHRINK;
var basis=style.flexBasis||DEFAULT_BASIS;
return grow+' '+shrink+' '+basis;
}



if(!isNaN(flex)){
return flex+' '+DEFAULT_SHRINK+' '+DEFAULT_BASIS;
}


if(flex==='auto'){
return FLEX_AUTO;
}else if(flex==='initial'){
return FLEX_INITIAL;
}


return flex;
}

function defaultFlexExpansion(style,result){
result.flex=getFlexExpansion(style);
}

function extendBoxProperties(property,value,result){
var padding='padding';
var margin='margin';
var horizontal='Horizontal';
var vertical='Vertical';
var type=property.indexOf(margin)==0?margin:padding;
var directionType=property.indexOf(vertical)!==-1?vertical:horizontal;

if(directionType==horizontal){
result[type+'Left']=result[type+'Right']=value;
}else if(directionType==vertical){
result[type+'Top']=result[type+'Bottom']=value;
}
}

function isValidValue(value){
return value!==''&&value!==null&&value!==undefined;
}

function processValueForProp(value,prop){

if(typeof value=='number'){

if(!_CSSProperty2.default.isUnitlessNumber[prop]&&value>0&&value<1){
value=1;
}


if(numberProperties[prop]&&typeof value=='number'){
value+='px';
}
}






if(shorthandProperties[prop]&&typeof value=='string'){
value=value.replace(/\d*\.?\d+(rem|em|in|cm|mm|pt|pc|px|vh|vw|vmin|vmax|%)*/g,function(val,unit){
return unit?val:val+'px';
});
}

return value;
}

function defaultBorderStyle(style,result){
if(!style.borderStyle&&!result.borderStyle){
result.borderStyle='solid';
}

if(!style.borderWidth&&!result.borderWidth){
result.borderWidth=0;
}

if(!style.borderColor&&!result.borderColor){
result.borderColor='black';
}
}

function extendProperties(style){
var result={};

for(var property in style){
var value=style[property];
if(!isValidValue(value)){
continue;
}

if(borderProperties[property]){
defaultBorderStyle(style,result);
}

if(boxProperties[property]){
extendBoxProperties(property,value,result);
}else if(flexboxProperties[property]){
prefixOldFlexbox(property,value,result);
if(property==='flex'){
defaultFlexExpansion(style,result);
}
}else{
value=processValueForProp(value,property);
property=(0,_getVendorPropertyName2.default)(property);
result[property]=value;
}
}

return result;
}

module.exports=extendProperties;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImV4dGVuZFByb3BlcnRpZXMud2ViLmpzIl0sIm5hbWVzIjpbInNob3J0aGFuZFByb3BlcnRpZXMiLCJtYXJnaW4iLCJwYWRkaW5nIiwiYm9yZGVyV2lkdGgiLCJib3JkZXJSYWRpdXMiLCJudW1iZXJQcm9wZXJ0aWVzIiwibGluZUhlaWdodCIsImJveFByb3BlcnRpZXMiLCJwYWRkaW5nSG9yaXpvbnRhbCIsInBhZGRpbmdWZXJ0aWNhbCIsIm1hcmdpbkhvcml6b250YWwiLCJtYXJnaW5WZXJ0aWNhbCIsImJvcmRlclByb3BlcnRpZXMiLCJib3JkZXJDb2xvciIsImJvcmRlclRvcENvbG9yIiwiYm9yZGVyUmlnaHRDb2xvciIsImJvcmRlckJvdHRvbUNvbG9yIiwiYm9yZGVyTGVmdENvbG9yIiwiYm9yZGVyVG9wV2lkdGgiLCJib3JkZXJSaWdodFdpZHRoIiwiYm9yZGVyQm90dG9tV2lkdGgiLCJib3JkZXJMZWZ0V2lkdGgiLCJmbGV4Ym94UHJvcGVydGllcyIsImZsZXgiLCJvcmRlciIsImZsZXhEaXJlY3Rpb24iLCJhbGlnbkl0ZW1zIiwianVzdGlmeUNvbnRlbnQiLCJmbGV4V3JhcCIsImFsaWduU2VsZiIsIm9sZEZsZXhib3hWYWx1ZXMiLCJidWlsdGluU3R5bGUiLCJkb2N1bWVudCIsImNyZWF0ZUVsZW1lbnQiLCJzdHlsZSIsImZsZXhib3hTcGVjIiwiaXNVQ0Jyb3dzZXIiLCJ0ZXN0IiwibmF2aWdhdG9yIiwidXNlckFnZW50IiwiaXNJRSIsImlzU2FmYXJpIiwiaW5kZXhPZiIsIkZMRVhfQVVUTyIsIkZMRVhfSU5JVElBTCIsIkRFRkFVTFRfQkFTSVMiLCJERUZBVUxUX1NIUklOSyIsInByZWZpeE9sZEZsZXhib3giLCJwcm9wZXJ0eSIsInZhbHVlIiwicmVzdWx0Iiwib2xkVmFsdWUiLCJvbGRQcm9wZXJ0eSIsImRpciIsIldlYmtpdEJveERpcmVjdGlvbiIsImdldEZsZXhFeHBhbnNpb24iLCJmbGV4R3JvdyIsImZsZXhTaHJpbmsiLCJmbGV4QmFzaXMiLCJncm93Iiwic2hyaW5rIiwiYmFzaXMiLCJpc05hTiIsImRlZmF1bHRGbGV4RXhwYW5zaW9uIiwiZXh0ZW5kQm94UHJvcGVydGllcyIsImhvcml6b250YWwiLCJ2ZXJ0aWNhbCIsInR5cGUiLCJkaXJlY3Rpb25UeXBlIiwiaXNWYWxpZFZhbHVlIiwidW5kZWZpbmVkIiwicHJvY2Vzc1ZhbHVlRm9yUHJvcCIsInByb3AiLCJpc1VuaXRsZXNzTnVtYmVyIiwicmVwbGFjZSIsInZhbCIsInVuaXQiLCJkZWZhdWx0Qm9yZGVyU3R5bGUiLCJib3JkZXJTdHlsZSIsImV4dGVuZFByb3BlcnRpZXMiLCJtb2R1bGUiLCJleHBvcnRzIl0sIm1hcHBpbmdzIjoiOzs7OztBQUtBOztBQUVBLG1FO0FBQ0EsMEM7O0FBRUEsR0FBSUEscUJBQXNCO0FBQ3hCQyxPQUFRLElBRGdCO0FBRXhCQyxRQUFTLElBRmU7QUFHeEJDLFlBQWEsSUFIVztBQUl4QkMsYUFBYyxJQUpVLENBQTFCOzs7O0FBUUEsR0FBSUMsa0JBQW1CO0FBQ3JCQyxXQUFZLElBRFMsQ0FBdkI7OztBQUlBLEdBQUlDLGVBQWdCO0FBQ2xCQyxrQkFBbUIsSUFERDtBQUVsQkMsZ0JBQWlCLElBRkM7QUFHbEJDLGlCQUFrQixJQUhBO0FBSWxCQyxlQUFnQixJQUpFLENBQXBCOzs7QUFPQSxHQUFJQyxrQkFBbUI7QUFDckJDLFlBQWEsSUFEUTtBQUVyQlYsWUFBYSxJQUZRO0FBR3JCVyxlQUFnQixJQUhLO0FBSXJCQyxpQkFBa0IsSUFKRztBQUtyQkMsa0JBQW1CLElBTEU7QUFNckJDLGdCQUFpQixJQU5JO0FBT3JCQyxlQUFnQixJQVBLO0FBUXJCQyxpQkFBa0IsSUFSRztBQVNyQkMsa0JBQW1CLElBVEU7QUFVckJDLGdCQUFpQixJQVZJLENBQXZCOzs7O0FBY0EsR0FBSUMsbUJBQW9CO0FBQ3RCQyxLQUFNLGVBRGdCO0FBRXRCQyxNQUFPLHVCQUZlOztBQUl0QkMsY0FBZSxpQkFKTzs7QUFNdEJDLFdBQVksZ0JBTlU7O0FBUXRCQyxlQUFnQixl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LFdBQWxDLENBQStDO0FBQzdDcUMsT0FBT3JDLFdBQVAsQ0FBcUIsT0FBckI7QUFDRDtBQUNGOztBQUVELFFBQVNrRSxpQkFBVCxDQUEwQjdDLEtBQTFCLENBQWlDO0FBQy9CLEdBQUlnQixRQUFTLEVBQWI7O0FBRUEsSUFBSyxHQUFJRixTQUFULEdBQXFCZCxNQUFyQixDQUE0QjtBQUMxQixHQUFJZSxPQUFRZixNQUFNYyxRQUFOLENBQVo7QUFDQSxHQUFJLENBQUNxQixhQUFhcEIsS0FBYixDQUFMLENBQTBCO0FBQ3hCO0FBQ0Q7O0FBRUQsR0FBSXJDLGlCQUFpQm9DLFFBQWpCLENBQUosQ0FBZ0M7QUFDOUI2QixtQkFBbUIzQyxLQUFuQixDQUEwQmdCLE1BQTFCO0FBQ0Q7O0FBRUQsR0FBSTNDLGNBQWN5QyxRQUFkLENBQUosQ0FBNkI7QUFDM0JnQixvQkFBb0JoQixRQUFwQixDQUE4QkMsS0FBOUIsQ0FBcUNDLE1BQXJDO0FBQ0QsQ0FGRCxJQUVPLElBQUk1QixrQkFBa0IwQixRQUFsQixDQUFKLENBQWlDO0FBQ3RDRCxpQkFBaUJDLFFBQWpCLENBQTJCQyxLQUEzQixDQUFrQ0MsTUFBbEM7QUFDQSxHQUFJRixXQUFhLE1BQWpCLENBQXlCO0FBQ3ZCZSxxQkFBcUI3QixLQUFyQixDQUE0QmdCLE1BQTVCO0FBQ0Q7QUFDRixDQUxNLElBS0E7QUFDTEQsTUFBUXNCLG9CQUFvQnRCLEtBQXBCLENBQTJCRCxRQUEzQixDQUFSO0FBQ0FBLFNBQVcsb0NBQXNCQSxRQUF0QixDQUFYO0FBQ0FFLE9BQU9GLFFBQVAsRUFBbUJDLEtBQW5CO0FBQ0Q7QUFDRjs7QUFFRCxNQUFPQyxPQUFQO0FBQ0Q7O0FBRUQ4QixPQUFPQyxPQUFQLENBQWlCRixnQkFBakIiLCJmaWxlIjoiZXh0ZW5kUHJvcGVydGllcy53ZWIuanMiLCJzb3VyY2VzQ29udGVudCI6WyIvKipcbiAqIENvcHlyaWdodCAoYykgMjAxNS1wcmVzZW50LCBBbGliYWJhIEdyb3VwIEhvbGRpbmcgTGltaXRlZC5cbiAqIEFsbCByaWdodHMgcmVzZXJ2ZWQuXG4gKlxuICovXG4ndXNlIHN0cmljdCc7XG5cbmltcG9ydCBnZXRWZW5kb3JQcm9wZXJ0eU5hbWUgZnJvbSAnZG9ta2l0L2dldFZlbmRvclByb3BlcnR5TmFtZSc7XG5pbXBvcnQgQ1NTUHJvcGVydHkgZnJvbSAnQ1NTUHJvcGVydHknO1xuXG52YXIgc2hvcnRoYW5kUHJvcGVydGllcyA9IHtcbiAgbWFyZ2luOiB0cnVlLFxuICBwYWRkaW5nOiB0cnVlLFxuICBib3JkZXJXaWR0aDogdHJ1ZSxcbiAgYm9yZGVyUmFkaXVzOiB0cnVlLFxufTtcblxuLy8gc29tZSBudW1iZXIgdGhhdCByZWFjdCBub3QgYXV0byBhZGQgcHhcbnZhciBudW1iZXJQcm9wZXJ0aWVzID0ge1xuICBsaW5lSGVpZ2h0OiB0cnVlXG59O1xuXG52YXIgYm94UHJvcGVydGllcyA9IHtcbiAgcGFkZGluZ0hvcml6b250YWw6IHRydWUsXG4gIHBhZGRpbmdWZXJ0aWNhbDogdHJ1ZSxcbiAgbWFyZ2luSG9yaXpvbnRhbDogdHJ1ZSxcbiAgbWFyZ2luVmVydGljYWw6IHRydWUsXG59O1xuXG52YXIgYm9yZGVyUHJvcGVydGllcyA9IHtcbiAgYm9yZGVyQ29sb3I6IHRydWUsXG4gIGJvcmRlcldpZHRoOiB0cnVlLFxuICBib3JkZXJUb3BDb2xvcjogdHJ1ZSxcbiAgYm9yZGVyUmlnaHRDb2xvcjogdHJ1ZSxcbiAgYm9yZGVyQm90dG9tQ29sb3I6IHRydWUsXG4gIGJvcmRlckxlZnRDb2xvcjogdHJ1ZSxcbiAgYm9yZGVyVG9wV2lkdGg6IHRydWUsXG4gIGJvcmRlclJpZ2h0V2lkdGg6IHRydWUsXG4gIGJvcmRlckJvdHRvbVdpZHRoOiB0cnVlLFxuICBib3JkZXJMZWZ0V2lkdGg6IHRydWUsXG59O1xuXG4vLyBwcmVmaXggMjAwOSBzcGVjXG52YXIgZmxleGJveFByb3BlcnRpZXMgPSB7XG4gIGZsZXg6ICdXZWJraXRCb3hGbGV4JyxcbiAgb3JkZXI6ICdXZWJraXRCb3hPcmRpbmFsR3JvdXAnLFxuICAvLyBodHRwczovL2dpdGh1Yi5jb20vcG9zdGNzcy9hdXRvcHJlZml4ZXIvYmxvYi9tYXN0ZXIvbGliL2hhY2tzL2ZsZXgtZGlyZWN0aW9uLmNvZmZlZVxuICBmbGV4RGlyZWN0aW9uOiAnV2Via2l0Qm94T3JpZW50JyxcbiAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3Bvc3Rjc3MvYXV0b3ByZWZpeGVyL2Jsb2IvbWFzdGVyL2xpYi9oYWNrcy9hbGlnbi1pdGVtcy5jb2ZmZWVcbiAgYWxpZ25JdGVtczogJ1dlYmtpdEJveEFsaWduJyxcbiAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3Bvc3Rjc3MvYXV0b3ByZWZpeGVyL2Jsb2IvbWFzdGVyL2xpYi9oYWNrcy9qdXN0aWZ5LWNvbnRlbnQuY29mZmVlXG4gIGp1c3RpZnlDb250ZW50OiAnV2Via2l0Qm94UGFjaycsXG4gIGZsZXhXcmFwOiBudWxsLFxuICBhbGlnblNlbGY6IG51bGwsXG59O1xuXG52YXIgb2xkRmxleGJveFZhbHVlcyA9IHtcbiAgJ2ZsZXgtZW5kJzogJ2VuZCcsXG4gICdmbGV4LXN0YXJ0JzogJ3N0YXJ0JyxcbiAgJ3NwYWNlLWJldHdlZW4nOiAnanVzdGlmeScsXG4gICdzcGFjZS1hcm91bmQnOiAnZGlzdHJpYnV0ZScsXG59O1xuXG52YXIgYnVpbHRpblN0eWxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnZGl2Jykuc3R5bGU7XG52YXIgZmxleGJveFNwZWM7XG5pZiAoJ2FsaWduU2VsZicgaW4gYnVpbHRpblN0eWxlKSBmbGV4Ym94U3BlYyA9ICdmaW5hbCc7XG5lbHNlIGlmICgnd2Via2l0QWxpZ25TZWxmJyBpbiBidWlsdGluU3R5bGUpIGZsZXhib3hTcGVjID0gJ2ZpbmFsVmVuZG9yJztcbmVsc2UgZmxleGJveFNwZWMgPSAnMjAwOSc7XG5cbi8vIEZJWE1FOiBVQ0Jyb3dzZXIgaXMgY2hlYXRcbnZhciBpc1VDQnJvd3NlciA9IC9VQ0Jyb3dzZXIvaS50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpO1xuaWYgKGlzVUNCcm93c2VyKSBmbGV4Ym94U3BlYyA9ICcyMDA5JztcblxuY29uc3QgaXNJRSA9IC9UcmlkZW50L2kudGVzdChuYXZpZ2F0b3IudXNlckFnZW50KTtcbmNvbnN0IGlzU2FmYXJpID1cbiAgbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCdTYWZhcmknKSAhPT0gLTEgJiZcbiAgbmF2aWdhdG9yLnVzZXJBZ2VudC5pbmRleE9mKCdDaHJvbWUnKSA9PT0gLTFcblxuY29uc3QgRkxFWF9BVVRPID0gJzEgMSBhdXRvJ1xuY29uc3QgRkxFWF9JTklUSUFMID0gJzAgMSBhdXRvJ1xuY29uc3QgREVGQVVMVF9CQVNJUyA9IGlzSUUgfHwgaXNTYWZhcmkgPyAnYXV0bycgOiAnMCUnXG5jb25zdCBERUZBVUxUX1NIUklOSyA9IGlzU2FmYXJpID8gJzAnIDogJzEnXG5cbi8vIFRPRE86IGNhY2hlIHRoZSByZXN1bHRcbmZ1bmN0aW9uIHByZWZpeE9sZEZsZXhib3gocHJvcGVydHksIHZhbHVlLCByZXN1bHQpIHtcblxuICBpZiAoZmxleGJveFNwZWMgPT09ICcyMDA5Jykge1xuICAgIHZhciBvbGRWYWx1ZSA9IG9sZEZsZXhib3hWYWx1ZXNbdmFsdWVdIHx8IHZhbHVlO1xuICAgIHZhciBvbGRQcm9wZXJ0eSA9IGZsZXhib3hQcm9wZXJ0aWVzW3Byb3BlcnR5XSB8fCBwcm9wZXJ0eTtcbiAgICBpZiAob2xkUHJvcGVydHkgPT09ICdXZWJraXRCb3hPcmllbnQnKSB7XG4gICAgICAvLyBib3hPcmllbnRcbiAgICAgIGlmICh2YWx1ZS5pbmRleE9mKCdyb3cnKSAhPSAtMSkge1xuICAgICAgICBvbGRWYWx1ZSA9ICdob3Jpem9udGFsJztcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIG9sZFZhbHVlID0gJ3ZlcnRpY2FsJztcbiAgICAgIH1cbiAgICAgIC8vIGJveERpcmVjdGlvblxuICAgICAgdmFyIGRpciA9ICcnO1xuICAgICAgaWYgKHZhbHVlLmluZGV4T2YoJ3JldmVyc2UnKSAhPSAtMSkge1xuICAgICAgICBkaXIgPSAncmV2ZXJzZSc7XG4gICAgICB9IGVsc2Uge1xuICAgICAgICBkaXIgPSAnbm9ybWFsJztcbiAgICAgIH1cbiAgICAgIHJlc3VsdC5XZWJraXRCb3hEaXJlY3Rpb24gPSBkaXI7XG4gICAgfVxuICAgIHJldHVybiByZXN1bHRbb2xkUHJvcGVydHldID0gb2xkVmFsdWU7XG5cbiAgfSBlbHNlIGlmIChmbGV4Ym94U3BlYyA9PT0gJ2ZpbmFsVmVuZG9yJykge1xuICAgIHJldHVybiByZXN1bHRbZ2V0VmVuZG9yUHJvcGVydHlOYW1lKHByb3BlcnR5KV0gPSB2YWx1ZTtcblxuICB9IGVsc2Uge1xuICAgIHJldHVybiByZXN1bHRbcHJvcGVydHldID0gdmFsdWU7XG5cbiAgfVxufVxuXG4vLyBodHRwczovL2dpdGh1Yi5jb20vcGhpbGlwd2FsdG9uL2ZsZXhidWdzXG4vLyAgICAgRGVjbGFyYXRpb24gICAgICAgICAgIFdoYXQgaXQgc2hvdWxkIG1lYW4gICAgIFdoYXQgaXQgbWVhbnMgaW4gSUUgMTBcbi8vIDEuICAobm8gZmxleCBkZWNsYXJhdGlvbikgZmxleDogMCAxIGF1dG8gICAgICAgICAgZmxleDogMCAwIGF1dG9cbi8vIDIuICBmbGV4OiAxICAgICAgICAgICAgICAgZmxleDogMSAxIDAlICAgICAgICAgICAgZmxleDogMSAwIDBweFxuLy8gMy4gIGZsZXg6IGF1dG8gICAgICAgICAgICBmbGV4OiAxIDEgYXV0byAgICAgICAgICBmbGV4OiAxIDAgYXV0b1xuLy8gNC4gIGZsZXg6IGluaXRpYWwgICAgICAgICBmbGV4OiAwIDEgYXV0byAgICAgICAgICBmbGV4OiAwIDAgYXV0b1xuXG5mdW5jdGlvbiBnZXRGbGV4RXhwYW5zaW9uIChzdHlsZSkge1xuICAvLyBodHRwczovL3JvbGFuZC5jb2Rlcy9ibG9nL2llLWZsZXgtY29sbGFwc2UtYnVnL1xuICBjb25zdCBmbGV4ID0gc3R5bGUuZmxleFxuICBpZiAoZmxleCA9PSBudWxsKSB7XG4gICAgaWYgKHN0eWxlLmZsZXhHcm93ID09IG51bGwgJiYgc3R5bGUuZmxleFNocmluayA9PSBudWxsICYmIHN0eWxlLmZsZXhCYXNpcyA9PSBudWxsKSB7XG4gICAgICByZXR1cm4gRkxFWF9JTklUSUFMXG4gICAgfVxuXG4gICAgLy8gXiBsaW5lIDFcbiAgICBjb25zdCBncm93ID0gc3R5bGUuZmxleEdyb3cgfHwgJzAnXG4gICAgY29uc3Qgc2hyaW5rID0gc3R5bGUuZmxleFNocmluayB8fCBERUZBVUxUX1NIUklOS1xuICAgIGNvbnN0IGJhc2lzID0gc3R5bGUuZmxleEJhc2lzIHx8IERFRkFVTFRfQkFTSVNcbiAgICByZXR1cm4gYCR7Z3Jvd30gJHtzaHJpbmt9ICR7YmFzaXN9YFxuICB9XG5cbiAgLy8gXiBsaW5lIDJcbiAgLy8gaWYgZmxleCBpcyBhIG51bWJlciBvciBhIHN0cmluZ2lmaWVkIG51bWJlclxuICBpZiAoIWlzTmFOKGZsZXgpKSB7XG4gICAgcmV0dXJuIGAke2ZsZXh9ICR7REVGQVVMVF9TSFJJTkt9ICR7REVGQVVMVF9CQVNJU31gXG4gIH1cblxuICAvLyBeIGxpbmVzIDMsIDRcbiAgaWYgKGZsZXggPT09ICdhdXRvJykge1xuICAgIHJldHVybiBGTEVYX0FVVE9cbiAgfSBlbHNlIGlmIChmbGV4ID09PSAnaW5pdGlhbCcpIHtcbiAgICByZXR1cm4gRkxFWF9JTklUSUFMXG4gIH1cblxuICAvLyBmbGV4IHdhcyBzZXQgZXhwbGljaXRseVxuICByZXR1cm4gZmxleFxufVxuXG5mdW5jdGlvbiBkZWZhdWx0RmxleEV4cGFuc2lvbiAoc3R5bGUsIHJlc3VsdCkge1xuICByZXN1bHQuZmxleCA9IGdldEZsZXhFeHBhbnNpb24oc3R5bGUpXG59XG5cbmZ1bmN0aW9uIGV4dGVuZEJveFByb3BlcnRpZXMocHJvcGVydHksIHZhbHVlLCByZXN1bHQpIHtcbiAgdmFyIHBhZGRpbmcgPSAncGFkZGluZyc7XG4gIHZhciBtYXJnaW4gPSAnbWFyZ2luJztcbiAgdmFyIGhvcml6b250YWwgPSAnSG9yaXpvbnRhbCc7XG4gIHZhciB2ZXJ0aWNhbCA9ICdWZXJ0aWNhbCc7XG4gIHZhciB0eXBlID0gcHJvcGVydHkuaW5kZXhPZihtYXJnaW4pID09IDAgPyBtYXJnaW4gOiBwYWRkaW5nO1xuICB2YXIgZGlyZWN0aW9uVHlwZSA9IHByb3BlcnR5LmluZGV4T2YodmVydGljYWwpICE9PSAtMSA/IHZlcnRpY2FsIDogaG9yaXpvbnRhbDtcblxuICBpZiAoZGlyZWN0aW9uVHlwZSA9PSBob3Jpem9udGFsKSB7XG4gICAgcmVzdWx0W3R5cGUgKyAnTGVmdCddID0gcmVzdWx0W3R5cGUgKyAnUmlnaHQnXSA9IHZhbHVlO1xuICB9IGVsc2UgaWYgKGRpcmVjdGlvblR5cGUgPT0gdmVydGljYWwpIHtcbiAgICByZXN1bHRbdHlwZSArICdUb3AnXSA9IHJlc3VsdFt0eXBlICsgJ0JvdHRvbSddID0gdmFsdWU7XG4gIH1cbn1cblxuZnVuY3Rpb24gaXNWYWxpZFZhbHVlKHZhbHVlKSB7XG4gIHJldHVybiB2YWx1ZSAhPT0gJycgJiYgdmFsdWUgIT09IG51bGwgJiYgdmFsdWUgIT09IHVuZGVmaW5lZDtcbn1cblxuZnVuY3Rpb24gcHJvY2Vzc1ZhbHVlRm9yUHJvcCh2YWx1ZSwgcHJvcCkge1xuXG4gIGlmICh0eXBlb2YgdmFsdWUgPT0gJ251bWJlcicpIHtcbiAgICAvLyB0cmFuc2Zvcm0gbGVzcyB0aGVuIDFweCB2YWx1ZSB0byAxcHgsIDAuNSB0byBiZSAxXG4gICAgaWYgKCFDU1NQcm9wZXJ0eS5pc1VuaXRsZXNzTnVtYmVyW3Byb3BdICYmIHZhbHVlID4gMCAmJiB2YWx1ZSA8IDEpIHtcbiAgICAgIHZhbHVlID0gMTtcbiAgICB9XG5cbiAgICAvLyBBZGQgcHggdG8gbnVtZXJpYyB2YWx1ZXNcbiAgICBpZiAobnVtYmVyUHJvcGVydGllc1twcm9wXSAmJiB0eXBlb2YgdmFsdWUgPT0gJ251bWJlcicpIHtcbiAgICAgIHZhbHVlICs9ICdweCc7XG4gICAgfVxuICB9XG5cbiAgLy8gW1xuICAvLyAgIHtzY2FsZVg6IDJ9LFxuICAvLyAgIHtzY2FsZVk6IDJ9XG4gIC8vIF0gPT4gc2NhbGVYKDIpIHNjYWxlWSgyKVxuXG4gIGlmIChzaG9ydGhhbmRQcm9wZXJ0aWVzW3Byb3BdICYmIHR5cGVvZiB2YWx1ZSA9PSAnc3RyaW5nJykge1xuICAgIHZhbHVlID0gdmFsdWUucmVwbGFjZSgvXFxkKlxcLj9cXGQrKHJlbXxlbXxpbnxjbXxtbXxwdHxwY3xweHx2aHx2d3x2bWlufHZtYXh8JSkqL2csIGZ1bmN0aW9uKHZhbCwgdW5pdCkge1xuICAgICAgcmV0dXJuIHVuaXQgPyB2YWwgOiB2YWwgKyAncHgnO1xuICAgIH0pO1xuICB9XG5cbiAgcmV0dXJuIHZhbHVlO1xufVxuXG5mdW5jdGlvbiBkZWZhdWx0Qm9yZGVyU3R5bGUoc3R5bGUsIHJlc3VsdCkge1xuICBpZiAoIXN0eWxlLmJvcmRlclN0eWxlICYmICFyZXN1bHQuYm9yZGVyU3R5bGUpIHtcbiAgICByZXN1bHQuYm9yZGVyU3R5bGUgPSAnc29saWQnO1xuICB9XG5cbiAgaWYgKCFzdHlsZS5ib3JkZXJXaWR0aCAmJiAhcmVzdWx0LmJvcmRlcldpZHRoKSB7XG4gICAgcmVzdWx0LmJvcmRlcldpZHRoID0gMDtcbiAgfVxuXG4gIGlmICghc3R5bGUuYm9yZGVyQ29sb3IgJiYgIXJlc3VsdC5ib3JkZXJDb2xvcikge1xuICAgIHJlc3VsdC5ib3JkZXJDb2xvciA9ICdibGFjayc7XG4gIH1cbn1cblxuZnVuY3Rpb24gZXh0ZW5kUHJvcGVydGllcyhzdHlsZSkge1xuICB2YXIgcmVzdWx0ID0ge307XG5cbiAgZm9yICh2YXIgcHJvcGVydHkgaW4gc3R5bGUpIHtcbiAgICB2YXIgdmFsdWUgPSBzdHlsZVtwcm9wZXJ0eV07XG4gICAgaWYgKCFpc1ZhbGlkVmFsdWUodmFsdWUpKSB7XG4gICAgICBjb250aW51ZTtcbiAgICB9XG4gICAgLy8gc2V0IGEgZGVmYXVsdCBib3JkZXIgc3R5bGUgaWYgdGhlcmUgaGFzIGJvcmRlciBhYm91dCBwcm9wZXJ0eVxuICAgIGlmIChib3JkZXJQcm9wZXJ0aWVzW3Byb3BlcnR5XSkge1xuICAgICAgZGVmYXVsdEJvcmRlclN0eWxlKHN0eWxlLCByZXN1bHQpO1xuICAgIH1cblxuICAgIGlmIChib3hQcm9wZXJ0aWVzW3Byb3BlcnR5XSkge1xuICAgICAgZXh0ZW5kQm94UHJvcGVydGllcyhwcm9wZXJ0eSwgdmFsdWUsIHJlc3VsdCk7XG4gICAgfSBlbHNlIGlmIChmbGV4Ym94UHJvcGVydGllc1twcm9wZXJ0eV0pIHtcbiAgICAgIHByZWZpeE9sZEZsZXhib3gocHJvcGVydHksIHZhbHVlLCByZXN1bHQpO1xuICAgICAgaWYgKHByb3BlcnR5ID09PSAnZmxleCcpIHtcbiAgICAgICAgZGVmYXVsdEZsZXhFeHBhbnNpb24oc3R5bGUsIHJlc3VsdCk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIHZhbHVlID0gcHJvY2Vzc1ZhbHVlRm9yUHJvcCh2YWx1ZSwgcHJvcGVydHkpO1xuICAgICAgcHJvcGVydHkgPSBnZXRWZW5kb3JQcm9wZXJ0eU5hbWUocHJvcGVydHkpO1xuICAgICAgcmVzdWx0W3Byb3BlcnR5XSA9IHZhbHVlO1xuICAgIH1cbiAgfVxuXG4gIHJldHVybiByZXN1bHQ7XG59XG5cbm1vZHVsZS5leHBvcnRzID0gZXh0ZW5kUHJvcGVydGllcztcbiJdfQ==